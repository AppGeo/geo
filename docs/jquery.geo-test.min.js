document.createElement("canvas").getContext||function(){function e(){return this.context_||(this.context_=new s(this))}function r(h,m){var q=J.call(arguments,2);return function(){return h.apply(m,q.concat(J.call(arguments)))}}function p(h){h.namespaces.g_vml_||h.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");h.namespaces.g_o_||h.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!h.styleSheets.ex_canvas_){h=h.createStyleSheet();h.owningElement.id=
"ex_canvas_";h.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function a(h){var m=h.srcElement;switch(h.propertyName){case "width":m.getContext().clearRect();m.style.width=m.attributes.width.nodeValue+"px";m.firstChild.style.width=m.clientWidth+"px";break;case "height":m.getContext().clearRect();m.style.height=m.attributes.height.nodeValue+"px";m.firstChild.style.height=m.clientHeight+"px"}}function c(h){h=h.srcElement;if(h.firstChild){h.firstChild.style.width=
h.clientWidth+"px";h.firstChild.style.height=h.clientHeight+"px"}}function b(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(h,m){for(var q=b(),w=0;w<3;w++)for(var z=0;z<3;z++){for(var x=0,L=0;L<3;L++)x+=h[w][L]*m[L][z];q[w][z]=x}return q}function g(h,m){m.fillStyle=h.fillStyle;m.lineCap=h.lineCap;m.lineJoin=h.lineJoin;m.lineWidth=h.lineWidth;m.miterLimit=h.miterLimit;m.shadowBlur=h.shadowBlur;m.shadowColor=h.shadowColor;m.shadowOffsetX=h.shadowOffsetX;m.shadowOffsetY=h.shadowOffsetY;m.strokeStyle=h.strokeStyle;
m.globalAlpha=h.globalAlpha;m.font=h.font;m.textAlign=h.textAlign;m.textBaseline=h.textBaseline;m.arcScaleX_=h.arcScaleX_;m.arcScaleY_=h.arcScaleY_;m.lineScale_=h.lineScale_}function f(h){var m=h.indexOf("(",3),q=h.indexOf(")",m+1);m=h.substring(m+1,q).split(",");if(m.length!=4||h.charAt(3)!="a")m[3]=1;return m}function n(h,m,q){return Math.min(q,Math.max(m,h))}function l(h,m,q){q<0&&q++;q>1&&q--;return 6*q<1?h+(m-h)*6*q:2*q<1?m:3*q<2?h+(m-h)*(2/3-q)*6:h}function o(h){if(h in N)return N[h];var m,
q=1;h=String(h);if(h.charAt(0)=="#")m=h;else if(/^rgb/.test(h)){q=f(h);m="#";for(var w,z=0;z<3;z++){w=q[z].indexOf("%")!=-1?Math.floor(parseFloat(q[z])/100*255):+q[z];m+=K[n(w,0,255)]}q=+q[3]}else if(/^hsl/.test(h)){z=q=f(h);m=parseFloat(z[0])/360%360;m<0&&m++;w=n(parseFloat(z[1])/100,0,1);z=n(parseFloat(z[2])/100,0,1);if(w==0)w=z=m=z;else{var x=z<0.5?z*(1+w):z+w-z*w,L=2*z-x;w=l(L,x,m+1/3);z=l(L,x,m);m=l(L,x,m-1/3)}m="#"+K[Math.floor(w*255)]+K[Math.floor(z*255)]+K[Math.floor(m*255)];q=q[3]}else m=
h;return N[h]={color:m,alpha:q}}function s(h){this.m_=b();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=C*1;this.globalAlpha=1;this.canvas=h;var m="width:"+h.clientWidth+"px;height:"+h.clientHeight+"px;overflow:hidden;position:absolute",q=h.ownerDocument.createElement("div");q.style.cssText=m;h.appendChild(q);m=q.cloneNode(false);m.style.backgroundColor="red";m.style.filter="alpha(opacity=0)";
h.appendChild(m);this.element_=q;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1}function u(h,m,q,w){h.currentPath_.push({type:"bezierCurveTo",cp1x:m.x,cp1y:m.y,cp2x:q.x,cp2y:q.y,x:w.x,y:w.y});h.currentX_=w.x;h.currentY_=w.y}function t(h,m,q){h=h.m_;return{x:C*(m*h[0][0]+q*h[1][0]+h[2][0])-G,y:C*(m*h[0][1]+q*h[1][1]+h[2][1])-G}}function A(h,m,q){if(isFinite(m[0][0])&&isFinite(m[0][1])&&isFinite(m[1][0])&&isFinite(m[1][1])&&isFinite(m[2][0])&&isFinite(m[2][1])){h.m_=m;if(q)h.lineScale_=H(M(m[0][0]*
m[1][1]-m[0][1]*m[1][0]))}}function E(h){this.code=this[h];this.message=h+": DOM Exception "+this.code}var y=Math,B=y.round,D=y.sin,F=y.cos,M=y.abs,H=y.sqrt,C=10,G=C/2;navigator.userAgent.match(/MSIE ([\d.]+)?/);var J=Array.prototype.slice;p(document);y={init:function(h){h=h||document;h.createElement("canvas");h.attachEvent("onreadystatechange",r(this.init_,this,h))},init_:function(h){h=h.getElementsByTagName("canvas");for(var m=0;m<h.length;m++)this.initElement(h[m])},initElement:function(h){if(!h.getContext){h.getContext=
e;p(h.ownerDocument);h.innerHTML="";h.attachEvent("onpropertychange",a);h.attachEvent("onresize",c);var m=h.attributes;if(m.width&&m.width.specified)h.style.width=m.width.nodeValue+"px";else h.width=h.clientWidth;if(m.height&&m.height.specified)h.style.height=m.height.nodeValue+"px";else h.height=h.clientHeight}return h}};y.init();for(var K=[],v=0;v<16;v++)for(var I=0;I<16;I++)K[v*16+I]=v.toString(16)+I.toString(16);var N={},P={butt:"flat",round:"round"};v=s.prototype;v.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);
this.textMeasureEl_=null}this.element_.innerHTML=""};v.beginPath=function(){this.currentPath_=[]};v.moveTo=function(h,m){var q=t(this,h,m);this.currentPath_.push({type:"moveTo",x:q.x,y:q.y});this.currentX_=q.x;this.currentY_=q.y};v.lineTo=function(h,m){var q=t(this,h,m);this.currentPath_.push({type:"lineTo",x:q.x,y:q.y});this.currentX_=q.x;this.currentY_=q.y};v.bezierCurveTo=function(h,m,q,w,z,x){z=t(this,z,x);h=t(this,h,m);q=t(this,q,w);u(this,h,q,z)};v.quadraticCurveTo=function(h,m,q,w){h=t(this,
h,m);q=t(this,q,w);w={x:this.currentX_+2/3*(h.x-this.currentX_),y:this.currentY_+2/3*(h.y-this.currentY_)};u(this,w,{x:w.x+(q.x-this.currentX_)/3,y:w.y+(q.y-this.currentY_)/3},q)};v.arc=function(h,m,q,w,z,x){q*=C;var L=x?"at":"wa",O=h+F(w)*q-G,Q=m+D(w)*q-G;w=h+F(z)*q-G;z=m+D(z)*q-G;if(O==w&&!x)O+=0.125;h=t(this,h,m);O=t(this,O,Q);w=t(this,w,z);this.currentPath_.push({type:L,x:h.x,y:h.y,radius:q,xStart:O.x,yStart:O.y,xEnd:w.x,yEnd:w.y})};v.stroke=function(h){var m=[];m.push("<g_vml_:shape",' filled="',
!!h,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0,0"',' coordsize="',C*10,",",C*10,'"',' stroked="',!h,'"',' path="');for(var q={x:null,y:null},w={x:null,y:null},z=0;z<this.currentPath_.length;z++){var x=this.currentPath_[z];switch(x.type){case "moveTo":m.push(" m ",B(x.x),",",B(x.y));break;case "lineTo":m.push(" l ",B(x.x),",",B(x.y));break;case "close":m.push(" x ");x=null;break;case "bezierCurveTo":m.push(" c ",B(x.cp1x),",",B(x.cp1y),",",B(x.cp2x),",",B(x.cp2y),
",",B(x.x),",",B(x.y));break;case "at":case "wa":m.push(" ",x.type," ",B(x.x-this.arcScaleX_*x.radius),",",B(x.y-this.arcScaleY_*x.radius)," ",B(x.x+this.arcScaleX_*x.radius),",",B(x.y+this.arcScaleY_*x.radius)," ",B(x.xStart),",",B(x.yStart)," ",B(x.xEnd),",",B(x.yEnd))}if(x){if(q.x==null||x.x<q.x)q.x=x.x;if(w.x==null||x.x>w.x)w.x=x.x;if(q.y==null||x.y<q.y)q.y=x.y;if(w.y==null||x.y>w.y)w.y=x.y}}m.push(' ">');if(h){h=o(this.fillStyle);m.push('<g_vml_:fill color="',h.color,'" opacity="',h.alpha*this.globalAlpha,
'" />')}else{q=o(this.strokeStyle);h=q.color;q=q.alpha*this.globalAlpha;w=this.lineScale_*this.lineWidth;if(w<1)q*=w;m.push("<g_vml_:stroke",' opacity="',q,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',P[this.lineCap]||"square",'"',' weight="',w,'px"',' color="',h,'" />')}m.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",m.join(""))};v.fill=function(){this.stroke(true)};v.closePath=function(){this.currentPath_.push({type:"close"})};v.save=
function(){var h={};g(this,h);this.aStack_.push(h);this.mStack_.push(this.m_);this.m_=d(b(),this.m_)};v.restore=function(){if(this.aStack_.length){g(this.aStack_.pop(),this);this.m_=this.mStack_.pop()}};v.translate=function(h,m){A(this,d([[1,0,0],[0,1,0],[h,m,1]],this.m_),false)};v.scale=function(h,m){this.arcScaleX_*=h;this.arcScaleY_*=m;A(this,d([[h,0,0],[0,m,0],[0,0,1]],this.m_),true)};v=E.prototype=Error();v.INDEX_SIZE_ERR=1;v.DOMSTRING_SIZE_ERR=2;v.HIERARCHY_REQUEST_ERR=3;v.WRONG_DOCUMENT_ERR=
4;v.INVALID_CHARACTER_ERR=5;v.NO_DATA_ALLOWED_ERR=6;v.NO_MODIFICATION_ALLOWED_ERR=7;v.NOT_FOUND_ERR=8;v.NOT_SUPPORTED_ERR=9;v.INUSE_ATTRIBUTE_ERR=10;v.INVALID_STATE_ERR=11;v.SYNTAX_ERR=12;v.INVALID_MODIFICATION_ERR=13;v.NAMESPACE_ERR=14;v.INVALID_ACCESS_ERR=15;v.VALIDATION_ERR=16;v.TYPE_MISMATCH_ERR=17;G_vmlCanvasManager=y;CanvasRenderingContext2D=s;DOMException=E}();
(function(e){function r(a){var c=[].slice.call(arguments,1),b=0;a=e.event.fix(a||window.event);a.type="mousewheel";if(a.wheelDelta)b=a.wheelDelta/120;if(a.detail)b=-a.detail/3;c.unshift(a,b);return e.event.handle.apply(this,c)}var p=["DOMMouseScroll","mousewheel"];e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=p.length;a;)this.addEventListener(p[--a],r,false);else this.onmousewheel=r},teardown:function(){if(this.removeEventListener)for(var a=p.length;a;)this.removeEventListener(p[--a],
r,false);else this.onmousewheel=null}};e.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);
$.widget||function(e,r){var p=Array.prototype.slice,a=e.cleanData;e.cleanData=function(c){for(var b=0,d;(d=c[b])!=null;b++)e(d).triggerHandler("remove");a(c)};e.widget=function(c,b,d){var g=c.split(".")[0],f;c=c.split(".")[1];f=g+"-"+c;if(!d){d=b;b=e.Widget}e.expr[":"][f]=function(l){return!!e.data(l,c)};e[g]=e[g]||{};e[g][c]=e.extend(function(l,o){if(!this._createWidget)return new e[g][c](l,o);arguments.length&&this._createWidget(l,o)},e[g][c]);var n=new b;n.options=e.extend(true,{},n.options);e.each(d,
function(l,o){if(e.isFunction(o))d[l]=function(){var s=function(t){return b.prototype[t].apply(this,p.call(arguments,1))},u=function(t,A){return b.prototype[t].apply(this,A)};return function(){var t=this._super,A=this._superApply,E;this._super=s;this._superApply=u;E=o.apply(this,arguments);this._super=t;this._superApply=A;return E}}()});e[g][c].prototype=e.extend(true,n,{namespace:g,widgetName:c,widgetEventPrefix:c,widgetBaseClass:f},d);e.widget.bridge(c,e[g][c])};e.widget.bridge=function(c,b){e.fn[c]=
function(d){var g=typeof d==="string",f=p.call(arguments,1),n=this;d=!g&&f.length?e.extend.apply(null,[true,d].concat(f)):d;g?this.each(function(){var l=e.data(this,c);if(!l)return e.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+d+"'");if(!e.isFunction(l[d])||d.charAt(0)==="_")return e.error("no such method '"+d+"' for "+c+" widget instance");var o=l[d].apply(l,f);if(o!==l&&o!==r){n=o;return false}}):this.each(function(){var l=e.data(this,c);l?l.option(d||
{})._init():b(d,this)});return n}};e.Widget=function(c,b){if(!this._createWidget)return new e[namespace][name](c,b);arguments.length&&this._createWidget(c,b)};e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false},_createWidget:function(c,b){b=e(b||this.defaultElement||this)[0];this.element=e(b);this.options=e.extend(true,{},this.options,this._getCreateOptions(),c);this.bindings=e();this.hoverable=e();this.focusable=e();if(b!==this){e.data(b,this.widgetName,
this);this._bind({remove:"destroy"})}this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:e.noop,_init:e.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");
this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(c,b){var d=c;if(arguments.length===0)return e.extend({},this.options);if(typeof c==="string"){if(b===r)return this.options[c];d={};d[c]=b}this._setOptions(d);return this},_setOptions:function(c){var b=this;e.each(c,function(d,g){b._setOption(d,g)});return this},_setOption:function(c,b){this.options[c]=b;if(c==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",
!!b).attr("aria-disabled",b);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_bind:function(c,b){if(b){c=e(c);this.bindings=this.bindings.add(c)}else{b=c;c=this.element}var d=this;e.each(b,function(g,f){c.bind(g+"."+d.widgetName,function(){if(!(d.options.disabled===true||e(this).hasClass("ui-state-disabled")))return(typeof f===
"string"?d[f]:f).apply(d,arguments)})})},_hoverable:function(c){this.hoverable=this.hoverable.add(c);this._bind(c,{mouseenter:function(b){e(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){e(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(c){this.focusable=this.focusable.add(c);this._bind(c,{focusin:function(b){e(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){e(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(c,b,d){var g=
this.options[c];b=e.Event(b);b.type=(c===this.widgetEventPrefix?c:this.widgetEventPrefix+c).toLowerCase();d=d||{};if(b.originalEvent){c=e.event.props.length;for(var f;c;){f=e.event.props[--c];b[f]=b.originalEvent[f]}}this.element.trigger(b,d);d=e.isArray(d)?[b].concat(d):[b,d];return!(e.isFunction(g)&&g.apply(this.element[0],d)===false||b.isDefaultPrevented())}}}(jQuery);
(function(e,r,p){var a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;e.geo={_allCoordinates:function(b){b=this._flatten(b);for(var d=0,g=[];d<b.length;d++){var f=b[d].coordinates,n=f&&e.isArray(f[0]),l=n&&e.isArray(f[0][0]),o;if(!(l&&e.isArray(f[0][0][0]))){if(!l){n||(f=[f]);f=[f]}f=[f]}for(n=0;n<f.length;n++)for(l=0;l<f[n].length;l++)for(o=0;o<f[n][l].length;o++)g.push(f[n][l][o])}return g},center:function(b,d){if(!d&&e.geo.proj)b=e.geo.proj.fromGeodetic(b);var g=[(b[0]+b[2])/2,(b[1]+b[3])/
2];return!d&&e.geo.proj?e.geo.proj.toGeodetic(g):g},expandBy:function(b,d,g){if(e.geo.proj)b=e.geo.proj.fromGeodetic(b);b=[b[0]-d,b[1]-g,b[2]+d,b[3]+g];return e.geo.proj?e.geo.proj.toGeodetic(b):b},height:function(b,d){if(!d&&e.geo.proj)b=e.geo.proj.fromGeodetic(b);return b[3]-b[1]},_in:function(b,d){return b[0]<=d[0]&&b[1]<=d[1]&&b[2]>=d[2]&&b[3]>=d[3]},_bboxDisjoint:function(b,d){return d[0]>b[2]||d[2]<b[0]||d[1]>b[3]||d[3]<b[1]},reaspect:function(b,d,g){if(!g&&e.geo.proj)b=e.geo.proj.fromGeodetic(b);
var f=this.width(b,true),n=this.height(b,true);g=this.center(b,true);if(f!=0&&n!=0&&d>0){if(f/n>d){b=f/2;f=b/d}else{f=n/2;b=f*d}b=[g[0]-b,g[1]-f,g[0]+b,g[1]+f]}return e.geo.proj?e.geo.proj.toGeodetic(b):b},scaleBy:function(b,d,g){if(!g&&e.geo.proj)b=e.geo.proj.fromGeodetic(b);var f=this.center(b,true),n=(b[2]-b[0])*d/2;b=(b[3]-b[1])*d/2;b=[f[0]-n,f[1]-b,f[0]+n,f[1]+b];return!g&&e.geo.proj?e.geo.proj.toGeodetic(b):b},width:function(b,d){if(!d&&e.geo.proj)b=e.geo.proj.fromGeodetic(b);return b[2]-b[0]},
bbox:function(b,d){if(b)if(b.bbox)result=!d&&e.geo.proj?e.geo.proj.fromGeodetic(b.bbox):b.bbox;else{result=[a,a,c,c];var g=this._allCoordinates(b),f=0;if(g.length==0)return p;if(e.geo.proj)g=e.geo.proj.fromGeodetic(g);for(;f<g.length;f++){result[0]=Math.min(g[f][0],result[0]);result[1]=Math.min(g[f][1],result[1]);result[2]=Math.max(g[f][0],result[2]);result[3]=Math.max(g[f][1],result[3])}}else return p;return e.geo.proj?e.geo.proj.toGeodetic(result):result},centroid:function(b,d){switch(b.type){case "Point":return e.extend({},
b);case "LineString":case "Polygon":var g=0,f=[0,0],n=e.merge([],b.type=="Polygon"?b.coordinates[0]:b.coordinates),l=1,o,s;if(!d&&e.geo.proj)n=e.geo.proj.fromGeodetic(n);for(;l<=n.length;l++){o=l%n.length;s=n[l-1][0]*n[o][1]-n[o][0]*n[l-1][1];g+=s;f[0]+=(n[l-1][0]+n[o][0])*s;f[1]+=(n[l-1][1]+n[o][1])*s}if(g==0)if(n.length>0){f[0]=n[0][0];f[1]=n[0][1];return{type:"Point",coordinates:!d&&e.geo.proj?e.geo.proj.toGeodetic(f):f}}else break;g*=3;f[0]/=g;f[1]/=g;return{type:"Point",coordinates:!d&&e.geo.proj?
e.geo.proj.toGeodetic(f):f}}return p},contains:function(b,d){if(b.type!="Polygon")return false;switch(d.type){case "Point":return this._containsPolygonPoint(b.coordinates,d.coordinates);case "LineString":return this._containsPolygonLineString(b.coordinates,d.coordinates);case "Polygon":return this._containsPolygonLineString(b.coordinates,d.coordinates[0]);default:return false}},_containsPolygonPoint:function(b,d){if(b.length==0||b[0].length<4)return false;for(var g=0,f=b[0][0],n=1,l;n<b[0].length;n++){l=
b[0][n];if(f[1]<=d[1]&&d[1]<l[1]||l[1]<=d[1]&&d[1]<f[1]&&(d[0]<f[0]||d[0]<l[0])){f=f[0]+(l[0]-f[0])*(d[1]-f[1])/(l[1]-f[1]);f>d[0]&&g++}f=l}return g%2==1},_containsPolygonLineString:function(b,d){for(var g=0;g<d.length;g++)if(!this._containsPolygonPoint(b,d[g]))return false;return true},distance:function(b,d,g){var f=!g&&e.geo.proj?e.geo.proj.fromGeodetic(b.coordinates):b.coordinates;g=!g&&e.geo.proj?e.geo.proj.fromGeodetic(d.coordinates):d.coordinates;switch(b.type){case "Point":switch(d.type){case "Point":return this._distancePointPoint(g,
f);case "LineString":return this._distanceLineStringPoint(g,f);case "Polygon":return this._containsPolygonPoint(g,f)?0:this._distanceLineStringPoint(g[0],f);default:return p}case "LineString":switch(d.type){case "Point":return this._distanceLineStringPoint(f,g);case "LineString":return this._distanceLineStringLineString(f,g);case "Polygon":return this._containsPolygonLineString(g,f)?0:this._distanceLineStringLineString(g[0],f);default:return p}case "Polygon":switch(d.type){case "Point":return this._containsPolygonPoint(f,
g)?0:this._distanceLineStringPoint(f[0],g);case "LineString":return this._containsPolygonLineString(f,g)?0:this._distanceLineStringLineString(f[0],g);case "Polygon":return this._containsPolygonLineString(f,g[0])?0:this._distanceLineStringLineString(f[0],g[0]);default:return p}}},_distancePointPoint:function(b,d){var g=d[0]-b[0],f=d[1]-b[1];return Math.sqrt(g*g+f*f)},_distanceLineStringPoint:function(b,d){var g=a;if(b.length>0){var f=b[0],n=d[0]-f[0],l=d[1]-f[1];if(b.length==1)return Math.sqrt(n*n+
l*l);else for(var o=1;o<b.length;o++){var s=b[o],u=d[0]-s[0],t=d[1]-s[1];f=this._distanceSegmentPoint(s[0]-f[0],s[1]-f[1],n,l,u,t);if(f==0)return 0;if(f<g)g=f;f=s;n=u;l=t}}return Math.sqrt(g)},_distanceSegmentPoint:function(b,d,g,f,n,l){var o=b*g+d*f;if(o<=0)return g*g+f*f;b=b*b+d*d;if(o>=b)return n*n+l*l;return g*g+f*f-o*o/b},_distanceLineStringLineString:function(b,d){for(var g=a,f=0;f<d.length;f++)g=Math.min(g,this._distanceLineStringPoint(b,d[f]));return g},_flatten:function(b){var d=[],g=0;switch(b.type){case "Feature":e.merge(d,
this._flatten(b.geometry));break;case "FeatureCollection":for(;g<b.features.length;g++)e.merge(d,this._flatten(b.features[g].geometry));break;case "GeometryCollection":for(;g<b.geometries.length;g++)e.merge(d,this._flatten(b.geometries[g]));break;default:d[0]=b}return d},_WKT:function(){function b(f){if(f&&f.length){for(var n=[],l=0;l<f.length;l++)n.push(f[l].join(" "));return"("+n+")"}else return"EMPTY"}function d(f){if(f&&f.length){for(var n=[],l=0;l<f.length;l++)n.push(b(f[l]));return"("+n+")"}else return"EMTPY"}
function g(f){if(f&&f.type)switch(f.type){case "Point":return"POINT "+(f.coordinates&&f.coordinates.length?"("+f.coordinates.join(" ")+")":"EMPTY");case "LineString":return"LINESTRING "+b(f.coordinates);case "Polygon":return"POLYGON "+d(f.coordinates);case "MultiPoint":return"MULTIPOINT "+b(f.coordinates);case "MultiLineString":return"MULTILINSTRING "+d(f.coordinates);case "MultiPolygon":if((f=f.coordinates)&&f.length){for(var n=[],l=0;l<f.length;l++)n.push(d(f[l]));f="("+n+")"}else f="EMPTY";return"MULTIPOLYGON "+
f;case "GeometryCollection":if((f=f.geometries)&&f.length){n=[];for(l=0;l<f.length;l++)n.push(g(f[l]));f="("+f+")"}else f="EMPTY";return"GEOMETRYCOLLECTION "+f;default:return""}else return""}return{stringify:g,parse:function(f){f=e.trim(f);var n=f.indexOf(" ");switch(f.substr(0,n).toUpperCase()){case "POINT":return(f=f.substr(n+1).match(/\(\s*([\d\.-]+)\s+([\d\.-]+)\s*\)/))&&f.length>=2?{type:"Point",coordinates:[parseFloat(f[1]),parseFloat(f[2])]}:null}}}}(),proj:function(){return{fromGeodeticPos:function(b){if(!b)debugger;
return[6378137*b[0]*0.017453292519943295,6378137*Math.log(Math.tan(0.7853981633974483+b[1]*0.017453292519943295/2))]},fromGeodetic:function(b){var d=e.isArray(b[0]),g=this.fromGeodeticPos;if(!d&&b.length==4){d=g([b[0],b[1]]);b=g([b[2],b[3]]);return[d[0],d[1],b[0],b[1]]}else{var f=d&&e.isArray(b[0][0]),n=f&&e.isArray(b[0][0][0]),l=[],o,s,u;if(!n){if(!f){d||(b=[b]);b=[b]}b=[b]}for(o=0;o<b.length;o++){l[o]=[];for(s=0;s<b[o].length;s++){l[o][s]=[];for(u=0;u<b[o][s].length;u++)l[o][s][u]=g(b[o][s][u])}}return n?
l:f?l[0]:d?l[0][0]:l[0][0][0]}},toGeodeticPos:function(b){return[b[0]/6378137*57.29577951308232,(1.5707963267948966-2*Math.atan(1/Math.exp(b[1]/6378137)))*57.29577951308232]},toGeodetic:function(b){var d=e.isArray(b[0]),g=this.toGeodeticPos;if(!d&&b.length==4){d=g([b[0],b[1]]);b=g([b[2],b[3]]);return[d[0],d[1],b[0],b[1]]}else{var f=d&&e.isArray(b[0][0]),n=f&&e.isArray(b[0][0][0]),l=[];if(!n){if(!f){d||(b=[b]);b=[b]}b=[b]}for(i=0;i<b.length;i++){l[i]=[];for(j=0;j<b[i].length;j++){l[i][j]=[];for(k=
0;k<b[i][j].length;k++)l[i][j][k]=g(b[i][j][k])}}return n?l:f?l[0]:d?l[0][0]:l[0][0][0]}}}}(),_serviceTypes:{}}})(jQuery,this);
(function(e,r){var p=function(){for(var a=5,c=document.createElement("div"),b=c.all||[];c.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",b[0];);return a>6?a:!a}();e.widget("geo.geographics",{_$elem:r,_options:{},_trueCanvas:true,_width:0,_height:0,_$canvas:r,_context:r,options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:0.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"}},_create:function(){this._$elem=this.element;this._options=this.options;
this._$elem.css({display:"inline-block",overflow:"hidden",textAlign:"left"});this._$elem.css("position")=="static"&&this._$elem.css("position","relative");this._width=this._$elem.width();this._height=this._$elem.height();if(!(this._width&&this._height)){this._width=parseInt(this._$elem.css("width"));this._height=parseInt(this._$elem.css("height"))}if(document.createElement("canvas").getContext){this._$elem.append('<canvas width="'+this._width+'" height="'+this._height+'" style="position:absolute; left:0; top:0; width:'+
this._width+"px; height:"+this._height+'px;"></canvas>');this._$canvas=this._$elem.children(":last");this._context=this._$canvas[0].getContext("2d")}else if(p<=8){this._trueCanvas=false;this._$elem.append('<div width="'+this._width+'" height="'+this._height+'" style="position:absolute; left:0; top:0; width:'+this._width+"px; height:"+this._height+'px; margin:0; padding:0;"></div>');this._$canvas=this._$elem.children(":last");G_vmlCanvasManager.initElement(this._$canvas[0]);this._context=this._$canvas[0].getContext("2d");
this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})}},_setOption:function(a,c){if(a=="style")c=e.extend({},this._options.style,c);e.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments);this._$elem.html("")},clear:function(){this._context.clearRect(0,0,this._width,this._height)},drawArc:function(a,c,b,d){d=this._getGraphicStyle(d);if(d.visibility!="hidden"&&d.opacity>0&&d.widthValue>0&&
d.heightValue>0){var g=Math.min(d.widthValue,d.heightValue)/2;c=c*Math.PI/180;b=b*Math.PI/180;this._context.save();this._context.translate(a[0],a[1]);d.widthValue>d.heightValue?this._context.scale(d.widthValue/d.heightValue,1):this._context.scale(1,d.heightValue/d.widthValue);this._context.beginPath();this._context.arc(0,0,g,c,b,false);this._trueCanvas&&this._context.restore();if(d.doFill){this._context.fillStyle=d.fill;this._context.globalAlpha=d.opacity*d.fillOpacity;this._context.fill()}if(d.doStroke){this._context.lineJoin=
"round";this._context.lineWidth=d.strokeWidthValue;this._context.strokeStyle=d.stroke;this._context.globalAlpha=d.opacity*d.strokeOpacity;this._context.stroke()}this._trueCanvas||this._context.restore()}},drawPoint:function(a,c){c=this._getGraphicStyle(c);if(c.widthValue==c.heightValue&&c.heightValue==c.borderRadiusValue)this.drawArc(a,0,360,c);else if(c.visibility!="hidden"&&c.opacity>0){c.borderRadiusValue=Math.min(Math.min(c.widthValue,c.heightValue)/2,c.borderRadiusValue);a[0]-=c.widthValue/2;
a[1]-=c.heightValue/2;this._context.beginPath();this._context.moveTo(a[0]+c.borderRadiusValue,a[1]);this._context.lineTo(a[0]+c.widthValue-c.borderRadiusValue,a[1]);this._context.quadraticCurveTo(a[0]+c.widthValue,a[1],a[0]+c.widthValue,a[1]+c.borderRadiusValue);this._context.lineTo(a[0]+c.widthValue,a[1]+c.heightValue-c.borderRadiusValue);this._context.quadraticCurveTo(a[0]+c.widthValue,a[1]+c.heightValue,a[0]+c.widthValue-c.borderRadiusValue,a[1]+c.heightValue);this._context.lineTo(a[0]+c.borderRadiusValue,
a[1]+c.heightValue);this._context.quadraticCurveTo(a[0],a[1]+c.heightValue,a[0],a[1]+c.heightValue-c.borderRadiusValue);this._context.lineTo(a[0],a[1]+c.borderRadiusValue);this._context.quadraticCurveTo(a[0],a[1],a[0]+c.borderRadiusValue,a[1]);this._context.closePath();if(c.doFill){this._context.fillStyle=c.fill;this._context.globalAlpha=c.opacity*c.fillOpacity;this._context.fill()}if(c.doStroke){this._context.lineJoin="round";this._context.lineWidth=c.strokeWidthValue;this._context.strokeStyle=c.stroke;
this._context.globalAlpha=c.opacity*c.strokeOpacity;this._context.stroke()}}},drawLineString:function(a,c){this._drawLines([a],false,c)},drawPolygon:function(a,c){this._drawLines(a,true,c)},drawBbox:function(a,c){this._drawLines([[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]],[a[0],a[1]]]],true,c)},_getGraphicStyle:function(a){function c(b){b=parseInt(b);return+b+""===b?+b:b}a=e.extend({},this._options.style,a);a.borderRadiusValue=c(a.borderRadius);a.fill=a.fill||a.color;a.doFill=a.fill&&a.fillOpacity>
0;a.stroke=a.stroke||a.color;a.strokeWidthValue=c(a.strokeWidth);a.doStroke=a.stroke&&a.strokeOpacity>0&&a.strokeWidthValue>0;a.widthValue=c(a.width);a.heightValue=c(a.height);return a},_drawLines:function(a,c,b){if(!(!a||!a.length||a[0].length<2)){b=this._getGraphicStyle(b);var d,g;if(b.visibility!="hidden"&&b.opacity>0){this._context.beginPath();this._context.moveTo(a[0][0][0],a[0][0][1]);for(d=0;d<a.length;d++)for(g=0;g<a[d].length;g++)this._context.lineTo(a[d][g][0],a[d][g][1]);c&&this._context.closePath();
if(c&&b.doFill){this._context.fillStyle=b.fill;this._context.globalAlpha=b.opacity*b.fillOpacity;this._context.fill()}if(b.doStroke){this._context.lineCap=this._context.lineJoin="round";this._context.lineWidth=b.strokeWidthValue;this._context.strokeStyle=b.stroke;this._context.globalAlpha=b.opacity*b.strokeOpacity;this._context.stroke()}}}}})})(jQuery);
(function(e,r){var p=function(){for(var a=5,c=document.createElement("div"),b=c.all||[];c.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",b[0];);return a>6?a:!a}();e.widget("geo.geomap",{_$elem:r,_created:false,_contentBounds:{},_$contentFrame:r,_$existingChildren:r,_$servicesContainer:r,_$drawContainer:r,_$shapesContainer:r,_$textContainer:r,_$textContent:r,_$eventTarget:r,_dpi:96,_currentServices:[],_center:r,_pixelSize:r,_centerMax:r,_pixelSizeMax:r,_wheelZoomFactor:1.18920711500273,_wheelTimeout:null,
_wheelLevel:0,_zoomFactor:2,_mouseDown:r,_inOp:r,_toolPan:r,_shiftZoom:r,_anchor:r,_current:r,_downDate:r,_moveDate:r,_clickDate:r,_lastMove:r,_lastDrag:r,_windowHandler:null,_resizeTimeout:null,_panning:r,_velocity:r,_friction:r,_supportTouch:r,_softDblClick:r,_isTap:r,_isDbltap:r,_drawTimeout:null,_drawPixels:[],_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:e.extend({},{bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{pan:"move",zoom:"crosshair",drawPoint:"crosshair",
drawLineString:"crosshair",drawPolygon:"crosshair"},drawStyle:{},shapeStyle:{},mode:"pan",services:[{"class":"osm",type:"tiled",getUrl:function(a){return"http://tile.openstreetmap.org/"+a.zoom+"/"+a.tile.column+"/"+a.tile.row+".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},axisLayout:"map",zoom:0,pixelSize:0}),_createWidget:function(a,c){this._$elem=
e(c);if(!this._$elem.is("[data-geo-service]")){this._$elem.attr("data-geo-map","data-geo-map");this._graphicShapes=[];this._initOptions=a||{};this._forcePosition(this._$elem);this._$elem.css("text-align","left");var b=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:b.width,height:b.height};this._createChildren();this._center=this._centerMax=[0,0];this.options.pixelSize=this._pixelSize=this._pixelSizeMax=156543.03392799935;
this._mouseDown=this._inOp=this._toolPan=this._shiftZoom=this._panning=this._isTap=this._isDbltap=false;this._anchor=this._current=this._lastMove=this._lastDrag=this._velocity=[0,0];this._friction=[0.8,0.8];this._downDate=this._moveDate=this._clickDate=0}e.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){if(!this._$elem.is("[data-geo-service]")){this._options=this.options;this._softDblClick=(this._supportTouch="ontouchend"in document)||p==7;var a=this._supportTouch?"touchstart":
"mousedown",c=this._supportTouch?"touchend touchcancel":"mouseup",b=this._supportTouch?"touchmove":"mousemove";e(document).keydown(e.proxy(this._document_keydown,this));this._$eventTarget.dblclick(e.proxy(this._eventTarget_dblclick,this));this._$eventTarget.bind(a,e.proxy(this._eventTarget_touchstart,this));a=this._$eventTarget[0].setCapture?this._$eventTarget:e(document);a.bind(b,e.proxy(this._dragTarget_touchmove,this));a.bind(c,e.proxy(this._dragTarget_touchstop,this));this._$eventTarget.mousewheel(e.proxy(this._eventTarget_mousewheel,
this));var d=this;this._windowHandler=function(){d._resizeTimeout&&clearTimeout(d._resizeTimeout);this._resizeTimeout=setTimeout(function(){d._created&&d._$elem.geomap("resize")},500)};e(window).resize(this._windowHandler);this._$drawContainer.geographics({style:this._initOptions.drawStyle||{}});this._options.drawStyle=this._$drawContainer.geographics("option","style");this._$shapesContainer.geographics({style:this._initOptions.shapeStyle||{}});this._options.shapeStyle=this._$shapesContainer.geographics("option",
"style");if(this._initOptions){this._initOptions.tilingScheme&&this._setOption("tilingScheme",this._initOptions.tilingScheme,false);this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,false);this._initOptions.center&&this._setOption("center",this._initOptions.center,false);this._initOptions.zoom!==r&&this._setZoom(this._initOptions.zoom,false,false)}this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._createServices();this._refresh();this._created=true}},
_setOption:function(a,c,b){if(!(this._$elem.is("[data-geo-service]")||a=="pixelSize")){b=b===r||b;switch(a){case "bbox":if(e.geo.proj){c=e.geo.proj.fromGeodetic([[c[0],c[1]],[c[2],c[3]]]);c=[c[0][0],c[0][1],c[1][0],c[1][1]]}this._setBbox(c,false,b);c=this._getBbox();if(e.geo.proj){c=e.geo.proj.toGeodetic([[c[0],c[1]],[c[2],c[3]]]);c=[c[0][0],c[0][1],c[1][0],c[1][1]]}break;case "center":this._setCenterAndSize(e.geo.proj?e.geo.proj.fromGeodetic([[c[0],c[1]]])[0]:c,this._pixelSize,false,b);break;case "drawStyle":if(this._$drawContainer){this._$drawContainer.geographics("option",
"style",c);c=this._$drawContainer.geographics("option","style")}break;case "shapeStyle":if(this._$shapesContainer){this._$shapesContainer.geographics("option","style",c);c=this._$shapesContainer.geographics("option","style")}break;case "mode":this._$drawContainer.geographics("clear");this._$eventTarget.css("cursor",this._options.cursors[c]);break;case "zoom":this._setZoom(c,false,b)}e.Widget.prototype._setOption.apply(this,arguments);switch(a){case "tilingScheme":this._pixelSizeMax=this._getTiledPixelSize(0);
this._centerMax=[c.origin[0]+this._pixelSizeMax*c.tileWidth/2,c.origin[1]+this._pixelSizeMax*c.tileHeight/2];break;case "services":this._createServices();b&&this._refresh();break;case "shapeStyle":if(b){this._$shapesContainer.geographics("clear");this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes)}}}},destroy:function(){if(this._$elem.is("[data-geo-map]")){this._created=false;e(window).unbind("resize",this._windowHandler);for(var a=0;a<this._currentServices.length;a++){this._currentServices[a].serviceContainer.geomap("destroy");
e.geo._serviceTypes[this._currentServices[a].type].destroy(this,this._$servicesContainer,this._currentServices[a])}this._$shapesContainer.geographics("destroy");this._$drawContainer.geographics("destroy");this._$existingChildren.detach();this._$elem.html("");this._$elem.append(this._$existingChildren);this._$elem.removeAttr("data-geo-map")}e.Widget.prototype.destroy.apply(this,arguments)},toMap:function(a){a=this._toMap(a);return e.geo.proj?e.geo.proj.toGeodetic(a):a},toPixel:function(a,c,b){a=e.geo.proj?
e.geo.proj.fromGeodetic(a):a;return this._toPixel(a,c,b)},opacity:function(a,c){if(this._$elem.is("[data-geo-service]"))this._$elem.closest("[data-geo-map]").geomap("opacity",a,this._$elem);else if(a>=0||a<=1)for(var b=0;b<this._currentServices.length;b++){var d=this._currentServices[b];if(!c||d.serviceContainer[0]==c[0]){this._options.services[b].opacity=d.opacity=a;e.geo._serviceTypes[d.type].opacity(this,d)}}},toggle:function(a,c){if(this._$elem.is("[data-geo-service]"))this._$elem.closest("[data-geo-map]").geomap("toggle",
a,this._$elem);else for(var b=0;b<this._currentServices.length;b++){var d=this._currentServices[b];if(!c||d.serviceContainer[0]==c[0]){if(a===r)a=d.visibility===r||d.visibility==="visible"?false:true;this._options.services[b].visibility=d.visibility=a?"visible":"hidden";e.geo._serviceTypes[d.type].toggle(this,d);a&&e.geo._serviceTypes[d.type].refresh(this,d)}}},zoom:function(a){a!=null&&this._setZoom(this._options.zoom+a,false,true)},refresh:function(){this._refresh()},resize:function(){var a=this._findMapSize(),
c=a.width/2-this._contentBounds.width/2,b=a.height/2-this._contentBounds.height/2,d;this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:a.width,height:a.height};this._$contentFrame.css({width:a.width,height:a.height});this._$servicesContainer.css({width:a.width,height:a.height});this._$eventTarget.css({width:a.width,height:a.height});var g=this._$shapesContainer.geographics("option","style");this._$shapesContainer.geographics("destroy");
this._$drawContainer.geographics("destroy");for(d=0;d<this._currentServices.length;d++)e.geo._serviceTypes[this._currentServices[d].type].resize(this,this._currentServices[d]);this._$drawContainer.css({width:a.width,height:a.height});this._$drawContainer.geographics();this._$shapesContainer.css({width:a.width,height:a.height});this._$shapesContainer.geographics({style:g});for(d=0;d<this._drawPixels.length;d++){this._drawPixels[d][0]+=c;this._drawPixels[d][1]+=b}this._setCenterAndSize(this._center,
this._pixelSize,false,true)},append:function(a,c,b){if(a){var d=0;a=a.type=="FeatureCollection"?a.features:e.isArray(a)?a:[a];if(typeof c==="boolean"){b=c;c=null}for(;d<a.length;d++){if(a[d].type!="Point"){var g=e.geo.bbox(a[d]);if(e.geo.proj)g=e.geo.proj.fromGeodetic(g);e.data(a[d],"geoBbox",g)}this._graphicShapes.push({shape:a[d],style:c})}if(b===r||b)this._refresh()}},empty:function(a){e.each(this._graphicShapes,function(){e.removeData(this,"geoBbox")});this._graphicShapes=[];if(a===r||a)this._refresh()},
find:function(a,c){this.toPixel(a.coordinates);var b=this._pixelSize*c,d=[],g;e.each(this._graphicShapes,function(){if(this.shape.type=="Point")e.geo.distance(this.shape,a)<=b&&d.push(this.shape);else{var f=e.data(this.shape,"geoBbox");f={type:"Polygon",coordinates:[[[f[0],f[1]],[f[0],f[3]],[f[2],f[3]],[f[2],f[1]],[f[0],f[1]]]]};var n={type:"Point",coordinates:e.geo.proj?e.geo.proj.fromGeodetic(a.coordinates):a.coordinates};if(e.geo.distance(f,n,true)<=b){f=e.geo._flatten(this.shape);for(g=0;g<f.length;g++)if(e.geo.distance(f[g],
a)<=b){d.push(this.shape);break}}}});return d},remove:function(a,c){var b=this;e.each(this._graphicShapes,function(d){if(this.shape==a){e.removeData(a,"geoBbox");var g=b._graphicShapes.slice(d+1);b._graphicShapes.length=d;b._graphicShapes.push.apply(b._graphicShapes,g);return false}});if(c===r||c)this._refresh()},_getBbox:function(a,c){a=a||this._center;c=c||this._pixelSize;var b=this._contentBounds.width/2*c,d=this._contentBounds.height/2*c;return[a[0]-b,a[1]-d,a[0]+b,a[1]+d]},_setBbox:function(a,
c,b){var d=[a[0]+(a[2]-a[0])/2,a[1]+(a[3]-a[1])/2];a=Math.max(e.geo.width(a,true)/this._contentBounds.width,e.geo.height(a,true)/this._contentBounds.height);if(this._options.tilingScheme)a=this._getTiledPixelSize(this._getTiledZoom(a));this._setCenterAndSize(d,a,c,b)},_getBboxMax:function(){var a=this._contentBounds.width/2*this._pixelSizeMax,c=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-a,this._centerMax[1]-c,this._centerMax[0]+a,this._centerMax[1]+c]},_getCenter:function(){return this._center},
_getContentBounds:function(){return this._contentBounds},_getServicesContainer:function(){return this._$servicesContainer},_getZoom:function(){if(this._options.tilingScheme)return this._getTiledZoom(this._pixelSize);else{var a=this._contentBounds.width/this._contentBounds.height,c=e.geo.reaspect(this._getBbox(),a,true);a=e.geo.reaspect(this._getBboxMax(),a,true);return Math.log(e.geo.width(a,true)/e.geo.width(c,true))/Math.log(this._zoomFactor)}},_setZoom:function(a,c,b){a=Math.max(a,0);if(this._options.tilingScheme)this._setCenterAndSize(this._center,
this._getTiledPixelSize(a),c,b);else{a=e.geo.scaleBy(this._getBboxMax(),1/Math.pow(this._zoomFactor,a),true);this._setCenterAndSize(this._center,Math.max(e.geo.width(a,true)/this._contentBounds.width,e.geo.height(a,true)/this._contentBounds.height),c,b)}},_createChildren:function(){this._$existingChildren=this._$elem.children().detach();this._forcePosition(this._$existingChildren);this._$existingChildren.css("-moz-user-select","none");this._$elem.prepend("<div style='position:absolute; left:"+this._contentBounds.x+
"px; top:"+this._contentBounds.y+"px; width:"+this._contentBounds.width+"px; height:"+this._contentBounds.height+"px; margin:0; padding:0; overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;' unselectable='on'></div>");this._$eventTarget=this._$contentFrame=this._$elem.children(":first");this._$contentFrame.append('<div style="position:absolute; left:0; top:0; width:'+this._contentBounds.width+"px; height:"+this._contentBounds.height+'px; margin:0; padding:0;"></div>');
this._$servicesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div style="position:absolute; left:0; top:0; width:'+this._contentBounds.width+"px; height:"+this._contentBounds.height+'px; margin:0; padding:0;"></div>');this._$shapesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div style="position:absolute; left:0; top:0; width:'+this._contentBounds.width+"px; height:"+this._contentBounds.height+'px; margin:0; padding:0;"></div>');this._$drawContainer=
this._$contentFrame.children(":last");this._$contentFrame.append('<div class="ui-widget ui-widget-content ui-corner-all" style="position:absolute; left:0; top:0px; max-width:128px; display:none;"><div style="margin:.2em;"></div></div>');this._$textContainer=this._$contentFrame.children(":last");this._$textContent=this._$textContainer.children();this._$contentFrame.append(this._$existingChildren)},_createServices:function(){var a;for(a=0;a<this._currentServices.length;a++){this._currentServices[a].serviceContainer.geomap("destroy");
e.geo._serviceTypes[this._currentServices[a].type].destroy(this,this._$servicesContainer,this._currentServices[a])}this._currentServices=[];for(a=0;a<this._options.services.length;a++){this._currentServices[a]=this._options.services[a];this._currentServices[a].serviceContainer=e.geo._serviceTypes[this._currentServices[a].type].create(this,this._$servicesContainer,this._currentServices[a],a).geomap()}},_refreshDrawing:function(){this._$drawContainer.geographics("clear");if(this._drawPixels.length>
0){var a=this._options.mode,c=this._drawPixels;if(a=="drawPolygon")c=[c];this._$drawContainer.geographics(a,c)}},_resetDrawing:function(){this._drawPixels=[];this._drawCoords=[];this._$drawContainer.geographics("clear")},_refreshShapes:function(a,c,b,d,g){var f,n,l,o,s,u=this._getBbox(d,g),t=this;for(f=0;f<c.length;f++){l=c[f].shape||c[f];l=l.geometry||l;n=e.data(l,"geoBbox");if(!(n&&e.geo._bboxDisjoint(u,n))){o=e.isArray(b)?b[f].style:b;switch(l.type){case "Point":this._$shapesContainer.geographics("drawPoint",
this.toPixel(l.coordinates,d,g),o);break;case "LineString":this._$shapesContainer.geographics("drawLineString",this.toPixel(l.coordinates,d,g),o);break;case "Polygon":s=[];e.each(l.coordinates,function(A){s[A]=t.toPixel(this,d,g)});this._$shapesContainer.geographics("drawPolygon",s,o);break;case "MultiPoint":for(n=0;n<l.coordinates;n++)this._$shapesContainer.geographics("drawPoint",this.toPixel(l.coordinates[n],d,g),o);break;case "MultiLineString":for(n=0;n<l.coordinates;n++)this._$shapesContainer.geographics("drawLineString",
this.toPixel(l.coordinates[n],d,g),o);break;case "MultiPolygon":for(n=0;n<l.coordinates;n++){s=[];e.each(l.coordinates[n],function(A){s[A]=t.toPixel(this,d,g)});this._$shapesContainer.geographics("drawPolygon",s,o)}break;case "GeometryCollection":t._refreshShapes(a,l.geometries,o,d,g)}}}},_findMapSize:function(){for(var a={width:0,height:0},c=this._$elem;c.size()&&!(a.width>0&&a.height>0);){a={width:c.width(),height:c.height()};if(a.width<=0||a.height<=0)a={width:parseInt(c.css("width")),height:parseInt(c.css("height"))};
c=c.parent()}return a},_forcePosition:function(a){var c=a.css("position");c!="relative"&&c!="absolute"&&c!="fixed"&&a.css("position","relative")},_getTiledPixelSize:function(a){var c=this._options.tilingScheme;if(c!=null){if(a===0)return c.pixelSizes!=null?c.pixelSizes[0]:c.basePixelSize;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,(c.pixelSizes!=null?c.pixelSizes.length:c.levels)-1);return c.pixelSizes!=null?c.pixelSizes[a]:c.basePixelSize/Math.pow(2,a)}else return NaN},_getTiledZoom:function(a){var c=
this._options.tilingScheme;if(c.pixelSizes!=null){a=Math.floor(a*1E3);for(var b=c.pixelSizes.length-1;b>=0;b--)if(Math.floor(c.pixelSizes[b]*1E3)>=a)return b;return 0}else return Math.max(Math.round(Math.log(c.basePixelSize/a)/Math.log(2)),0)},_getZoomCenterAndSize:function(a,c,b){if(this._options.tilingScheme){c=this._getTiledZoom(this._pixelSize)+c;c=this._getTiledPixelSize(c)}else{c=Math.pow(b,-c);c=this._pixelSize*c}b=c/this._pixelSize;a=this._toMap(a);b=[(this._center[0]-a[0])*b,(this._center[1]-
a[1])*b];return{pixelSize:c,center:[a[0]+b[0],a[1]+b[1]]}},_mouseWheelFinish:function(){this._wheelTimeout=null;if(this._wheelLevel!=0){var a=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._wheelZoomFactor);this._setCenterAndSize(a.center,a.pixelSize,true,true);this._wheelLevel=0}else this._refresh()},_panEnd:function(){this._velocity=[this._velocity[0]>0?Math.floor(this._velocity[0]*this._friction[0]):Math.ceil(this._velocity[0]*this._friction[0]),this._velocity[1]>0?Math.floor(this._velocity[1]*
this._friction[1]):Math.ceil(this._velocity[1]*this._friction[1])];if(Math.abs(this._velocity[0])<4&&Math.abs(this._velocity[1])<4)this._panFinalize();else{this._current=[this._current[0]+this._velocity[0],this._current[1]+this._velocity[1]];this._panMove();setTimeout(e.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(this._panning){this._velocity=[0,0];var a=-(this._current[0]-this._anchor[0])*this._pixelSize,c=(this._options.axisLayout==="image"?-1:1)*(this._current[1]-this._anchor[1])*
this._pixelSize;this._$shapesContainer.css({left:0,top:0});this._setCenterAndSize([this._center[0]+a,this._center[1]+c],this._pixelSize,true,true);this._inOp=false;this._anchor=this._current;this._toolPan=this._panning=false;this._$eventTarget.css("cursor",this._options.cursors[this._options.mode])}},_panMove:function(){var a=this._current[0]-this._lastDrag[0],c=this._current[1]-this._lastDrag[1],b=0,d;if(this._toolPan||a>3||a<-3||c>3||c<-3){if(!this._toolPan){this._toolPan=true;this._$eventTarget.css("cursor",
this._options.cursors.pan)}if(this._mouseDown)this._velocity=[a,c];if(a!=0||c!=0){this._panning=true;this._lastDrag=this._current;for(b=0;b<this._options.services.length;b++){d=this._options.services[b];e.geo._serviceTypes[d.type].interactivePan(this,d,a,c)}this._$shapesContainer.css({left:function(g,f){return parseInt(f)+a},top:function(g,f){return parseInt(f)+c}});for(b=0;b<this._drawPixels.length;b++){this._drawPixels[b][0]+=a;this._drawPixels[b][1]+=c}this._refreshDrawing()}}},_refresh:function(){for(var a=
0;a<this._options.services.length;a++){var c=this._options.services[a];!this._mouseDown&&e.geo._serviceTypes[c.type]!=null&&e.geo._serviceTypes[c.type].refresh(this,c)}if(this._$shapesContainer){this._$shapesContainer.geographics("clear");this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes)}},_setCenterAndSize:function(a,c,b,d){if(this._pixelSize!=c){this._$shapesContainer.geographics("clear");for(var g=0;g<this._options.services.length;g++){var f=
this._options.services[g];e.geo._serviceTypes[f.type].interactiveScale(this,f,a,c)}}this._center=a;this.options.pixelSize=this._pixelSize=c;if(e.geo.proj){a=this._getBbox();a=e.geo.proj.toGeodetic([[a[0],a[1]],[a[2],a[3]]]);a=[a[0][0],a[0][1],a[1][0],a[1][1]];this._options.bbox=a;this._options.center=e.geo.proj.toGeodetic([[this._center[0],this._center[1]]])[0]}else{this._options.bbox=this._getBbox();this._options.center=this._center}this._options.zoom=this._getZoom();if(this._drawCoords.length>0)this._drawPixels=
this._toPixel(this._drawCoords);b&&this._trigger("bboxchange",window.event,{bbox:this._options.bbox});if(d){this._refresh();this._refreshDrawing()}},_toMap:function(a,c,b){var d=e.isArray(a[0]);d||(a=[a]);c=c||this._center;b=b||this._pixelSize;var g=this._contentBounds.width,f=this._contentBounds.height,n=g/2*b;b=f/2*b;var l=[c[0]-n,c[1]-b,c[0]+n,c[1]+b],o=e.geo.width(l,true)/g,s=e.geo.height(l,true)/f,u=this._options.axisLayout==="image",t=[];e.each(a,function(A){var E=this[1]*s;t[A]=[l[0]+this[0]*
o,u?l[1]+E:l[3]-E]});return d?t:t[0]},_toPixel:function(a,c,b){var d=e.isArray(a[0]);d||(a=[a]);c=c||this._center;b=b||this._pixelSize;var g=this._contentBounds.width,f=this._contentBounds.height,n=g/2*b;b=f/2*b;var l=[c[0]-n,c[1]-b,c[0]+n,c[1]+b];c=e.geo.width(l,true);n=e.geo.height(l,true);var o=this._options.axisLayout==="image",s=g/c,u=f/n,t=[];e.each(a,function(A){t[A]=[Math.round((this[0]-l[0])*s),Math.round((o?this[1]-l[1]:l[3]-this[1])*u)]});return d?t:t[0]},_zoomTo:function(a,c,b,d){c=c<
0?0:c;var g=this._getTiledPixelSize(c);if(isNaN(g)){c=e.geo._scaleBy(this._getBboxMax(),1/Math.pow(this._zoomFactor,c),true);c=Math.max(e.geo.width(c,true)/this._contentBounds.width,e.geo.height(c,true)/this._contentBounds.height);this._setCenterAndSize(a,c,b,d)}else this._setCenterAndSize(a,g,b,d)},_document_keydown:function(a){var c=this._drawCoords.length;if(c>0&&a.which==27)if(c<=2){this._resetDrawing();this._inOp=false}else{this._drawCoords[c-2]=e.merge([],this._drawCoords[c-1]);this._drawPixels[c-
2]=e.merge([],this._drawPixels[c-1]);this._drawCoords.length--;this._drawPixels.length--;this._refreshDrawing()}},_eventTarget_dblclick_zoom:function(a){this._trigger("dblclick",a,{type:"Point",coordinates:this.toMap(this._current)});if(!a.isDefaultPrevented()){a=this._getZoomCenterAndSize(this._current,1,this._zoomFactor);this._setCenterAndSize(a.center,a.pixelSize,true,true)}},_eventTarget_dblclick:function(a){this._panFinalize();if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=
null}e(a.currentTarget).offset();switch(this._options.mode){case "pan":case "drawPoint":this._eventTarget_dblclick_zoom(a);break;case "drawLineString":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){this._drawCoords.length--;this._trigger("shape",a,{type:"LineString",coordinates:e.geo.proj?e.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})}else this._eventTarget_dblclick_zoom(a);this._resetDrawing();break;case "drawPolygon":if(this._drawCoords.length>
1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){var c=this._drawCoords.length-1;if(c>2){this._drawCoords[c]=e.merge([],this._drawCoords[0]);this._trigger("shape",a,{type:"Polygon",coordinates:[e.geo.proj?e.geo.proj.toGeodetic(this._drawCoords):this._drawCoords]})}}else this._eventTarget_dblclick_zoom(a);this._resetDrawing()}this._inOp=false},_eventTarget_touchstart:function(a){if(!(!this._supportTouch&&a.which!=1)){this._panFinalize();this._mouseWheelFinish();
var c=e(a.currentTarget).offset();this._current=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-c.left,a.originalEvent.changedTouches[0].pageY-c.top]:[a.pageX-c.left,a.pageY-c.top];if(this._softDblClick){c=e.now();if(c-this._downDate<750){if(this._isTap){var b=this._current[0]-this._anchor[0],d=this._current[1]-this._anchor[1];if(Math.sqrt(b*b+d*d)>10)this._isTap=false;else this._current=this._anchor}this._isDbltap=this._isDbltap?false:this._isTap}else this._isDbltap=false;this._isTap=
true;this._downDate=c}this._mouseDown=true;this._anchor=this._current;if(!this._inOp&&a.shiftKey){this._shiftZoom=true;this._$eventTarget.css("cursor",this._options.cursors.zoom)}else{this._inOp=true;switch(this._options.mode){case "pan":case "drawPoint":case "drawLineString":case "drawPolygon":this._lastDrag=this._current;a.currentTarget.setCapture&&a.currentTarget.setCapture()}}if(this._inOp){a.preventDefault();return false}}},_dragTarget_touchmove:function(a){var c=this._$eventTarget.offset(),
b=this._drawCoords.length;c=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-c.left,a.originalEvent.changedTouches[0].pageY-c.top]:[a.pageX-c.left,a.pageY-c.top];if(c[0]===this._lastMove[0]&&c[1]===this._lastMove[1])if(this._inOp){a.preventDefault();return false}if(this._softDblClick)this._isDbltap=this._isTap=false;if(this._mouseDown){this._current=c;this._moveDate=e.now()}switch(this._shiftZoom?"zoom":this._options.mode){case "zoom":if(this._mouseDown){this._$drawContainer.geographics("clear");
this._$drawContainer.geographics("drawBbox",[this._anchor[0],this._anchor[1],c[0],c[1]])}else this._trigger("move",a,{type:"Point",coordinates:this.toMap(c)});break;case "pan":case "drawPoint":this._mouseDown||this._toolPan?this._panMove():this._trigger("move",a,{type:"Point",coordinates:this.toMap(c)});break;case "drawLineString":case "drawPolygon":if(this._mouseDown||this._toolPan)this._panMove();else{if(b>0){this._drawCoords[b-1]=this._toMap(c);this._drawPixels[b-1]=c;this._refreshDrawing()}this._trigger("move",
a,{type:"Point",coordinates:this.toMap(c)})}}this._lastMove=c;if(this._inOp){a.preventDefault();return false}},_dragTarget_touchstop:function(a){!this._mouseDown&&p==7&&this._eventTarget_touchstart(a);var c=this._mouseDown,b=this._toolPan,d=this._$eventTarget.offset(),g=this._shiftZoom?"zoom":this._options.mode,f,n;f=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-d.left,a.originalEvent.changedTouches[0].pageY-d.top]:[a.pageX-d.left,a.pageY-d.top];d=f[0]-this._anchor[0];n=f[1]-this._anchor[1];
this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._shiftZoom=this._mouseDown=this._toolPan=false;document.releaseCapture&&document.releaseCapture();if(c){c=e.now();this._current=f;switch(g){case "zoom":if(d>0||n>0){b=this._pixelSize*6;g=this._toMap([[Math.min(this._anchor[0],f[0]),Math.max(this._anchor[1],f[1])],[Math.max(this._anchor[0],f[0]),Math.min(this._anchor[1],f[1])]]);g=[g[0][0],g[0][1],g[1][0],g[1][1]];if(g[2]-g[0]<b&&g[3]-g[1]<b)g=e.geo.scaleBy(this._getBbox(e.geo.center(g,
true)),0.5,true);this._setBbox(g,true,true)}this._resetDrawing();break;case "pan":if(b)this._panEnd();else if(c-this._clickDate>100){this._trigger("click",a,{type:"Point",coordinates:this.toMap(f)});this._inOp=false}break;case "drawPoint":if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}if(b)this._panFinalize();else if(c-this._clickDate>100){var l=this;this._drawTimeout=setTimeout(function(){if(l._drawTimeout){l._trigger("shape",a,{type:"Point",coordinates:l.toMap(f)});
l._inOp=false;l._drawTimeout=false}},250)}break;case "drawLineString":case "drawPolygon":if(b)this._panFinalize();else{b=this._drawCoords.length==0?0:this._drawCoords.length-1;this._drawCoords[b]=this._toMap(f);this._drawPixels[b]=f;if(b<2||!(this._drawCoords[b][0]==this._drawCoords[b-1][0]&&this._drawCoords[b][1]==this._drawCoords[b-1][1])){this._drawCoords[b+1]=this._toMap(f);this._drawPixels[b+1]=f}this._refreshDrawing()}}this._clickDate=c;if(this._softDblClick&&this._isDbltap){this._isDbltap=
this._isTap=false;this._$eventTarget.trigger("dblclick",a)}}if(this._inOp){a.preventDefault();return false}},_eventTarget_mousewheel:function(a,c){a.preventDefault();this._panFinalize();if(this._mouseDown)return false;if(c!=0){if(this._wheelTimeout){window.clearTimeout(this._wheelTimeout);this._wheelTimeout=null}else{var b=e(a.currentTarget).offset();this._anchor=[a.pageX-b.left,a.pageY-b.top]}this._wheelLevel+=c;b=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._wheelZoomFactor);this._$shapesContainer.geographics("clear");
for(i=0;i<this._options.services.length;i++){var d=this._options.services[i];e.geo._serviceTypes[d.type].interactiveScale(this,d,b.center,b.pixelSize)}this._$shapesContainer.geographics("clear");this._graphicShapes.length>0&&this._graphicShapes.length<256&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,b.center,b.pixelSize);if(this._drawCoords.length>0){this._drawPixels=this._toPixel(this._drawCoords,b.center,b.pixelSize);this._refreshDrawing()}var g=this;this._wheelTimeout=
window.setTimeout(function(){g._mouseWheelFinish()},1E3)}return false}})})(jQuery);
(function(e,r){e.geo._serviceTypes.tiled=function(){return{create:function(p,a,c){p=e.data(c,"geoServiceState");if(!p){p={loadCount:0,reloadTiles:false};a.append('<div data-geo-service="tiled"'+(c.id?' id="'+c.id+'"':"")+(c["class"]?' class="'+c["class"]+'"':"")+' style="position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0; display:'+(c.visibility===r||c.visibility==="visible"?"block":"none")+';"></div>');p.serviceContainer=a.children(":last");e.data(c,"geoServiceState",p)}return p.serviceContainer},
destroy:function(p,a,c){e.data(c,"geoServiceState").serviceContainer.remove();e.removeData(c,"geoServiceState")},interactivePan:function(p,a,c,b){var d=e.data(a,"geoServiceState");if(d){this._cancelUnloaded(p,a);d.serviceContainer.children().css({left:function(I,N){return parseInt(N)+c},top:function(I,N){return parseInt(N)+b}});if(a&&(a.visibility===r||a.visibility==="visible")){var g=p._pixelSize,f=d.serviceContainer,n=f.children("[data-pixelSize='"+g+"']"),l=p._getContentBounds(),o=p.options.axisLayout===
"image",s=o?+1:-1,u=p.options.tilingScheme,t=u.tileWidth,A=u.tileHeight,E=l.width/2*g,y=l.height/2*g,B=n.position(),D=n.data("scaleOrigin").split(",");l=parseInt(D[0])-B.left;B=parseInt(D[1])-B.top;var F=p._getCenter();D=[F[0]+l*g,F[1]+s*B*g];var M=Math.floor((D[0]-E-u.origin[0])/(g*t));l=Math.floor((o?D[1]-y-u.origin[1]:u.origin[1]-(D[1]+y))/(g*A));B=Math.ceil((D[0]+E-u.origin[0])/(g*t));D=Math.ceil((o?D[1]+y-u.origin[1]:u.origin[1]-(D[1]-y))/(g*A));var H=p._getBboxMax(),C=p._getTiledPixelSize(0),
G=C/g,J=Math.floor((H[0]-u.origin[0])/(C*t))*G;H=Math.floor((u.origin[1]+s*H[3])/(C*A))*G;C=u.origin[1]+s*H*A*g;E=Math.round((u.origin[0]+J*t*g-(F[0]-E))/g);o=Math.round((o?C-(F[1]-y):F[1]+y-C)/g);var K=a.opacity===r?1:a.opacity;for(y=M;y<B;y++)for(F=l;F<D;F++){M=""+y+","+F;C=n.children("[data-tile='"+M+"']").removeAttr("data-dirty");if(C.size()===0){G=[u.origin[0]+y*t*g,u.origin[1]+s*F*A*g];var v=[u.origin[0]+((y+1)*t-1)*g,u.origin[1]+s*((F+1)*A-1)*g];G=a.getUrl({bbox:[G[0],G[1],v[0],v[1]],width:t,
height:A,zoom:p._getZoom(),tile:{row:F,column:y},index:Math.abs(F+y)});d.loadCount++;if(d.reloadTiles&&C.size()>0)C.attr("src",G);else{C="<img style='position:absolute; left:"+((y-J)*100+(E-E%t)/t*100)+"%; top:"+((F-H)*100+(o-o%A)/A*100)+"%; ";if(e("body")[0].filters===r)C+="width: 100%; height: 100%;";C+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+M+"' />";n.append(C);C=n.children(":last");
C.load(function(I){K<1?e(I.target).fadeTo(0,K):e(I.target).show();d.loadCount--;if(d.loadCount<=0){f.children(":not([data-pixelSize='"+g+"'])").remove();d.loadCount=0}}).error(function(I){e(I.target).remove();d.loadCount--;if(d.loadCount<=0){f.children(":not([data-pixelSize='"+g+"'])").remove();d.loadCount=0}}).attr("src",G)}}}}}},interactiveScale:function(p,a,c,b){var d=e.data(a,"geoServiceState");if(d&&a&&(a.visibility===r||a.visibility==="visible")){this._cancelUnloaded(p,a);a=p.options.tilingScheme;
var g=a.tileWidth,f=a.tileHeight;d.serviceContainer.children().each(function(){var n=e(this),l=n.attr("data-pixelSize")/b;l=Math.round(l*1E3)/1E3;var o=n.data("scaleOrigin").split(",");o=p._toMap([o[0],o[1]]);o=p._toPixel(o,c,b);n.css({left:Math.round(o[0])+"px",top:Math.round(o[1])+"px",width:g*l,height:f*l});e("body")[0].filters!==r&&n.children().each(function(){e(this).css("filter","progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+l+",M22="+l+",sizingmethod='auto expand')")})})}},
refresh:function(p,a){var c=e.data(a,"geoServiceState");if(c&&a&&(a.visibility===r||a.visibility==="visible")){this._cancelUnloaded(p,a);var b=p._getBbox(),d=p._pixelSize,g=c.serviceContainer;p._getContentBounds();var f=p.options.axisLayout==="image",n=f?+1:-1,l=p.options.tilingScheme,o=l.tileWidth,s=l.tileHeight,u=Math.floor((b[0]-l.origin[0])/(d*o)),t=Math.floor((f?b[1]-l.origin[1]:l.origin[1]-b[3])/(d*s)),A=Math.ceil((b[2]-l.origin[0])/(d*o)),E=Math.ceil((f?b[3]-l.origin[1]:l.origin[1]-b[1])/(d*
s)),y=p._getBboxMax(),B=p._getTiledPixelSize(0),D=B/d,F=Math.floor((y[0]-l.origin[0])/(B*o))*D,M=Math.floor((l.origin[1]+n*y[3])/(B*s))*D;y=l.origin[1]+n*M*s*d;var H=Math.round((l.origin[0]+F*o*d-b[0])/d),C=Math.round((f?y-b[1]:b[3]-y)/d);b=g.children().show();f=b.filter("[data-pixelSize='"+d+"']").appendTo(g);var G=a.opacity===r?1:a.opacity;c.reloadTiles&&b.find("img").attr("data-dirty","true");if(f.size()){f.css({left:H%o+"px",top:C%s+"px"}).data("scaleOrigin",H%o+","+C%s);f.children().each(function(){var v=
e(this),I=v.attr("data-tile").split(",");v.css({left:Math.round((parseInt(I[0])-F)*100+(H-H%o)/o*100)+"%",top:Math.round((parseInt(I[1])-M)*100+(C-C%s)/s*100)+"%"});G<1&&v.fadeTo(0,G)})}else{g.append("<div style='position:absolute; left:"+H%o+"px; top:"+C%s+"px; width:"+o+"px; height:"+s+"px; margin:0; padding:0;' data-pixelSize='"+d+"'></div>");f=g.children(":last").data("scaleOrigin",H%o+","+C%s)}for(u=u;u<A;u++)for(y=t;y<E;y++){B=""+u+","+y;D=f.children("[data-tile='"+B+"']").removeAttr("data-dirty");
if(D.size()===0||c.reloadTiles){var J=[l.origin[0]+u*o*d,l.origin[1]+n*y*s*d],K=[l.origin[0]+((u+1)*o-1)*d,l.origin[1]+n*((y+1)*s-1)*d];J=a.getUrl({bbox:[J[0],J[1],K[0],K[1]],width:o,height:s,zoom:p._getZoom(),tile:{row:y,column:u},index:Math.abs(y+u)});c.loadCount++;if(c.reloadTiles&&D.size()>0)D.attr("src",J);else{D="<img style='position:absolute; left:"+((u-F)*100+(H-H%o)/o*100)+"%; top:"+((y-M)*100+(C-C%s)/s*100)+"%; ";if(e("body")[0].filters===r)D+="width: 100%; height: 100%;";D+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+
B+"' />";f.append(D);D=f.children(":last");D.load(function(v){G<1?e(v.target).fadeTo(0,G):e(v.target).show();c.loadCount--;if(c.loadCount<=0){g.children(":not([data-pixelSize='"+d+"'])").remove();c.loadCount=0}}).error(function(v){e(v.target).remove();c.loadCount--;if(c.loadCount<=0){g.children(":not([data-pixelSize='"+d+"'])").remove();c.loadCount=0}}).attr("src",J)}}}b.find("[data-dirty]").remove();c.reloadTiles=false}},resize:function(){},opacity:function(p,a){e.data(a,"geoServiceState").serviceContainer.find("img").stop(true).fadeTo("fast",
a.opacity)},toggle:function(p,a){e.data(a,"geoServiceState").serviceContainer.css("display",a.visibility==="visible"?"block":"none")},_cancelUnloaded:function(p,a){var c=e.data(a,"geoServiceState");if(c&&c.loadCount>0)for(c.serviceContainer.find("img:hidden").remove();c.loadCount>0;)c.loadCount--}}}()})(jQuery);
(function(e,r){e.geo._serviceTypes.shingled=function(){return{create:function(p,a,c){p=e.data(c,"geoServiceState");if(!p){p={loadCount:0};a.append('<div data-geo-service="shingled"'+(c.id?' id="'+c.id+'"':"")+(c["class"]?' class="'+c["class"]+'"':"")+' style="position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0; display:'+(c.visibility===r||c.visibility==="visible"?"block":"none")+';"></div>');p.serviceContainer=a.children(":last");e.data(c,"geoServiceState",p)}return p.serviceContainer},
destroy:function(p,a,c){e.data(c,"geoServiceState").serviceContainer.remove();e.removeData(c,"geoServiceState")},interactivePan:function(p,a,c,b){var d=e.data(a,"geoServiceState");if(d){this._cancelUnloaded(p,a);p=d.serviceContainer.children("[data-pixelSize='"+p._pixelSize+"']");a=p.children("div");if(!a.length){p.children("img").wrap('<div style="position:absolute; left:0; top:0; width:100%; height:100%;"></div>');a=p.children("div")}a.css({left:function(g,f){return parseInt(f)+c},top:function(g,
f){return parseInt(f)+b}})}},interactiveScale:function(p,a,c,b){var d=e.data(a,"geoServiceState");if(d){this._cancelUnloaded(p,a);a=d.serviceContainer;p=p._getContentBounds();var g=p.width,f=p.height,n=g/2,l=f/2;a.children().each(function(){var o=e(this),s=o.attr("data-pixelSize"),u=s/b;o.css({width:g*u,height:f*u}).children("img").each(function(){var t=e(this),A=t.data("center");t.css({left:(Math.round((A[0]-c[0])/s)-n)*u+"px",top:(Math.round((c[1]-A[1])/s)-l)*u+"px"})})})}},refresh:function(p,a){var c=
e.data(a,"geoServiceState");if(c&&a&&(a.visibility===r||a.visibility==="visible")){this._cancelUnloaded(p,a);var b=p._getBbox(),d=p._pixelSize,g=c.serviceContainer,f=p._getContentBounds(),n=f.width,l=f.height,o=n/2,s=l/2;f=g.children('[data-pixelSize="'+d+'"]');var u=a.opacity===r?1:a.opacity;if(!f.size()){g.append('<div style="position:absolute; left:'+o+"px; top:"+s+"px; width:"+n+"px; height:"+l+'px; margin:0; padding:0;" data-pixelSize="'+d+'"></div>');f=g.children(":last")}f.children("img").each(function(){var t=
e(this),A=t.data("center"),E=p._getCenter();t.css({left:Math.round((A[0]-E[0])/d)-o+"px",top:Math.round((E[1]-A[1])/d)-s+"px"})});u<1&&g.find("img").attr("data-keepAlive","0");b=a.getUrl({bbox:b,width:n,height:l,zoom:p._getZoom(),tile:null,index:0});c.loadCount++;f.append('<img style="position:absolute; left:-'+o+"px; top:-"+s+'px; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />');
f.children(":last").data("center",p._getCenter()).load(function(t){u<1?e(t.target).fadeTo(0,u):e(t.target).show();c.loadCount--;if(c.loadCount<=0){g.children(':not([data-pixelSize="'+d+'"])').remove();t=g.find('[data-pixelSize="'+d+'"]>div');if(t.size()>0){var A=t.position();t.children("img").each(function(){var E=e(this),y=A.left+parseInt(E.css("left")),B=A.top+parseInt(E.css("top"));E.css({left:y+"px",top:B+"px"})}).unwrap();t.remove()}c.loadCount=0}}).error(function(t){e(t.target).remove();c.loadCount--;
if(c.loadCount<=0){g.children(":not([data-pixelSize='"+d+"'])").remove();c.loadCount=0}}).attr("src",b)}},resize:function(p,a){var c=e.data(a,"geoServiceState");if(c&&a&&(a.visibility===r||a.visibility==="visible")){this._cancelUnloaded(p,a);var b=c.serviceContainer,d=p._getContentBounds();c=d.width/2;d=d.height/2;b=b.children();b.attr("data-pixelSize","0");b.css({left:c+"px",top:d+"px"})}},opacity:function(p,a){e.data(a,"geoServiceState").serviceContainer.find("img").stop(true).fadeTo("fast",a.opacity)},
toggle:function(p,a){e.data(a,"geoServiceState").serviceContainer.css("display",a.visibility==="visible"?"block":"none")},_cancelUnloaded:function(p,a){var c=e.data(a,"geoServiceState");if(c&&c.loadCount>0)for(c.serviceContainer.find("img:hidden").remove();c.loadCount>0;)c.loadCount--}}}()})(jQuery);
