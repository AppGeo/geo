document.createElement("canvas").getContext||function(){function f(){return this.context_||(this.context_=new t(this))}function v(n,h){var m=P.call(arguments,2);return function(){return n.apply(h,m.concat(P.call(arguments)))}}function r(n){n.namespaces.g_vml_||n.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");n.namespaces.g_o_||n.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!n.styleSheets.ex_canvas_){n=n.createStyleSheet();n.owningElement.id=
"ex_canvas_";n.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function a(n){var h=n.srcElement;switch(n.propertyName){case "width":h.getContext().clearRect();h.style.width=h.attributes.width.nodeValue+"px";h.firstChild.style.width=h.clientWidth+"px";break;case "height":h.getContext().clearRect();h.style.height=h.attributes.height.nodeValue+"px";h.firstChild.style.height=h.clientHeight+"px"}}function c(n){n=n.srcElement;if(n.firstChild){n.firstChild.style.width=
n.clientWidth+"px";n.firstChild.style.height=n.clientHeight+"px"}}function b(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(n,h){for(var m=b(),q=0;q<3;q++)for(var x=0;x<3;x++){for(var u=0,B=0;B<3;B++)u+=n[q][B]*h[B][x];m[q][x]=u}return m}function g(n,h){h.fillStyle=n.fillStyle;h.lineCap=n.lineCap;h.lineJoin=n.lineJoin;h.lineWidth=n.lineWidth;h.miterLimit=n.miterLimit;h.shadowBlur=n.shadowBlur;h.shadowColor=n.shadowColor;h.shadowOffsetX=n.shadowOffsetX;h.shadowOffsetY=n.shadowOffsetY;h.strokeStyle=n.strokeStyle;
h.globalAlpha=n.globalAlpha;h.font=n.font;h.textAlign=n.textAlign;h.textBaseline=n.textBaseline;h.arcScaleX_=n.arcScaleX_;h.arcScaleY_=n.arcScaleY_;h.lineScale_=n.lineScale_}function e(n){var h=n.indexOf("(",3),m=n.indexOf(")",h+1);h=n.substring(h+1,m).split(",");if(h.length!=4||n.charAt(3)!="a")h[3]=1;return h}function p(n,h,m){return Math.min(m,Math.max(h,n))}function l(n,h,m){m<0&&m++;m>1&&m--;return 6*m<1?n+(h-n)*6*m:2*m<1?h:3*m<2?n+(h-n)*(2/3-m)*6:n}function o(n){if(n in M)return M[n];var h,
m=1;n=String(n);if(n.charAt(0)=="#")h=n;else if(/^rgb/.test(n)){m=e(n);h="#";for(var q,x=0;x<3;x++){q=m[x].indexOf("%")!=-1?Math.floor(parseFloat(m[x])/100*255):+m[x];h+=Q[p(q,0,255)]}m=+m[3]}else if(/^hsl/.test(n)){x=m=e(n);h=parseFloat(x[0])/360%360;h<0&&h++;q=p(parseFloat(x[1])/100,0,1);x=p(parseFloat(x[2])/100,0,1);if(q==0)q=x=h=x;else{var u=x<0.5?x*(1+q):x+q-x*q,B=2*x-u;q=l(B,u,h+1/3);x=l(B,u,h);h=l(B,u,h-1/3)}h="#"+Q[Math.floor(q*255)]+Q[Math.floor(x*255)]+Q[Math.floor(h*255)];m=m[3]}else h=
n;return M[n]={color:h,alpha:m}}function t(n){this.m_=b();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=D*1;this.globalAlpha=1;this.canvas=n;var h="width:"+n.clientWidth+"px;height:"+n.clientHeight+"px;overflow:hidden;position:absolute",m=n.ownerDocument.createElement("div");m.style.cssText=h;n.appendChild(m);h=m.cloneNode(false);h.style.backgroundColor="red";h.style.filter="alpha(opacity=0)";
n.appendChild(h);this.element_=m;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1}function s(n,h,m,q){n.currentPath_.push({type:"bezierCurveTo",cp1x:h.x,cp1y:h.y,cp2x:m.x,cp2y:m.y,x:q.x,y:q.y});n.currentX_=q.x;n.currentY_=q.y}function w(n,h,m){n=n.m_;return{x:D*(h*n[0][0]+m*n[1][0]+n[2][0])-I,y:D*(h*n[0][1]+m*n[1][1]+n[2][1])-I}}function y(n,h,m){if(isFinite(h[0][0])&&isFinite(h[0][1])&&isFinite(h[1][0])&&isFinite(h[1][1])&&isFinite(h[2][0])&&isFinite(h[2][1])){n.m_=h;if(m)n.lineScale_=J(R(h[0][0]*
h[1][1]-h[0][1]*h[1][0]))}}function H(n){this.code=this[n];this.message=n+": DOM Exception "+this.code}var z=Math,C=z.round,E=z.sin,G=z.cos,R=z.abs,J=z.sqrt,D=10,I=D/2;navigator.userAgent.match(/MSIE ([\d.]+)?/);var P=Array.prototype.slice;r(document);z={init:function(n){n=n||document;n.createElement("canvas");n.attachEvent("onreadystatechange",v(this.init_,this,n))},init_:function(n){n=n.getElementsByTagName("canvas");for(var h=0;h<n.length;h++)this.initElement(n[h])},initElement:function(n){if(!n.getContext){n.getContext=
f;r(n.ownerDocument);n.innerHTML="";n.attachEvent("onpropertychange",a);n.attachEvent("onresize",c);var h=n.attributes;if(h.width&&h.width.specified)n.style.width=h.width.nodeValue+"px";else n.width=n.clientWidth;if(h.height&&h.height.specified)n.style.height=h.height.nodeValue+"px";else n.height=n.clientHeight}return n}};z.init();for(var Q=[],A=0;A<16;A++)for(var K=0;K<16;K++)Q[A*16+K]=A.toString(16)+K.toString(16);var M={},U={butt:"flat",round:"round"};A=t.prototype;A.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);
this.textMeasureEl_=null}this.element_.innerHTML=""};A.beginPath=function(){this.currentPath_=[]};A.moveTo=function(n,h){var m=w(this,n,h);this.currentPath_.push({type:"moveTo",x:m.x,y:m.y});this.currentX_=m.x;this.currentY_=m.y};A.lineTo=function(n,h){var m=w(this,n,h);this.currentPath_.push({type:"lineTo",x:m.x,y:m.y});this.currentX_=m.x;this.currentY_=m.y};A.bezierCurveTo=function(n,h,m,q,x,u){x=w(this,x,u);n=w(this,n,h);m=w(this,m,q);s(this,n,m,x)};A.quadraticCurveTo=function(n,h,m,q){n=w(this,
n,h);m=w(this,m,q);q={x:this.currentX_+2/3*(n.x-this.currentX_),y:this.currentY_+2/3*(n.y-this.currentY_)};s(this,q,{x:q.x+(m.x-this.currentX_)/3,y:q.y+(m.y-this.currentY_)/3},m)};A.arc=function(n,h,m,q,x,u){m*=D;var B=u?"at":"wa",F=n+G(q)*m-I,L=h+E(q)*m-I;q=n+G(x)*m-I;x=h+E(x)*m-I;if(F==q&&!u)F+=0.125;n=w(this,n,h);F=w(this,F,L);q=w(this,q,x);this.currentPath_.push({type:B,x:n.x,y:n.y,radius:m,xStart:F.x,yStart:F.y,xEnd:q.x,yEnd:q.y})};A.stroke=function(n){var h=[];h.push("<g_vml_:shape",' filled="',
!!n,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0,0"',' coordsize="',D*10,",",D*10,'"',' stroked="',!n,'"',' path="');for(var m={x:null,y:null},q={x:null,y:null},x=0;x<this.currentPath_.length;x++){var u=this.currentPath_[x];switch(u.type){case "moveTo":h.push(" m ",C(u.x),",",C(u.y));break;case "lineTo":h.push(" l ",C(u.x),",",C(u.y));break;case "close":h.push(" x ");u=null;break;case "bezierCurveTo":h.push(" c ",C(u.cp1x),",",C(u.cp1y),",",C(u.cp2x),",",C(u.cp2y),
",",C(u.x),",",C(u.y));break;case "at":case "wa":h.push(" ",u.type," ",C(u.x-this.arcScaleX_*u.radius),",",C(u.y-this.arcScaleY_*u.radius)," ",C(u.x+this.arcScaleX_*u.radius),",",C(u.y+this.arcScaleY_*u.radius)," ",C(u.xStart),",",C(u.yStart)," ",C(u.xEnd),",",C(u.yEnd))}if(u){if(m.x==null||u.x<m.x)m.x=u.x;if(q.x==null||u.x>q.x)q.x=u.x;if(m.y==null||u.y<m.y)m.y=u.y;if(q.y==null||u.y>q.y)q.y=u.y}}h.push(' ">');if(n){n=o(this.fillStyle);h.push('<g_vml_:fill color="',n.color,'" opacity="',n.alpha*this.globalAlpha,
'" />')}else{m=o(this.strokeStyle);n=m.color;m=m.alpha*this.globalAlpha;q=this.lineScale_*this.lineWidth;if(q<1)m*=q;h.push("<g_vml_:stroke",' opacity="',m,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',U[this.lineCap]||"square",'"',' weight="',q,'px"',' color="',n,'" />')}h.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",h.join(""))};A.fill=function(){this.stroke(true)};A.closePath=function(){this.currentPath_.push({type:"close"})};A.save=
function(){var n={};g(this,n);this.aStack_.push(n);this.mStack_.push(this.m_);this.m_=d(b(),this.m_)};A.restore=function(){if(this.aStack_.length){g(this.aStack_.pop(),this);this.m_=this.mStack_.pop()}};A.translate=function(n,h){y(this,d([[1,0,0],[0,1,0],[n,h,1]],this.m_),false)};A.scale=function(n,h){this.arcScaleX_*=n;this.arcScaleY_*=h;y(this,d([[n,0,0],[0,h,0],[0,0,1]],this.m_),true)};A=H.prototype=Error();A.INDEX_SIZE_ERR=1;A.DOMSTRING_SIZE_ERR=2;A.HIERARCHY_REQUEST_ERR=3;A.WRONG_DOCUMENT_ERR=
4;A.INVALID_CHARACTER_ERR=5;A.NO_DATA_ALLOWED_ERR=6;A.NO_MODIFICATION_ALLOWED_ERR=7;A.NOT_FOUND_ERR=8;A.NOT_SUPPORTED_ERR=9;A.INUSE_ATTRIBUTE_ERR=10;A.INVALID_STATE_ERR=11;A.SYNTAX_ERR=12;A.INVALID_MODIFICATION_ERR=13;A.NAMESPACE_ERR=14;A.INVALID_ACCESS_ERR=15;A.VALIDATION_ERR=16;A.TYPE_MISMATCH_ERR=17;G_vmlCanvasManager=z;CanvasRenderingContext2D=t;DOMException=H}();
(function(f){function v(a){var c=[].slice.call(arguments,1),b=0;a=f.event.fix(a||window.event);a.type="mousewheel";if(a.wheelDelta)b=a.wheelDelta/120;if(a.detail)b=-a.detail/3;c.unshift(a,b);return f.event.handle.apply(this,c)}var r=["DOMMouseScroll","mousewheel"];f.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=r.length;a;)this.addEventListener(r[--a],v,false);else this.onmousewheel=v},teardown:function(){if(this.removeEventListener)for(var a=r.length;a;)this.removeEventListener(r[--a],
v,false);else this.onmousewheel=null}};f.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);
$.widget||function(f,v){var r=Array.prototype.slice,a=f.cleanData;f.cleanData=function(c){for(var b=0,d;(d=c[b])!=null;b++)f(d).triggerHandler("remove");a(c)};f.widget=function(c,b,d){var g=c.split(".")[0],e;c=c.split(".")[1];e=g+"-"+c;if(!d){d=b;b=f.Widget}f.expr[":"][e]=function(l){return!!f.data(l,c)};f[g]=f[g]||{};f[g][c]=f.extend(function(l,o){if(!this._createWidget)return new f[g][c](l,o);arguments.length&&this._createWidget(l,o)},f[g][c]);var p=new b;p.options=f.extend(true,{},p.options);f.each(d,
function(l,o){if(f.isFunction(o))d[l]=function(){var t=function(w){return b.prototype[w].apply(this,r.call(arguments,1))},s=function(w,y){return b.prototype[w].apply(this,y)};return function(){var w=this._super,y=this._superApply,H;this._super=t;this._superApply=s;H=o.apply(this,arguments);this._super=w;this._superApply=y;return H}}()});f[g][c].prototype=f.extend(true,p,{namespace:g,widgetName:c,widgetEventPrefix:c,widgetBaseClass:e},d);f.widget.bridge(c,f[g][c])};f.widget.bridge=function(c,b){f.fn[c]=
function(d){var g=typeof d==="string",e=r.call(arguments,1),p=this;d=!g&&e.length?f.extend.apply(null,[true,d].concat(e)):d;g?this.each(function(){var l=f.data(this,c);if(!l)return f.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+d+"'");if(!f.isFunction(l[d])||d.charAt(0)==="_")return f.error("no such method '"+d+"' for "+c+" widget instance");var o=l[d].apply(l,e);if(o!==l&&o!==v){p=o;return false}}):this.each(function(){var l=f.data(this,c);l?l.option(d||
{})._init():b(d,this)});return p}};f.Widget=function(c,b){if(!this._createWidget)return new f[namespace][name](c,b);arguments.length&&this._createWidget(c,b)};f.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false},_createWidget:function(c,b){b=f(b||this.defaultElement||this)[0];this.element=f(b);this.options=f.extend(true,{},this.options,this._getCreateOptions(),c);this.bindings=f();this.hoverable=f();this.focusable=f();if(b!==this){f.data(b,this.widgetName,
this);this._bind({remove:"destroy"})}this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return f.metadata&&f.metadata.get(this.element[0])[this.widgetName]},_create:f.noop,_init:f.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");
this.focusable.removeClass("ui-state-focus")},_destroy:f.noop,widget:function(){return this.element},option:function(c,b){var d=c;if(arguments.length===0)return f.extend({},this.options);if(typeof c==="string"){if(b===v)return this.options[c];d={};d[c]=b}this._setOptions(d);return this},_setOptions:function(c){var b=this;f.each(c,function(d,g){b._setOption(d,g)});return this},_setOption:function(c,b){this.options[c]=b;if(c==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",
!!b).attr("aria-disabled",b);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_bind:function(c,b){if(b){c=f(c);this.bindings=this.bindings.add(c)}else{b=c;c=this.element}var d=this;f.each(b,function(g,e){c.bind(g+"."+d.widgetName,function(){if(!(d.options.disabled===true||f(this).hasClass("ui-state-disabled")))return(typeof e===
"string"?d[e]:e).apply(d,arguments)})})},_hoverable:function(c){this.hoverable=this.hoverable.add(c);this._bind(c,{mouseenter:function(b){f(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){f(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(c){this.focusable=this.focusable.add(c);this._bind(c,{focusin:function(b){f(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){f(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(c,b,d){var g=
this.options[c];b=f.Event(b);b.type=(c===this.widgetEventPrefix?c:this.widgetEventPrefix+c).toLowerCase();d=d||{};if(b.originalEvent){c=f.event.props.length;for(var e;c;){e=f.event.props[--c];b[e]=b.originalEvent[e]}}this.element.trigger(b,d);d=f.isArray(d)?[b].concat(d):[b,d];return!(f.isFunction(g)&&g.apply(this.element[0],d)===false||b.isDefaultPrevented())}}}(jQuery);
window.JsViews||window.jQuery&&jQuery.views||function(f,v){function r(h,m,q,x,u){var B=(q=q||{viewsCount:0,ctx:o.helpers})&&q.ctx;return{jsViews:"v1.0pre",path:m||"",itemNumber:++q.viewsCount||1,viewsCount:0,tmpl:u,data:x||q.data||{},ctx:h&&h===B?B:B?z(z({},B),h):h||{},parent:q}}function a(h,m,q,x,u,B,F){return q?(x?u?"$view."+u:q:"$data."+q)+(B||""):F||m||""}function c(h){function m(N){N-=x;N&&F.push(h.substr(x,N).replace(I,"\\n"))}var q,x=0,u=[],B=[],F=B,L=[,,B];h=h.replace(Q,"\\$1");h.replace(w,
function(N,S,O,ga,ha,T,ia,ja,ka,ca){function la(Z,V,ma,da,na,oa,ea,fa,pa,qa){return W?(W=!ea,W?Z:'"'):X?(X=!fa,X?Z:'"'):da?V.replace(J,a)+da:na?Y?"":(aa=E,"\u0008"+V+":"):ma?(Y++,V.replace(J,a)+"("):pa?(Y--,")"):V?V.replace(J,a):oa?",":qa?Y?"":aa?(aa=C,"\u0008"):",":(W=ea,X=fa,'"')}var aa,ba="",Y=0,X=C,W=C;O=O||ga;m(ca);if(ha)o.allowCode&&F.push(["*",T.replace(P,"$1")]);else if(O){if(O==="else"){L=u.pop();F=L[2];S=E}T=T?(T+" ").replace(D,la).replace(A,function(Z,V){ba+=V+",";return""}):"";T=T.slice(0,
-1);q=[O,ia?ja||"none":"",S&&[],"{"+ba+"_hash:'"+ba+"',_path:'"+T+"'}",T];if(S){u.push(L);L=q}F.push(q)}else if(ka)L=u.pop();x=ca+N.length;if(!L)throw"Expected block tag";F=L[2]});m(h.length);return b(B)}function b(h){var m,q,x=[],u=h.length,B="try{var views="+(G?"jQuery":"JsViews")+'.views,tag=views.renderTag,enc=views.encode,html=views.encoders.html,$ctx=$view && $view.ctx,result=""+\n\n';for(q=0;q<u;q++){m=h[q];if(m[0]==="*")B=B.slice(0,q?-1:-3)+";"+m[1]+(q+1<u?"result+=":"");else if(""+m===m)B+=
'"'+m+'"+';else{var F=m[0],L=m[1],N=m[2],S=m[3];m=m[4];var O=m+'||"")+';N&&x.push(b(N));B+=F==="="?!L||L==="html"?"html("+O:L==="none"?"("+O:'enc("'+L+'",'+O:'tag("'+F+'",$view,"'+(L||"")+'",'+(N?x.length:'""')+","+S+(m?",":"")+m+")+"}}h=new Function("$data, $view",B.slice(0,-1)+";return result;\n\n}catch(e){return views.err(e);}");h.nested=x;return h}function d(h){return M[h]||(M[h]="&#"+h.charCodeAt(0)+";")}function g(h){try{return e(h)}catch(m){}return h}var e,p,l,o,t,s,w,y,H,z,C=false,E=true,
G=f.jQuery,R=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,J=/^(true|false|null|[\d\.]+)|(\w+|\$(view|data|ctx|(\w+)))([\w\.]*)|((['"])(?:\\\1|.)*\7)$/g,D=/(\$?[\w\.\[\]]+)(?:(\()|\s*(===|!==|==|!=|<|>|<=|>=)\s*|\s*(\=)\s*)?|(\,\s*)|\\?(\')|\\?(\")|(\))|(\s+)/g,I=/\r?\n/g,P=/\\(['"])/g,Q=/\\?(['"])/g,A=/\x08([^\x08]+)\x08/g,K=0,M={"&":"&amp;","<":"&lt;",">":"&gt;"},U=/[\x00"&'<>]/g,n=Array.prototype.slice;if(G){e=G;e.fn.extend({render:function(h,m,q,x){return s(h,this[0],m,q,x)},template:function(h,m){return e.template(h,
this[0],m)}})}else{p=f.$;f.JsViews=l=f.$=e={extend:function(h,m){for(var q in m)h[q]=m[q];return h},isArray:Array.isArray||function(h){return Object.prototype.toString.call(h)==="[object Array]"},noConflict:function(){if(f.$===l)f.$=p;return l}}}z=e.extend;z(e,{views:o={templates:{},tags:{"if":function(){var h=this._view;h.onElse=function(m,q){for(var x=0,u=q.length;u&&!q[x++];)if(x===u)return"";h.onElse=v;return s(h.data,m.tmpl,h.ctx,h)};return h.onElse(this,arguments)},"else":function(){var h=this._view;
return h.onElse?h.onElse(this,arguments):""},each:function(){var h,m="",q=arguments,x=q.length,u=this.tmpl,B=this._view;for(h=0;h<x;h++)m+=q[h]?s(q[h],u,this.ctx||B.ctx,B,this._path,this._ctor):"";return x?m:m+s(B.data,u,B.ctx,B,this._path,this.tag)},"=":function(h){return h},"*":function(h){return h}},helpers:{not:function(h){return!h}},allowCode:C,debugMode:E,err:function(h){return o.debugMode?"<br/><b>Error:</b> <em> "+(h.message||h)+". </em>":'""'},setDelimiters:function(h,m){var q=m.charAt(0),
x=m.charAt(1);h="\\"+h.charAt(0)+"\\"+h.charAt(1);m="\\"+q+"\\"+x;w=h+"(?:(?:(\\#)?(\\w+(?=[!\\s\\"+q+"]))|(?:(\\=)|(\\*)))\\s*((?:[^\\"+q+"]|\\"+q+"(?!\\"+x+"))*?)(!(\\w*))?|(?:\\/([\\w\\$\\.\\[\\]]+)))"+m;w=RegExp(w,"g")},registerTags:y=function(h,m){var q;if(typeof h==="object")for(q in h)y(q,h[q]);else o.tags[h]=m;return this},registerHelpers:H=function(h,m){if(typeof h==="object")for(var q in h)H(q,h[q]);else o.helpers[h]=m;return this},encode:function(h,m){return m?(t[h||"html"]||t.html)(m):
""},encoders:t={none:function(h){return h},html:function(h){return String(h).replace(U,d)}},renderTag:function(h,m,q,x,u){var B,F;B=arguments;F=o.presenters;hash=u._hash;tagFn=o.tags[h];if(!tagFn)return"";x=x&&m.tmpl.nested[x-1];u.tmpl=u.tmpl||x||v;if(F&&F[h]){F=z(z({},u.ctx),u);delete F.ctx;delete F._path;delete F.tmpl;u.ctx=F;u._ctor=h+(hash?"="+hash.slice(0,-1):"");u=z(z({},tagFn),u);tagFn=o.tags.each}u._encode=q;u._view=m;return(B=tagFn.apply(u,B.length>5?n.call(B,5):[m.data]))||(B===v?"":B.toString())}},
render:s=function(h,m,q,x,u,B){var F,L,N,S,O="";if(arguments.length===2&&h.jsViews){x=h;q=x.ctx;h=x.data}m=e.template(m);if(!m)return"";if(e.isArray(h)){S=new r(q,u,x,h);F=0;for(L=h.length;F<L;F++){N=(N=h[F])?m(N,new r(q,u,S,N,m,this)):"";O+=o.activeViews?"<!--item--\>"+N+"<!--/item--\>":N}}else O+=m(h,new r(q,u,x,h,m));return o.activeViews?"<!--tmpl("+(u||"")+") "+(B?"tag="+B:m._name)+"--\>"+O+"<!--/tmpl--\>":O},template:function(h,m){if(m){if(""+m===m)m=c(m);else if(G&&m instanceof e)m=m[0];if(m){if(G&&
m.nodeType)m=e.data(m,"tmpl")||e.data(m,"tmpl",c(m.innerHTML));o.templates[m._name=m._name||h||"_"+K++]=m}return m}return h?""+h!==h?h._name?h:e.template(null,h):o.templates[h]||e.template(null,R.test(h)?h:g(h)):null}});o.setDelimiters("{{","}}")}(window);
(function(f,v,r){var a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;f.geo={_allCoordinates:function(b){b=this._flatten(b);for(var d=0,g=[];d<b.length;d++){var e=b[d].coordinates,p=e&&f.isArray(e[0]),l=p&&f.isArray(e[0][0]),o;if(!(l&&f.isArray(e[0][0][0]))){if(!l){p||(e=[e]);e=[e]}e=[e]}for(p=0;p<e.length;p++)for(l=0;l<e[p].length;l++)for(o=0;o<e[p][l].length;o++)g.push(e[p][l][o])}return g},center:function(b,d){if(!d&&f.geo.proj)b=f.geo.proj.fromGeodetic(b);var g=[(b[0]+b[2])/2,(b[1]+b[3])/
2];return!d&&f.geo.proj?f.geo.proj.toGeodetic(g):g},expandBy:function(b,d,g){if(f.geo.proj)b=f.geo.proj.fromGeodetic(b);b=[b[0]-d,b[1]-g,b[2]+d,b[3]+g];return f.geo.proj?f.geo.proj.toGeodetic(b):b},height:function(b,d){if(!d&&f.geo.proj)b=f.geo.proj.fromGeodetic(b);return b[3]-b[1]},_in:function(b,d){return b[0]<=d[0]&&b[1]<=d[1]&&b[2]>=d[2]&&b[3]>=d[3]},_bboxDisjoint:function(b,d){return d[0]>b[2]||d[2]<b[0]||d[1]>b[3]||d[3]<b[1]},reaspect:function(b,d,g){if(!g&&f.geo.proj)b=f.geo.proj.fromGeodetic(b);
var e=this.width(b,true),p=this.height(b,true);g=this.center(b,true);if(e!=0&&p!=0&&d>0){if(e/p>d){b=e/2;e=b/d}else{e=p/2;b=e*d}b=[g[0]-b,g[1]-e,g[0]+b,g[1]+e]}return f.geo.proj?f.geo.proj.toGeodetic(b):b},scaleBy:function(b,d,g){if(!g&&f.geo.proj)b=f.geo.proj.fromGeodetic(b);var e=this.center(b,true),p=(b[2]-b[0])*d/2;b=(b[3]-b[1])*d/2;b=[e[0]-p,e[1]-b,e[0]+p,e[1]+b];return!g&&f.geo.proj?f.geo.proj.toGeodetic(b):b},width:function(b,d){if(!d&&f.geo.proj)b=f.geo.proj.fromGeodetic(b);return b[2]-b[0]},
bbox:function(b,d){if(b)if(b.bbox)result=!d&&f.geo.proj?f.geo.proj.fromGeodetic(b.bbox):b.bbox;else{result=[a,a,c,c];var g=this._allCoordinates(b),e=0;if(g.length==0)return r;if(f.geo.proj)g=f.geo.proj.fromGeodetic(g);for(;e<g.length;e++){result[0]=Math.min(g[e][0],result[0]);result[1]=Math.min(g[e][1],result[1]);result[2]=Math.max(g[e][0],result[2]);result[3]=Math.max(g[e][1],result[3])}}else return r;return f.geo.proj?f.geo.proj.toGeodetic(result):result},centroid:function(b,d){switch(b.type){case "Point":return f.extend({},
b);case "LineString":case "Polygon":var g=0,e=[0,0],p=f.merge([],b.type=="Polygon"?b.coordinates[0]:b.coordinates),l=1,o,t;if(!d&&f.geo.proj)p=f.geo.proj.fromGeodetic(p);for(;l<=p.length;l++){o=l%p.length;t=p[l-1][0]*p[o][1]-p[o][0]*p[l-1][1];g+=t;e[0]+=(p[l-1][0]+p[o][0])*t;e[1]+=(p[l-1][1]+p[o][1])*t}if(g==0)if(p.length>0){e[0]=p[0][0];e[1]=p[0][1];return{type:"Point",coordinates:!d&&f.geo.proj?f.geo.proj.toGeodetic(e):e}}else break;g*=3;e[0]/=g;e[1]/=g;return{type:"Point",coordinates:!d&&f.geo.proj?
f.geo.proj.toGeodetic(e):e}}return r},contains:function(b,d){if(b.type!="Polygon")return false;switch(d.type){case "Point":return this._containsPolygonPoint(b.coordinates,d.coordinates);case "LineString":return this._containsPolygonLineString(b.coordinates,d.coordinates);case "Polygon":return this._containsPolygonLineString(b.coordinates,d.coordinates[0]);default:return false}},_containsPolygonPoint:function(b,d){if(b.length==0||b[0].length<4)return false;for(var g=0,e=b[0][0],p=1,l;p<b[0].length;p++){l=
b[0][p];if(e[1]<=d[1]&&d[1]<l[1]||l[1]<=d[1]&&d[1]<e[1]&&(d[0]<e[0]||d[0]<l[0])){e=e[0]+(l[0]-e[0])*(d[1]-e[1])/(l[1]-e[1]);e>d[0]&&g++}e=l}return g%2==1},_containsPolygonLineString:function(b,d){for(var g=0;g<d.length;g++)if(!this._containsPolygonPoint(b,d[g]))return false;return true},distance:function(b,d,g){var e=!g&&f.geo.proj?f.geo.proj.fromGeodetic(b.coordinates):b.coordinates;g=!g&&f.geo.proj?f.geo.proj.fromGeodetic(d.coordinates):d.coordinates;switch(b.type){case "Point":switch(d.type){case "Point":return this._distancePointPoint(g,
e);case "LineString":return this._distanceLineStringPoint(g,e);case "Polygon":return this._containsPolygonPoint(g,e)?0:this._distanceLineStringPoint(g[0],e);default:return r}case "LineString":switch(d.type){case "Point":return this._distanceLineStringPoint(e,g);case "LineString":return this._distanceLineStringLineString(e,g);case "Polygon":return this._containsPolygonLineString(g,e)?0:this._distanceLineStringLineString(g[0],e);default:return r}case "Polygon":switch(d.type){case "Point":return this._containsPolygonPoint(e,
g)?0:this._distanceLineStringPoint(e[0],g);case "LineString":return this._containsPolygonLineString(e,g)?0:this._distanceLineStringLineString(e[0],g);case "Polygon":return this._containsPolygonLineString(e,g[0])?0:this._distanceLineStringLineString(e[0],g[0]);default:return r}}},_distancePointPoint:function(b,d){var g=d[0]-b[0],e=d[1]-b[1];return Math.sqrt(g*g+e*e)},_distanceLineStringPoint:function(b,d){var g=a;if(b.length>0){var e=b[0],p=d[0]-e[0],l=d[1]-e[1];if(b.length==1)return Math.sqrt(p*p+
l*l);else for(var o=1;o<b.length;o++){var t=b[o],s=d[0]-t[0],w=d[1]-t[1];e=this._distanceSegmentPoint(t[0]-e[0],t[1]-e[1],p,l,s,w);if(e==0)return 0;if(e<g)g=e;e=t;p=s;l=w}}return Math.sqrt(g)},_distanceSegmentPoint:function(b,d,g,e,p,l){var o=b*g+d*e;if(o<=0)return g*g+e*e;b=b*b+d*d;if(o>=b)return p*p+l*l;return g*g+e*e-o*o/b},_distanceLineStringLineString:function(b,d){for(var g=a,e=0;e<d.length;e++)g=Math.min(g,this._distanceLineStringPoint(b,d[e]));return g},_buffer:function(b,d,g){switch(b.type){case "Point":b=
!g&&f.geo.proj?f.geo.proj.fromGeodetic(b.coordinates):b.coordinates;for(var e=[],p=0,l;p<=180;p++){l=p*360/180*(Math.PI/180);e.push([b[0]+Math.cos(l)*d,b[1]+Math.sin(l)*d])}return{type:"Polygon",coordinates:[!g&&f.geo.proj?f.geo.proj.toGeodetic(e):e]};default:return r}},_flatten:function(b){var d=[],g=0;switch(b.type){case "Feature":f.merge(d,this._flatten(b.geometry));break;case "FeatureCollection":for(;g<b.features.length;g++)f.merge(d,this._flatten(b.features[g].geometry));break;case "GeometryCollection":for(;g<
b.geometries.length;g++)f.merge(d,this._flatten(b.geometries[g]));break;default:d[0]=b}return d},length:function(b,d){var g=0,e,p=1,l,o;switch(b.type){case "Point":return 0;case "LineString":e=!d&&f.geo.proj?f.geo.proj.fromGeodetic(b.coordinates):b.coordinates;break;case "Polygon":e=!d&&f.geo.proj?f.geo.proj.fromGeodetic(b.coordinates[0]):b.coordinates[0]}if(e){for(;p<e.length;p++){l=e[p][0]-e[p-1][0];o=e[p][1]-e[p-1][1];g+=Math.sqrt(l*l+o*o)}return g}},area:function(b,d){var g=0,e,p=1,l;switch(b.type){case "Point":case "LineString":return 0;
case "Polygon":e=!d&&f.geo.proj?f.geo.proj.fromGeodetic(b.coordinates[0]):b.coordinates[0]}if(e){for(;p<=e.length;p++){l=p%e.length;g+=(e[p-1][0]-e[l][0])*(e[p-1][1]+e[l][1])/2}return Math.abs(g)}},pointAlong:function(b,d,g){var e=0,p=0,l=0,o,t=[],s=1,w;switch(b.type){case "Point":return f.extend({},b);case "LineString":o=b.coordinates;break;case "Polygon":o=b.coordinates[0]}if(o)if(d===0)return{type:"Point",coordinates:[o[0][0],o[0][1]]};else if(d===1){s=o.length-1;return{type:"Point",coordinates:[o[s][0],
o[s][1]]}}else{for(o=!g&&f.geo.proj?f.geo.proj.fromGeodetic(o):o;s<o.length;s++){b=o[s][0]-o[s-1][0];w=o[s][1]-o[s-1][1];b=Math.sqrt(b*b+w*w);t.push(b);e+=b}for(s=0;s<t.length&&l<d;s++){p=l;l+=t[s]/e}d=d-p;e=o[s-1];o=o[s];o=[e[0]+d*(o[0]-e[0]),e[1]+d*(o[1]-e[1])];return{type:"Point",coordinates:!g&&f.geo.proj?f.geo.proj.toGeodetic(o):o}}},_WKT:function(){function b(e){if(e&&e.length){for(var p=[],l=0;l<e.length;l++)p.push(e[l].join(" "));return"("+p+")"}else return"EMPTY"}function d(e){if(e&&e.length){for(var p=
[],l=0;l<e.length;l++)p.push(b(e[l]));return"("+p+")"}else return"EMTPY"}function g(e){if(e&&e.type)switch(e.type){case "Point":return"POINT "+(e.coordinates&&e.coordinates.length?"("+e.coordinates.join(" ")+")":"EMPTY");case "LineString":return"LINESTRING "+b(e.coordinates);case "Polygon":return"POLYGON "+d(e.coordinates);case "MultiPoint":return"MULTIPOINT "+b(e.coordinates);case "MultiLineString":return"MULTILINSTRING "+d(e.coordinates);case "MultiPolygon":if((e=e.coordinates)&&e.length){for(var p=
[],l=0;l<e.length;l++)p.push(d(e[l]));e="("+p+")"}else e="EMPTY";return"MULTIPOLYGON "+e;case "GeometryCollection":if((e=e.geometries)&&e.length){p=[];for(l=0;l<e.length;l++)p.push(g(e[l]));e="("+e+")"}else e="EMPTY";return"GEOMETRYCOLLECTION "+e;default:return""}else return""}return{stringify:g,parse:function(e){e=f.trim(e);var p=e.indexOf(" ");switch(e.substr(0,p).toUpperCase()){case "POINT":return(e=e.substr(p+1).match(/\(\s*([\d\.-]+)\s+([\d\.-]+)\s*\)/))&&e.length>=2?{type:"Point",coordinates:[parseFloat(e[1]),
parseFloat(e[2])]}:null}}}}(),proj:function(){return{fromGeodeticPos:function(b){if(!b)debugger;return[6378137*b[0]*0.017453292519943295,6378137*Math.log(Math.tan(0.7853981633974483+b[1]*0.017453292519943295/2))]},fromGeodetic:function(b){var d=f.isArray(b[0]),g=this.fromGeodeticPos;if(!d&&b.length==4){d=g([b[0],b[1]]);b=g([b[2],b[3]]);return[d[0],d[1],b[0],b[1]]}else{var e=d&&f.isArray(b[0][0]),p=e&&f.isArray(b[0][0][0]),l=[],o,t,s;if(!p){if(!e){d||(b=[b]);b=[b]}b=[b]}for(o=0;o<b.length;o++){l[o]=
[];for(t=0;t<b[o].length;t++){l[o][t]=[];for(s=0;s<b[o][t].length;s++)l[o][t][s]=g(b[o][t][s])}}return p?l:e?l[0]:d?l[0][0]:l[0][0][0]}},toGeodeticPos:function(b){return[b[0]/6378137*57.29577951308232,(1.5707963267948966-2*Math.atan(1/Math.exp(b[1]/6378137)))*57.29577951308232]},toGeodetic:function(b){var d=f.isArray(b[0]),g=this.toGeodeticPos;if(!d&&b.length==4){d=g([b[0],b[1]]);b=g([b[2],b[3]]);return[d[0],d[1],b[0],b[1]]}else{var e=d&&f.isArray(b[0][0]),p=e&&f.isArray(b[0][0][0]),l=[];if(!p){if(!e){d||
(b=[b]);b=[b]}b=[b]}for(i=0;i<b.length;i++){l[i]=[];for(j=0;j<b[i].length;j++){l[i][j]=[];for(k=0;k<b[i][j].length;k++)l[i][j][k]=g(b[i][j][k])}}return p?l:e?l[0]:d?l[0][0]:l[0][0][0]}}}}(),_serviceTypes:{}}})(jQuery,this);
(function(f,v){var r=function(){for(var a=5,c=document.createElement("div"),b=c.all||[];c.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",b[0];);return a>6?a:!a}();f.widget("geo.geographics",{_$elem:v,_options:{},_trueCanvas:true,_width:0,_height:0,_$canvas:v,_context:v,options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:0.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"}},_create:function(){this._$elem=this.element;this._options=this.options;
this._$elem.css({display:"inline-block",overflow:"hidden",textAlign:"left"});this._$elem.css("position")=="static"&&this._$elem.css("position","relative");this._width=this._$elem.width();this._height=this._$elem.height();if(!(this._width&&this._height)){this._width=parseInt(this._$elem.css("width"));this._height=parseInt(this._$elem.css("height"))}if(document.createElement("canvas").getContext){this._$elem.append('<canvas width="'+this._width+'" height="'+this._height+'" style="position:absolute; left:0; top:0; width:'+
this._width+"px; height:"+this._height+'px;"></canvas>');this._$canvas=this._$elem.children(":last");this._context=this._$canvas[0].getContext("2d")}else if(r<=8){this._trueCanvas=false;this._$elem.append('<div width="'+this._width+'" height="'+this._height+'" style="position:absolute; left:0; top:0; width:'+this._width+"px; height:"+this._height+'px; margin:0; padding:0;"></div>');this._$canvas=this._$elem.children(":last");G_vmlCanvasManager.initElement(this._$canvas[0]);this._context=this._$canvas[0].getContext("2d");
this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})}},_setOption:function(a,c){if(a=="style")c=f.extend({},this._options.style,c);f.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){f.Widget.prototype.destroy.apply(this,arguments);this._$elem.html("")},clear:function(){this._context.clearRect(0,0,this._width,this._height)},drawArc:function(a,c,b,d){d=this._getGraphicStyle(d);if(d.visibility!="hidden"&&d.opacity>0&&d.widthValue>0&&
d.heightValue>0){var g=Math.min(d.widthValue,d.heightValue)/2;c=c*Math.PI/180;b=b*Math.PI/180;this._context.save();this._context.translate(a[0],a[1]);d.widthValue>d.heightValue?this._context.scale(d.widthValue/d.heightValue,1):this._context.scale(1,d.heightValue/d.widthValue);this._context.beginPath();this._context.arc(0,0,g,c,b,false);this._trueCanvas&&this._context.restore();if(d.doFill){this._context.fillStyle=d.fill;this._context.globalAlpha=d.opacity*d.fillOpacity;this._context.fill()}if(d.doStroke){this._context.lineJoin=
"round";this._context.lineWidth=d.strokeWidthValue;this._context.strokeStyle=d.stroke;this._context.globalAlpha=d.opacity*d.strokeOpacity;this._context.stroke()}this._trueCanvas||this._context.restore()}},drawPoint:function(a,c){c=this._getGraphicStyle(c);if(c.widthValue==c.heightValue&&c.heightValue==c.borderRadiusValue)this.drawArc(a,0,360,c);else if(c.visibility!="hidden"&&c.opacity>0){c.borderRadiusValue=Math.min(Math.min(c.widthValue,c.heightValue)/2,c.borderRadiusValue);a[0]-=c.widthValue/2;
a[1]-=c.heightValue/2;this._context.beginPath();this._context.moveTo(a[0]+c.borderRadiusValue,a[1]);this._context.lineTo(a[0]+c.widthValue-c.borderRadiusValue,a[1]);this._context.quadraticCurveTo(a[0]+c.widthValue,a[1],a[0]+c.widthValue,a[1]+c.borderRadiusValue);this._context.lineTo(a[0]+c.widthValue,a[1]+c.heightValue-c.borderRadiusValue);this._context.quadraticCurveTo(a[0]+c.widthValue,a[1]+c.heightValue,a[0]+c.widthValue-c.borderRadiusValue,a[1]+c.heightValue);this._context.lineTo(a[0]+c.borderRadiusValue,
a[1]+c.heightValue);this._context.quadraticCurveTo(a[0],a[1]+c.heightValue,a[0],a[1]+c.heightValue-c.borderRadiusValue);this._context.lineTo(a[0],a[1]+c.borderRadiusValue);this._context.quadraticCurveTo(a[0],a[1],a[0]+c.borderRadiusValue,a[1]);this._context.closePath();if(c.doFill){this._context.fillStyle=c.fill;this._context.globalAlpha=c.opacity*c.fillOpacity;this._context.fill()}if(c.doStroke){this._context.lineJoin="round";this._context.lineWidth=c.strokeWidthValue;this._context.strokeStyle=c.stroke;
this._context.globalAlpha=c.opacity*c.strokeOpacity;this._context.stroke()}}},drawLineString:function(a,c){this._drawLines([a],false,c)},drawPolygon:function(a,c){this._drawLines(a,true,c)},drawBbox:function(a,c){this._drawLines([[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]],[a[0],a[1]]]],true,c)},_getGraphicStyle:function(a){function c(b){b=parseInt(b);return+b+""===b?+b:b}a=f.extend({},this._options.style,a);a.borderRadiusValue=c(a.borderRadius);a.fill=a.fill||a.color;a.doFill=a.fill&&a.fillOpacity>
0;a.stroke=a.stroke||a.color;a.strokeWidthValue=c(a.strokeWidth);a.doStroke=a.stroke&&a.strokeOpacity>0&&a.strokeWidthValue>0;a.widthValue=c(a.width);a.heightValue=c(a.height);return a},_drawLines:function(a,c,b){if(!(!a||!a.length||a[0].length<2)){b=this._getGraphicStyle(b);var d,g;if(b.visibility!="hidden"&&b.opacity>0){this._context.beginPath();this._context.moveTo(a[0][0][0],a[0][0][1]);for(d=0;d<a.length;d++)for(g=0;g<a[d].length;g++)this._context.lineTo(a[d][g][0],a[d][g][1]);c&&this._context.closePath();
if(c&&b.doFill){this._context.fillStyle=b.fill;this._context.globalAlpha=b.opacity*b.fillOpacity;this._context.fill()}if(b.doStroke){this._context.lineCap=this._context.lineJoin="round";this._context.lineWidth=b.strokeWidthValue;this._context.strokeStyle=b.stroke;this._context.globalAlpha=b.opacity*b.strokeOpacity;this._context.stroke()}}}}})})(jQuery);
(function(f,v){var r=function(){for(var a=5,c=document.createElement("div"),b=c.all||[];c.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",b[0];);return a>6?a:!a}();f.widget("geo.geomap",{_$elem:v,_created:false,_contentBounds:{},_$eventTarget:v,_$contentFrame:v,_$existingChildren:v,_$servicesContainer:v,_$panContainer:v,_$shapesContainer:v,_$labelsContainer:v,_$drawContainer:v,_$measureContainer:v,_$measureLabel:v,_dpi:96,_currentServices:[],_center:v,_pixelSize:v,_centerMax:v,_pixelSizeMax:v,
_wheelZoomFactor:1.18920711500273,_wheelTimeout:null,_wheelLevel:0,_zoomFactor:2,_mouseDown:v,_inOp:v,_toolPan:v,_shiftZoom:v,_anchor:v,_current:v,_downDate:v,_moveDate:v,_clickDate:v,_lastMove:v,_lastDrag:v,_windowHandler:null,_resizeTimeout:null,_panning:v,_velocity:v,_friction:v,_supportTouch:v,_softDblClick:v,_isTap:v,_isDbltap:v,_drawTimeout:null,_drawPixels:[],_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:f.extend({},{bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,
0],cursors:{pan:"move",zoom:"crosshair",drawPoint:"crosshair",drawLineString:"crosshair",drawPolygon:"crosshair",measureLength:"crosshair",measureArea:"crosshair"},measureLabels:{length:"{{=length.toFixed( 2 )}} m",area:"{{=area.toFixed( 2 )}} sq m"},drawStyle:{},shapeStyle:{},mode:"pan",services:[{"class":"osm",type:"tiled",src:function(a){return"http://tile.openstreetmap.org/"+a.zoom+"/"+a.tile.column+"/"+a.tile.row+".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,
tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},axisLayout:"map",zoom:0,pixelSize:0}),_createWidget:function(a,c){this._$elem=f(c);if(!this._$elem.is(".geo-service")){this._$elem.addClass("geo-map");this._initOptions=a||{};this._forcePosition(this._$elem);this._$elem.css("text-align","left");var b=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:b.width,height:b.height};
this._createChildren();this._center=this._centerMax=[0,0];this.options.pixelSize=this._pixelSize=this._pixelSizeMax=156543.03392799935;this._mouseDown=this._inOp=this._toolPan=this._shiftZoom=this._panning=this._isTap=this._isDbltap=false;this._anchor=[0,0];this._current=[0,0];this._lastMove=[0,0];this._lastDrag=[0,0];this._velocity=[0,0];this._friction=[0.8,0.8];this._downDate=this._moveDate=this._clickDate=0;this._drawPixels=[];this._drawCoords=[];this._graphicShapes=[]}f.Widget.prototype._createWidget.apply(this,
arguments)},_create:function(){if(!this._$elem.is(".geo-service")){this._options=this.options;this._softDblClick=(this._supportTouch="ontouchend"in document)||r==7;var a=this._supportTouch?"touchstart":"mousedown",c=this._supportTouch?"touchend touchcancel":"mouseup",b=this._supportTouch?"touchmove":"mousemove";f(document).keydown(f.proxy(this._document_keydown,this));this._$eventTarget.dblclick(f.proxy(this._eventTarget_dblclick,this));this._$eventTarget.bind(a,f.proxy(this._eventTarget_touchstart,
this));a=this._$eventTarget[0].setCapture?this._$eventTarget:f(document);a.bind(b,f.proxy(this._dragTarget_touchmove,this));a.bind(c,f.proxy(this._dragTarget_touchstop,this));this._$eventTarget.mousewheel(f.proxy(this._eventTarget_mousewheel,this));var d=this;this._windowHandler=function(){d._resizeTimeout&&clearTimeout(d._resizeTimeout);this._resizeTimeout=setTimeout(function(){d._created&&d._$elem.geomap("resize")},500)};f(window).resize(this._windowHandler);this._$drawContainer.geographics({style:this._initOptions.drawStyle||
{}});this._options.drawStyle=this._$drawContainer.geographics("option","style");this._$shapesContainer.geographics({style:this._initOptions.shapeStyle||{}});this._options.shapeStyle=this._$shapesContainer.geographics("option","style");if(this._initOptions){this._initOptions.tilingScheme&&this._setOption("tilingScheme",this._initOptions.tilingScheme,false);this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,false);this._initOptions.center&&this._setOption("center",this._initOptions.center,
false);this._initOptions.zoom!==v&&this._setZoom(this._initOptions.zoom,false,false)}f.template("geoMeasureLength",this._options.measureLabels.length);f.template("geoMeasureArea",this._options.measureLabels.area);this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._createServices();this._refresh();this._created=true}},_setOption:function(a,c,b){if(!(this._$elem.is(".geo-service")||a=="pixelSize")){b=b===v||b;switch(a){case "bbox":if(f.geo.proj){c=f.geo.proj.fromGeodetic([[c[0],
c[1]],[c[2],c[3]]]);c=[c[0][0],c[0][1],c[1][0],c[1][1]]}this._setBbox(c,false,b);c=this._getBbox();if(f.geo.proj){c=f.geo.proj.toGeodetic([[c[0],c[1]],[c[2],c[3]]]);c=[c[0][0],c[0][1],c[1][0],c[1][1]]}break;case "center":this._setCenterAndSize(f.geo.proj?f.geo.proj.fromGeodetic([[c[0],c[1]]])[0]:c,this._pixelSize,false,b);break;case "measureLabels":c=f.extend(this._options.measureLabels,c);f.template("geoMeasureLength",c.length);f.template("geoMeasureArea",c.area);break;case "drawStyle":if(this._$drawContainer){this._$drawContainer.geographics("option",
"style",c);c=this._$drawContainer.geographics("option","style")}break;case "shapeStyle":if(this._$shapesContainer){this._$shapesContainer.geographics("option","style",c);c=this._$shapesContainer.geographics("option","style")}break;case "mode":this._$drawContainer.geographics("clear");this._$eventTarget.css("cursor",this._options.cursors[c]);break;case "zoom":this._setZoom(c,false,b)}f.Widget.prototype._setOption.apply(this,arguments);switch(a){case "tilingScheme":this._pixelSizeMax=this._getTiledPixelSize(0);
this._centerMax=[c.origin[0]+this._pixelSizeMax*c.tileWidth/2,c.origin[1]+this._pixelSizeMax*c.tileHeight/2];break;case "services":this._createServices();b&&this._refresh();break;case "shapeStyle":if(b){this._$shapesContainer.geographics("clear");this._$labelsContainer.html("");this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes)}}}},destroy:function(){if(this._$elem.is(".geo-map")){this._created=false;f(window).unbind("resize",this._windowHandler);
for(var a=0;a<this._currentServices.length;a++){this._currentServices[a].serviceContainer.geomap("destroy");f.geo._serviceTypes[this._currentServices[a].type].destroy(this,this._$servicesContainer,this._currentServices[a])}this._$shapesContainer.geographics("destroy");this._$drawContainer.geographics("destroy");this._$existingChildren.detach();this._$elem.html("");this._$elem.append(this._$existingChildren);this._$elem.removeClass("geo-map")}f.Widget.prototype.destroy.apply(this,arguments)},toMap:function(a){a=
this._toMap(a);return f.geo.proj?f.geo.proj.toGeodetic(a):a},toPixel:function(a,c,b){a=f.geo.proj?f.geo.proj.fromGeodetic(a):a;return this._toPixel(a,c,b)},opacity:function(a,c){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("opacity",a,this._$elem);else if(a>=0||a<=1)for(var b=0;b<this._currentServices.length;b++){var d=this._currentServices[b];if(!c||d.serviceContainer[0]==c[0]){this._options.services[b].opacity=d.opacity=a;f.geo._serviceTypes[d.type].opacity(this,d)}}},
toggle:function(a,c){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("toggle",a,this._$elem);else for(var b=0;b<this._currentServices.length;b++){var d=this._currentServices[b];if(!c||d.serviceContainer[0]==c[0]){if(a===v)a=d.visibility===v||d.visibility==="visible"?false:true;this._options.services[b].visibility=d.visibility=a?"visible":"hidden";f.geo._serviceTypes[d.type].toggle(this,d);a&&f.geo._serviceTypes[d.type].refresh(this,d)}}},zoom:function(a){a!=null&&this._setZoom(this._options.zoom+
a,false,true)},refresh:function(){this._refresh()},resize:function(){var a=this._findMapSize(),c=a.width/2-this._contentBounds.width/2,b=a.height/2-this._contentBounds.height/2,d=this._$shapesContainer.geographics("option","style"),g=this._$drawContainer.geographics("option","style"),e;this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:a.width,height:a.height};this._$contentFrame.css({width:a.width,height:a.height});this._$servicesContainer.css({width:a.width,
height:a.height});this._$eventTarget.css({width:a.width,height:a.height});this._$drawContainer.geographics("destroy");this._$shapesContainer.geographics("destroy");for(e=0;e<this._currentServices.length;e++)f.geo._serviceTypes[this._currentServices[e].type].resize(this,this._currentServices[e]);this._$panContainer.css({width:a.width,height:a.height});this._$shapesContainer.geographics({style:d});this._$drawContainer.geographics({style:g});for(e=0;e<this._drawPixels.length;e++){this._drawPixels[e][0]+=
c;this._drawPixels[e][1]+=b}this._setCenterAndSize(this._center,this._pixelSize,false,true)},append:function(a){if(a&&f.isPlainObject(a)){var c,b,d,g,e,p;c=a.type=="FeatureCollection"?a.features:f.isArray(a)?a:[a];for(d=1;d<arguments.length;d++){b=arguments[d];if(typeof b==="object")g=b;else if(typeof b==="number"||typeof b==="string")e=b;else if(typeof b==="boolean")p=b}for(d=0;d<c.length;d++){if(c[d].type!="Point"){b=f.geo.bbox(c[d]);if(f.geo.proj)b=f.geo.proj.fromGeodetic(b);f.data(c[d],"geoBbox",
b)}this._graphicShapes.push({shape:c[d],style:g,label:e})}if(p===v||p)this._refresh()}},empty:function(a){f.each(this._graphicShapes,function(){f.removeData(this,"geoBbox")});this._graphicShapes=[];if(a===v||a)this._refresh()},find:function(a,c){this.toPixel(a.coordinates);var b=this._pixelSize*c,d=[],g;f.each(this._graphicShapes,function(){if(this.shape.type=="Point")f.geo.distance(this.shape,a)<=b&&d.push(this.shape);else{var e=f.data(this.shape,"geoBbox");e={type:"Polygon",coordinates:[[[e[0],
e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]]]};var p={type:"Point",coordinates:f.geo.proj?f.geo.proj.fromGeodetic(a.coordinates):a.coordinates};if(f.geo.distance(e,p,true)<=b){e=f.geo._flatten(this.shape);for(g=0;g<e.length;g++)if(f.geo.distance(e[g],a)<=b){d.push(this.shape);break}}}});return d},remove:function(a,c){var b=this;f.each(this._graphicShapes,function(d){if(this.shape==a){f.removeData(a,"geoBbox");var g=b._graphicShapes.slice(d+1);b._graphicShapes.length=d;b._graphicShapes.push.apply(b._graphicShapes,
g);return false}});if(c===v||c)this._refresh()},_getBbox:function(a,c){a=a||this._center;c=c||this._pixelSize;var b=this._contentBounds.width/2*c,d=this._contentBounds.height/2*c;return[a[0]-b,a[1]-d,a[0]+b,a[1]+d]},_setBbox:function(a,c,b){var d=[a[0]+(a[2]-a[0])/2,a[1]+(a[3]-a[1])/2];a=Math.max(f.geo.width(a,true)/this._contentBounds.width,f.geo.height(a,true)/this._contentBounds.height);if(this._options.tilingScheme)a=this._getTiledPixelSize(this._getTiledZoom(a));this._setCenterAndSize(d,a,c,
b)},_getBboxMax:function(){var a=this._contentBounds.width/2*this._pixelSizeMax,c=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-a,this._centerMax[1]-c,this._centerMax[0]+a,this._centerMax[1]+c]},_getCenter:function(){return this._center},_getContentBounds:function(){return this._contentBounds},_getServicesContainer:function(){return this._$servicesContainer},_getZoom:function(){if(this._options.tilingScheme)return this._getTiledZoom(this._pixelSize);else{var a=this._contentBounds.width/
this._contentBounds.height,c=f.geo.reaspect(this._getBbox(),a,true);a=f.geo.reaspect(this._getBboxMax(),a,true);return Math.log(f.geo.width(a,true)/f.geo.width(c,true))/Math.log(this._zoomFactor)}},_setZoom:function(a,c,b){a=Math.max(a,0);if(this._options.tilingScheme)this._setCenterAndSize(this._center,this._getTiledPixelSize(a),c,b);else{a=f.geo.scaleBy(this._getBboxMax(),1/Math.pow(this._zoomFactor,a),true);this._setCenterAndSize(this._center,Math.max(f.geo.width(a,true)/this._contentBounds.width,
f.geo.height(a,true)/this._contentBounds.height),c,b)}},_createChildren:function(){this._$existingChildren=this._$elem.children().detach();this._forcePosition(this._$existingChildren);this._$existingChildren.css("-moz-user-select","none");var a="width:"+this._contentBounds.width+"px; height:"+this._contentBounds.height+"px; margin:0; padding:0;";this._$elem.prepend('<div class="geo-event-target geo-content-frame" style="position:absolute; left:'+this._contentBounds.x+"px; top:"+this._contentBounds.y+
"px;"+a+'overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;" unselectable="on"></div>');this._$eventTarget=this._$contentFrame=this._$elem.children(":first");this._$contentFrame.append('<div class="geo-services-container" style="position:absolute; left:0; top:0;'+a+'"></div>');this._$servicesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0;'+
a+'"></div>');this._$shapesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-labels-container" style="position:absolute; left:0; top:0;'+a+'"></div>');this._$labelsContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-draw-container" style="position:absolute; left:0; top:0;'+a+'"></div>');this._$drawContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-measure-container" style="position:absolute; left:0; top:0;'+
a+'"><div class="geo-measure-label" style="position:absolute; left:0; top:0;; display: none;"></div></div>');this._$measureContainer=this._$contentFrame.children(":last");this._$measureLabel=this._$measureContainer.children();this._$panContainer=f([this._$shapesContainer[0],this._$labelsContainer[0],this._$drawContainer[0],this._$measureContainer[0]]);this._$contentFrame.append(this._$existingChildren);f("#geo-measure-style").length||f("head").prepend('<style type="text/css" id="geo-measure-style">.geo-measure-label { margin: 4px 0 0 6px; font-family: sans-serif;'+
(r?"letter-spacing: 2px; color: #444; filter:progid:DXImageTransform.Microsoft.DropShadow(Color=white, OffX=1, OffY=2, Positive=true);":"color: #000; text-shadow: #fff 1px 2px; font-weight: bold;")+" }</style>")},_createServices:function(){var a;for(a=0;a<this._currentServices.length;a++){this._currentServices[a].serviceContainer.geomap("destroy");f.geo._serviceTypes[this._currentServices[a].type].destroy(this,this._$servicesContainer,this._currentServices[a])}this._currentServices=[];for(a=0;a<this._options.services.length;a++){this._currentServices[a]=
this._options.services[a];this._currentServices[a].serviceContainer=f.geo._serviceTypes[this._currentServices[a].type].create(this,this._$servicesContainer,this._currentServices[a],a).geomap()}},_refreshDrawing:function(){this._$drawContainer.geographics("clear");if(this._drawPixels.length>0){var a=this._options.mode,c=this._drawPixels,b=this._drawCoords,d,g;switch(a){case "measureLength":a="drawLineString";g={type:"LineString",coordinates:b};d=f.render({length:f.geo.length(g,true)},"geoMeasureLength");
g=f.merge([],c[c.length-1]);break;case "measureArea":a="drawPolygon";g={type:"Polygon",coordinates:[f.merge([],b)]};g.coordinates[0].push(b[0]);d=f.render({area:f.geo.area(g,true)},"geoMeasureArea");g=f.merge([],c[c.length-1]);c=[c];break;case "drawPolygon":c=[c]}this._$drawContainer.geographics(a,c);if(d){this._$measureLabel.html(d);a=this._contentBounds.width-(this._$measureLabel.outerWidth(true)+g[0]);c=this._contentBounds.height-(this._$measureLabel.outerHeight(true)+g[1]);if(a<0)g[0]+=a;if(c<
0)g[1]+=c;this._$measureLabel.css({left:g[0],top:g[1]}).show()}}},_resetDrawing:function(){this._drawPixels=[];this._drawCoords=[];this._$drawContainer.geographics("clear");this._$measureLabel.hide()},_refreshShapes:function(a,c,b,d,g,e){var p,l,o,t,s,w,y,H=this._getBbox(g,e);for(p=0;p<c.length;p++){o=c[p].shape||c[p];o=o.geometry||o;l=f.data(o,"geoBbox");if(!(l&&f.geo._bboxDisjoint(H,l))){t=f.isArray(b)?b[p].style:b;s=f.isArray(d)?d[p].label:d;w=s!==v;y=v;switch(o.type){case "Point":y=this.toPixel(o.coordinates,
g,e);this._$shapesContainer.geographics("drawPoint",y,t);break;case "LineString":this._$shapesContainer.geographics("drawLineString",this.toPixel(o.coordinates,g,e),t);if(w)y=this.toPixel(f.geo.pointAlong(o,0.5).coordinates,g,e);break;case "Polygon":this._$shapesContainer.geographics("drawPolygon",this.toPixel(o.coordinates,g,e),t);if(w)y=this.toPixel(f.geo.centroid(o).coordinates,g,e);break;case "MultiPoint":for(l=0;l<o.coordinates.length;l++)this._$shapesContainer.geographics("drawPoint",this.toPixel(o.coordinates[l],
g,e),t);if(w)y=this.toPixel(f.geo.centroid(o).coordinates,g,e);break;case "MultiLineString":for(l=0;l<o.coordinates.length;l++)this._$shapesContainer.geographics("drawLineString",this.toPixel(o.coordinates[l],g,e),t);if(w)y=this.toPixel(f.geo.centroid(o).coordinates,g,e);break;case "MultiPolygon":for(l=0;l<o.coordinates.length;l++)this._$shapesContainer.geographics("drawPolygon",this.toPixel(o.coordinates[l],g,e),t);if(w)y=this.toPixel(f.geo.centroid(o).coordinates,g,e);break;case "GeometryCollection":this._refreshShapes(a,
o.geometries,t,s,g,e)}w&&y&&this._$labelsContainer.append('<div class="geo-label" style="position:absolute; left:'+y[0]+"px; top:"+y[1]+'px;">'+s+"</div>")}}},_findMapSize:function(){for(var a={width:0,height:0},c=this._$elem;c.size()&&!(a.width>0&&a.height>0);){a={width:c.width(),height:c.height()};if(a.width<=0||a.height<=0)a={width:parseInt(c.css("width")),height:parseInt(c.css("height"))};c=c.parent()}return a},_forcePosition:function(a){var c=a.css("position");c!="relative"&&c!="absolute"&&c!=
"fixed"&&a.css("position","relative")},_getTiledPixelSize:function(a){var c=this._options.tilingScheme;if(c!=null){if(a===0)return c.pixelSizes!=null?c.pixelSizes[0]:c.basePixelSize;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,(c.pixelSizes!=null?c.pixelSizes.length:c.levels)-1);return c.pixelSizes!=null?c.pixelSizes[a]:c.basePixelSize/Math.pow(2,a)}else return NaN},_getTiledZoom:function(a){var c=this._options.tilingScheme;if(c.pixelSizes!=null){a=Math.floor(a*1E3);for(var b=c.pixelSizes.length-
1;b>=0;b--)if(Math.floor(c.pixelSizes[b]*1E3)>=a)return b;return 0}else return Math.max(Math.round(Math.log(c.basePixelSize/a)/Math.log(2)),0)},_getZoomCenterAndSize:function(a,c,b){if(this._options.tilingScheme){c=this._getTiledZoom(this._pixelSize)+c;c=this._getTiledPixelSize(c)}else{c=Math.pow(b,-c);c=this._pixelSize*c}b=c/this._pixelSize;a=this._toMap(a);b=[(this._center[0]-a[0])*b,(this._center[1]-a[1])*b];return{pixelSize:c,center:[a[0]+b[0],a[1]+b[1]]}},_mouseWheelFinish:function(){this._wheelTimeout=
null;if(this._wheelLevel!=0){var a=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._wheelZoomFactor);this._setCenterAndSize(a.center,a.pixelSize,true,true);this._wheelLevel=0}else this._refresh()},_panEnd:function(){this._velocity=[this._velocity[0]>0?Math.floor(this._velocity[0]*this._friction[0]):Math.ceil(this._velocity[0]*this._friction[0]),this._velocity[1]>0?Math.floor(this._velocity[1]*this._friction[1]):Math.ceil(this._velocity[1]*this._friction[1])];if(Math.abs(this._velocity[0])<
4&&Math.abs(this._velocity[1])<4)this._panFinalize();else{this._current=[this._current[0]+this._velocity[0],this._current[1]+this._velocity[1]];this._panMove();setTimeout(f.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(this._panning){this._velocity=[0,0];var a=-(this._current[0]-this._anchor[0])*this._pixelSize,c=(this._options.axisLayout==="image"?-1:1)*(this._current[1]-this._anchor[1])*this._pixelSize;this._$panContainer.css({left:0,top:0});this._setCenterAndSize([this._center[0]+a,
this._center[1]+c],this._pixelSize,true,true);this._inOp=false;this._anchor=this._current;this._toolPan=this._panning=false;this._$eventTarget.css("cursor",this._options.cursors[this._options.mode])}},_panMove:function(){var a=this._current[0]-this._lastDrag[0],c=this._current[1]-this._lastDrag[1],b=0,d;if(this._toolPan||a>3||a<-3||c>3||c<-3){if(!this._toolPan){this._toolPan=true;this._$eventTarget.css("cursor",this._options.cursors.pan)}if(this._mouseDown)this._velocity=[a,c];if(a!=0||c!=0){this._panning=
true;this._lastDrag=this._current;for(b=0;b<this._options.services.length;b++){d=this._options.services[b];f.geo._serviceTypes[d.type].interactivePan(this,d,a,c)}this._$panContainer.css({left:function(g,e){return parseInt(e)+a},top:function(g,e){return parseInt(e)+c}})}}},_refresh:function(){for(var a=0;a<this._options.services.length;a++){var c=this._options.services[a];!this._mouseDown&&f.geo._serviceTypes[c.type]!=null&&f.geo._serviceTypes[c.type].refresh(this,c)}if(this._$shapesContainer){this._$shapesContainer.geographics("clear");
this._$labelsContainer.html("");this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes)}},_setCenterAndSize:function(a,c,b,d){if(this._pixelSize!=c){this._$shapesContainer.geographics("clear");for(var g=0;g<this._options.services.length;g++){var e=this._options.services[g];f.geo._serviceTypes[e.type].interactiveScale(this,e,a,c)}}this._center=a;this.options.pixelSize=this._pixelSize=c;if(f.geo.proj){a=this._getBbox();a=
f.geo.proj.toGeodetic([[a[0],a[1]],[a[2],a[3]]]);a=[a[0][0],a[0][1],a[1][0],a[1][1]];this._options.bbox=a;this._options.center=f.geo.proj.toGeodetic([[this._center[0],this._center[1]]])[0]}else{this._options.bbox=this._getBbox();this._options.center=this._center}this._options.zoom=this._getZoom();if(this._drawCoords.length>0)this._drawPixels=this._toPixel(this._drawCoords);b&&this._trigger("bboxchange",window.event,{bbox:this._options.bbox});if(d){this._refresh();this._refreshDrawing()}},_toMap:function(a,
c,b){c=c||this._center;b=b||this._pixelSize;var d=f.isArray(a[0]),g=d&&f.isArray(a[0][0]),e=g&&f.isArray(a[0][0][0]),p=this._contentBounds.width,l=this._contentBounds.height,o=p/2*b;b=l/2*b;c=[c[0]-o,c[1]-b,c[0]+o,c[1]+b];p=f.geo.width(c,true)/p;l=f.geo.height(c,true)/l;b=this._options.axisLayout==="image";var t=[],s,w,y;if(!e){if(!g){d||(a=[a]);a=[a]}a=[a]}for(s=0;s<a.length;s++){t[s]=[];for(w=0;w<a[s].length;w++){t[s][w]=[];for(y=0;y<a[s][w].length;y++){o=a[s][w][y][1]*l;t[s][w][y]=[c[0]+a[s][w][y][0]*
p,b?c[1]+o:c[3]-o]}}}return e?t:g?t[0]:d?t[0][0]:t[0][0][0]},_toPixel:function(a,c,b){c=c||this._center;b=b||this._pixelSize;var d=f.isArray(a[0]),g=d&&f.isArray(a[0][0]),e=g&&f.isArray(a[0][0][0]),p=this._contentBounds.width,l=this._contentBounds.height,o=p/2*b;b=l/2*b;c=[c[0]-o,c[1]-b,c[0]+o,c[1]+b];var t=f.geo.width(c,true);b=f.geo.height(c,true);o=this._options.axisLayout==="image";p=p/t;l=l/b;b=[];var s,w;if(!e){if(!g){d||(a=[a]);a=[a]}a=[a]}for(t=0;t<a.length;t++){b[t]=[];for(s=0;s<a[t].length;s++){b[t][s]=
[];for(w=0;w<a[t][s].length;w++)b[t][s][w]=[Math.round((a[t][s][w][0]-c[0])*p),Math.round((o?a[t][s][w][1]-c[1]:c[3]-a[t][s][w][1])*l)]}}return e?b:g?b[0]:d?b[0][0]:b[0][0][0]},_zoomTo:function(a,c,b,d){c=c<0?0:c;var g=this._getTiledPixelSize(c);if(isNaN(g)){c=f.geo._scaleBy(this._getBboxMax(),1/Math.pow(this._zoomFactor,c),true);c=Math.max(f.geo.width(c,true)/this._contentBounds.width,f.geo.height(c,true)/this._contentBounds.height);this._setCenterAndSize(a,c,b,d)}else this._setCenterAndSize(a,g,
b,d)},_document_keydown:function(a){var c=this._drawCoords.length;if(c>0&&a.which==27)if(c<=2){this._resetDrawing();this._inOp=false}else{this._drawCoords[c-2]=f.merge([],this._drawCoords[c-1]);this._drawPixels[c-2]=f.merge([],this._drawPixels[c-1]);this._drawCoords.length--;this._drawPixels.length--;this._refreshDrawing()}},_eventTarget_dblclick_zoom:function(a){this._trigger("dblclick",a,{type:"Point",coordinates:this.toMap(this._current)});if(!a.isDefaultPrevented()){a=this._getZoomCenterAndSize(this._current,
1,this._zoomFactor);this._setCenterAndSize(a.center,a.pixelSize,true,true)}},_eventTarget_dblclick:function(a){this._panFinalize();if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}f(a.currentTarget).offset();switch(this._options.mode){case "pan":case "drawPoint":this._eventTarget_dblclick_zoom(a);break;case "drawLineString":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){this._drawCoords.length--;
this._trigger("shape",a,{type:"LineString",coordinates:f.geo.proj?f.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})}else this._eventTarget_dblclick_zoom(a);this._resetDrawing();break;case "drawPolygon":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){var c=this._drawCoords.length-1;if(c>2){this._drawCoords[c]=f.merge([],this._drawCoords[0]);this._trigger("shape",a,{type:"Polygon",coordinates:[f.geo.proj?f.geo.proj.toGeodetic(this._drawCoords):
this._drawCoords]})}}else this._eventTarget_dblclick_zoom(a);this._resetDrawing();break;case "measureLength":case "measureArea":this._resetDrawing()}this._inOp=false},_eventTarget_touchstart:function(a){if(!(!this._supportTouch&&a.which!=1)){this._panFinalize();this._mouseWheelFinish();var c=f(a.currentTarget).offset();this._current=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-c.left,a.originalEvent.changedTouches[0].pageY-c.top]:[a.pageX-c.left,a.pageY-c.top];if(this._softDblClick){c=
f.now();if(c-this._downDate<750){if(this._isTap){var b=this._current[0]-this._anchor[0],d=this._current[1]-this._anchor[1];if(Math.sqrt(b*b+d*d)>10)this._isTap=false;else this._current=this._anchor}this._isDbltap=this._isDbltap?false:this._isTap}else this._isDbltap=false;this._isTap=true;this._downDate=c}this._mouseDown=true;this._anchor=this._current;if(!this._inOp&&a.shiftKey){this._shiftZoom=true;this._$eventTarget.css("cursor",this._options.cursors.zoom)}else{this._inOp=true;switch(this._options.mode){case "pan":case "drawPoint":case "drawLineString":case "drawPolygon":case "measureLength":case "measureArea":this._lastDrag=
this._current;a.currentTarget.setCapture&&a.currentTarget.setCapture()}}a.preventDefault();return false}},_dragTarget_touchmove:function(a){var c=this._$eventTarget.offset(),b=this._drawCoords.length;c=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-c.left,a.originalEvent.changedTouches[0].pageY-c.top]:[a.pageX-c.left,a.pageY-c.top];if(c[0]===this._lastMove[0]&&c[1]===this._lastMove[1])if(this._inOp){a.preventDefault();return false}if(this._softDblClick)this._isDbltap=this._isTap=false;
if(this._mouseDown){this._current=c;this._moveDate=f.now()}switch(this._shiftZoom?"zoom":this._options.mode){case "zoom":if(this._mouseDown){this._$drawContainer.geographics("clear");this._$drawContainer.geographics("drawBbox",[this._anchor[0],this._anchor[1],c[0],c[1]])}else this._trigger("move",a,{type:"Point",coordinates:this.toMap(c)});break;case "pan":case "drawPoint":this._mouseDown||this._toolPan?this._panMove():this._trigger("move",a,{type:"Point",coordinates:this.toMap(c)});break;case "drawLineString":case "drawPolygon":case "measureLength":case "measureArea":if(this._mouseDown||
this._toolPan)this._panMove();else{if(b>0){this._drawCoords[b-1]=this._toMap(c);this._drawPixels[b-1]=c;this._refreshDrawing()}this._trigger("move",a,{type:"Point",coordinates:this.toMap(c)})}}this._lastMove=c;if(this._inOp){a.preventDefault();return false}},_dragTarget_touchstop:function(a){!this._mouseDown&&r==7&&this._eventTarget_touchstart(a);var c=this._mouseDown,b=this._toolPan,d=this._$eventTarget.offset(),g=this._shiftZoom?"zoom":this._options.mode,e,p;e=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-
d.left,a.originalEvent.changedTouches[0].pageY-d.top]:[a.pageX-d.left,a.pageY-d.top];d=e[0]-this._anchor[0];p=e[1]-this._anchor[1];this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._shiftZoom=this._mouseDown=this._toolPan=false;document.releaseCapture&&document.releaseCapture();if(c){c=f.now();this._current=e;switch(g){case "zoom":if(d>0||p>0){b=this._pixelSize*6;g=this._toMap([[Math.min(this._anchor[0],e[0]),Math.max(this._anchor[1],e[1])],[Math.max(this._anchor[0],
e[0]),Math.min(this._anchor[1],e[1])]]);g=[g[0][0],g[0][1],g[1][0],g[1][1]];if(g[2]-g[0]<b&&g[3]-g[1]<b)g=f.geo.scaleBy(this._getBbox(f.geo.center(g,true)),0.5,true);this._setBbox(g,true,true)}this._resetDrawing();break;case "pan":if(b)this._panEnd();else if(c-this._clickDate>100){this._trigger("click",a,{type:"Point",coordinates:this.toMap(e)});this._inOp=false}break;case "drawPoint":if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}if(b)this._panFinalize();else if(c-
this._clickDate>100){var l=this;this._drawTimeout=setTimeout(function(){if(l._drawTimeout){l._trigger("shape",a,{type:"Point",coordinates:l.toMap(e)});l._inOp=false;l._drawTimeout=false}},250)}break;case "drawLineString":case "drawPolygon":case "measureLength":case "measureArea":if(b)this._panFinalize();else{b=this._drawCoords.length==0?0:this._drawCoords.length-1;this._drawCoords[b]=this._toMap(e);this._drawPixels[b]=e;if(b<2||!(this._drawCoords[b][0]==this._drawCoords[b-1][0]&&this._drawCoords[b][1]==
this._drawCoords[b-1][1])){this._drawCoords[b+1]=this._toMap(e);this._drawPixels[b+1]=e}this._refreshDrawing()}}this._clickDate=c;if(this._softDblClick&&this._isDbltap){this._isDbltap=this._isTap=false;this._$eventTarget.trigger("dblclick",a)}}if(this._inOp){a.preventDefault();return false}},_eventTarget_mousewheel:function(a,c){a.preventDefault();this._panFinalize();if(this._mouseDown)return false;if(c!=0){if(this._wheelTimeout){window.clearTimeout(this._wheelTimeout);this._wheelTimeout=null}else{var b=
f(a.currentTarget).offset();this._anchor=[a.pageX-b.left,a.pageY-b.top]}this._wheelLevel+=c;b=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._wheelZoomFactor);this._$shapesContainer.geographics("clear");for(i=0;i<this._options.services.length;i++){var d=this._options.services[i];f.geo._serviceTypes[d.type].interactiveScale(this,d,b.center,b.pixelSize)}this._$shapesContainer.geographics("clear");this._$labelsContainer.html("");this._graphicShapes.length>0&&this._graphicShapes.length<
256&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes,b.center,b.pixelSize);if(this._drawCoords.length>0){this._drawPixels=this._toPixel(this._drawCoords,b.center,b.pixelSize);this._refreshDrawing()}var g=this;this._wheelTimeout=window.setTimeout(function(){g._mouseWheelFinish()},1E3)}return false}})})(jQuery);
(function(f,v){f.geo._serviceTypes.tiled=function(){return{create:function(r,a,c){r=f.data(c,"geoServiceState");if(!r){r={loadCount:0,reloadTiles:false};a.append('<div class="geo-service" data-geo-service="tiled"'+(c.id?' id="'+c.id+'"':"")+(c["class"]?' class="'+c["class"]+'"':"")+' style="position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0; display:'+(c.visibility===v||c.visibility==="visible"?"block":"none")+';"></div>');r.serviceContainer=a.children(":last");f.data(c,
"geoServiceState",r)}return r.serviceContainer},destroy:function(r,a,c){f.data(c,"geoServiceState").serviceContainer.remove();f.removeData(c,"geoServiceState")},interactivePan:function(r,a,c,b){var d=f.data(a,"geoServiceState");if(d){this._cancelUnloaded(r,a);d.serviceContainer.children().css({left:function(M,U){return parseInt(U)+c},top:function(M,U){return parseInt(U)+b}});if(a&&(a.visibility===v||a.visibility==="visible")){var g=r._pixelSize,e=d.serviceContainer,p=e.children("[data-pixelSize='"+
g+"']"),l=r._getContentBounds(),o=r.options.axisLayout==="image",t=o?+1:-1,s=r.options.tilingScheme,w=s.tileWidth,y=s.tileHeight,H=l.width/2*g,z=l.height/2*g,C=p.position(),E=p.data("scaleOrigin").split(",");l=parseInt(E[0])-C.left;C=parseInt(E[1])-C.top;var G=r._getCenter();E=[G[0]+l*g,G[1]+t*C*g];var R=Math.floor((E[0]-H-s.origin[0])/(g*w));l=Math.floor((o?E[1]-z-s.origin[1]:s.origin[1]-(E[1]+z))/(g*y));C=Math.ceil((E[0]+H-s.origin[0])/(g*w));E=Math.ceil((o?E[1]+z-s.origin[1]:s.origin[1]-(E[1]-
z))/(g*y));var J=r._getBboxMax(),D=r._getTiledPixelSize(0),I=D/g,P=Math.floor((J[0]-s.origin[0])/(D*w))*I;J=Math.floor((s.origin[1]+t*J[3])/(D*y))*I;D=s.origin[1]+t*J*y*g;H=Math.round((s.origin[0]+P*w*g-(G[0]-H))/g);o=Math.round((o?D-(G[1]-z):G[1]+z-D)/g);var Q=a.opacity===v?1:a.opacity;for(z=R;z<C;z++)for(G=l;G<E;G++){R=""+z+","+G;D=p.children("[data-tile='"+R+"']").removeAttr("data-dirty");if(D.size()===0){var A=[s.origin[0]+z*w*g,s.origin[1]+t*G*y*g],K=[s.origin[0]+((z+1)*w-1)*g,s.origin[1]+t*
((G+1)*y-1)*g];I="src"in a?"src":"getUrl";A={bbox:[A[0],A[1],K[0],K[1]],width:w,height:y,zoom:r._getZoom(),tile:{row:G,column:z},index:Math.abs(G+z)};if(f.isFunction(a[I]))I=a[I](A);else{f.template("geoSrc",a[I]);I=f.render(A,"geoSrc")}d.loadCount++;if(d.reloadTiles&&D.size()>0)D.attr("src",I);else{D="<img style='position:absolute; left:"+((z-P)*100+(H-H%w)/w*100)+"%; top:"+((G-J)*100+(o-o%y)/y*100)+"%; ";if(f("body")[0].filters===v)D+="width: 100%; height: 100%;";D+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+
R+"' />";p.append(D);D=p.children(":last");D.load(function(M){Q<1?f(M.target).fadeTo(0,Q):f(M.target).show();d.loadCount--;if(d.loadCount<=0){e.children(":not([data-pixelSize='"+g+"'])").remove();d.loadCount=0}}).error(function(M){f(M.target).remove();d.loadCount--;if(d.loadCount<=0){e.children(":not([data-pixelSize='"+g+"'])").remove();d.loadCount=0}}).attr("src",I)}}}}}},interactiveScale:function(r,a,c,b){var d=f.data(a,"geoServiceState");if(d&&a&&(a.visibility===v||a.visibility==="visible")){this._cancelUnloaded(r,
a);a=r.options.tilingScheme;var g=a.tileWidth,e=a.tileHeight;d.serviceContainer.children().each(function(){var p=f(this),l=p.attr("data-pixelSize")/b;l=Math.round(l*1E3)/1E3;var o=p.data("scaleOrigin").split(",");o=r._toMap([o[0],o[1]]);o=r._toPixel(o,c,b);p.css({left:Math.round(o[0])+"px",top:Math.round(o[1])+"px",width:g*l,height:e*l});f("body")[0].filters!==v&&p.children().each(function(){f(this).css("filter","progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+l+",M22="+l+",sizingmethod='auto expand')")})})}},
refresh:function(r,a){var c=f.data(a,"geoServiceState");if(c&&a&&(a.visibility===v||a.visibility==="visible")){this._cancelUnloaded(r,a);var b=r._getBbox(),d=r._pixelSize,g=c.serviceContainer;r._getContentBounds();var e=r.options.axisLayout==="image",p=e?+1:-1,l=r.options.tilingScheme,o=l.tileWidth,t=l.tileHeight,s=Math.floor((b[0]-l.origin[0])/(d*o)),w=Math.floor((e?b[1]-l.origin[1]:l.origin[1]-b[3])/(d*t)),y=Math.ceil((b[2]-l.origin[0])/(d*o)),H=Math.ceil((e?b[3]-l.origin[1]:l.origin[1]-b[1])/(d*
t)),z=r._getBboxMax(),C=r._getTiledPixelSize(0),E=C/d,G=Math.floor((z[0]-l.origin[0])/(C*o))*E,R=Math.floor((l.origin[1]+p*z[3])/(C*t))*E;z=l.origin[1]+p*R*t*d;var J=Math.round((l.origin[0]+G*o*d-b[0])/d),D=Math.round((e?z-b[1]:b[3]-z)/d);b=g.children().show();e=b.filter("[data-pixelSize='"+d+"']").appendTo(g);var I=a.opacity===v?1:a.opacity;c.reloadTiles&&b.find("img").attr("data-dirty","true");if(e.size()){e.css({left:J%o+"px",top:D%t+"px"}).data("scaleOrigin",J%o+","+D%t);e.children().each(function(){var K=
f(this),M=K.attr("data-tile").split(",");K.css({left:Math.round((parseInt(M[0])-G)*100+(J-J%o)/o*100)+"%",top:Math.round((parseInt(M[1])-R)*100+(D-D%t)/t*100)+"%"});I<1&&K.fadeTo(0,I)})}else{g.append("<div style='position:absolute; left:"+J%o+"px; top:"+D%t+"px; width:"+o+"px; height:"+t+"px; margin:0; padding:0;' data-pixelSize='"+d+"'></div>");e=g.children(":last").data("scaleOrigin",J%o+","+D%t)}for(s=s;s<y;s++)for(z=w;z<H;z++){C=""+s+","+z;E=e.children("[data-tile='"+C+"']").removeAttr("data-dirty");
if(E.size()===0||c.reloadTiles){var P=[l.origin[0]+s*o*d,l.origin[1]+p*z*t*d],Q=[l.origin[0]+((s+1)*o-1)*d,l.origin[1]+p*((z+1)*t-1)*d],A="src"in a?"src":"getUrl";P={bbox:[P[0],P[1],Q[0],Q[1]],width:o,height:t,zoom:r._getZoom(),tile:{row:z,column:s},index:Math.abs(z+s)};if(f.isFunction(a[A]))A=a[A](P);else{f.template("geoSrc",a[A]);A=f.render(P,"geoSrc")}c.loadCount++;if(c.reloadTiles&&E.size()>0)E.attr("src",A);else{E="<img style='position:absolute; left:"+((s-G)*100+(J-J%o)/o*100)+"%; top:"+((z-
R)*100+(D-D%t)/t*100)+"%; ";if(f("body")[0].filters===v)E+="width: 100%; height: 100%;";E+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+C+"' />";e.append(E);E=e.children(":last");E.load(function(K){I<1?f(K.target).fadeTo(0,I):f(K.target).show();c.loadCount--;if(c.loadCount<=0){g.children(":not([data-pixelSize='"+d+"'])").remove();c.loadCount=0}}).error(function(K){f(K.target).remove();
c.loadCount--;if(c.loadCount<=0){g.children(":not([data-pixelSize='"+d+"'])").remove();c.loadCount=0}}).attr("src",A)}}}b.find("[data-dirty]").remove();c.reloadTiles=false}},resize:function(){},opacity:function(r,a){f.data(a,"geoServiceState").serviceContainer.find("img").stop(true).fadeTo("fast",a.opacity)},toggle:function(r,a){f.data(a,"geoServiceState").serviceContainer.css("display",a.visibility==="visible"?"block":"none")},_cancelUnloaded:function(r,a){var c=f.data(a,"geoServiceState");if(c&&
c.loadCount>0)for(c.serviceContainer.find("img:hidden").remove();c.loadCount>0;)c.loadCount--}}}()})(jQuery);
(function(f,v){f.geo._serviceTypes.shingled=function(){return{create:function(r,a,c){r=f.data(c,"geoServiceState");if(!r){r={loadCount:0};a.append('<div class="geo-service" data-geo-service="shingled"'+(c.id?' id="'+c.id+'"':"")+(c["class"]?' class="'+c["class"]+'"':"")+' style="position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0; display:'+(c.visibility===v||c.visibility==="visible"?"block":"none")+';"></div>');r.serviceContainer=a.children(":last");f.data(c,"geoServiceState",
r)}return r.serviceContainer},destroy:function(r,a,c){f.data(c,"geoServiceState").serviceContainer.remove();f.removeData(c,"geoServiceState")},interactivePan:function(r,a,c,b){var d=f.data(a,"geoServiceState");if(d){this._cancelUnloaded(r,a);r=d.serviceContainer.children("[data-pixelSize='"+r._pixelSize+"']");a=r.children("div");if(!a.length){r.children("img").wrap('<div style="position:absolute; left:0; top:0; width:100%; height:100%;"></div>');a=r.children("div")}a.css({left:function(g,e){return parseInt(e)+
c},top:function(g,e){return parseInt(e)+b}})}},interactiveScale:function(r,a,c,b){var d=f.data(a,"geoServiceState");if(d){this._cancelUnloaded(r,a);a=d.serviceContainer;r=r._getContentBounds();var g=r.width,e=r.height,p=g/2,l=e/2;a.children().each(function(){var o=f(this),t=o.attr("data-pixelSize"),s=t/b;o.css({width:g*s,height:e*s}).children("img").each(function(){var w=f(this),y=w.data("center");w.css({left:(Math.round((y[0]-c[0])/t)-p)*s+"px",top:(Math.round((c[1]-y[1])/t)-l)*s+"px"})})})}},refresh:function(r,
a){var c=f.data(a,"geoServiceState");if(c&&a&&(a.visibility===v||a.visibility==="visible")){this._cancelUnloaded(r,a);var b=r._getBbox(),d=r._pixelSize,g=c.serviceContainer,e=r._getContentBounds(),p=e.width,l=e.height,o=p/2,t=l/2;e=g.children('[data-pixelSize="'+d+'"]');var s=a.opacity===v?1:a.opacity;if(!e.size()){g.append('<div style="position:absolute; left:'+o+"px; top:"+t+"px; width:"+p+"px; height:"+l+'px; margin:0; padding:0;" data-pixelSize="'+d+'"></div>');e=g.children(":last")}e.children("img").each(function(){var y=
f(this),H=y.data("center"),z=r._getCenter();y.css({left:Math.round((H[0]-z[0])/d)-o+"px",top:Math.round((z[1]-H[1])/d)-t+"px"})});s<1&&g.find("img").attr("data-keepAlive","0");var w="src"in a?"src":"getUrl";b={bbox:b,width:p,height:l,zoom:r._getZoom(),tile:null,index:0};if(f.isFunction(a[w]))b=a[w](b);else{f.template("geoSrc",a[w]);b=f.render(b,"geoSrc")}c.loadCount++;e.append('<img style="position:absolute; left:-'+o+"px; top:-"+t+'px; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />');
e.children(":last").data("center",r._getCenter()).load(function(y){s<1?f(y.target).fadeTo(0,s):f(y.target).show();c.loadCount--;if(c.loadCount<=0){g.children(':not([data-pixelSize="'+d+'"])').remove();y=g.find('[data-pixelSize="'+d+'"]>div');if(y.size()>0){var H=y.position();y.children("img").each(function(){var z=f(this),C=H.left+parseInt(z.css("left")),E=H.top+parseInt(z.css("top"));z.css({left:C+"px",top:E+"px"})}).unwrap();y.remove()}c.loadCount=0}}).error(function(y){f(y.target).remove();c.loadCount--;
if(c.loadCount<=0){g.children(":not([data-pixelSize='"+d+"'])").remove();c.loadCount=0}}).attr("src",b)}},resize:function(r,a){var c=f.data(a,"geoServiceState");if(c&&a&&(a.visibility===v||a.visibility==="visible")){this._cancelUnloaded(r,a);var b=c.serviceContainer,d=r._getContentBounds();c=d.width/2;d=d.height/2;b=b.children();b.attr("data-pixelSize","0");b.css({left:c+"px",top:d+"px"})}},opacity:function(r,a){f.data(a,"geoServiceState").serviceContainer.find("img").stop(true).fadeTo("fast",a.opacity)},
toggle:function(r,a){f.data(a,"geoServiceState").serviceContainer.css("display",a.visibility==="visible"?"block":"none")},_cancelUnloaded:function(r,a){var c=f.data(a,"geoServiceState");if(c&&c.loadCount>0)for(c.serviceContainer.find("img:hidden").remove();c.loadCount>0;)c.loadCount--}}}()})(jQuery);
