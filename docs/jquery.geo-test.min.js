document.createElement("canvas").getContext||function(){function e(){return this.context_||(this.context_=new p(this))}function o(g,j){var m=J.call(arguments,2);return function(){return g.apply(j,m.concat(J.call(arguments)))}}function q(g){g.namespaces.g_vml_||g.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");g.namespaces.g_o_||g.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!g.styleSheets.ex_canvas_){g=g.createStyleSheet();g.owningElement.id=
"ex_canvas_";g.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function a(g){var j=g.srcElement;switch(g.propertyName){case "width":j.getContext().clearRect();j.style.width=j.attributes.width.nodeValue+"px";j.firstChild.style.width=j.clientWidth+"px";break;case "height":j.getContext().clearRect();j.style.height=j.attributes.height.nodeValue+"px";j.firstChild.style.height=j.clientHeight+"px"}}function b(g){g=g.srcElement;if(g.firstChild){g.firstChild.style.width=
g.clientWidth+"px";g.firstChild.style.height=g.clientHeight+"px"}}function c(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(g,j){for(var m=c(),s=0;s<3;s++)for(var v=0;v<3;v++){for(var t=0,K=0;K<3;K++)t+=g[s][K]*j[K][v];m[s][v]=t}return m}function f(g,j){j.fillStyle=g.fillStyle;j.lineCap=g.lineCap;j.lineJoin=g.lineJoin;j.lineWidth=g.lineWidth;j.miterLimit=g.miterLimit;j.shadowBlur=g.shadowBlur;j.shadowColor=g.shadowColor;j.shadowOffsetX=g.shadowOffsetX;j.shadowOffsetY=g.shadowOffsetY;j.strokeStyle=g.strokeStyle;
j.globalAlpha=g.globalAlpha;j.font=g.font;j.textAlign=g.textAlign;j.textBaseline=g.textBaseline;j.arcScaleX_=g.arcScaleX_;j.arcScaleY_=g.arcScaleY_;j.lineScale_=g.lineScale_}function h(g){var j=g.indexOf("(",3),m=g.indexOf(")",j+1);j=g.substring(j+1,m).split(",");if(j.length!=4||g.charAt(3)!="a")j[3]=1;return j}function l(g,j,m){return Math.min(m,Math.max(j,g))}function k(g,j,m){m<0&&m++;m>1&&m--;return 6*m<1?g+(j-g)*6*m:2*m<1?j:3*m<2?g+(j-g)*(2/3-m)*6:g}function n(g){if(g in L)return L[g];var j,
m=1;g=String(g);if(g.charAt(0)=="#")j=g;else if(/^rgb/.test(g)){m=h(g);j="#";for(var s,v=0;v<3;v++){s=m[v].indexOf("%")!=-1?Math.floor(parseFloat(m[v])/100*255):+m[v];j+=H[l(s,0,255)]}m=+m[3]}else if(/^hsl/.test(g)){v=m=h(g);j=parseFloat(v[0])/360%360;j<0&&j++;s=l(parseFloat(v[1])/100,0,1);v=l(parseFloat(v[2])/100,0,1);if(s==0)s=v=j=v;else{var t=v<0.5?v*(1+s):v+s-v*s,K=2*v-t;s=k(K,t,j+1/3);v=k(K,t,j);j=k(K,t,j-1/3)}j="#"+H[Math.floor(s*255)]+H[Math.floor(v*255)]+H[Math.floor(j*255)];m=m[3]}else j=
g;return L[g]={color:j,alpha:m}}function p(g){this.m_=c();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=B*1;this.globalAlpha=1;this.canvas=g;var j="width:"+g.clientWidth+"px;height:"+g.clientHeight+"px;overflow:hidden;position:absolute",m=g.ownerDocument.createElement("div");m.style.cssText=j;g.appendChild(m);j=m.cloneNode(false);j.style.backgroundColor="red";j.style.filter="alpha(opacity=0)";
g.appendChild(j);this.element_=m;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1}function x(g,j,m,s){g.currentPath_.push({type:"bezierCurveTo",cp1x:j.x,cp1y:j.y,cp2x:m.x,cp2y:m.y,x:s.x,y:s.y});g.currentX_=s.x;g.currentY_=s.y}function u(g,j,m){g=g.m_;return{x:B*(j*g[0][0]+m*g[1][0]+g[2][0])-D,y:B*(j*g[0][1]+m*g[1][1]+g[2][1])-D}}function y(g,j,m){if(isFinite(j[0][0])&&isFinite(j[0][1])&&isFinite(j[1][0])&&isFinite(j[1][1])&&isFinite(j[2][0])&&isFinite(j[2][1])){g.m_=j;if(m)g.lineScale_=E(G(j[0][0]*
j[1][1]-j[0][1]*j[1][0]))}}function A(g){this.code=this[g];this.message=g+": DOM Exception "+this.code}var z=Math,w=z.round,C=z.sin,F=z.cos,G=z.abs,E=z.sqrt,B=10,D=B/2;navigator.userAgent.match(/MSIE ([\d.]+)?/);var J=Array.prototype.slice;q(document);z={init:function(g){g=g||document;g.createElement("canvas");g.attachEvent("onreadystatechange",o(this.init_,this,g))},init_:function(g){g=g.getElementsByTagName("canvas");for(var j=0;j<g.length;j++)this.initElement(g[j])},initElement:function(g){if(!g.getContext){g.getContext=
e;q(g.ownerDocument);g.innerHTML="";g.attachEvent("onpropertychange",a);g.attachEvent("onresize",b);var j=g.attributes;if(j.width&&j.width.specified)g.style.width=j.width.nodeValue+"px";else g.width=g.clientWidth;if(j.height&&j.height.specified)g.style.height=j.height.nodeValue+"px";else g.height=g.clientHeight}return g}};z.init();for(var H=[],r=0;r<16;r++)for(var I=0;I<16;I++)H[r*16+I]=r.toString(16)+I.toString(16);var L={},N={butt:"flat",round:"round"};r=p.prototype;r.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);
this.textMeasureEl_=null}this.element_.innerHTML=""};r.beginPath=function(){this.currentPath_=[]};r.moveTo=function(g,j){var m=u(this,g,j);this.currentPath_.push({type:"moveTo",x:m.x,y:m.y});this.currentX_=m.x;this.currentY_=m.y};r.lineTo=function(g,j){var m=u(this,g,j);this.currentPath_.push({type:"lineTo",x:m.x,y:m.y});this.currentX_=m.x;this.currentY_=m.y};r.bezierCurveTo=function(g,j,m,s,v,t){v=u(this,v,t);g=u(this,g,j);m=u(this,m,s);x(this,g,m,v)};r.quadraticCurveTo=function(g,j,m,s){g=u(this,
g,j);m=u(this,m,s);s={x:this.currentX_+2/3*(g.x-this.currentX_),y:this.currentY_+2/3*(g.y-this.currentY_)};x(this,s,{x:s.x+(m.x-this.currentX_)/3,y:s.y+(m.y-this.currentY_)/3},m)};r.arc=function(g,j,m,s,v,t){m*=B;var K=t?"at":"wa",M=g+F(s)*m-D,O=j+C(s)*m-D;s=g+F(v)*m-D;v=j+C(v)*m-D;if(M==s&&!t)M+=0.125;g=u(this,g,j);M=u(this,M,O);s=u(this,s,v);this.currentPath_.push({type:K,x:g.x,y:g.y,radius:m,xStart:M.x,yStart:M.y,xEnd:s.x,yEnd:s.y})};r.stroke=function(g){var j=[];j.push("<g_vml_:shape",' filled="',
!!g,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0,0"',' coordsize="',B*10,",",B*10,'"',' stroked="',!g,'"',' path="');for(var m={x:null,y:null},s={x:null,y:null},v=0;v<this.currentPath_.length;v++){var t=this.currentPath_[v];switch(t.type){case "moveTo":j.push(" m ",w(t.x),",",w(t.y));break;case "lineTo":j.push(" l ",w(t.x),",",w(t.y));break;case "close":j.push(" x ");t=null;break;case "bezierCurveTo":j.push(" c ",w(t.cp1x),",",w(t.cp1y),",",w(t.cp2x),",",w(t.cp2y),
",",w(t.x),",",w(t.y));break;case "at":case "wa":j.push(" ",t.type," ",w(t.x-this.arcScaleX_*t.radius),",",w(t.y-this.arcScaleY_*t.radius)," ",w(t.x+this.arcScaleX_*t.radius),",",w(t.y+this.arcScaleY_*t.radius)," ",w(t.xStart),",",w(t.yStart)," ",w(t.xEnd),",",w(t.yEnd))}if(t){if(m.x==null||t.x<m.x)m.x=t.x;if(s.x==null||t.x>s.x)s.x=t.x;if(m.y==null||t.y<m.y)m.y=t.y;if(s.y==null||t.y>s.y)s.y=t.y}}j.push(' ">');if(g){g=n(this.fillStyle);j.push('<g_vml_:fill color="',g.color,'" opacity="',g.alpha*this.globalAlpha,
'" />')}else{m=n(this.strokeStyle);g=m.color;m=m.alpha*this.globalAlpha;s=this.lineScale_*this.lineWidth;if(s<1)m*=s;j.push("<g_vml_:stroke",' opacity="',m,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',N[this.lineCap]||"square",'"',' weight="',s,'px"',' color="',g,'" />')}j.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",j.join(""))};r.fill=function(){this.stroke(true)};r.closePath=function(){this.currentPath_.push({type:"close"})};r.save=
function(){var g={};f(this,g);this.aStack_.push(g);this.mStack_.push(this.m_);this.m_=d(c(),this.m_)};r.restore=function(){if(this.aStack_.length){f(this.aStack_.pop(),this);this.m_=this.mStack_.pop()}};r.translate=function(g,j){y(this,d([[1,0,0],[0,1,0],[g,j,1]],this.m_),false)};r.scale=function(g,j){this.arcScaleX_*=g;this.arcScaleY_*=j;y(this,d([[g,0,0],[0,j,0],[0,0,1]],this.m_),true)};r=A.prototype=Error();r.INDEX_SIZE_ERR=1;r.DOMSTRING_SIZE_ERR=2;r.HIERARCHY_REQUEST_ERR=3;r.WRONG_DOCUMENT_ERR=
4;r.INVALID_CHARACTER_ERR=5;r.NO_DATA_ALLOWED_ERR=6;r.NO_MODIFICATION_ALLOWED_ERR=7;r.NOT_FOUND_ERR=8;r.NOT_SUPPORTED_ERR=9;r.INUSE_ATTRIBUTE_ERR=10;r.INVALID_STATE_ERR=11;r.SYNTAX_ERR=12;r.INVALID_MODIFICATION_ERR=13;r.NAMESPACE_ERR=14;r.INVALID_ACCESS_ERR=15;r.VALIDATION_ERR=16;r.TYPE_MISMATCH_ERR=17;G_vmlCanvasManager=z;CanvasRenderingContext2D=p;DOMException=A}();
(function(e){function o(a){var b=[].slice.call(arguments,1),c=0;a=e.event.fix(a||window.event);a.type="mousewheel";if(a.wheelDelta)c=a.wheelDelta/120;if(a.detail)c=-a.detail/3;b.unshift(a,c);return e.event.handle.apply(this,b)}var q=["DOMMouseScroll","mousewheel"];e.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=q.length;a;)this.addEventListener(q[--a],o,false);else this.onmousewheel=o},teardown:function(){if(this.removeEventListener)for(var a=q.length;a;)this.removeEventListener(q[--a],
o,false);else this.onmousewheel=null}};e.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);
$.widget||function(e,o){var q=Array.prototype.slice,a=e.cleanData;e.cleanData=function(b){for(var c=0,d;(d=b[c])!=null;c++)e(d).triggerHandler("remove");a(b)};e.widget=function(b,c,d){var f=b.split(".")[0],h;b=b.split(".")[1];h=f+"-"+b;if(!d){d=c;c=e.Widget}e.expr[":"][h]=function(k){return!!e.data(k,b)};e[f]=e[f]||{};e[f][b]=e.extend(function(k,n){if(!this._createWidget)return new e[f][b](k,n);arguments.length&&this._createWidget(k,n)},e[f][b]);var l=new c;l.options=e.extend(true,{},l.options);e.each(d,
function(k,n){if(e.isFunction(n))d[k]=function(){var p=function(u){return c.prototype[u].apply(this,q.call(arguments,1))},x=function(u,y){return c.prototype[u].apply(this,y)};return function(){var u=this._super,y=this._superApply,A;this._super=p;this._superApply=x;A=n.apply(this,arguments);this._super=u;this._superApply=y;return A}}()});e[f][b].prototype=e.extend(true,l,{namespace:f,widgetName:b,widgetEventPrefix:b,widgetBaseClass:h},d);e.widget.bridge(b,e[f][b])};e.widget.bridge=function(b,c){e.fn[b]=
function(d){var f=typeof d==="string",h=q.call(arguments,1),l=this;d=!f&&h.length?e.extend.apply(null,[true,d].concat(h)):d;f?this.each(function(){var k=e.data(this,b);if(!k)return e.error("cannot call methods on "+b+" prior to initialization; attempted to call method '"+d+"'");if(!e.isFunction(k[d])||d.charAt(0)==="_")return e.error("no such method '"+d+"' for "+b+" widget instance");var n=k[d].apply(k,h);if(n!==k&&n!==o){l=n;return false}}):this.each(function(){var k=e.data(this,b);k?k.option(d||
{})._init():c(d,this)});return l}};e.Widget=function(b,c){if(!this._createWidget)return new e[namespace][name](b,c);arguments.length&&this._createWidget(b,c)};e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false},_createWidget:function(b,c){c=e(c||this.defaultElement||this)[0];this.element=e(c);this.options=e.extend(true,{},this.options,this._getCreateOptions(),b);this.bindings=e();this.hoverable=e();this.focusable=e();if(c!==this){e.data(c,this.widgetName,
this);this._bind({remove:"destroy"})}this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return e.metadata&&e.metadata.get(this.element[0])[this.widgetName]},_create:e.noop,_init:e.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");
this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(b,c){var d=b;if(arguments.length===0)return e.extend({},this.options);if(typeof b==="string"){if(c===o)return this.options[b];d={};d[b]=c}this._setOptions(d);return this},_setOptions:function(b){var c=this;e.each(b,function(d,f){c._setOption(d,f)});return this},_setOption:function(b,c){this.options[b]=c;if(b==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",
!!c).attr("aria-disabled",c);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_bind:function(b,c){if(c){b=e(b);this.bindings=this.bindings.add(b)}else{c=b;b=this.element}var d=this;e.each(c,function(f,h){b.bind(f+"."+d.widgetName,function(){if(!(d.options.disabled===true||e(this).hasClass("ui-state-disabled")))return(typeof h===
"string"?d[h]:h).apply(d,arguments)})})},_hoverable:function(b){this.hoverable=this.hoverable.add(b);this._bind(b,{mouseenter:function(c){e(c.currentTarget).addClass("ui-state-hover")},mouseleave:function(c){e(c.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b);this._bind(b,{focusin:function(c){e(c.currentTarget).addClass("ui-state-focus")},focusout:function(c){e(c.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var f=
this.options[b];c=e.Event(c);c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();d=d||{};if(c.originalEvent){b=e.event.props.length;for(var h;b;){h=e.event.props[--b];c[h]=c.originalEvent[h]}}this.element.trigger(c,d);d=e.isArray(d)?[c].concat(d):[c,d];return!(e.isFunction(f)&&f.apply(this.element[0],d)===false||c.isDefaultPrevented())}}}(jQuery);
(function(e){var o=Number.POSITIVE_INFINITY,q=Number.NEGATIVE_INFINITY;e.geo={_allCoordinates:function(a){a=this._flatten(a);for(var b=0,c=[];b<a.length;b++){var d=a[b].coordinates,f=e.isArray(d[0]),h=f&&e.isArray(d[0][0]),l;if(!(h&&e.isArray(d[0][0][0]))){if(!h){f||(d=[d]);d=[d]}d=[d]}for(f=0;f<d.length;f++)for(h=0;h<d[f].length;h++)for(l=0;l<d[f][h].length;l++)c.push(d[f][h][l])}return c},center:function(a,b){if(!b&&e.geo.proj)a=e.geo.proj.fromGeodetic(a);var c=[(a[0]+a[2])/2,(a[1]+a[3])/2];return!b&&
e.geo.proj?e.geo.proj.toGeodetic(c):c},expandBy:function(a,b,c){if(e.geo.proj)a=e.geo.proj.fromGeodetic(a);a=[a[0]-b,a[1]-c,a[2]+b,a[3]+c];return e.geo.proj?e.geo.proj.toGeodetic(a):a},height:function(a,b){if(!b&&e.geo.proj)a=e.geo.proj.fromGeodetic(a);return a[3]-a[1]},_in:function(a,b){return a[0]<=b[0]&&a[1]<=b[1]&&a[2]>=b[2]&&a[3]>=b[3]},reaspect:function(a,b,c){if(!c&&e.geo.proj)a=e.geo.proj.fromGeodetic(a);var d=this.width(a,true),f=this.height(a,true);c=this.center(a,true);if(d!=0&&f!=0&&b>
0){if(d/f>b){a=d/2;d=a/b}else{d=f/2;a=d*b}a=[c[0]-a,c[1]-d,c[0]+a,c[1]+d]}return e.geo.proj?e.geo.proj.toGeodetic(a):a},scaleBy:function(a,b,c){if(!c&&e.geo.proj)a=e.geo.proj.fromGeodetic(a);var d=this.center(a,true),f=(a[2]-a[0])*b/2;a=(a[3]-a[1])*b/2;a=[d[0]-f,d[1]-a,d[0]+f,d[1]+a];return!c&&e.geo.proj?e.geo.proj.toGeodetic(a):a},width:function(a,b){if(!b&&e.geo.proj)a=e.geo.proj.fromGeodetic(a);return a[2]-a[0]},bbox:function(a){var b=e.data(a,"geoBbox");if(!b)if(a.bbox)e.data(a,"geoBbox",b=a.bbox);
else{b=[o,o,q,q];var c=this._allCoordinates(a),d=0;if(e.geo.proj)c=e.geo.proj.fromGeodetic(c);for(;d<c.length;d++){b[0]=Math.min(c[d][0],b[0]);b[1]=Math.min(c[d][1],b[1]);b[2]=Math.max(c[d][0],b[2]);b[3]=Math.max(c[d][1],b[3])}e.data(a,"geoBbox",b)}return e.geo.proj?e.geo.proj.toGeodetic(b):b},_contains:function(a,b){if(a.type!="Polygon")return false;switch(b.type){case "Point":return this._containsPolygonPoint(a.coordinates,b.coordinates);case "LineString":return this._containsPolygonLineString(a.coordinates,
b.coordinates);case "Polygon":return this._containsPolygonLineString(a.coordinates,b.coordinates[0])}},_containsPolygonPoint:function(a,b){if(a.length==0||a[0].length<4)return false;for(var c=0,d=a[0][0],f=1,h;f<a[0].length;f++){h=a[0][f];if(d[1]<=b[1]&&b[1]<h[1]||h[1]<=b[1]&&b[1]<d[1]&&(b[0]<d[0]||b[0]<h[0])){d=d[0]+(h[0]-d[0])*(b[1]-d[1])/(h[1]-d[1]);d>b[0]&&c++}d=h}return c%2==1},_containsPolygonLineString:function(a,b){for(var c=0;c<b.length;c++)if(!this._containsPolygonPoint(a,b[c]))return false;
return true},_distance:function(a,b){var c=e.isArray(a)?a:a.coordinates,d=e.isArray(b)?b:b.coordinates;c=e.geo.proj?e.geo.proj.fromGeodetic(c):c;d=e.geo.proj?e.geo.proj.fromGeodetic(d):d;switch(a.type){case "Point":switch(b.type){case "Point":return this._distancePointPoint(d,c);case "LineString":return this._distanceLineStringPoint(d,c);case "Polygon":return this._containsPolygonPoint(d,c)?0:this._distanceLineStringPoint(d[0],c);default:throw Error("not implemented");}case "LineString":switch(b.type){case "Point":return this._distanceLineStringPoint(c,
d);case "LineString":return this._distanceLineStringLineString(c,d);case "Polygon":return this._containsPolygonLineString(d,c)?0:this._distanceLineStringLineString(d[0],c);default:throw Error("not implemented");}case "Polygon":switch(b.type){case "Point":return this._containsPolygonPoint(c,d)?0:this._distanceLineStringPoint(c[0],d);case "LineString":return this._containsPolygonLineString(c,d)?0:this._distanceLineStringLineString(c[0],d);case "Polygon":return this._containsPolygonLineString(c,d[0])?
0:this._distanceLineStringLineString(c[0],d[0]);default:throw Error("not implemented");}}},_distancePointPoint:function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},_distanceLineStringPoint:function(a,b){var c=o;if(a.length>0){var d=a[0],f=b[0]-d[0],h=b[1]-d[1];if(a.length==1)return Math.sqrt(f*f+h*h);else for(var l=1;l<a.length;l++){var k=a[l],n=b[0]-k[0],p=b[1]-k[1];d=this._distanceSegmentPoint(k[0]-d[0],k[1]-d[1],f,h,n,p);if(d==0)return 0;if(d<c)c=d;d=k;f=n;h=p}}return Math.sqrt(c)},
_distanceSegmentPoint:function(a,b,c,d,f,h){var l=a*c+b*d;if(l<=0)return c*c+d*d;a=a*a+b*b;if(l>=a)return f*f+h*h;return c*c+d*d-l*l/a},_distanceLineStringLineString:function(a,b){for(var c=o,d=0;d<b;d++)c=Math.min(c,this._distanceLineStringPoint(a,b[d]));return c},_flatten:function(a){var b=[];switch(a.type){case "Feature":e.merge(b,this._flatten(a.geometry));break;case "GeometryCollection":for(curGeom=0;curGeom<a.geometries.length;curGeom++)e.merge(b,this._flatten(a.geometries[curGeom]));break;
default:b[0]=a}return b},_WKT:function(){function a(d){if(d&&d.length){for(var f=[],h=0;h<d.length;h++)f.push(d[h].join(" "));return"("+f+")"}else return"EMPTY"}function b(d){if(d&&d.length){for(var f=[],h=0;h<d.length;h++)f.push(a(d[h]));return"("+f+")"}else return"EMTPY"}function c(d){if(d&&d.type)switch(d.type){case "Point":return"POINT "+(d.coordinates&&d.coordinates.length?"("+d.coordinates.join(" ")+")":"EMPTY");case "LineString":return"LINESTRING "+a(d.coordinates);case "Polygon":return"POLYGON "+
b(d.coordinates);case "MultiPoint":return"MULTIPOINT "+a(d.coordinates);case "MultiLineString":return"MULTILINSTRING "+b(d.coordinates);case "MultiPolygon":if((d=d.coordinates)&&d.length){for(var f=[],h=0;h<d.length;h++)f.push(b(d[h]));d="("+f+")"}else d="EMPTY";return"MULTIPOLYGON "+d;case "GeometryCollection":if((d=d.geometries)&&d.length){f=[];for(h=0;h<d.length;h++)f.push(c(d[h]));d="("+d+")"}else d="EMPTY";return"GEOMETRYCOLLECTION "+d;default:return""}else return""}return{stringify:c,parse:function(d){d=
e.trim(d);var f=d.indexOf(" ");switch(d.substr(0,f).toUpperCase()){case "POINT":return(d=d.substr(f+1).match(/\(\s*([\d\.-]+)\s+([\d\.-]+)\s*\)/))&&d.length>=2?{type:"Point",coordinates:[parseFloat(d[1]),parseFloat(d[2])]}:null}}}}(),proj:function(){return{fromGeodeticPos:function(a){return[6378137*a[0]*0.017453292519943295,6378137*Math.log(Math.tan(0.7853981633974483+a[1]*0.017453292519943295/2))]},fromGeodetic:function(a){var b=e.isArray(a[0]),c=this.fromGeodeticPos;if(!b&&a.length==4){b=c([a[0],
a[1]]);a=c([a[2],a[3]]);return[b[0],b[1],a[0],a[1]]}else{var d=b&&e.isArray(a[0][0]),f=d&&e.isArray(a[0][0][0]),h=[[[]]];if(!f){if(!d){b||(a=[a]);a=[a]}a=[a]}e.each(a,function(l){e.each(this,function(k){e.each(this,function(n){h[l][k][n]=c(this)})})});return f?h:d?h[0]:b?h[0][0]:h[0][0][0]}},toGeodeticPos:function(a){return[a[0]/6378137*57.29577951308232,(1.5707963267948966-2*Math.atan(1/Math.exp(a[1]/6378137)))*57.29577951308232]},toGeodetic:function(a){var b=e.isArray(a[0]),c=this.toGeodeticPos;
if(!b&&a.length==4){b=c([a[0],a[1]]);a=c([a[2],a[3]]);return[b[0],b[1],a[0],a[1]]}else{var d=b&&e.isArray(a[0][0]),f=d&&e.isArray(a[0][0][0]),h=[[[]]];if(!f){if(!d){b||(a=[a]);a=[a]}a=[a]}e.each(a,function(l){e.each(this,function(k){e.each(this,function(n){h[l][k][n]=c(this)})})});return f?h:d?h[0]:b?h[0][0]:h[0][0][0]}}}}(),_serviceTypes:{}}})(jQuery,this);
(function(e,o){var q=function(){for(var a=5,b=document.createElement("div"),c=b.all||[];b.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",c[0];);return a>6?a:!a}();e.widget("geo.geographics",{_$elem:o,_options:{},_trueCanvas:true,_width:0,_height:0,_$canvas:o,_context:o,options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:0.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"}},_create:function(){this._$elem=this.element;this._options=this.options;
this._$elem.css({display:"inline-block",overflow:"hidden",textAlign:"left"});this._$elem.css("position")=="static"&&this._$elem.css("position","relative");this._width=this._$elem.width();this._height=this._$elem.height();if(!(this._width&&this._height)){this._width=parseInt(this._$elem.css("width"));this._height=parseInt(this._$elem.css("height"))}if(document.createElement("canvas").getContext){this._$elem.append('<canvas width="'+this._width+'" height="'+this._height+'" style="position:absolute; left:0; top:0; width:'+
this._width+"px; height:"+this._height+'px;"></canvas>');this._$canvas=this._$elem.children(":last");this._context=this._$canvas[0].getContext("2d")}else if(q<=8){this._trueCanvas=false;this._$elem.append('<div width="'+this._width+'" height="'+this._height+'" style="position:absolute; left:0; top:0; width:'+this._width+"px; height:"+this._height+'px; margin:0; padding:0;"></div>');this._$canvas=this._$elem.children(":last");G_vmlCanvasManager.initElement(this._$canvas[0]);this._context=this._$canvas[0].getContext("2d");
this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})}},_setOption:function(a,b){if(a=="style")b=e.extend({},this._options.style,b);e.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){e.Widget.prototype.destroy.apply(this,arguments);this._$elem.html("")},clear:function(){this._context.clearRect(0,0,this._width,this._height)},drawArc:function(a,b,c,d){d=this._getGraphicStyle(d);if(d.visibility!="hidden"&&d.opacity>0&&d.widthValue>0&&
d.heightValue>0){var f=Math.min(d.widthValue,d.heightValue)/2;b=b*Math.PI/180;c=c*Math.PI/180;this._context.save();this._context.translate(a[0],a[1]);d.widthValue>d.heightValue?this._context.scale(d.widthValue/d.heightValue,1):this._context.scale(1,d.heightValue/d.widthValue);this._context.beginPath();this._context.arc(0,0,f,b,c,false);this._trueCanvas&&this._context.restore();if(d.doFill){this._context.fillStyle=d.fill;this._context.globalAlpha=d.opacity*d.fillOpacity;this._context.fill()}if(d.doStroke){this._context.lineJoin=
"round";this._context.lineWidth=d.strokeWidthValue;this._context.strokeStyle=d.stroke;this._context.globalAlpha=d.opacity*d.strokeOpacity;this._context.stroke()}this._trueCanvas||this._context.restore()}},drawPoint:function(a,b){b=this._getGraphicStyle(b);if(b.widthValue==b.heightValue&&b.heightValue==b.borderRadiusValue)this.drawArc(a,0,360,b);else if(b.visibility!="hidden"&&b.opacity>0){b.borderRadiusValue=Math.min(Math.min(b.widthValue,b.heightValue)/2,b.borderRadiusValue);a[0]-=b.widthValue/2;
a[1]-=b.heightValue/2;this._context.beginPath();this._context.moveTo(a[0]+b.borderRadiusValue,a[1]);this._context.lineTo(a[0]+b.widthValue-b.borderRadiusValue,a[1]);this._context.quadraticCurveTo(a[0]+b.widthValue,a[1],a[0]+b.widthValue,a[1]+b.borderRadiusValue);this._context.lineTo(a[0]+b.widthValue,a[1]+b.heightValue-b.borderRadiusValue);this._context.quadraticCurveTo(a[0]+b.widthValue,a[1]+b.heightValue,a[0]+b.widthValue-b.borderRadiusValue,a[1]+b.heightValue);this._context.lineTo(a[0]+b.borderRadiusValue,
a[1]+b.heightValue);this._context.quadraticCurveTo(a[0],a[1]+b.heightValue,a[0],a[1]+b.heightValue-b.borderRadiusValue);this._context.lineTo(a[0],a[1]+b.borderRadiusValue);this._context.quadraticCurveTo(a[0],a[1],a[0]+b.borderRadiusValue,a[1]);this._context.closePath();if(b.doFill){this._context.fillStyle=b.fill;this._context.globalAlpha=b.opacity*b.fillOpacity;this._context.fill()}if(b.doStroke){this._context.lineJoin="round";this._context.lineWidth=b.strokeWidthValue;this._context.strokeStyle=b.stroke;
this._context.globalAlpha=b.opacity*b.strokeOpacity;this._context.stroke()}}},drawLineString:function(a,b){this._drawLines([a],false,b)},drawPolygon:function(a,b){this._drawLines(a,true,b)},drawBbox:function(a,b){this._drawLines([[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]],[a[0],a[1]]]],true,b)},_getGraphicStyle:function(a){function b(c){c=parseInt(c);return+c+""===c?+c:c}a=e.extend({},this._options.style,a);a.borderRadiusValue=b(a.borderRadius);a.fill=a.fill||a.color;a.doFill=a.fill&&a.fillOpacity>
0;a.stroke=a.stroke||a.color;a.strokeWidthValue=b(a.strokeWidth);a.doStroke=a.stroke&&a.strokeOpacity>0&&a.strokeWidthValue>0;a.widthValue=b(a.width);a.heightValue=b(a.height);return a},_drawLines:function(a,b,c){if(!(!a||!a.length||a[0].length<2)){c=this._getGraphicStyle(c);var d,f;if(c.visibility!="hidden"&&c.opacity>0){this._context.beginPath();this._context.moveTo(a[0][0][0],a[0][0][1]);var h=a[0][a[0].length-1];for(d=0;d<a.length;d++){for(f=0;f<a[d].length;f++)this._context.lineTo(a[d][f][0],
a[d][f][1]);if(b&&d>0){this._context.lineTo(h[0],h[1]);this._context.closePath()}}if(b&&c.doFill){this._context.fillStyle=c.fill;this._context.globalAlpha=c.opacity*c.fillOpacity;this._context.fill()}if(c.doStroke){this._context.lineJoin="round";this._context.lineWidth=c.strokeWidthValue;this._context.strokeStyle=c.stroke;this._context.globalAlpha=c.opacity*c.strokeOpacity;this._context.stroke()}}}}})})(jQuery);
(function(e,o){var q=function(){for(var a=5,b=document.createElement("div"),c=b.all||[];b.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",c[0];);return a>6?a:!a}();e.widget("geo.geomap",{_$elem:o,_created:false,_contentBounds:{},_$contentFrame:o,_$existingChildren:o,_$servicesContainer:o,_$drawContainer:o,_$shapesContainer:o,_$textContainer:o,_$textContent:o,_$eventTarget:o,_dpi:96,_currentServices:[],_center:o,_pixelSize:o,_centerMax:o,_pixelSizeMax:o,_wheelZoomFactor:1.18920711500273,_wheelTimeout:null,
_wheelLevel:0,_zoomFactor:2,_mouseDown:o,_inOp:o,_toolPan:o,_shiftZoom:o,_anchor:o,_current:o,_downDate:o,_moveDate:o,_clickDate:o,_lastMove:o,_lastDrag:o,_windowHandler:null,_resizeTimeout:null,_panning:o,_velocity:o,_friction:o,_supportTouch:o,_softDblClick:o,_isTap:o,_isDbltap:o,_drawTimeout:null,_drawPixels:[],_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:e.extend({},{bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{pan:"move",zoom:"crosshair",drawPoint:"crosshair",
drawLineString:"crosshair",drawPolygon:"crosshair"},drawStyle:{},mode:"pan",services:[{id:"OSM",type:"tiled",getUrl:function(a){return"http://tile.openstreetmap.org/"+a.zoom+"/"+a.tile.column+"/"+a.tile.row+".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},zoom:0}),_createWidget:function(a,b){this._$elem=e(b);if(!this._$elem.is("[data-geo-service]")){this._$elem.attr("data-geo-map",
"data-geo-map");this._graphicShapes=[];this._initOptions=a;this._forcePosition(this._$elem);this._$elem.css("text-align","left");var c=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:c.width,height:c.height};this._createChildren();this._center=this._centerMax=[0,0];this._pixelSize=this._pixelSizeMax=156543.03392799935;this._mouseDown=this._inOp=this._toolPan=this._shiftZoom=this._panning=this._isTap=this._isDbltap=
false;this._anchor=this._current=this._lastMove=this._lastDrag=this._velocity=[0,0];this._friction=[0.8,0.8];this._downDate=this._moveDate=this._clickDate=0}e.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){if(!this._$elem.is("[data-geo-service]")){this._options=this.options;this._softDblClick=(this._supportTouch="ontouchend"in document)||q==7;var a=this._supportTouch?"touchstart":"mousedown",b=this._supportTouch?"touchend touchcancel":"mouseup",c=this._supportTouch?"touchmove":
"mousemove";e(document).keydown(e.proxy(this._document_keydown,this));this._$eventTarget.dblclick(e.proxy(this._eventTarget_dblclick,this));this._$eventTarget.bind(a,e.proxy(this._eventTarget_touchstart,this));a=this._$eventTarget[0].setCapture?this._$eventTarget:e(document);a.bind(c,e.proxy(this._dragTarget_touchmove,this));a.bind(b,e.proxy(this._dragTarget_touchstop,this));this._$eventTarget.mousewheel(e.proxy(this._eventTarget_mousewheel,this));var d=this;this._windowHandler=function(){d._resizeTimeout&&
clearTimeout(d._resizeTimeout);this._resizeTimeout=setTimeout(function(){d._created&&d._$elem.geomap("resize")},500)};e(window).resize(this._windowHandler);this._$drawContainer.geographics({style:this._initOptions.drawStyle||{}});this._options.drawStyle=this._$drawContainer.geographics("option","style");this._$shapesContainer.geographics();if(this._initOptions){this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,false);this._initOptions.center&&this._setOption("center",this._initOptions.center,
false);this._initOptions.zoom&&this._setZoom(this._initOptions.zoom,false,false)}this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._createServices();this._refresh();this._created=true}},_setOption:function(a,b,c){if(!this._$elem.is("[data-geo-service]")){c=c===o||c;switch(a){case "bbox":if(e.geo.proj){b=e.geo.proj.fromGeodetic([[b[0],b[1]],[b[2],b[3]]]);b=[b[0][0],b[0][1],b[1][0],b[1][1]]}this._setBbox(b,false,c);b=this._getBbox();if(e.geo.proj){b=e.geo.proj.toGeodetic([[b[0],
b[1]],[b[2],b[3]]]);b=[b[0][0],b[0][1],b[1][0],b[1][1]]}break;case "center":this._setCenterAndSize(e.geo.proj?e.geo.proj.fromGeodetic([[b[0],b[1]]])[0]:b,this._pixelSize,false,c);break;case "drawStyle":if(this._$drawContainer){this._$drawContainer.geographics("option","style",b);b=this._$drawContainer.geographics("option","style")}break;case "mode":this._$drawContainer.geographics("clear");this._$eventTarget.css("cursor",this._options.cursors[b]);break;case "zoom":this._setZoom(b,false,c)}e.Widget.prototype._setOption.apply(this,
arguments);switch(a){case "services":this._createServices();c&&this._refresh()}}},destroy:function(){if(this._$elem.is("[data-geo-map]")){this._created=false;e(window).unbind("resize",this._windowHandler);for(var a=0;a<this._currentServices.length;a++){this._currentServices[a].serviceContainer.geomap("destroy");e.geo._serviceTypes[this._currentServices[a].type].destroy(this,this._$servicesContainer,this._currentServices[a])}this._$shapesContainer.geographics("destroy");this._$drawContainer.geographics("destroy");
this._$existingChildren.detach();this._$elem.html("");this._$elem.append(this._$existingChildren);this._$elem.removeAttr("data-geo-map")}e.Widget.prototype.destroy.apply(this,arguments)},getPixelSize:function(){return this._pixelSize},toMap:function(a){a=this._toMap(a);return e.geo.proj?e.geo.proj.toGeodetic(a):a},toPixel:function(a,b,c){a=e.geo.proj?e.geo.proj.fromGeodetic(a):a;return this._toPixel(a,b,c)},opacity:function(a,b){if(this._$elem.is("[data-geo-service]"))this._$elem.closest("[data-geo-map]").geomap("opacity",
a,this._$elem);else if(a>=0||a<=1)for(var c=0;c<this._currentServices.length;c++){var d=this._currentServices[c];if(!b||d.serviceContainer[0]==b[0]){this._options.services[c].opacity=d.opacity=a;e.geo._serviceTypes[d.type].opacity(this,d)}}},toggle:function(a,b){if(this._$elem.is("[data-geo-service]"))this._$elem.closest("[data-geo-map]").geomap("toggle",a,this._$elem);else for(var c=0;c<this._currentServices.length;c++){var d=this._currentServices[c];if(!b||d.serviceContainer[0]==b[0]){if(a===o)a=
d.visible===o?false:!d.visible;this._options.services[c].visible=d.visible=a;e.geo._serviceTypes[d.type].toggle(this,d);a&&e.geo._serviceTypes[d.type].refresh(this,d)}}},zoom:function(a){a!=null&&this._setZoom(this._options.zoom+a,false,true)},refresh:function(){this._refresh()},resize:function(){var a=this._findMapSize(),b=a.width/2-this._contentBounds.width/2,c=a.height/2-this._contentBounds.height/2;this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),
width:a.width,height:a.height};this._$contentFrame.css({width:a.width,height:a.height});this._$servicesContainer.css({width:a.width,height:a.height});this._$eventTarget.css({width:a.width,height:a.height});var d=this._$shapesContainer.geographics("option","style");this._$shapesContainer.geographics("destroy");this._$drawContainer.geographics("destroy");this._$drawContainer.css({width:a.width,height:a.height});this._$drawContainer.geographics();this._$shapesContainer.css({width:a.width,height:a.height});
this._$shapesContainer.geographics({style:d});for(a=0;a<this._drawPixels.length;a++){this._drawPixels[a][0]+=b;this._drawPixels[a][1]+=c}this._setCenterAndSize(this._center,this._pixelSize,false,true)},shapeStyle:function(a){if(a){this._$shapesContainer.geographics("option","style",a);this._refresh()}else return this._$shapesContainer.geographics("option","style")},append:function(a,b,c){c=c===o||c;if(a){var d=this;a=a.type=="FeatureCollection"?a.features:e.isArray(a)?a:[a];e.each(a,function(){d._graphicShapes[d._graphicShapes.length]=
{shape:this,style:b}});c&&this._refresh()}},empty:function(){this._graphicShapes=[];this._refresh()},find:function(a,b){this.toPixel(a.coordinates);var c=this._pixelSize*b,d=[],f;e.each(this._graphicShapes,function(){if(this.shape.type=="Point")e.geo._distance(this.shape,a)<=c&&d.push(this.shape);else{var h=e.geo.bbox(this.shape);if(e.geo._distance({type:"Polygon",coordinates:[[[h[0],h[1]],[h[0],h[3]],[h[2],h[3]],[h[2],h[1]],[h[0],h[1]]]]},a)<=c){h=e.geo._flatten(this.shape);for(f=0;f<h.length;f++)if(e.geo._distance(h[f],
a)<=c){d.push(this.shape);break}}}});return d},remove:function(a){var b=this;e.each(this._graphicShapes,function(c){if(this.shape==a){var d=b._graphicShapes.slice(c+1||b._graphicShapes.length);b._graphicShapes.length=c<0?b._graphicShapes.length+c:c;b._graphicShapes.push.apply(b._graphicShapes,d);return false}});this._refresh()},_getBbox:function(a,b){a=a||this._center;b=b||this._pixelSize;var c=this._contentBounds.width/2*b,d=this._contentBounds.height/2*b;return[a[0]-c,a[1]-d,a[0]+c,a[1]+d]},_setBbox:function(a,
b,c){var d=[a[0]+(a[2]-a[0])/2,a[1]+(a[3]-a[1])/2];a=Math.max(e.geo.width(a,true)/this._contentBounds.width,e.geo.height(a,true)/this._contentBounds.height);if(this._options.tilingScheme)a=this._getTiledPixelSize(this._getTiledZoom(a));this._setCenterAndSize(d,a,b,c)},_getBboxMax:function(){var a=this._contentBounds.width/2*this._pixelSizeMax,b=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-a,this._centerMax[1]-b,this._centerMax[0]+a,this._centerMax[1]+b]},_getCenter:function(){return this._center},
_getContentBounds:function(){return this._contentBounds},_getZoom:function(){if(this._options.tilingScheme)return this._getTiledZoom(this._pixelSize);else{var a=this._contentBounds.width/this._contentBounds.height,b=e.geo.reaspect(this._getBbox(),a,true);a=e.geo.reaspect(this._getBboxMax(),a,true);return Math.log(e.geo.width(a,true)/e.geo.width(b,true))/Math.log(this._zoomFactor)}},_setZoom:function(a,b,c){a=Math.max(a,0);if(this._options.tilingScheme)this._setCenterAndSize(this._center,this._getTiledPixelSize(a),
b,c);else{a=e.geo.scaleBy(this._getBbox(),1/Math.pow(this._zoomFactor,a),true);this._setCenterAndSize(this._center,Math.max(e.geo.width(a,true)/this._contentBounds.width,e.geo.height(a,true)/this._contentBounds.height),b,c)}},_createChildren:function(){this._$existingChildren=this._$elem.children().detach();this._forcePosition(this._$existingChildren);this._$existingChildren.css("-moz-user-select","none");this._$elem.prepend("<div style='position:absolute; left:"+this._contentBounds.x+"px; top:"+
this._contentBounds.y+"px; width:"+this._contentBounds.width+"px; height:"+this._contentBounds.height+"px; margin:0; padding:0; overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;' unselectable='on'></div>");this._$eventTarget=this._$contentFrame=this._$elem.children(":first");this._$contentFrame.append('<div style="position:absolute; left:0; top:0; width:'+this._contentBounds.width+"px; height:"+this._contentBounds.height+'px; margin:0; padding:0;"></div>');
this._$servicesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div style="position:absolute; left:0; top:0; width:'+this._contentBounds.width+"px; height:"+this._contentBounds.height+'px; margin:0; padding:0;"></div>');this._$shapesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div style="position:absolute; left:0; top:0; width:'+this._contentBounds.width+"px; height:"+this._contentBounds.height+'px; margin:0; padding:0;"></div>');this._$drawContainer=
this._$contentFrame.children(":last");this._$contentFrame.append('<div class="ui-widget ui-widget-content ui-corner-all" style="position:absolute; left:0; top:0px; max-width:128px; display:none;"><div style="margin:.2em;"></div></div>');this._$textContainer=this._$contentFrame.children(":last");this._$textContent=this._$textContainer.children();this._$contentFrame.append(this._$existingChildren)},_createServices:function(){var a;for(a=0;a<this._currentServices.length;a++){this._currentServices[a].serviceContainer.geomap("destroy");
e.geo._serviceTypes[this._currentServices[a].type].destroy(this,this._$servicesContainer,this._currentServices[a])}this._currentServices=[];for(a=0;a<this._options.services.length;a++){this._currentServices[a]=e.extend({},this._options.services[a]);this._currentServices[a].serviceContainer=e.geo._serviceTypes[this._currentServices[a].type].create(this,this._$servicesContainer,this._currentServices[a],a).geomap()}},_refreshDrawing:function(){this._$drawContainer.geographics("clear");if(this._drawPixels.length>
0){var a;if(this._options.mode=="drawLineString")this._$drawContainer.geographics("drawLineString",this._drawPixels);else{a=e.merge([],this._drawPixels);a.push(a);this._$drawContainer.geographics("drawPolygon",a)}}},_resetDrawing:function(){this._drawPixels=[];this._drawCoords=[];this._$drawContainer.geographics("clear")},_refreshShapes:function(a,b,c,d,f){var h,l,k,n,p,x=this._getBbox(d,f),u=this;for(h=0;h<b.length;h++){k=b[h].shape||b[h];k=k.geometry||k;l=e.data(k,"geoBbox");if(!(l&&!e.geo._in(x,
l))){n=e.isArray(c)?c[h].style:c;switch(k.type){case "Point":this._$shapesContainer.geographics("drawPoint",this.toPixel(k.coordinates,d,f),n);break;case "LineString":this._$shapesContainer.geographics("drawLineString",this.toPixel(k.coordinates,d,f),n);break;case "Polygon":p=[];e.each(k.coordinates,function(y){p[y]=u.toPixel(this,d,f)});this._$shapesContainer.geographics("drawPolygon",p,n);break;case "MultiPoint":for(l=0;l<k.coordinates;l++)this._$shapesContainer.geographics("drawPoint",this.toPixel(k.coordinates[l],
d,f),n);break;case "MultiLineString":for(l=0;l<k.coordinates;l++)this._$shapesContainer.geographics("drawLineString",this.toPixel(k.coordinates[l],d,f),n);break;case "MultiPolygon":for(l=0;l<k.coordinates;l++){p=[];e.each(k.coordinates[l],function(y){p[y]=u.toPixel(this,d,f)});this._$shapesContainer.geographics("drawPolygon",p,n)}break;case "GeometryCollection":u._refreshShapes(a,k.geometries,n,d,f)}}}},_findMapSize:function(){for(var a={width:0,height:0},b=this._$elem;b.size()&&!(a.width>0&&a.height>
0);){a={width:b.width(),height:b.height()};if(a.width<=0||a.height<=0)a={width:parseInt(b.css("width")),height:parseInt(b.css("height"))};b=b.parent()}return a},_forcePosition:function(a){var b=a.css("position");b!="relative"&&b!="absolute"&&b!="fixed"&&a.css("position","relative")},_getTiledPixelSize:function(a){var b=this._options.tilingScheme;if(b!=null){if(a===0)return b.pixelSizes!=null?b.pixelSizes[0]:b.basePixelSize;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,(b.pixelSizes!=null?b.pixelSizes.length:
b.levels)-1);return b.pixelSizes!=null?b.pixelSizes[a]:b.basePixelSize/Math.pow(2,a)}else return NaN},_getTiledZoom:function(a){var b=this._options.tilingScheme;if(b.pixelSizes!=null){a=Math.floor(a*1E3);for(var c=(b.pixelSizes!=null?b.pixelSizes.length:b.levels)-1;c>=0;c--)if(Math.floor(b.pixelSizes[c]*1E3)>=a)return c;return 0}else return Math.max(Math.round(Math.log(b.basePixelSize/a)/Math.log(2)),0)},_getZoomCenterAndSize:function(a,b,c){if(this._options.tilingScheme){b=this._getTiledZoom(this._pixelSize)+
b;b=this._getTiledPixelSize(b)}else{b=Math.pow(c,-b);b=this._pixelSize*b}c=b/this._pixelSize;a=this._toMap(a);c=[(this._center[0]-a[0])*c,(this._center[1]-a[1])*c];return{pixelSize:b,center:[a[0]+c[0],a[1]+c[1]]}},_mouseWheelFinish:function(){this._wheelTimeout=null;if(this._wheelLevel!=0){var a=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._wheelZoomFactor);this._setCenterAndSize(a.center,a.pixelSize,true,true);this._wheelLevel=0}else this._refresh()},_panEnd:function(){this._velocity=
[this._velocity[0]>0?Math.floor(this._velocity[0]*this._friction[0]):Math.ceil(this._velocity[0]*this._friction[0]),this._velocity[1]>0?Math.floor(this._velocity[1]*this._friction[1]):Math.ceil(this._velocity[1]*this._friction[1])];if(Math.abs(this._velocity[0])<4&&Math.abs(this._velocity[1])<4)this._panFinalize();else{this._current=[this._current[0]+this._velocity[0],this._current[1]+this._velocity[1]];this._panMove();setTimeout(e.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(this._panning){this._velocity=
[0,0];var a=-(this._current[0]-this._anchor[0])*this._pixelSize,b=(this._current[1]-this._anchor[1])*this._pixelSize;this._$shapesContainer.css({left:0,top:0});this._setCenterAndSize([this._center[0]+a,this._center[1]+b],this._pixelSize,true,true);this._inOp=false;this._anchor=this._current;this._toolPan=this._panning=false;this._$eventTarget.css("cursor",this._options.cursors[this._options.mode])}},_panMove:function(){var a=this._current[0]-this._lastDrag[0],b=this._current[1]-this._lastDrag[1],
c=0,d;if(this._toolPan||a>3||a<-3||b>3||b<-3){if(!this._toolPan){this._toolPan=true;this._$eventTarget.css("cursor",this._options.cursors.pan)}if(this._mouseDown)this._velocity=[a,b];if(a!=0||b!=0){this._panning=true;this._lastDrag=this._current;for(c=0;c<this._options.services.length;c++){d=this._options.services[c];e.geo._serviceTypes[d.type].interactivePan(this,d,a,b)}this._$shapesContainer.css({left:function(f,h){return parseInt(h)+a},top:function(f,h){return parseInt(h)+b}});for(c=0;c<this._drawPixels.length;c++){this._drawPixels[c][0]+=
a;this._drawPixels[c][1]+=b}this._refreshDrawing()}}},_refresh:function(){for(var a=0;a<this._options.services.length;a++){var b=this._options.services[a];!this._mouseDown&&e.geo._serviceTypes[b.type]!=null&&e.geo._serviceTypes[b.type].refresh(this,b)}if(this._$shapesContainer){this._$shapesContainer.geographics("clear");this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes)}},_setCenterAndSize:function(a,b,c,d){if(this._pixelSize!=b){this._$shapesContainer.geographics("clear");
for(var f=0;f<this._options.services.length;f++){var h=this._options.services[f];e.geo._serviceTypes[h.type].interactiveScale(this,h,a,b)}}this._center=a;this._pixelSize=b;if(e.geo.proj){a=this._getBbox();a=e.geo.proj.toGeodetic([[a[0],a[1]],[a[2],a[3]]]);a=[a[0][0],a[0][1],a[1][0],a[1][1]];this._options.bbox=a;this._options.center=e.geo.proj.toGeodetic([[this._center[0],this._center[1]]])[0]}else{this._options.bbox=this._getBbox();this._options.center=this._center}this._options.zoom=this._getZoom();
if(this._drawCoords.length>0)this._drawPixels=this._toPixel(this._drawCoords);c&&this._trigger("bboxchange",window.event,{bbox:this._options.bbox});if(d){this._refresh();this._refreshDrawing()}},_toMap:function(a,b,c){var d=e.isArray(a[0]);d||(a=[a]);b=b||this._center;c=c||this._pixelSize;var f=this._contentBounds.width,h=this._contentBounds.height,l=f/2*c;c=h/2*c;var k=[b[0]-l,b[1]-c,b[0]+l,b[1]+c],n=e.geo.width(k,true)/f,p=e.geo.height(k,true)/h,x=[];e.each(a,function(u){x[u]=[k[0]+this[0]*n,k[3]-
this[1]*p]});return d?x:x[0]},_toPixel:function(a,b,c){var d=e.isArray(a[0]);d||(a=[a]);b=b||this._center;c=c||this._pixelSize;var f=this._contentBounds.width,h=this._contentBounds.height,l=f/2*c;c=h/2*c;var k=[b[0]-l,b[1]-c,b[0]+l,b[1]+c],n=e.geo.width(k,true),p=e.geo.height(k,true),x=[];e.each(a,function(u){x[u]=[Math.round((this[0]-k[0])*f/n),Math.round((k[3]-this[1])*h/p)]});return d?x:x[0]},_zoomTo:function(a,b,c,d){b=b<0?0:b;var f=this._getTiledPixelSize(b);if(isNaN(f)){b=e.geo._scaleBy(this._getBboxMax(),
1/Math.pow(this._zoomFactor,b),true);b=Math.max(e.geo.width(b,true)/this._contentBounds.width,e.geo.height(b,true)/this._contentBounds.height);this._setCenterAndSize(a,b,c,d)}else this._setCenterAndSize(a,f,c,d)},_document_keydown:function(a){var b=this._drawCoords.length;if(b>0&&a.which==27)if(b<=2){this._resetDrawing();this._inOp=false}else{this._drawCoords[b-2]=e.merge([],this._drawCoords[b-1]);this._drawPixels[b-2]=e.merge([],this._drawPixels[b-1]);this._drawCoords.length--;this._drawPixels.length--;
this._refreshDrawing()}},_eventTarget_dblclick_zoom:function(a){this._trigger("dblclick",a,{type:"Point",coordinates:this.toMap(this._current)});if(!a.isDefaultPrevented()){a=this._getZoomCenterAndSize(this._current,1,this._zoomFactor);this._setCenterAndSize(a.center,a.pixelSize,true,true)}},_eventTarget_dblclick:function(a){this._panFinalize();if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}e(a.currentTarget).offset();switch(this._options.mode){case "pan":case "drawPoint":this._eventTarget_dblclick_zoom(a);
break;case "drawLineString":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){this._drawCoords.length--;this._trigger("shape",a,{type:"LineString",coordinates:e.geo.proj?e.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})}else this._eventTarget_dblclick_zoom(a);this._resetDrawing();break;case "drawPolygon":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){var b=
this._drawCoords.length-1;if(b>2){this._drawCoords[b]=e.merge([],this._drawCoords[0]);this._trigger("shape",a,{type:"Polygon",coordinates:[e.geo.proj?e.geo.proj.toGeodetic(this._drawCoords):this._drawCoords]})}}else this._eventTarget_dblclick_zoom(a);this._resetDrawing()}this._inOp=false},_eventTarget_touchstart:function(a){if(!(!this._supportTouch&&a.which!=1)){this._panFinalize();this._mouseWheelFinish();var b=e(a.currentTarget).offset();this._current=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-
b.left,a.originalEvent.changedTouches[0].pageY-b.top]:[a.pageX-b.left,a.pageY-b.top];if(this._softDblClick){b=e.now();if(b-this._downDate<750){if(this._isTap){var c=this._current[0]-this._anchor[0],d=this._current[1]-this._anchor[1];if(Math.sqrt(c*c+d*d)>10)this._isTap=false;else this._current=this._anchor}this._isDbltap=this._isDbltap?false:this._isTap}else this._isDbltap=false;this._isTap=true;this._downDate=b}a.preventDefault();this._mouseDown=true;this._anchor=this._current;if(!this._inOp&&a.shiftKey){this._shiftZoom=
true;this._$eventTarget.css("cursor",this._options.cursors.zoom)}else{this._inOp=true;switch(this._options.mode){case "pan":case "drawPoint":case "drawLineString":case "drawPolygon":this._lastDrag=this._current;a.currentTarget.setCapture&&a.currentTarget.setCapture()}}return false}},_dragTarget_touchmove:function(a){var b=this._$eventTarget.offset(),c=this._drawCoords.length;b=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-b.left,a.originalEvent.changedTouches[0].pageY-b.top]:[a.pageX-
b.left,a.pageY-b.top];if(!(b[0]==this._lastMove[0]&&b[1]==this._lastMove[1])){if(this._softDblClick)this._isDbltap=this._isTap=false;if(this._mouseDown){this._current=b;this._moveDate=e.now()}switch(this._shiftZoom?"zoom":this._options.mode){case "pan":case "drawPoint":this._mouseDown||this._toolPan?this._panMove():this._trigger("move",a,{type:"Point",coordinates:this.toMap(b)});break;case "drawLineString":case "drawPolygon":if(this._mouseDown||this._toolPan)this._panMove();else{if(c>0){this._drawCoords[c-
1]=this._toMap(b);this._drawPixels[c-1]=b;this._refreshDrawing()}this._trigger("move",a,{type:"Point",coordinates:this.toMap(b)})}}this._lastMove=b}},_dragTarget_touchstop:function(a){!this._mouseDown&&q==7&&this._eventTarget_touchstart(a);var b=this._mouseDown,c=this._toolPan,d=this._$eventTarget.offset(),f=this._shiftZoom?"zoom":this._options.mode,h;h=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-d.left,a.originalEvent.changedTouches[0].pageY-d.top]:[a.pageX-d.left,a.pageY-d.top];
this._$eventTarget.css("cursor",this._options.cursors[f]);this._shiftZoom=this._mouseDown=this._toolPan=false;document.releaseCapture&&document.releaseCapture();if(b){b=e.now();this._current=h;switch(f){case "pan":if(c)this._panEnd();else if(b-this._clickDate>100){this._trigger("click",a,{type:"Point",coordinates:this.toMap(h)});this._inOp=false}break;case "drawPoint":if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}if(c)this._panFinalize();else if(b-this._clickDate>
100){var l=this;this._drawTimeout=setTimeout(function(){if(l._drawTimeout){l._trigger("shape",a,{type:"Point",coordinates:l.toMap(h)});l._inOp=false;l._drawTimeout=false}},250)}break;case "drawLineString":case "drawPolygon":if(c)this._panFinalize();else{c=this._drawCoords.length==0?0:this._drawCoords.length-1;this._drawCoords[c]=this._toMap(h);this._drawPixels[c]=h;if(c<2||!(this._drawCoords[c][0]==this._drawCoords[c-1][0]&&this._drawCoords[c][1]==this._drawCoords[c-1][1])){this._drawCoords[c+1]=
this._toMap(h);this._drawPixels[c+1]=h}this._refreshDrawing()}}this._clickDate=b;if(this._softDblClick&&this._isDbltap){this._isDbltap=this._isTap=false;this._$eventTarget.trigger("dblclick",a)}}},_eventTarget_mousewheel:function(a,b){a.preventDefault();this._panFinalize();if(!this._mouseDown){if(b!=0){if(this._wheelTimeout){window.clearTimeout(this._wheelTimeout);this._wheelTimeout=null}else{var c=e(a.currentTarget).offset();this._anchor=[a.pageX-c.left,a.pageY-c.top]}this._wheelLevel+=b;c=this._getZoomCenterAndSize(this._anchor,
this._wheelLevel,this._wheelZoomFactor);this._$shapesContainer.geographics("clear");for(i=0;i<this._options.services.length;i++){var d=this._options.services[i];e.geo._serviceTypes[d.type].interactiveScale(this,d,c.center,c.pixelSize)}this._$shapesContainer.geographics("clear");this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,c.center,c.pixelSize);if(this._drawCoords.length>0){this._drawPixels=this._toPixel(this._drawCoords,c.center,
c.pixelSize);this._refreshDrawing()}var f=this;this._wheelTimeout=window.setTimeout(function(){f._mouseWheelFinish()},1E3)}return false}}})})(jQuery);
(function(e,o){e.geo._serviceTypes.tiled=function(){var q={};return{create:function(a,b,c){if(!q[c.id]){q[c.id]={loadCount:0,reloadTiles:false,serviceContainer:null};b.append('<div data-geo-service="tiled" id="'+c.id+'" style="position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0; display:'+(c.visible===o||c.visible?"block":"none")+';"></div>');return q[c.id].serviceContainer=b.children(":last")}},destroy:function(a,b,c){q[c.id].serviceContainer.remove();delete q[c.id]},interactivePan:function(a,
b,c,d){if(q[b.id]){this._cancelUnloaded(a,b);q[b.id].serviceContainer.children().css({left:function(I,L){return parseInt(L)+c},top:function(I,L){return parseInt(L)+d}});if(b&&q[b.id]!=null&&(b.visible===o||b.visible)){var f=a.getPixelSize(),h=q[b.id],l=h.serviceContainer,k=l.children("[data-pixelSize='"+f+"']"),n=a._getContentBounds(),p=a.options.tilingScheme,x=p.tileWidth,u=p.tileHeight,y=n.width/2*f,A=n.height/2*f,z=k.position(),w=k.data("scaleOrigin").split(",");n=parseInt(w[0])-z.left;z=parseInt(w[1])-
z.top;var C=a._getCenter();w=[C[0]+n*f,C[1]-z*f];var F=Math.floor((w[0]-y-p.origin[0])/(f*x));n=Math.floor((p.origin[1]-(w[1]+A))/(f*u));z=Math.ceil((w[0]+y-p.origin[0])/(f*x));w=Math.ceil((p.origin[1]-(w[1]-A))/(f*u));var G=a._getBboxMax(),E=a._getTiledPixelSize(0),B=E/f,D=Math.floor((G[0]-p.origin[0])/(E*x))*B;G=Math.floor((p.origin[1]-G[3])/(E*u))*B;y=Math.round((p.origin[0]+D*x*f-(C[0]-y))/f);A=Math.round((C[1]+A-(p.origin[1]-G*u*f))/f);var J=b.opacity===o?1:b.opacity;for(C=F;C<z;C++)for(F=n;F<
w;F++){E=""+C+","+F;B=k.children("[data-tile='"+E+"']").removeAttr("data-dirty");if(B.size()===0){var H=[p.origin[0]+C*x*f,p.origin[1]-F*u*f],r=[p.origin[0]+((C+1)*x-1)*f,p.origin[1]-((F+1)*u-1)*f];H=b.getUrl({bbox:[H[0],H[1],r[0],r[1]],width:x,height:u,zoom:a._getZoom(),tile:{row:F,column:C},index:Math.abs(F+C)});h.loadCount++;if(h.reloadTiles&&B.size()>0)B.attr("src",H);else{B="<img style='position:absolute; left:"+((C-D)*100+(y-y%x)/x*100)+"%; top:"+((F-G)*100+(A-A%u)/u*100)+"%; ";if(e("body")[0].filters===
o)B+="width: 100%; height: 100%;";B+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+E+"' />";k.append(B);B=k.children(":last");B.load(function(I){J<1?e(I.target).fadeTo(0,J):e(I.target).show();h.loadCount--;if(h.loadCount<=0){l.children(":not([data-pixelSize='"+f+"'])").remove();h.loadCount=0}}).error(function(I){e(I.target).remove();h.loadCount--;if(h.loadCount<=0){l.children(":not([data-pixelSize='"+
f+"'])").remove();h.loadCount=0}}).attr("src",H)}}}}}},interactiveScale:function(a,b,c,d){if(q[b.id]){this._cancelUnloaded(a,b);var f=a.options.tilingScheme,h=f.tileWidth,l=f.tileHeight;q[b.id].serviceContainer.children().each(function(){var k=e(this),n=k.attr("data-pixelSize")/d;n=Math.round(n*1E3)/1E3;var p=k.data("scaleOrigin").split(",");p=a._toMap([p[0],p[1]]);p=a._toPixel(p,c,d);k.css({left:Math.round(p[0])+"px",top:Math.round(p[1])+"px",width:h*n,height:l*n});e("body")[0].filters!==o&&k.children().each(function(){e(this).css("filter",
"progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+n+",M22="+n+",sizingmethod='auto expand')")})})}},refresh:function(a,b){if(b&&q[b.id]&&(b.visible===o||b.visible)){this._cancelUnloaded(a,b);var c=a._getBbox(),d=a.getPixelSize(),f=q[b.id],h=f.serviceContainer;a._getContentBounds();var l=a.options.tilingScheme,k=l.tileWidth,n=l.tileHeight,p=Math.floor((c[0]-l.origin[0])/(d*k)),x=Math.floor((l.origin[1]-c[3])/(d*n)),u=Math.ceil((c[2]-l.origin[0])/(d*k)),y=Math.ceil((l.origin[1]-c[1])/
(d*n)),A=a._getBboxMax(),z=a._getTiledPixelSize(0),w=z/d,C=Math.floor((A[0]-l.origin[0])/(z*k))*w,F=Math.floor((l.origin[1]-A[3])/(z*n))*w,G=Math.round((l.origin[0]+C*k*d-c[0])/d),E=Math.round((c[3]-(l.origin[1]-F*n*d))/d);c=h.children().show();A=c.filter("[data-pixelSize='"+d+"']").appendTo(h);var B=b.opacity===o?1:b.opacity;f.reloadTiles&&c.find("img").attr("data-dirty","true");if(A.size()){A.css({left:G%k+"px",top:E%n+"px"}).data("scaleOrigin",G%k+","+E%n);A.children().each(function(){var r=e(this),
I=r.attr("data-tile").split(",");r.css({left:Math.round((parseInt(I[0])-C)*100+(G-G%k)/k*100)+"%",top:Math.round((parseInt(I[1])-F)*100+(E-E%n)/n*100)+"%"});B<1&&r.fadeTo(0,B)})}else{h.append("<div style='position:absolute; left:"+G%k+"px; top:"+E%n+"px; width:"+k+"px; height:"+n+"px; margin:0; padding:0;' data-pixelSize='"+d+"'></div>");A=h.children(":last").data("scaleOrigin",G%k+","+E%n)}for(p=p;p<u;p++)for(z=x;z<y;z++){w=""+p+","+z;var D=A.children("[data-tile='"+w+"']").removeAttr("data-dirty");
if(D.size()===0||f.reloadTiles){var J=[l.origin[0]+p*k*d,l.origin[1]-z*n*d],H=[l.origin[0]+((p+1)*k-1)*d,l.origin[1]-((z+1)*n-1)*d];J=b.getUrl({bbox:[J[0],J[1],H[0],H[1]],width:k,height:n,zoom:a._getZoom(),tile:{row:z,column:p},index:Math.abs(z+p)});f.loadCount++;if(f.reloadTiles&&D.size()>0)D.attr("src",J);else{D="<img style='position:absolute; left:"+((p-C)*100+(G-G%k)/k*100)+"%; top:"+((z-F)*100+(E-E%n)/n*100)+"%; ";if(e("body")[0].filters===o)D+="width: 100%; height: 100%;";D+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+
w+"' />";A.append(D);D=A.children(":last");D.load(function(r){B<1?e(r.target).fadeTo(0,B):e(r.target).show();f.loadCount--;if(f.loadCount<=0){h.children(":not([data-pixelSize='"+d+"'])").remove();f.loadCount=0}}).error(function(r){e(r.target).remove();f.loadCount--;if(f.loadCount<=0){h.children(":not([data-pixelSize='"+d+"'])").remove();f.loadCount=0}}).attr("src",J)}}}c.find("[data-dirty]").remove();f.reloadTiles=false}},opacity:function(a,b){q[b.id].serviceContainer.find("img").stop(true).fadeTo("fast",
b.opacity)},toggle:function(a,b){q[b.id].serviceContainer.css("display",b.visible?"block":"none")},_cancelUnloaded:function(a,b){var c=q[b.id];if(c&&c.loadCount>0)for(c.serviceContainer.find("img:hidden").remove();c.loadCount>0;)c.loadCount--}}}()})(jQuery);
(function(e,o){e.geo._serviceTypes.shingled=function(){var q={};return{create:function(a,b,c){if(!q[c.id]){q[c.id]={loadCount:0};b.append('<div data-geo-service="shingled" id="'+c.id+'" style="position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0; display:'+(c.visible===o||c.visible?"block":"none")+';"></div>');return q[c.id].serviceContainer=b.children(":last")}},destroy:function(a,b,c){q[c.id].serviceContainer.remove();delete q[c.id]},interactivePan:function(a,b,c,d){if(q[b.id]){this._cancelUnloaded(a,
b);b=q[b.id].serviceContainer;a=a.getPixelSize();a=b.children("[data-pixelSize='"+a+"']");b=a.children("div");if(!b.length){a.children("img").wrap('<div style="position:absolute; left:0; top:0; width:100%; height:100%;"></div>');b=a.children("div")}b.css({left:function(f,h){return parseInt(h)+c},top:function(f,h){return parseInt(h)+d}})}},interactiveScale:function(a,b,c,d){if(q[b.id]){this._cancelUnloaded(a,b);b=q[b.id].serviceContainer;a=a._getContentBounds();var f=a.width,h=a.height,l=f/2,k=h/2;
b.children().each(function(){var n=e(this),p=n.attr("data-pixelSize"),x=p/d;n.css({width:f*x,height:h*x}).children("img").each(function(){var u=e(this),y=u.data("center");u.css({left:(Math.round((y[0]-c[0])/p)-l)*x+"px",top:(Math.round((c[1]-y[1])/p)-k)*x+"px"})})})}},refresh:function(a,b){if(b&&q[b.id]&&(b.visible===o||b.visible)){this._cancelUnloaded(a,b);var c=a._getBbox(),d=a.getPixelSize(),f=q[b.id],h=f.serviceContainer,l=a._getContentBounds(),k=l.width,n=l.height,p=k/2,x=n/2;l=h.children('[data-pixelSize="'+
d+'"]');var u=b.opacity===o?1:b.opacity;if(!l.size()){h.append('<div style="position:absolute; left:'+p+"px; top:"+x+"px; width:"+k+"px; height:"+n+'px; margin:0; padding:0;" data-pixelSize="'+d+'"></div>');l=h.children(":last")}l.children("img").each(function(){var y=e(this),A=y.data("center"),z=a._getCenter();y.css({left:Math.round((A[0]-z[0])/d)-p+"px",top:Math.round((z[1]-A[1])/d)-x+"px"})});u<1&&h.find("img").attr("data-keepAlive","0");c=b.getUrl({bbox:c,width:k,height:n,zoom:a._getZoom(),tile:null,
index:0});f.loadCount++;l.append('<img style="position:absolute; left:-'+p+"px; top:-"+x+'px; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />');l.children(":last").data("center",a._getCenter()).load(function(y){u<1?e(y.target).fadeTo(0,u):e(y.target).show();f.loadCount--;if(f.loadCount<=0){h.children(':not([data-pixelSize="'+d+'"])').remove();y=h.find('[data-pixelSize="'+d+
'"]>div');if(y.size()>0){var A=y.position();y.children("img").each(function(){var z=e(this),w=A.left+parseInt(z.css("left")),C=A.top+parseInt(z.css("top"));z.css({left:w+"px",top:C+"px"})}).unwrap();y.remove()}f.loadCount=0}}).error(function(y){e(y.target).remove();f.loadCount--;if(f.loadCount<=0){h.children(":not([data-pixelSize='"+d+"'])").remove();f.loadCount=0}}).attr("src",c)}},opacity:function(a,b){q[b.id].serviceContainer.find("img").stop(true).fadeTo("fast",b.opacity)},_cancelUnloaded:function(a,
b){var c=q[b.id];if(c&&c.loadCount>0)for(c.serviceContainer.find("img:hidden").remove();c.loadCount>0;)c.loadCount--}}}()})(jQuery);
