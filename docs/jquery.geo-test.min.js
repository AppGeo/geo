document.createElement("canvas").getContext||function(){function f(){return this.context_||(this.context_=new s(this))}function p(m,o){var v=R.call(arguments,2);return function(){return m.apply(o,v.concat(R.call(arguments)))}}function t(m){m.namespaces.g_vml_||m.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");m.namespaces.g_o_||m.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!m.styleSheets.ex_canvas_){m=m.createStyleSheet();m.owningElement.id=
"ex_canvas_";m.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function g(m){var o=m.srcElement;switch(m.propertyName){case "width":o.getContext().clearRect();o.style.width=o.attributes.width.nodeValue+"px";o.firstChild.style.width=o.clientWidth+"px";break;case "height":o.getContext().clearRect();o.style.height=o.attributes.height.nodeValue+"px";o.firstChild.style.height=o.clientHeight+"px"}}function b(m){m=m.srcElement;if(m.firstChild){m.firstChild.style.width=
m.clientWidth+"px";m.firstChild.style.height=m.clientHeight+"px"}}function a(){return[[1,0,0],[0,1,0],[0,0,1]]}function c(m,o){for(var v=a(),C=0;C<3;C++)for(var H=0;H<3;H++){for(var E=0,Z=0;Z<3;Z++)E+=m[C][Z]*o[Z][H];v[C][H]=E}return v}function e(m,o){o.fillStyle=m.fillStyle;o.lineCap=m.lineCap;o.lineJoin=m.lineJoin;o.lineWidth=m.lineWidth;o.miterLimit=m.miterLimit;o.shadowBlur=m.shadowBlur;o.shadowColor=m.shadowColor;o.shadowOffsetX=m.shadowOffsetX;o.shadowOffsetY=m.shadowOffsetY;o.strokeStyle=m.strokeStyle;
o.globalAlpha=m.globalAlpha;o.font=m.font;o.textAlign=m.textAlign;o.textBaseline=m.textBaseline;o.arcScaleX_=m.arcScaleX_;o.arcScaleY_=m.arcScaleY_;o.lineScale_=m.lineScale_}function d(m){var o=m.indexOf("(",3),v=m.indexOf(")",o+1);o=m.substring(o+1,v).split(",");if(o.length!=4||m.charAt(3)!="a")o[3]=1;return o}function h(m,o,v){return Math.min(v,Math.max(o,m))}function l(m,o,v){v<0&&v++;v>1&&v--;return 6*v<1?m+(o-m)*6*v:2*v<1?o:3*v<2?m+(o-m)*(2/3-v)*6:m}function n(m){if(m in aa)return aa[m];var o,
v=1;m=String(m);if(m.charAt(0)=="#")o=m;else if(/^rgb/.test(m)){v=d(m);o="#";for(var C,H=0;H<3;H++){C=v[H].indexOf("%")!=-1?Math.floor(parseFloat(v[H])/100*255):+v[H];o+=W[h(C,0,255)]}v=+v[3]}else if(/^hsl/.test(m)){H=v=d(m);o=parseFloat(H[0])/360%360;o<0&&o++;C=h(parseFloat(H[1])/100,0,1);H=h(parseFloat(H[2])/100,0,1);if(C==0)C=H=o=H;else{var E=H<0.5?H*(1+C):H+C-H*C,Z=2*H-E;C=l(Z,E,o+1/3);H=l(Z,E,o);o=l(Z,E,o-1/3)}o="#"+W[Math.floor(C*255)]+W[Math.floor(H*255)]+W[Math.floor(o*255)];v=v[3]}else o=
m;return aa[m]={color:o,alpha:v}}function s(m){this.m_=a();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=N*1;this.globalAlpha=1;this.canvas=m;var o="width:"+m.clientWidth+"px;height:"+m.clientHeight+"px;overflow:hidden;position:absolute",v=m.ownerDocument.createElement("div");v.style.cssText=o;m.appendChild(v);o=v.cloneNode(false);o.style.backgroundColor="red";o.style.filter="alpha(opacity=0)";
m.appendChild(o);this.element_=v;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1}function u(m,o,v,C){m.currentPath_.push({type:"bezierCurveTo",cp1x:o.x,cp1y:o.y,cp2x:v.x,cp2y:v.y,x:C.x,y:C.y});m.currentX_=C.x;m.currentY_=C.y}function w(m,o,v){m=m.m_;return{x:N*(o*m[0][0]+v*m[1][0]+m[2][0])-I,y:N*(o*m[0][1]+v*m[1][1]+m[2][1])-I}}function G(m,o,v){if(isFinite(o[0][0])&&isFinite(o[0][1])&&isFinite(o[1][0])&&isFinite(o[1][1])&&isFinite(o[2][0])&&isFinite(o[2][1])){m.m_=o;if(v)m.lineScale_=S(Q(o[0][0]*
o[1][1]-o[0][1]*o[1][0]))}}function D(m){this.code=this[m];this.message=m+": DOM Exception "+this.code}var P=Math,z=P.round,O=P.sin,K=P.cos,Q=P.abs,S=P.sqrt,N=10,I=N/2;navigator.userAgent.match(/MSIE ([\d.]+)?/);var R=Array.prototype.slice;t(document);P={init:function(m){m=m||document;m.createElement("canvas");m.attachEvent("onreadystatechange",p(this.init_,this,m))},init_:function(m){m=m.getElementsByTagName("canvas");for(var o=0;o<m.length;o++)this.initElement(m[o])},initElement:function(m){if(!m.getContext){m.getContext=
f;t(m.ownerDocument);m.innerHTML="";m.attachEvent("onpropertychange",g);m.attachEvent("onresize",b);var o=m.attributes;if(o.width&&o.width.specified)m.style.width=o.width.nodeValue+"px";else m.width=m.clientWidth;if(o.height&&o.height.specified)m.style.height=o.height.nodeValue+"px";else m.height=m.clientHeight}return m}};P.init();for(var W=[],A=0;A<16;A++)for(var V=0;V<16;V++)W[A*16+V]=A.toString(16)+V.toString(16);var aa={},la={butt:"flat",round:"round"};A=s.prototype;A.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);
this.textMeasureEl_=null}this.element_.innerHTML=""};A.beginPath=function(){this.currentPath_=[]};A.moveTo=function(m,o){var v=w(this,m,o);this.currentPath_.push({type:"moveTo",x:v.x,y:v.y});this.currentX_=v.x;this.currentY_=v.y};A.lineTo=function(m,o){var v=w(this,m,o);this.currentPath_.push({type:"lineTo",x:v.x,y:v.y});this.currentX_=v.x;this.currentY_=v.y};A.bezierCurveTo=function(m,o,v,C,H,E){H=w(this,H,E);m=w(this,m,o);v=w(this,v,C);u(this,m,v,H)};A.quadraticCurveTo=function(m,o,v,C){m=w(this,
m,o);v=w(this,v,C);C={x:this.currentX_+2/3*(m.x-this.currentX_),y:this.currentY_+2/3*(m.y-this.currentY_)};u(this,C,{x:C.x+(v.x-this.currentX_)/3,y:C.y+(v.y-this.currentY_)/3},v)};A.arc=function(m,o,v,C,H,E){v*=N;var Z=E?"at":"wa",X=m+K(C)*v-I,q=o+O(C)*v-I;C=m+K(H)*v-I;H=o+O(H)*v-I;if(X==C&&!E)X+=0.125;m=w(this,m,o);X=w(this,X,q);C=w(this,C,H);this.currentPath_.push({type:Z,x:m.x,y:m.y,radius:v,xStart:X.x,yStart:X.y,xEnd:C.x,yEnd:C.y})};A.stroke=function(m){var o=[];o.push("<g_vml_:shape",' filled="',
!!m,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0,0"',' coordsize="',N*10,",",N*10,'"',' stroked="',!m,'"',' path="');for(var v={x:null,y:null},C={x:null,y:null},H=0;H<this.currentPath_.length;H++){var E=this.currentPath_[H];switch(E.type){case "moveTo":o.push(" m ",z(E.x),",",z(E.y));break;case "lineTo":o.push(" l ",z(E.x),",",z(E.y));break;case "close":o.push(" x ");E=null;break;case "bezierCurveTo":o.push(" c ",z(E.cp1x),",",z(E.cp1y),",",z(E.cp2x),",",z(E.cp2y),
",",z(E.x),",",z(E.y));break;case "at":case "wa":o.push(" ",E.type," ",z(E.x-this.arcScaleX_*E.radius),",",z(E.y-this.arcScaleY_*E.radius)," ",z(E.x+this.arcScaleX_*E.radius),",",z(E.y+this.arcScaleY_*E.radius)," ",z(E.xStart),",",z(E.yStart)," ",z(E.xEnd),",",z(E.yEnd))}if(E){if(v.x==null||E.x<v.x)v.x=E.x;if(C.x==null||E.x>C.x)C.x=E.x;if(v.y==null||E.y<v.y)v.y=E.y;if(C.y==null||E.y>C.y)C.y=E.y}}o.push(' ">');if(m){m=n(this.fillStyle);o.push('<g_vml_:fill color="',m.color,'" opacity="',m.alpha*this.globalAlpha,
'" />')}else{v=n(this.strokeStyle);m=v.color;v=v.alpha*this.globalAlpha;C=this.lineScale_*this.lineWidth;if(C<1)v*=C;o.push("<g_vml_:stroke",' opacity="',v,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',la[this.lineCap]||"square",'"',' weight="',C,'px"',' color="',m,'" />')}o.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",o.join(""))};A.fill=function(){this.stroke(true)};A.closePath=function(){this.currentPath_.push({type:"close"})};A.save=
function(){var m={};e(this,m);this.aStack_.push(m);this.mStack_.push(this.m_);this.m_=c(a(),this.m_)};A.restore=function(){if(this.aStack_.length){e(this.aStack_.pop(),this);this.m_=this.mStack_.pop()}};A.translate=function(m,o){G(this,c([[1,0,0],[0,1,0],[m,o,1]],this.m_),false)};A.scale=function(m,o){this.arcScaleX_*=m;this.arcScaleY_*=o;G(this,c([[m,0,0],[0,o,0],[0,0,1]],this.m_),true)};A=D.prototype=Error();A.INDEX_SIZE_ERR=1;A.DOMSTRING_SIZE_ERR=2;A.HIERARCHY_REQUEST_ERR=3;A.WRONG_DOCUMENT_ERR=
4;A.INVALID_CHARACTER_ERR=5;A.NO_DATA_ALLOWED_ERR=6;A.NO_MODIFICATION_ALLOWED_ERR=7;A.NOT_FOUND_ERR=8;A.NOT_SUPPORTED_ERR=9;A.INUSE_ATTRIBUTE_ERR=10;A.INVALID_STATE_ERR=11;A.SYNTAX_ERR=12;A.INVALID_MODIFICATION_ERR=13;A.NAMESPACE_ERR=14;A.INVALID_ACCESS_ERR=15;A.VALIDATION_ERR=16;A.TYPE_MISMATCH_ERR=17;G_vmlCanvasManager=P;CanvasRenderingContext2D=s;DOMException=D}();
$.widget||function(f,p){if(f.cleanData){var t=f.cleanData;f.cleanData=function(b){for(var a=0,c;(c=b[a])!=null;a++)try{f(c).triggerHandler("remove")}catch(e){}t(b)}}else{var g=f.fn.remove;f.fn.remove=function(b,a){return this.each(function(){if(!a)if(!b||f.filter(b,[this]).length)f("*",this).add([this]).each(function(){try{f(this).triggerHandler("remove")}catch(c){}});return g.call(f(this),b,a)})}}f.widget=function(b,a,c){var e=b.split(".")[0],d;b=b.split(".")[1];d=e+"-"+b;if(!c){c=a;a=f.Widget}f.expr[":"][d]=
function(h){return!!f.data(h,b)};f[e]=f[e]||{};f[e][b]=function(h,l){arguments.length&&this._createWidget(h,l)};a=new a;a.options=f.extend(true,{},a.options);f[e][b].prototype=f.extend(true,a,{namespace:e,widgetName:b,widgetEventPrefix:f[e][b].prototype.widgetEventPrefix||b,widgetBaseClass:d},c);f.widget.bridge(b,f[e][b])};f.widget.bridge=function(b,a){f.fn[b]=function(c){var e=typeof c==="string",d=Array.prototype.slice.call(arguments,1),h=this;c=!e&&d.length?f.extend.apply(null,[true,c].concat(d)):
c;if(e&&c.charAt(0)==="_")return h;e?this.each(function(){var l=f.data(this,b),n=l&&f.isFunction(l[c])?l[c].apply(l,d):l;if(n!==l&&n!==p){h=n;return false}}):this.each(function(){var l=f.data(this,b);l?l.option(c||{})._init():f.data(this,b,new a(c,this))});return h}};f.Widget=function(b,a){arguments.length&&this._createWidget(b,a)};f.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:false},_createWidget:function(b,a){f.data(a,this.widgetName,this);this.element=f(a);this.options=
f.extend(true,{},this.options,this._getCreateOptions(),b);var c=this;this.element.bind("remove."+this.widgetName,function(){c.destroy()});this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return f.metadata&&f.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+
"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(b,a){var c=b;if(arguments.length===0)return f.extend({},this.options);if(typeof b==="string"){if(a===p)return this.options[b];c={};c[b]=a}this._setOptions(c);return this},_setOptions:function(b){var a=this;f.each(b,function(c,e){a._setOption(c,e)});return this},_setOption:function(b,a){this.options[b]=a;if(b==="disabled")this.widget()[a?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",
a);return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_trigger:function(b,a,c){var e,d=this.options[b];c=c||{};a=f.Event(a);a.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();a.target=this.element[0];if(b=a.originalEvent)for(e in b)e in a||(a[e]=b[e]);this.element.trigger(a,c);return!(f.isFunction(d)&&d.call(this.element[0],a,c)===false||a.isDefaultPrevented())}}}(jQuery);
this.jsviews||this.jQuery&&jQuery.views||function(f,p){function t(q,r){var y="\\"+q.charAt(0),F="\\"+q.charAt(1),B="\\"+r.charAt(0),x="\\"+r.charAt(1);X.rTag=P=F+"(?:(?:(\\w+(?=[\\/\\s"+B+"]))|(?:(\\w+)?(:)|(>)|(\\*)))\\s*((?:[^"+B+"]|"+B+"(?!"+x+"))*?)(\\/)?|(?:\\/(\\w+)))"+B;P=RegExp(y+P+x,"g");z=RegExp("<.*>|"+q+".*"+r);return this}function g(q,r,y,F,B,x){var J=y.views;q={tmpl:B,path:r,parent:y,data:F,ctx:q,views:D.isArray(F)?[]:{}};if(D.isArray(J))J.splice(q.index=x!==p?x:J.length,0,q);else J[q.index=
"_"+la++]=q;return q}function b(q,r,y,F){var B;if(r&&typeof r==="object"&&!r.nodeType){for(B in r)q(B,r[B]);return X}if(!r||y===p){if(F)y=F(p,y||r)}else if(""+r===r)if(y===null)delete q[r];else if(y=F?F(r,y):y)q[r]=y;if(B=K.onStoreItem)B(q,r,y,F);return y}function a(q,r){return b(a,q,r,u)}function c(q,r){return b(c,q,r)}function e(q,r){return b(e,q,r)}function d(q,r){return b(d,q,r)}function h(q,r,y,F,B){var x,J,T,M,L,ca,U,fa={};M=B===S;var ga="";if(this.isTag){U=this.tmpl;r=r||this.ctx;y=y||this.parent;
F=F||this.path;B=B||this.index;fa=this.props}else U=this.jquery&&this[0]||this;y=y||X.topView;L=y.ctx;x=U.layout;if(q===y){q=y.data;x=S}r=r&&r===L?L:L?(L=O({},L),r)?O(L,r):L:r||{};if(fa.link!==p)r.link=fa.link;U.fn||(U=a[U]||a(U));L=r.link&&K.onRenderItem;ca=r.link&&K.onRenderItems;if(U){if(D.isArray(q)&&!x){M=M?y:B!==p&&y||g(r,F,y,q,U,B);x=0;for(J=q.length;x<J;x++){T=q[x];T=U.fn(T,g(r,F,M,T,U,(B||0)+x),X);ga+=L?L(T,fa):T}}else{M=M?y:g(r,F,y,q,U,B);ga+=q||x?U.fn(q,M,X):""}y.topKey=M.index;return ca?
ca(ga,F,M.index,U,fa):ga}return""}function l(){throw"Syntax error";}function n(q,r,y){function F(ha){ha-=pa;ha&&ba.push(q.substr(pa,ha).replace(W,"\\n"))}var B,x,J,T,M,L,ca,U,fa,ga,da,ra,ma,ea,sa,na,wa=r?{allowCode:na=r.allowCode,debug:r.debug}:{},xa=r&&r.tmpls,qa=[],pa=0,ia=[],ba=qa,Y=[,,,qa],ta=0;q=q.replace(V,"\\$1");q.replace(P,function(ha,oa,ja,za,ua,Ca,ka,Da,Ea,ya){if(ua){za=":";ja="html"}var va="",Aa="";ua=!Da&&!za;oa=oa||za;F(ya);pa=ya+ha.length;if(Ca)na&&ba.push(["*",ka.replace(A,"$1")]);
else if(oa){if(oa==="else"){Y[5]=q.substring(Y[5],ya);Y=ia.pop();ba=Y[3];ua=S}ka=ka?s(ka,y).replace(aa,function(Ga,Fa,Ba){if(Fa)Aa+=Ba+",";else va+=Ba+",";return""}):"";va=va.slice(0,-1);ka=ka.slice(0,-1);B=[oa,ja||"",ka,ua&&[],"{"+(va?"props:{"+va+"},":"")+"path:'"+ka+"'"+(Aa?",ctx:{"+Aa.slice(0,-1)+"}":"")+"}"];if(ua){ia.push(Y);Y=B;Y[5]=pa}ba.push(B)}else if(Ea){Y[5]=q.substring(Y[5],ya);Y=ia.pop()}if(!Y)throw"Expected block tag";ba=Y[3]});F(q.length);M=(T=qa.length)?"":'"";';for(J=0;J<T;J++){x=
qa[J];if(x[0]==="*")M=M.slice(0,J?-1:-3)+";"+x[1]+(J+1<T?"ret+=":"");else if(""+x===x)M+='"'+x+'"+';else{ra=x[0];ma=x[1];ea=x[2];ba=x[3];sa=x[4];q=x[5];if(ba){x=w(q,wa,r,ta++);n(q,x);xa.push(x)}U=U||ea.indexOf('h(view,"')>-1;da=da||ea.indexOf("view")>-1;M+=(ra===":"?ma==="html"?(ca=S,"e("+ea):ma?(ga=S,'c("'+ma+'",view,'+ea):(fa=S,"((v="+ea+')!==u?v:""'):(L=S,'t("'+ra+'",view,"'+(ma||"")+'",'+(ba?xa.length:'""')+","+sa+(ea?",":"")+ea))+")+"}}M=new Function("data, view, j, b, u",C+(fa?"v,":"")+(L?"t=j.tag,":
"")+(ga?"c=j.convert,":"")+(ca?"e=j.converters.html,":"")+(U?"h=j.ctx,":"")+"ret; try{\n\n"+(wa.debug?"debugger;":"")+(na?"ret=":"return ")+M.slice(0,-1)+";\n\n"+(na?"return ret;":"")+"}catch(e){return j.err(e);}");if(r){r.fn=M;r.useVw=ga||U||da||L}return M}function s(q,r){var y,F={},B=0,x=Q,J=Q;return q=(q+" ").replace(R,function(T,M,L,ca,U,fa,ga,da,ra,ma,ea,sa,na,wa,xa){function qa(pa,ia,ba,Y,ta,ha,oa,ja){if(ba){ia=(Y?'h(view,"'+Y+'")':ta?"view":"data")+(ja?(ha?"."+ha:Y?"":ta?"":"."+ba)+(oa||""):
(ja=Y?"":ta?ha||"":ba,""));if(r&&da!=="(")ia="b("+ia+',"'+ja+'")';ia+=ja?"."+ja:""}return ia||pa}L=L||ga;da=da||wa||"";ca=ca||"";if(U)l();else return((M=M||ma)?(B++,M):"")+(J?(J=!ea,J?T:'"'):x?(x=!sa,x?T:'"'):xa?B?"":y?(y=Q,"\u0008"):",":fa?(B&&l(),y=S,"\u0008"+L+":"):L?L.replace(I,qa)+(da?(F[++B]=S,da):ca):ca?T:na?(F[B--]=Q,na)+(da?(F[++B]=S,da):""):ra?(F[B]||l(),","):(J=ea,x=sa,'"'))})}function u(q,r,y,F){function B(L){if(""+L===L||L.nodeType>0){if((J=L.nodeType>0?L:!z.test(L)&&N&&N(L)[0])&&J.type){L=
a[J.getAttribute(v)];if(!L){q=q||"_"+m++;J.setAttribute(v,q);L=u(q,J.innerHTML,y,F);a[q]=L}}return L}}var x,J,T,M;x=B(r);F=F||(r.markup?r:{});F.name=q;M=F.templates;if(!x&&r.markup&&(x=B(r.markup)))if(x.fn&&(x.debug!==r.debug||x.allowCode!==r.allowCode))x=x.markup;if(x!==p){if(q&&!y)Z[q]=function(){return r.render.apply(r,arguments)};if(x.fn||r.fn){if(x.fn)r=q&&q!==x.name?O(O({},x),F):x}else{r=w(x,F,y,0);n(x,r)}for(T in M){x=M[T];if(x.name!==T)M[T]=u(T,x,r)}return r}}function w(q,r,y,F){function B(J){if(y[J])x[J]=
O(O({},y[J]),r[J])}r=r||{};var x={markup:q,tmpls:[],links:[],render:h};if(y){if(y.templates)x.templates=O(O({},y.templates),r.templates);x.parent=y;x.name=y.name+"["+F+"]";x.index=F}O(x,r);if(y){B("templates");B("tags");B("helpers");B("converters")}return x}function G(q){return o[q]||(o[q]="&#"+q.charCodeAt(0)+";")}var D,P,z,O,K={},Q=false,S=true,N=f.jQuery,I=/^(?:(true|false|null|\d[\d.]*)|([\w$]+|~([\w$]+)|#(view|([\w$]+))?)([\w$.]*?)(?:[.[]([\w$]+)\]?)?|(['"]).*\8)$/g,R=/(?:([([])\s*)?(?:([#~]?[\w$.]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*!:?\/]|(=))\s*|([#~]?[\w$.]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*([)\]])([([]?))|(\s+)/g,
W=/\r?\n/g,A=/\\(['"])/g,V=/\\?(['"])/g,aa=/\x08(~)?([^\x08]+)\x08/g,la=0,m=0,o={"&":"&amp;","<":"&lt;",">":"&gt;"},v="data-jsv-tmpl",C="var j=j||"+(N?"jQuery.":"js")+"views,",H=/[\x00"&'<>]/g,E=Array.prototype.slice,Z={},X={jsviews:"v1.0pre",sub:K,debugMode:S,err:function(q){return X.debugMode?"<br/><b>Error:</b> <em> "+(q.message||q)+". </em>":'""'},tmplFn:n,render:Z,templates:a,tags:c,helpers:e,converters:d,View:g,convert:function(q,r,y){var F=r.tmpl.converters;return(q=F&&F[q]||d[q])?q.call(r,
y):y},ctx:function(q,r){var y=q.tmpl.helpers||{};y=q.ctx[r]?q.ctx:y[r]?y:e[r]?e:{};return y[r]},delimiters:t,tag:function(q,r,y,F,B){B.props=B.props||{};var x;x=B.props.tmpl;var J=r.tmpl.tags,T=r.tmpl.templates,M=arguments;J=J&&J[q]||c[q];if(!J)return"";F=F&&r.tmpl.tmpls[F-1];x=x||F||p;B.tmpl=""+x===x?T&&T[x]||a[x]||a(x):x;B.isTag=S;B.converter=y;B.parent=r;B.renderContent=h;r.ctx&&O(B.ctx,r.ctx);return(x=J.apply(B,M.length>5?E.call(M,5):[]))||(x===p?"":x.toString())}};if(N){D=N;D.templates=a;D.render=
Z;D.views=X;D.fn.render=h}else{D=f.jsviews=X;D.extend=function(q,r){var y;q=q||{};for(y in r)q[y]=r[y];return q};D.isArray=Array&&Array.isArray||function(q){return Object.prototype.toString.call(q)==="[object Array]"}}O=D.extend;X.topView={views:{},tmpl:{},ctx:X.helpers};c({"if":function(){var q=this.parent;q.onElse=function(r,y){for(var F=0,B=y.length;B&&!y[F++];)if(F===B)return"";q.onElse=p;r.path="";return r.renderContent(q)};return q.onElse(this,arguments)},"else":function(){var q=this.parent;
return q.onElse?q.onElse(this,arguments):""},"for":function(){var q,r="",y=arguments,F=y.length;if(this.props.layout)this.tmpl.layout=S;for(q=0;q<F;q++)r+=this.renderContent(y[q]);return r},"=":function(q){return q},"*":function(q){return q}});d({html:function(q){return q!==p?String(q).replace(H,G):""}});t("{{","}}")}(this);
(function(f,p,t){var g=Number.POSITIVE_INFINITY,b=Number.NEGATIVE_INFINITY;f.geo={_allCoordinates:function(a){a=this._flatten(a);for(var c=0,e=[];c<a.length;c++){var d=a[c].coordinates,h=d&&f.isArray(d[0]),l=h&&f.isArray(d[0][0]),n;if(!(l&&f.isArray(d[0][0][0]))){if(!l){h||(d=[d]);d=[d]}d=[d]}for(h=0;h<d.length;h++)for(l=0;l<d[h].length;l++)for(n=0;n<d[h][l].length;n++)e.push(d[h][l][n])}return e},_isGeodetic:function(a){for(;f.isArray(a);)if(a.length>1&&!f.isArray(a[0]))return a[0]>=-180&&a[0]<=
180&&a[1]>=-85&&a[1]<=85;else a=a[0];return false},center:function(a,c){var e=false;if(!c&&f.geo.proj&&this._isGeodetic(a)){e=true;a=f.geo.proj.fromGeodetic(a)}var d=[(a[0]+a[2])/2,(a[1]+a[3])/2];return e?f.geo.proj.toGeodetic(d):d},expandBy:function(a,c,e,d){var h=false;if(!d&&f.geo.proj&&this._isGeodetic(a)){h=true;a=f.geo.proj.fromGeodetic(a)}a=[a[0]-c,a[1]-e,a[2]+c,a[3]+e];return h?f.geo.proj.toGeodetic(a):a},height:function(a,c){if(!c&&f.geo.proj&&this._isGeodetic(a))a=f.geo.proj.fromGeodetic(a);
return a[3]-a[1]},_in:function(a,c){return a[0]<=c[0]&&a[1]<=c[1]&&a[2]>=c[2]&&a[3]>=c[3]},_bboxDisjoint:function(a,c){return c[0]>a[2]||c[2]<a[0]||c[1]>a[3]||c[3]<a[1]},reaspect:function(a,c,e){var d=false;if(!e&&f.geo.proj&&this._isGeodetic(a)){d=true;a=f.geo.proj.fromGeodetic(a)}var h=this.width(a,true),l=this.height(a,true);e=this.center(a,true);if(h!=0&&l!=0&&c>0){if(h/l>c){a=h/2;h=a/c}else{h=l/2;a=h*c}a=[e[0]-a,e[1]-h,e[0]+a,e[1]+h]}return d?f.geo.proj.toGeodetic(a):a},recenter:function(a,c,
e){var d=false;if(!e&&f.geo.proj){if(this._isGeodetic(a)){d=true;a=f.geo.proj.fromGeodetic(a)}if(this._isGeodetic(c))c=f.geo.proj.fromGeodetic(c)}e=(a[2]-a[0])/2;a=(a[3]-a[1])/2;a=[c[0]-e,c[1]-a,c[0]+e,c[1]+a];return d?f.geo.proj.toGeodetic(a):a},scaleBy:function(a,c,e){var d=false;if(!e&&f.geo.proj&&this._isGeodetic(a)){d=true;a=f.geo.proj.fromGeodetic(a)}e=this.center(a,true);var h=(a[2]-a[0])*c/2;a=(a[3]-a[1])*c/2;a=[e[0]-h,e[1]-a,e[0]+h,e[1]+a];return d?f.geo.proj.toGeodetic(a):a},width:function(a,
c){if(!c&&f.geo.proj&&this._isGeodetic(a))a=f.geo.proj.fromGeodetic(a);return a[2]-a[0]},bbox:function(a,c){if(a)if(a.bbox)result=!c&&f.geo.proj&&this._isGeodetic(a.bbox)?f.geo.proj.fromGeodetic(a.bbox):a.bbox;else{result=[g,g,b,b];var e=this._allCoordinates(a),d=0;if(e.length==0)return t;var h=false;if(!c&&f.geo.proj&&this._isGeodetic(e)){h=true;e=f.geo.proj.fromGeodetic(e)}for(;d<e.length;d++){result[0]=Math.min(e[d][0],result[0]);result[1]=Math.min(e[d][1],result[1]);result[2]=Math.max(e[d][0],
result[2]);result[3]=Math.max(e[d][1],result[3])}}else return t;return h?f.geo.proj.toGeodetic(result):result},centroid:function(a,c){switch(a.type){case "Point":return f.extend({},a);case "LineString":case "Polygon":var e=0,d=[0,0],h=f.merge([],a.type=="Polygon"?a.coordinates[0]:a.coordinates),l=1,n,s,u=false;if(!c&&f.geo.proj&&this._isGeodetic(h)){u=true;h=f.geo.proj.fromGeodetic(h)}for(;l<=h.length;l++){n=l%h.length;s=h[l-1][0]*h[n][1]-h[n][0]*h[l-1][1];e+=s;d[0]+=(h[l-1][0]+h[n][0])*s;d[1]+=(h[l-
1][1]+h[n][1])*s}if(e==0)if(h.length>0){d[0]=h[0][0];d[1]=h[0][1];return{type:"Point",coordinates:u?f.geo.proj.toGeodetic(d):d}}else break;e*=3;d[0]/=e;d[1]/=e;return{type:"Point",coordinates:u?f.geo.proj.toGeodetic(d):d}}return t},contains:function(a,c){if(a.type!="Polygon")return false;switch(c.type){case "Point":return this._containsPolygonPoint(a.coordinates,c.coordinates);case "LineString":return this._containsPolygonLineString(a.coordinates,c.coordinates);case "Polygon":return this._containsPolygonLineString(a.coordinates,
c.coordinates[0]);default:return false}},_containsPolygonPoint:function(a,c){if(a.length==0||a[0].length<4)return false;for(var e=0,d=a[0][0],h=1,l;h<a[0].length;h++){l=a[0][h];if(d[1]<=c[1]&&c[1]<l[1]||l[1]<=c[1]&&c[1]<d[1]&&(c[0]<d[0]||c[0]<l[0])){d=d[0]+(l[0]-d[0])*(c[1]-d[1])/(l[1]-d[1]);d>c[0]&&e++}d=l}return e%2==1},_containsPolygonLineString:function(a,c){for(var e=0;e<c.length;e++)if(!this._containsPolygonPoint(a,c[e]))return false;return true},distance:function(a,c,e){var d=!e&&f.geo.proj&&
this._isGeodetic(a.coordinates)?f.geo.proj.fromGeodetic(a.coordinates):a.coordinates;e=!e&&f.geo.proj&&this._isGeodetic(c.coordinates)?f.geo.proj.fromGeodetic(c.coordinates):c.coordinates;switch(a.type){case "Point":switch(c.type){case "Point":return this._distancePointPoint(e,d);case "LineString":return this._distanceLineStringPoint(e,d);case "Polygon":return this._containsPolygonPoint(e,d)?0:this._distanceLineStringPoint(e[0],d);default:return t}case "LineString":switch(c.type){case "Point":return this._distanceLineStringPoint(d,
e);case "LineString":return this._distanceLineStringLineString(d,e);case "Polygon":return this._containsPolygonLineString(e,d)?0:this._distanceLineStringLineString(e[0],d);default:return t}case "Polygon":switch(c.type){case "Point":return this._containsPolygonPoint(d,e)?0:this._distanceLineStringPoint(d[0],e);case "LineString":return this._containsPolygonLineString(d,e)?0:this._distanceLineStringLineString(d[0],e);case "Polygon":return this._containsPolygonLineString(d,e[0])?0:this._distanceLineStringLineString(d[0],
e[0]);default:return t}}},_distancePointPoint:function(a,c){var e=c[0]-a[0],d=c[1]-a[1];return Math.sqrt(e*e+d*d)},_distanceLineStringPoint:function(a,c){var e=g;if(a.length>0){var d=a[0],h=c[0]-d[0],l=c[1]-d[1];if(a.length==1)return Math.sqrt(h*h+l*l);else for(var n=1;n<a.length;n++){var s=a[n],u=c[0]-s[0],w=c[1]-s[1];d=this._distanceSegmentPoint(s[0]-d[0],s[1]-d[1],h,l,u,w);if(d==0)return 0;if(d<e)e=d;d=s;h=u;l=w}}return Math.sqrt(e)},_distanceSegmentPoint:function(a,c,e,d,h,l){var n=a*e+c*d;if(n<=
0)return e*e+d*d;a=a*a+c*c;if(n>=a)return h*h+l*l;return e*e+d*d-n*n/a},_distanceLineStringLineString:function(a,c){for(var e=g,d=0;d<c.length;d++)e=Math.min(e,this._distanceLineStringPoint(a,c[d]));return e},_buffer:function(a,c,e){var d=false,h=a.coordinates;if(!e&&f.geo.proj&&this._isGeodetic(a.coordinates)){d=true;h=f.geo.proj.fromGeodetic(a.coordinates)}switch(a.type){case "Point":a=[];e=0;for(var l;e<=180;e++){l=e*360/180*(Math.PI/180);a.push([h[0]+Math.cos(l)*c,h[1]+Math.sin(l)*c])}return{type:"Polygon",
coordinates:[d?f.geo.proj.toGeodetic(a):a]};default:return t}},_flatten:function(a){var c=[],e=0;switch(a.type){case "Feature":f.merge(c,this._flatten(a.geometry));break;case "FeatureCollection":for(;e<a.features.length;e++)f.merge(c,this._flatten(a.features[e].geometry));break;case "GeometryCollection":for(;e<a.geometries.length;e++)f.merge(c,this._flatten(a.geometries[e]));break;default:c[0]=a}return c},length:function(a,c){var e=0,d,h=1,l,n;switch(a.type){case "Point":return 0;case "LineString":d=
a.coordinates;break;case "Polygon":d=a.coordinates[0]}if(d){if(!c&&f.geo.proj&&this._isGeodetic(d))d=f.geo.proj.fromGeodetic(d);for(;h<d.length;h++){l=d[h][0]-d[h-1][0];n=d[h][1]-d[h-1][1];e+=Math.sqrt(l*l+n*n)}return e}},area:function(a,c){var e=0,d,h=1,l;switch(a.type){case "Point":case "LineString":return 0;case "Polygon":d=a.coordinates[0]}if(d){if(!c&&f.geo.proj&&this._isGeodetic(d))d=f.geo.proj.fromGeodetic(d);for(;h<=d.length;h++){l=h%d.length;e+=(d[h-1][0]-d[l][0])*(d[h-1][1]+d[l][1])/2}return Math.abs(e)}},
pointAlong:function(a,c,e){var d=0,h=0,l=0,n,s=[],u=1,w=false;switch(a.type){case "Point":return f.extend({},a);case "LineString":n=a.coordinates;break;case "Polygon":n=a.coordinates[0]}if(n)if(c===0)return{type:"Point",coordinates:[n[0][0],n[0][1]]};else if(c===1){u=n.length-1;return{type:"Point",coordinates:[n[u][0],n[u][1]]}}else{if(!e&&f.geo.proj&&this._isGeodetic(n)){w=true;n=f.geo.proj.fromGeodetic(n)}for(;u<n.length;u++){a=n[u][0]-n[u-1][0];e=n[u][1]-n[u-1][1];a=Math.sqrt(a*a+e*e);s.push(a);
d+=a}for(u=0;u<s.length&&l<c;u++){h=l;l+=s[u]/d}c=c-h;d=n[u-1];n=n[u];n=[d[0]+c*(n[0]-d[0]),d[1]+c*(n[1]-d[1])];return{type:"Point",coordinates:w?f.geo.proj.toGeodetic(n):n}}},_WKT:function(){function a(d){if(d&&d.length){for(var h=[],l=0;l<d.length;l++)h.push(d[l].join(" "));return"("+h+")"}else return"EMPTY"}function c(d){if(d&&d.length){for(var h=[],l=0;l<d.length;l++)h.push(a(d[l]));return"("+h+")"}else return"EMTPY"}function e(d){if(d&&d.type)switch(d.type){case "Point":return"POINT "+(d.coordinates&&
d.coordinates.length?"("+d.coordinates.join(" ")+")":"EMPTY");case "LineString":return"LINESTRING "+a(d.coordinates);case "Polygon":return"POLYGON "+c(d.coordinates);case "MultiPoint":return"MULTIPOINT "+a(d.coordinates);case "MultiLineString":return"MULTILINSTRING "+c(d.coordinates);case "MultiPolygon":if((d=d.coordinates)&&d.length){for(var h=[],l=0;l<d.length;l++)h.push(c(d[l]));d="("+h+")"}else d="EMPTY";return"MULTIPOLYGON "+d;case "GeometryCollection":if((d=d.geometries)&&d.length){h=[];for(l=
0;l<d.length;l++)h.push(e(d[l]));d="("+d+")"}else d="EMPTY";return"GEOMETRYCOLLECTION "+d;default:return""}else return""}return{stringify:e,parse:function(d){d=f.trim(d);var h=d.indexOf(" "),l=d.substr(h+1);switch(d.substr(0,h).toUpperCase()){case "POINT":return(d=l.match(/\(\s*([\d\.-]+)\s+([\d\.-]+)\s*\)/))&&d.length>2?{type:"Point",coordinates:[parseFloat(d[1]),parseFloat(d[2])]}:null;case "LINESTRING":l=l.match(/\s*\((.*)\)/);d=[];var n;h=0;if(l.length>1){for(l=l[1].match(/[\d\.-]+\s+[\d\.-]+/g);h<
l.length;h++){n=l[h].match(/\s*([\d\.-]+)\s+([\d\.-]+)\s*/);d[h]=[parseFloat(n[1]),parseFloat(n[2])]}d={type:"LineString",coordinates:d}}else d=null;return d;case "POLYGON":l=l.match(/\s*\(\s*\((.*)\)\s*\)/);d=[];h=0;if(l.length>1){for(l=l[1].match(/[\d\.-]+\s+[\d\.-]+/g);h<l.length;h++){n=l[h].match(/\s*([\d\.-]+)\s+([\d\.-]+)\s*/);d[h]=[parseFloat(n[1]),parseFloat(n[2])]}d={type:"Polygon",coordinates:[d]}}else d=null;return d;default:return null}}}}(),proj:function(){return{fromGeodeticPos:function(a){if(!a)debugger;
return[6378137*a[0]*0.017453292519943295,6378137*Math.log(Math.tan(0.7853981633974483+a[1]*0.017453292519943295/2))]},fromGeodetic:function(a){if(!f.geo._isGeodetic(a))return a;var c=f.isArray(a[0]),e=this.fromGeodeticPos;if(!c&&a.length==4){c=e([a[0],a[1]]);a=e([a[2],a[3]]);return[c[0],c[1],a[0],a[1]]}else{var d=c&&f.isArray(a[0][0]),h=d&&f.isArray(a[0][0][0]),l=[],n,s,u;if(!h){if(!d){c||(a=[a]);a=[a]}a=[a]}for(n=0;n<a.length;n++){l[n]=[];for(s=0;s<a[n].length;s++){l[n][s]=[];for(u=0;u<a[n][s].length;u++)l[n][s][u]=
e(a[n][s][u])}}return h?l:d?l[0]:c?l[0][0]:l[0][0][0]}},toGeodeticPos:function(a){return[a[0]/6378137*57.29577951308232,(1.5707963267948966-2*Math.atan(1/Math.exp(a[1]/6378137)))*57.29577951308232]},toGeodetic:function(a){if(f.geo._isGeodetic(a))return a;var c=f.isArray(a[0]),e=this.toGeodeticPos;if(!c&&a.length==4){c=e([a[0],a[1]]);a=e([a[2],a[3]]);return[c[0],c[1],a[0],a[1]]}else{var d=c&&f.isArray(a[0][0]),h=d&&f.isArray(a[0][0][0]),l=[];if(!h){if(!d){c||(a=[a]);a=[a]}a=[a]}for(i=0;i<a.length;i++){l[i]=
[];for(j=0;j<a[i].length;j++){l[i][j]=[];for(k=0;k<a[i][j].length;k++)l[i][j][k]=e(a[i][j][k])}}return h?l:d?l[0]:c?l[0][0]:l[0][0][0]}}}}(),_serviceTypes:{}}})(jQuery,this);
(function(f,p){var t=function(){for(var g=5,b=document.createElement("div"),a=b.all||[];b.innerHTML="<!--[if gt IE "+ ++g+"]><br><![endif]--\>",a[0];);return g>6?g:!g}();f.widget("geo.geographics",{_$elem:p,_options:{},_trueCanvas:true,_width:0,_height:0,_$canvas:p,_context:p,_$blitcanvas:p,_blitcontext:p,_$labelsContainer:p,options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:0.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"}},_create:function(){this._$elem=
this.element;this._options=this.options;this._$elem.css({display:"inline-block",overflow:"hidden",textAlign:"left"});this._$elem.css("position")=="static"&&this._$elem.css("position","relative");this._$elem.addClass("geo-graphics");this._width=this._$elem.width();this._height=this._$elem.height();if(!(this._width&&this._height)){this._width=parseInt(this._$elem.css("width"));this._height=parseInt(this._$elem.css("height"))}var g="width:"+this._width+"px;height:"+this._height+"px;",b='width="'+this._width+
'" height="'+this._height+'"';if(document.createElement("canvas").getContext){this._$elem.append("<canvas "+b+' style="position:absolute;left:0;top:0;margin:0;padding:0;"></canvas>');this._$canvas=this._$elem.children(":last");this._context=this._$canvas[0].getContext("2d");this._$elem.append("<canvas "+b+' style="position:absolute;left:0;top:0;margin:0;padding:0; visibility: hidden;"></canvas>');this._$blitcanvas=this._$elem.children(":last");this._blitcontext=this._$blitcanvas[0].getContext("2d")}else if(t<=
8){this._trueCanvas=false;this._$elem.append("<div "+b+' style="position:absolute;left:0;top:0;margin:0;padding:0;'+g+'"></div>');this._$canvas=this._$elem.children(":last");G_vmlCanvasManager.initElement(this._$canvas[0]);this._context=this._$canvas[0].getContext("2d");this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})}this._$elem.append('<div class="geo-labels-container" style="position:absolute;left:0;top:0;margin:0;padding:0;'+g+'"></div>');this._$labelsContainer=
this._$elem.children(":last")},_setOption:function(g,b){if(g=="style")b=f.extend({},this._options.style,b);f.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){f.Widget.prototype.destroy.apply(this,arguments);this._$elem.html("");this._$elem.removeClass("geo-graphics")},clear:function(){this._context.clearRect(0,0,this._width,this._height);this._$labelsContainer.html("")},drawArc:function(g,b,a,c){c=this._getGraphicStyle(c);if(c.visibility!="hidden"&&c.opacity>0&&c.widthValue>0&&
c.heightValue>0){var e=Math.min(c.widthValue,c.heightValue)/2;b=b*Math.PI/180;a=a*Math.PI/180;this._context.save();this._context.translate(g[0],g[1]);c.widthValue>c.heightValue?this._context.scale(c.widthValue/c.heightValue,1):this._context.scale(1,c.heightValue/c.widthValue);this._context.beginPath();this._context.arc(0,0,e,b,a,false);this._trueCanvas&&this._context.restore();if(c.doFill){this._context.fillStyle=c.fill;this._context.globalAlpha=c.opacity*c.fillOpacity;this._context.fill()}if(c.doStroke){this._context.lineJoin=
"round";this._context.lineWidth=c.strokeWidthValue;this._context.strokeStyle=c.stroke;this._context.globalAlpha=c.opacity*c.strokeOpacity;this._context.stroke()}this._trueCanvas||this._context.restore()}},drawPoint:function(g,b){b=this._getGraphicStyle(b);if(b.widthValue==b.heightValue&&b.heightValue==b.borderRadiusValue)this.drawArc(g,0,360,b);else if(b.visibility!="hidden"&&b.opacity>0){b.borderRadiusValue=Math.min(Math.min(b.widthValue,b.heightValue)/2,b.borderRadiusValue);g[0]-=b.widthValue/2;
g[1]-=b.heightValue/2;this._context.beginPath();this._context.moveTo(g[0]+b.borderRadiusValue,g[1]);this._context.lineTo(g[0]+b.widthValue-b.borderRadiusValue,g[1]);this._context.quadraticCurveTo(g[0]+b.widthValue,g[1],g[0]+b.widthValue,g[1]+b.borderRadiusValue);this._context.lineTo(g[0]+b.widthValue,g[1]+b.heightValue-b.borderRadiusValue);this._context.quadraticCurveTo(g[0]+b.widthValue,g[1]+b.heightValue,g[0]+b.widthValue-b.borderRadiusValue,g[1]+b.heightValue);this._context.lineTo(g[0]+b.borderRadiusValue,
g[1]+b.heightValue);this._context.quadraticCurveTo(g[0],g[1]+b.heightValue,g[0],g[1]+b.heightValue-b.borderRadiusValue);this._context.lineTo(g[0],g[1]+b.borderRadiusValue);this._context.quadraticCurveTo(g[0],g[1],g[0]+b.borderRadiusValue,g[1]);this._context.closePath();if(b.doFill){this._context.fillStyle=b.fill;this._context.globalAlpha=b.opacity*b.fillOpacity;this._context.fill()}if(b.doStroke){this._context.lineJoin="round";this._context.lineWidth=b.strokeWidthValue;this._context.strokeStyle=b.stroke;
this._context.globalAlpha=b.opacity*b.strokeOpacity;this._context.stroke()}}},drawLineString:function(g,b){this._drawLines([g],false,b)},drawPolygon:function(g,b){if(!this._trueCanvas||g.length==1)this._drawLines(g,true,b);else if(!(!g||!g.length||g[0].length<3)){b=this._getGraphicStyle(b);var a,c,e;if(b.visibility!="hidden"&&b.opacity>0){this._blitcontext.clearRect(0,0,this._width,this._height);if(b.doFill)if(g.length>1){this._blitcontext.globalCompositeOperation="source-out";for(c=this._blitcontext.globalAlpha=
1;c<g.length;c++){this._blitcontext.beginPath();this._blitcontext.moveTo(g[c][0][0],g[c][0][1]);for(e=1;e<g[c].length;e++)this._blitcontext.lineTo(g[c][e][0],g[c][e][1]);this._blitcontext.closePath();this._blitcontext.fill()}}this._blitcontext.beginPath();this._blitcontext.moveTo(g[0][0][0],g[0][0][1]);a=[g[0][0][0]-b.strokeWidthValue,g[0][0][1]-b.strokeWidthValue,g[0][0][0]+b.strokeWidthValue,g[0][0][1]+b.strokeWidthValue];for(c=1;c<g[0].length-1;c++){this._blitcontext.lineTo(g[0][c][0],g[0][c][1]);
a[0]=Math.min(g[0][c][0]-b.strokeWidthValue,a[0]);a[1]=Math.min(g[0][c][1]-b.strokeWidthValue,a[1]);a[2]=Math.max(g[0][c][0]+b.strokeWidthValue,a[2]);a[3]=Math.max(g[0][c][1]+b.strokeWidthValue,a[3])}this._blitcontext.closePath();this._blitcontext.globalCompositeOperation="source-out";if(b.doFill){this._blitcontext.fillStyle=b.fill;this._blitcontext.globalAlpha=b.opacity*b.fillOpacity;this._blitcontext.fill()}this._blitcontext.globalCompositeOperation="source-over";if(b.doStroke){this._blitcontext.lineCap=
this._blitcontext.lineJoin="round";this._blitcontext.lineWidth=b.strokeWidthValue;this._blitcontext.strokeStyle=b.stroke;this._blitcontext.globalAlpha=b.opacity*b.strokeOpacity;this._blitcontext.stroke();if(g.length>1)for(c=1;c<g.length;c++){this._blitcontext.beginPath();this._blitcontext.moveTo(g[c][0][0],g[c][0][1]);for(e=1;e<g[c].length;e++)this._blitcontext.lineTo(g[c][e][0],g[c][e][1]);this._blitcontext.closePath();this._blitcontext.stroke()}}a[0]=Math.max(a[0],0);a[1]=Math.max(a[1],0);a[2]=
Math.min(a[2],this._width);a[3]=Math.min(a[3],this._height);this._context.drawImage(this._$blitcanvas[0],a[0],a[1],a[2]-a[0],a[3]-a[1],a[0],a[1],a[2]-a[0],a[3]-a[1])}}},drawBbox:function(g,b){this._drawLines([[[g[0],g[1]],[g[0],g[3]],[g[2],g[3]],[g[2],g[1]],[g[0],g[1]]]],true,b)},drawLabel:function(g,b){this._$labelsContainer.append('<div class="geo-label" style="position:absolute; left:'+g[0]+"px; top:"+g[1]+'px;">'+b+"</div>")},resize:function(){this._width=this._$elem.width();this._height=this._$elem.height();
if(!(this._width&&this._height)){this._width=parseInt(this._$elem.css("width"));this._height=parseInt(this._$elem.css("height"))}if(this._trueCanvas){this._$canvas[0].width=this._width;this._$canvas[0].height=this._height}this._$labelsContainer.css({width:this._width,height:this._height})},_getGraphicStyle:function(g){function b(a){a=parseInt(a);return+a+""===a?+a:a}g=f.extend({},this._options.style,g);g.borderRadiusValue=b(g.borderRadius);g.fill=g.fill||g.color;g.doFill=g.fill&&g.fillOpacity>0;g.stroke=
g.stroke||g.color;g.strokeWidthValue=b(g.strokeWidth);g.doStroke=g.stroke&&g.strokeOpacity>0&&g.strokeWidthValue>0;g.widthValue=b(g.width);g.heightValue=b(g.height);return g},_drawLines:function(g,b,a){if(!(!g||!g.length||g[0].length<2)){a=this._getGraphicStyle(a);var c,e;if(a.visibility!="hidden"&&a.opacity>0){this._context.beginPath();for(c=0;c<g.length;c++){this._context.moveTo(g[c][0][0],g[c][0][1]);for(e=1;e<g[c].length;e++)this._context.lineTo(g[c][e][0],g[c][e][1])}b&&this._context.closePath();
if(b&&a.doFill){this._context.fillStyle=a.fill;this._context.globalAlpha=a.opacity*a.fillOpacity;this._context.fill()}if(a.doStroke){this._context.lineCap=this._context.lineJoin="round";this._context.lineWidth=a.strokeWidthValue;this._context.strokeStyle=a.stroke;this._context.globalAlpha=a.opacity*a.strokeOpacity;this._context.stroke()}}}}})})(jQuery);
(function(f,p){var t=0,g=function(){for(var b=5,a=document.createElement("div"),c=a.all||[];a.innerHTML="<!--[if gt IE "+ ++b+"]><br><![endif]--\>",c[0];);return b>6?b:!b}();f.widget("geo.geomap",{_$elem:p,_map:p,_created:false,_widgetId:0,_tmplLengthId:"",_tmplAreaId:"",_contentBounds:{},_$resizeContainer:p,_$eventTarget:p,_$contentFrame:p,_$existingChildren:p,_$attrList:p,_$servicesContainer:p,_$panContainer:p,_$shapesContainer:p,_$drawContainer:p,_$measureContainer:p,_$measureLabel:p,_dpi:96,_currentServices:[],
_center:p,_pixelSize:p,_centerMax:p,_pixelSizeMax:p,_userGeodetic:true,_wheelTimeout:null,_wheelLevel:0,_zoomFactor:2,_fullZoomFactor:2,_partialZoomFactor:1.18920711500273,_mouseDown:p,_inOp:p,_toolPan:p,_shiftZoom:p,_anchor:p,_current:p,_downDate:p,_moveDate:p,_clickDate:p,_lastMove:p,_lastDrag:p,_windowHandler:null,_resizeTimeout:null,_panning:p,_velocity:p,_friction:p,_supportTouch:p,_softDblClick:p,_isTap:p,_isDbltap:p,_isMultiTouch:p,_multiTouchAnchor:p,_multiTouchAnchorBbox:p,_multiTouchCurrentBbox:p,
_drawTimeout:null,_drawPixels:[],_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:f.extend({},{bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{"static":"default",pan:"url(data:image/vnd.microsoft.icon;base64,AAACAAEAICACAAgACAAwAQAAFgAAACgAAAAgAAAAQAAAAAEAAQAAAAAAAAEAAAAAAAAAAAAAAgAAAAAAAAAAAAAA////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD8AAAA/AAAAfwAAAP+AAAH/gAAB/8AAA//AAAd/wAAGf+AAAH9gAADbYAAA2yAAAZsAAAGbAAAAGAAAAAAAAA//////////////////////////////////////////////////////////////////////////////////////gH///4B///8Af//+AD///AA///wAH//4AB//8AAf//AAD//5AA///gAP//4AD//8AF///AB///5A////5///8=), move",
zoom:"crosshair",drawPoint:"crosshair",drawLineString:"crosshair",drawPolygon:"crosshair",measureLength:"crosshair",measureArea:"crosshair"},measureLabels:{length:"{{:length.toFixed( 2 )}} m",area:"{{:area.toFixed( 2 )}} sq m"},drawStyle:{},shapeStyle:{},mode:"pan",pannable:true,scroll:"default",services:[{"class":"osm",type:"tiled",src:function(b){return"http://tile.openstreetmap.org/"+b.zoom+"/"+b.tile.column+"/"+b.tile.row+".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,
tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},axisLayout:"map",zoom:0,pixelSize:0}),_createWidget:function(b,a){this._$elem=f(a);if(this._$elem.is(".geo-service")){var c=this._$elem.closest(".geo-content-frame");this._$elem.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0; width:'+c.css("width")+"; height:"+c.css("height")+'; margin:0; padding:0;"></div>');this._$shapesContainer=this._$elem.children(":last")}else{this._widgetId=
t++;this._tmplLengthId="geoMeasureLength"+this._widgetId;this._tmplAreaId="geoMeasureArea"+this._widgetId;this._$elem.addClass("geo-map");this._initOptions=b||{};this._forcePosition(this._$elem);this._$elem.css("text-align","left");c=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:c.width,height:c.height};this._createChildren();this._center=this._centerMax=[0,0];this.options.pixelSize=this._pixelSize=this._pixelSizeMax=
156543.03392799935;this._mouseDown=this._inOp=this._toolPan=this._shiftZoom=this._panning=this._isTap=this._isDbltap=false;this._anchor=[0,0];this._current=[0,0];this._lastMove=[0,0];this._lastDrag=[0,0];this._velocity=[0,0];this._friction=[0.8,0.8];this._downDate=this._moveDate=this._clickDate=0;this._drawPixels=[];this._drawCoords=[]}this._graphicShapes=[];f.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){this._options=this.options;if(this._$elem.is(".geo-service")){this._map=
this._$elem.data("geoMap");this._$shapesContainer.geographics();this._options.shapeStyle=this._$shapesContainer.geographics("option","style")}else{this._map=this;this._softDblClick=(this._supportTouch="ontouchend"in document)||g==7;var b=this,a=this._supportTouch?"touchstart":"mousedown",c=this._supportTouch?"touchend touchcancel":"mouseup",e=this._supportTouch?"touchmove":"mousemove";f(document).keydown(f.proxy(this._document_keydown,this));this._$eventTarget.dblclick(f.proxy(this._eventTarget_dblclick,
this));this._$eventTarget.bind(a,f.proxy(this._eventTarget_touchstart,this));a=this._$eventTarget[0].setCapture?this._$eventTarget:f(document);a.bind(e,f.proxy(this._dragTarget_touchmove,this));a.bind(c,f.proxy(this._dragTarget_touchstop,this));this._$eventTarget.mousewheel(f.proxy(this._eventTarget_mousewheel,this));this._windowHandler=function(){b._resizeTimeout&&clearTimeout(b._resizeTimeout);b._resizeTimeout=setTimeout(function(){b._created&&b._$elem.geomap("resize",true)},500)};f(window).resize(this._windowHandler);
this._$drawContainer.geographics({style:this._initOptions.drawStyle||{}});this._options.drawStyle=this._$drawContainer.geographics("option","style");this._$shapesContainer.geographics({style:this._initOptions.shapeStyle||{}});this._options.shapeStyle=this._$shapesContainer.geographics("option","style");if(this._initOptions){this._initOptions.tilingScheme&&this._setOption("tilingScheme",this._initOptions.tilingScheme,false);if(this._initOptions.services)this._options.services=f.merge([],this._initOptions.services);
this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,false);this._initOptions.center&&this._setOption("center",this._initOptions.center,false);this._initOptions.zoom!==p&&this._setZoom(this._initOptions.zoom,false,false)}f.templates(this._tmplLengthId,this._options.measureLabels.length);f.templates(this._tmplAreaId,this._options.measureLabels.area);this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._createServices();this._refresh();this._created=true}},
_setOption:function(b,a,c){if(b!="pixelSize"){c=c===p||c;this._$elem.is(".geo-map")&&this._panFinalize();switch(b){case "bbox":if(this._userGeodetic=f.geo.proj&&f.geo._isGeodetic(a))a=f.geo.proj.fromGeodetic(a);this._setBbox(a,false,c);a=this._getBbox();break;case "center":if(this._userGeodetic=f.geo.proj&&f.geo._isGeodetic(a))a=f.geo.proj.fromGeodetic(a);this._setCenterAndSize(a,this._pixelSize,false,c);break;case "measureLabels":a=f.extend(this._options.measureLabels,a);f.templates(this._tmplLengthId,
this._options.measureLabels.length);f.templates(this._tmplAreaId,this._options.measureLabels.area);break;case "drawStyle":if(this._$drawContainer){this._$drawContainer.geographics("option","style",a);a=this._$drawContainer.geographics("option","style")}break;case "shapeStyle":if(this._$shapesContainer){this._$shapesContainer.geographics("option","style",a);a=this._$shapesContainer.geographics("option","style")}break;case "mode":this._resetDrawing();this._$eventTarget.css("cursor",this._options.cursors[a]);
break;case "zoom":this._setZoom(a,false,c)}f.Widget.prototype._setOption.apply(this,arguments);switch(b){case "bbox":case "center":if(this._userGeodetic){this._options.bbox=f.geo.proj.toGeodetic(this._options.bbox);this._options.center=f.geo.proj.toGeodetic(this._center)}break;case "tilingScheme":if(a!=null){this._pixelSizeMax=this._getPixelSize(0);this._centerMax=[a.origin[0]+this._pixelSizeMax*a.tileWidth/2,a.origin[1]+this._pixelSizeMax*a.tileHeight/2]}break;case "bboxMax":this._pixelSizeMax=this._getPixelSize(0);
this._centerMax=f.geo.proj&&f.geo._isGeodetic(a)?f.geo.center(f.geo.proj.fromGeodetic(a)):f.geo.center(a);break;case "services":this._createServices();c&&this._refresh();break;case "shapeStyle":if(c){this._$shapesContainer.geographics("clear");this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes)}}}},destroy:function(){if(this._$elem.is(".geo-service")){this._$shapesContainer.geographics("destroy");this._$shapesContainer=p}else{this._created=false;
f(window).unbind("resize",this._windowHandler);for(var b=0;b<this._currentServices.length;b++){this._currentServices[b].serviceContainer.geomap("destroy");f.geo._serviceTypes[this._currentServices[b].type].destroy(this,this._$servicesContainer,this._currentServices[b])}this._$shapesContainer.geographics("destroy");this._$shapesContainer=p;this._$drawContainer.geographics("destroy");this._$drawContainer=p;this._$existingChildren.detach();this._$elem.html("");this._$elem.append(this._$existingChildren);
this._$elem.removeClass("geo-map")}f.Widget.prototype.destroy.apply(this,arguments)},toMap:function(b){b=this._toMap(b);return this._userGeodetic?f.geo.proj.toGeodetic(b):b},toPixel:function(b,a,c){return this._toPixel(f.geo.proj?f.geo.proj.fromGeodetic(b):b,a,c)},opacity:function(b,a){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("opacity",b,this._$elem);else if(b>=0||b<=1)for(var c=0;c<this._currentServices.length;c++){var e=this._currentServices[c];if(!a||e.serviceContainer[0]==
a[0]){e.style.opacity=b;f.geo._serviceTypes[e.type].opacity(this,e)}}},toggle:function(b,a){if(this._$elem.is(".geo-service"))this._$elem.closest(".geo-map").geomap("toggle",b,this._$elem);else for(var c=0;c<this._currentServices.length;c++){var e=this._currentServices[c];if(!a||e.serviceContainer[0]==a[0]){if(b===p)b=e.style.visibility!=="visible";e.style.visibility=b?"visible":"hidden";e.serviceContainer.toggle(b);b&&f.geo._serviceTypes[e.type].refresh(this,e)}}},zoom:function(b){b!=null&&this._setZoom(this._options.zoom+
b,false,true)},refresh:function(){this._refresh()},resize:function(b){var a=this._findMapSize(),c=a.width/2-this._contentBounds.width/2,e=a.height/2-this._contentBounds.height/2,d;this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:a.width,height:a.height};this._$resizeContainer.css({width:a.width,height:a.height});for(d=0;d<this._currentServices.length;d++)f.geo._serviceTypes[this._currentServices[d].type].resize(this,this._currentServices[d]);
this._$elem.find(".geo-graphics").css({width:a.width,height:a.height}).geographics("resize");for(d=0;d<this._drawPixels.length;d++){this._drawPixels[d][0]+=c;this._drawPixels[d][1]+=e}this._setCenterAndSize(this._center,this._pixelSize,b,true)},append:function(b){if(b&&f.isPlainObject(b)){var a,c,e,d,h,l;a=b.type=="FeatureCollection"?b.features:f.isArray(b)?b:[b];for(e=1;e<arguments.length;e++){c=arguments[e];if(typeof c==="object")d=c;else if(typeof c==="number"||typeof c==="string")h=c;else if(typeof c===
"boolean")l=c}for(e=0;e<a.length;e++){if(a[e].type!="Point"){c=f.geo.bbox(a[e]);if(f.geo.proj&&f.geo._isGeodetic(c))c=f.geo.proj.fromGeodetic(c);f.data(a[e],"geoBbox",c)}this._graphicShapes.push({shape:a[e],style:d,label:h})}if(l===p||l)this._refresh()}},empty:function(b){for(var a=0;a<this._graphicShapes.length;a++)f.removeData(this._graphicShapes[a].shape,"geoBbox");this._graphicShapes=[];if(b===p||b)this._refresh()},find:function(b,a){var c=f.isPlainObject(b);c&&this._map.toPixel(b.coordinates);
for(var e=this._map._pixelSize*a,d=[],h,l,n,s=0;s<this._graphicShapes.length;s++){h=this._graphicShapes[s];if(c)if(h.shape.type=="Point")f.geo.distance(h.shape,b)<=e&&d.push(h.shape);else{l=f.data(h.shape,"geoBbox");l={type:"Polygon",coordinates:[[[l[0],l[1]],[l[0],l[3]],[l[2],l[3]],[l[2],l[1]],[l[0],l[1]]]]};n={type:"Point",coordinates:f.geo.proj&&f.geo._isGeodetic(b.coordinates)?f.geo.proj.fromGeodetic(b.coordinates):b.coordinates};if(f.geo.distance(l,n,true)<=e){l=f.geo._flatten(h.shape);for(n=
0;n<l.length;n++)if(f.geo.distance(l[n],b)<=e){d.push(h.shape);break}}}else d.push(h.shape)}this._$elem.is(".geo-map")&&this._$elem.find(".geo-service").each(function(){d=f.merge(d,f(this).geomap("find",b,a))});return d},remove:function(b,a){for(var c=0;c<this._graphicShapes.length;c++)if(this._graphicShapes[c].shape==b){f.removeData(b,"geoBbox");var e=this._graphicShapes.slice(c+1);this._graphicShapes.length=c;this._graphicShapes.push.apply(this._graphicShapes,e);break}if(a===p||a)this._refresh()},
_getBbox:function(b,a){b=b||this._center;a=a||this._pixelSize;var c=this._contentBounds.width/2*a,e=this._contentBounds.height/2*a;return[b[0]-c,b[1]-e,b[0]+c,b[1]+e]},_setBbox:function(b,a,c){var e=[b[0]+(b[2]-b[0])/2,b[1]+(b[3]-b[1])/2];b=Math.max(f.geo.width(b,true)/this._contentBounds.width,f.geo.height(b,true)/this._contentBounds.height);if(this._options.tilingScheme)b=this._getPixelSize(this._getZoom(e,b));else if(this._getZoom(e,b)<0)b=this._pixelSizeMax;this._setCenterAndSize(e,b,a,c)},_getBboxMax:function(){var b=
this._contentBounds.width/2*this._pixelSizeMax,a=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-b,this._centerMax[1]-a,this._centerMax[0]+b,this._centerMax[1]+a]},_getCenter:function(){return this._center},_getContentBounds:function(){return this._contentBounds},_getServicesContainer:function(){return this._$servicesContainer},_getZoom:function(b,a){b=b||this._center;a=a||this._pixelSize;var c=this._options.tilingScheme;if(c)if(c.pixelSizes!=null){for(var e=Math.floor(a*
1E3),d=c.pixelSizes.length-1;d>=0;d--)if(Math.floor(c.pixelSizes[d]*1E3)>=e)return d;return 0}else return Math.max(Math.round(Math.log(c.basePixelSize/a)/Math.log(2)),0);else{e=this._contentBounds.width/this._contentBounds.height;c=f.geo.reaspect(this._getBbox(b,a),e,true);e=f.geo.reaspect(this._getBboxMax(),e,true);return Math.max(Math.round(Math.log(f.geo.width(e,true)/f.geo.width(c,true))/Math.log(this._zoomFactor)),0)}},_setZoom:function(b,a,c){b=Math.max(b,0);this._setCenterAndSize(this._center,
this._getPixelSize(b),a,c)},_createChildren:function(){this._$existingChildren=this._$elem.children();this._forcePosition(this._$existingChildren);this._$existingChildren.detach().css("-moz-user-select","none");var b="width:"+this._contentBounds.width+"px; height:"+this._contentBounds.height+"px; margin:0; padding:0;";this._$elem.prepend('<div class="geo-event-target geo-content-frame" style="position:absolute; left:'+this._contentBounds.x+"px; top:"+this._contentBounds.y+"px;"+b+'overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;" unselectable="on"></div>');
this._$eventTarget=this._$contentFrame=this._$elem.children(":first");this._$contentFrame.append('<div class="geo-services-container" style="position:absolute; left:0; top:0;'+b+'"></div>');this._$servicesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-shapes-container" style="position:absolute; left:0; top:0;'+b+'"></div>');this._$shapesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<ul style="position: absolute; bottom: 8px; left: 8px; list-style-type: none; max-width: 50%; padding: 0; margin: 0;"></ul>');
this._$attrList=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-draw-container" style="position:absolute; left:0; top:0;'+b+'"></div>');this._$drawContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="geo-measure-container" style="position:absolute; left:0; top:0;'+b+'"><div class="geo-measure-label" style="position:absolute; left:0; top:0;; display: none;"></div></div>');this._$measureContainer=this._$contentFrame.children(":last");
this._$measureLabel=this._$measureContainer.children();this._$panContainer=f([this._$shapesContainer[0],this._$drawContainer[0],this._$measureContainer[0]]);this._$resizeContainer=f([this._$contentFrame[0],this._$servicesContainer[0],this._$eventTarget[0],this._$measureContainer[0]]);this._$contentFrame.append(this._$existingChildren);f("#geo-measure-style").length||f("head").prepend('<style type="text/css" id="geo-measure-style">.geo-measure-label { margin: 4px 0 0 6px; font-family: sans-serif;'+
(g?"letter-spacing: 2px; color: #444; filter:progid:DXImageTransform.Microsoft.DropShadow(Color=white, OffX=1, OffY=2, Positive=true);":"color: #000; text-shadow: #fff 1px 2px; font-weight: bold;")+" }</style>")},_createServices:function(){var b,a;for(a=0;a<this._currentServices.length;a++){this._currentServices[a].serviceContainer.geomap("destroy");f.geo._serviceTypes[this._currentServices[a].type].destroy(this,this._$servicesContainer,this._currentServices[a])}this._currentServices=[];this._$servicesContainer.html("");
this._$attrList.html("");for(a=0;a<this._options.services.length;a++){b=this._currentServices[a]=f.extend({},this._options.services[a]);b.style=f.extend({visibility:"visible",opacity:1},b.style);this._$servicesContainer.append("<div "+(b.id?' id="'+b.id+'"':"")+('class="geo-service '+(b["class"]?b["class"]:"")+'"')+' style="position:absolute; left:0; top:0; width:32px; height:32px; margin:0; padding:0; display:'+(b.style.visibility==="visible"?"block":"none")+';"></div>');serviceContainer=this._$servicesContainer.children(":last");
this._currentServices[a].serviceContainer=serviceContainer;f.geo._serviceTypes[b.type].create(this,serviceContainer,b,a);serviceContainer.data("geoMap",this).geomap();b.attr&&this._$attrList.append("<li>"+b.attr+"</li>")}this._$attrList.find("a").css({position:"relative",zIndex:100})},_refreshDrawing:function(){this._$drawContainer.geographics("clear");if(this._drawPixels.length>0){var b=this._options.mode,a=this._drawPixels,c=this._drawCoords,e,d;switch(b){case "measureLength":b="drawLineString";
d={type:"LineString",coordinates:c};e=f.render[this._tmplLengthId]({length:f.geo.length(d,true)});d=f.merge([],a[a.length-1]);break;case "measureArea":b="drawPolygon";d={type:"Polygon",coordinates:[f.merge([],c)]};d.coordinates[0].push(c[0]);e=f.render[this._tmplAreaId]({area:f.geo.area(d,true)});d=f.merge([],a[a.length-1]);a=[a];break;case "drawPolygon":a=[a]}this._$drawContainer.geographics(b,a);if(e){this._$measureLabel.html(e);b=this._contentBounds.width-(this._$measureLabel.outerWidth(true)+
d[0]);a=this._contentBounds.height-(this._$measureLabel.outerHeight(true)+d[1]);if(b<0)d[0]+=b;if(a<0)d[1]+=a;this._$measureLabel.css({left:d[0],top:d[1]}).show()}}},_resetDrawing:function(){this._drawPixels=[];this._drawCoords=[];this._$drawContainer.geographics("clear");this._$measureLabel.hide()},_refreshShapes:function(b,a,c,e,d,h){var l,n,s,u,w,G,D,P=this._map._getBbox(d,h);for(l=0;l<a.length;l++){s=a[l].shape||a[l];s=s.geometry||s;n=f.data(s,"geoBbox");if(!(n&&f.geo._bboxDisjoint(P,n))){u=f.isArray(c)?
c[l].style:c;w=f.isArray(e)?e[l].label:e;G=w!==p;D=p;switch(s.type){case "Point":D=this._map.toPixel(s.coordinates,d,h);this._$shapesContainer.geographics("drawPoint",D,u);break;case "LineString":this._$shapesContainer.geographics("drawLineString",this._map.toPixel(s.coordinates,d,h),u);if(G)D=this._map.toPixel(f.geo.pointAlong(s,0.5).coordinates,d,h);break;case "Polygon":this._$shapesContainer.geographics("drawPolygon",this._map.toPixel(s.coordinates,d,h),u);if(G)D=this._map.toPixel(f.geo.centroid(s).coordinates,
d,h);break;case "MultiPoint":for(n=0;n<s.coordinates.length;n++)this._$shapesContainer.geographics("drawPoint",this._map.toPixel(s.coordinates[n],d,h),u);if(G)D=this._map.toPixel(f.geo.centroid(s).coordinates,d,h);break;case "MultiLineString":for(n=0;n<s.coordinates.length;n++)this._$shapesContainer.geographics("drawLineString",this._map.toPixel(s.coordinates[n],d,h),u);if(G)D=this._map.toPixel(f.geo.centroid(s).coordinates,d,h);break;case "MultiPolygon":for(n=0;n<s.coordinates.length;n++)this._$shapesContainer.geographics("drawPolygon",
this._map.toPixel(s.coordinates[n],d,h),u);if(G)D=this._map.toPixel(f.geo.centroid(s).coordinates,d,h);break;case "GeometryCollection":this._refreshShapes(b,s.geometries,u,w,d,h)}G&&D&&this._$shapesContainer.geographics("drawLabel",D,w)}}},_findMapSize:function(){for(var b={width:0,height:0},a=this._$elem;a.size()&&!(b.width>0&&b.height>0);){b={width:a.width(),height:a.height()};if(b.width<=0||b.height<=0)b={width:parseInt(a.css("width")),height:parseInt(a.css("height"))};a=a.parent()}return b},_forcePosition:function(b){var a=
b.css("position");a!="relative"&&a!="absolute"&&a!="fixed"&&b.css("position","relative")},_getPixelSize:function(b){var a=this._options.tilingScheme;if(a!=null){if(b===0)return a.pixelSizes!=null?a.pixelSizes[0]:a.basePixelSize;b=Math.round(b);b=Math.max(b,0);b=Math.min(b,(a.pixelSizes!=null?a.pixelSizes.length:a.levels)-1);return a.pixelSizes!=null?a.pixelSizes[b]:a.basePixelSize/Math.pow(2,b)}else{b=f.geo.scaleBy(this._getBboxMax(),1/Math.pow(this._zoomFactor,b),true);return Math.max(f.geo.width(b,
true)/this._contentBounds.width,f.geo.height(b,true)/this._contentBounds.height)}},_getZoomCenterAndSize:function(b,a,c){a=Math.pow(c?this._fullZoomFactor:this._partialZoomFactor,-a);if(this._options.tilingScheme){a=this._getZoom(this._center,this._pixelSize*a);a=this._getPixelSize(a)}else{a=this._pixelSize*a;if(this._getZoom(this._center,a)<0)a=this._pixelSizeMax}c=a/this._pixelSize;b=this._toMap(b);c=[(this._center[0]-b[0])*c,(this._center[1]-b[1])*c];return{pixelSize:a,center:[b[0]+c[0],b[1]+c[1]]}},
_mouseWheelFinish:function(b){this._wheelTimeout=null;if(this._wheelLevel!=0){b=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._options.tilingScheme!=null);this._setCenterAndSize(b.center,b.pixelSize,true,true);this._wheelLevel=0}else b&&this._refresh()},_panEnd:function(){this._velocity=[this._velocity[0]>0?Math.floor(this._velocity[0]*this._friction[0]):Math.ceil(this._velocity[0]*this._friction[0]),this._velocity[1]>0?Math.floor(this._velocity[1]*this._friction[1]):Math.ceil(this._velocity[1]*
this._friction[1])];if(Math.abs(this._velocity[0])<4&&Math.abs(this._velocity[1])<4)this._panFinalize();else{this._current=[this._current[0]+this._velocity[0],this._current[1]+this._velocity[1]];this._panMove();setTimeout(f.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(this._panning){this._velocity=[0,0];var b=-(this._current[0]-this._anchor[0])*this._pixelSize,a=(this._options.axisLayout==="image"?-1:1)*(this._current[1]-this._anchor[1])*this._pixelSize;this._$panContainer.css({left:0,
top:0});this._$servicesContainer.find(".geo-shapes-container").css({left:0,top:0});this._setCenterAndSize([this._center[0]+b,this._center[1]+a],this._pixelSize,true,true);this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._inOp=false;this._anchor=this._current;this._mouseDown=this._toolPan=this._panning=false}},_panMove:function(){if(this._options.pannable){var b=this._current[0]-this._lastDrag[0],a=this._current[1]-this._lastDrag[1],c=0,e,d;if(this._toolPan||b>3||b<-3||
a>3||a<-3){if(!this._toolPan){this._toolPan=true;this._$eventTarget.css("cursor",this._options.cursors.pan)}if(this._mouseDown)this._velocity=[b,a];if(b!=0||a!=0){this._panning=true;this._lastDrag=this._current;d={left:function(h,l){return parseInt(l)+b},top:function(h,l){return parseInt(l)+a}};for(c=0;c<this._currentServices.length;c++){e=this._currentServices[c];f.geo._serviceTypes[e.type].interactivePan(this,e,b,a);e.serviceContainer.find(".geo-shapes-container").css(d)}this._$panContainer.css(d)}}}},
_refresh:function(){var b,a=0;if(this._$elem.is(".geo-map"))for(;a<this._currentServices.length;a++){b=this._currentServices[a];if(!this._mouseDown&&f.geo._serviceTypes[b.type]!==null){f.geo._serviceTypes[b.type].refresh(this,b);b.serviceContainer.geomap("refresh")}}if(this._$shapesContainer){this._$shapesContainer.geographics("clear");this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes)}},_setCenterAndSize:function(b,
a,c,e){if(!(!f.isArray(b)||b.length!=2||typeof b[0]!=="number"||typeof b[1]!=="number")){if(this._pixelSize!=a){this._$elem.find(".geo-shapes-container").geographics("clear");for(var d=0;d<this._currentServices.length;d++){var h=this._currentServices[d];f.geo._serviceTypes[h.type].interactiveScale(this,h,b,a)}}this._center=f.merge([],b);this._options.pixelSize=this._pixelSize=a;if(this._userGeodetic){this._options.bbox=f.geo.proj.toGeodetic(this._getBbox());this._options.center=f.geo.proj.toGeodetic(this._center)}else{this._options.bbox=
this._getBbox();this._options.center=f.merge([],b)}this._options.zoom=this._getZoom();if(this._drawCoords.length>0)this._drawPixels=this._toPixel(this._drawCoords);c&&this._trigger("bboxchange",window.event,{bbox:f.merge([],this._options.bbox)});if(e){this._refresh();this._refreshDrawing()}}},_toMap:function(b,a,c){a=a||this._center;c=c||this._pixelSize;var e=f.isArray(b[0]),d=e&&f.isArray(b[0][0]),h=d&&f.isArray(b[0][0][0]),l=this._contentBounds.width,n=this._contentBounds.height,s=l/2*c;c=n/2*c;
a=[a[0]-s,a[1]-c,a[0]+s,a[1]+c];l=f.geo.width(a,true)/l;n=f.geo.height(a,true)/n;c=this._options.axisLayout==="image";var u=[],w,G,D;if(!h){if(!d){e||(b=[b]);b=[b]}b=[b]}for(w=0;w<b.length;w++){u[w]=[];for(G=0;G<b[w].length;G++){u[w][G]=[];for(D=0;D<b[w][G].length;D++){s=b[w][G][D][1]*n;u[w][G][D]=[a[0]+b[w][G][D][0]*l,c?a[1]+s:a[3]-s]}}}return h?u:d?u[0]:e?u[0][0]:u[0][0][0]},_toPixel:function(b,a,c){a=a||this._center;c=c||this._pixelSize;var e=f.isArray(b[0]),d=e&&f.isArray(b[0][0]),h=d&&f.isArray(b[0][0][0]),
l=this._contentBounds.width,n=this._contentBounds.height,s=l/2*c;c=n/2*c;a=[a[0]-s,a[1]-c,a[0]+s,a[1]+c];var u=f.geo.width(a,true);c=f.geo.height(a,true);s=this._options.axisLayout==="image";l=l/u;n=n/c;c=[];var w,G;if(!h){if(!d){e||(b=[b]);b=[b]}b=[b]}for(u=0;u<b.length;u++){c[u]=[];for(w=0;w<b[u].length;w++){c[u][w]=[];for(G=0;G<b[u][w].length;G++)c[u][w][G]=[Math.round((b[u][w][G][0]-a[0])*l),Math.round((s?b[u][w][G][1]-a[1]:a[3]-b[u][w][G][1])*n)]}}return h?c:d?c[0]:e?c[0][0]:c[0][0][0]},_zoomTo:function(b,
a,c,e){a=a<0?0:a;a=this._getPixelSize(a);this._setCenterAndSize(b,a,c,e)},_document_keydown:function(b){var a=this._drawCoords.length;if(a>0&&b.which==27)if(a<=2){this._resetDrawing();this._inOp=false}else{this._drawCoords[a-2]=f.merge([],this._drawCoords[a-1]);this._drawPixels[a-2]=f.merge([],this._drawPixels[a-1]);this._drawCoords.length--;this._drawPixels.length--;this._refreshDrawing()}},_eventTarget_dblclick_zoom:function(b){this._trigger("dblclick",b,{type:"Point",coordinates:this.toMap(this._current)});
if(!b.isDefaultPrevented()){b=this._getZoomCenterAndSize(this._current,1,true);this._setCenterAndSize(b.center,b.pixelSize,true,true)}},_eventTarget_dblclick:function(b){if(this._options.mode!=="static"){this._panFinalize();if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}f(b.currentTarget).offset();switch(this._options.mode){case "drawLineString":case "measureLength":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==
this._drawCoords[1][1])){this._drawCoords.length--;this._trigger("shape",b,{type:"LineString",coordinates:this._userGeodetic?f.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})}else this._eventTarget_dblclick_zoom(b);this._resetDrawing();break;case "drawPolygon":case "measureArea":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){var a=this._drawCoords.length-1;if(a>2){this._drawCoords[a]=f.merge([],this._drawCoords[0]);
this._trigger("shape",b,{type:"Polygon",coordinates:[this._userGeodetic?f.geo.proj.toGeodetic(this._drawCoords):this._drawCoords]})}}else this._eventTarget_dblclick_zoom(b);this._resetDrawing();break;default:this._eventTarget_dblclick_zoom(b)}this._inOp=false}},_eventTarget_touchstart:function(b){if(this._options.mode!=="static")if(!(!this._supportTouch&&b.which!=1)){this._panFinalize();this._mouseWheelFinish(false);var a=f(b.currentTarget).offset(),c=b.originalEvent.changedTouches;if(this._supportTouch){this._multiTouchAnchor=
f.merge([],c);if(this._isMultiTouch=this._multiTouchAnchor.length>1){this._multiTouchCurrentBbox=[c[0].pageX-a.left,c[0].pageY-a.top,c[1].pageX-a.left,c[1].pageY-a.top];this._multiTouchAnchorBbox=f.merge([],this._multiTouchCurrentBbox);this._current=f.geo.center(this._multiTouchCurrentBbox,true)}else{this._multiTouchCurrentBbox=[c[0].pageX-a.left,c[0].pageY-a.top,NaN,NaN];this._current=[c[0].pageX-a.left,c[0].pageY-a.top]}}else this._current=[b.pageX-a.left,b.pageY-a.top];if(this._softDblClick){a=
f.now();if(a-this._downDate<750){if(this._isTap){c=this._current[0]-this._anchor[0];var e=this._current[1]-this._anchor[1];if(Math.sqrt(c*c+e*e)>8)this._isTap=false;else this._current=f.merge([],this._anchor)}this._isDbltap=this._isDbltap?false:this._isTap}else this._isDbltap=false;this._isTap=true;this._downDate=a}this._mouseDown=true;this._anchor=f.merge([],this._current);if(!this._inOp&&b.shiftKey){this._shiftZoom=true;this._$eventTarget.css("cursor",this._options.cursors.zoom)}else if(!this._isMultiTouch&&
this._options.pannable){this._inOp=true;switch(this._options.mode){case "zoom":break;default:this._lastDrag=this._current;b.currentTarget.setCapture&&b.currentTarget.setCapture()}}b.preventDefault();return false}},_dragTarget_touchmove:function(b){if(this._options.mode!=="static"){var a=this._$eventTarget.offset(),c=this._drawCoords.length,e=b.originalEvent.changedTouches,d;d=0;if(this._supportTouch){if(!this._isMultiTouch&&e[0].identifier!==this._multiTouchAnchor[0].identifier){this._mouseDown=false;
this._dragTarget_touchstop(b);this._isMultiTouch=true;this._multiTouchAnchor.push(e[0]);this._multiTouchCurrentBbox=[this._multiTouchCurrentBbox[0],this._multiTouchCurrentBbox[1],this._multiTouchAnchor[1].pageX-a.left,this._multiTouchAnchor[1].pageY-a.top];this._multiTouchAnchorBbox=f.merge([],this._multiTouchCurrentBbox);this._mouseDown=true;this._anchor=this._current=f.geo.center(this._multiTouchCurrentBbox,true);return false}if(this._isMultiTouch){for(;d<e.length;d++)if(e[d].identifier===this._multiTouchAnchor[0].identifier){this._multiTouchCurrentBbox[0]=
e[d].pageX-a.left;this._multiTouchCurrentBbox[1]=e[d].pageY-a.top}else if(e[d].identifier===this._multiTouchAnchor[1].identifier){this._multiTouchCurrentBbox[2]=e[d].pageX-a.left;this._multiTouchCurrentBbox[3]=e[d].pageY-a.top}f.geo.center(this._multiTouchCurrentBbox,true);d=this._multiTouchCurrentBbox[2]-this._multiTouchCurrentBbox[0];a=this._multiTouchAnchorBbox[2]-this._multiTouchAnchorBbox[0];this._wheelLevel=Math.abs(Math.floor((1-d/a)*10));if(Math.abs(d)<Math.abs(a))this._wheelLevel=-this._wheelLevel;
e=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,false);this._$elem.find(".geo-shapes-container").geographics("clear");for(d=0;d<this._currentServices.length;d++){a=this._currentServices[d];f.geo._serviceTypes[a.type].interactiveScale(this,a,e.center,e.pixelSize)}this._graphicShapes.length>0&&this._graphicShapes.length<256&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes,e.center,e.pixelSize);if(this._drawCoords.length>0){this._drawPixels=
this._toPixel(this._drawCoords,e.center,e.pixelSize);this._refreshDrawing()}d=f.geo.center(this._multiTouchCurrentBbox,true)}else d=[b.originalEvent.changedTouches[0].pageX-a.left,b.originalEvent.changedTouches[0].pageY-a.top]}else d=[b.pageX-a.left,b.pageY-a.top];if(d[0]===this._lastMove[0]&&d[1]===this._lastMove[1])if(this._inOp){b.preventDefault();return false}if(g==7)this._isDbltap=this._isTap=false;if(this._mouseDown){this._current=d;this._moveDate=f.now()}if(this._isMultiTouch){b.preventDefault();
return this._isDbltap=this._isTap=false}switch(this._shiftZoom?"zoom":this._options.mode){case "zoom":if(this._mouseDown){this._$drawContainer.geographics("clear");this._$drawContainer.geographics("drawBbox",[this._anchor[0],this._anchor[1],d[0],d[1]])}else this._trigger("move",b,{type:"Point",coordinates:this.toMap(d)});break;case "drawLineString":case "drawPolygon":case "measureLength":case "measureArea":if(this._mouseDown||this._toolPan)this._panMove();else{if(c>0){this._drawCoords[c-1]=this._toMap(d);
this._drawPixels[c-1]=d;this._refreshDrawing()}this._trigger("move",b,{type:"Point",coordinates:this.toMap(d)})}break;default:this._mouseDown||this._toolPan?this._panMove():this._trigger("move",b,{type:"Point",coordinates:this.toMap(d)})}this._lastMove=d;if(this._inOp){b.preventDefault();return false}}},_dragTarget_touchstop:function(b){if(this._options.mode!=="static"){!this._mouseDown&&g==7&&this._eventTarget_touchstart(b);var a=this._mouseDown,c=this._toolPan,e=this._$eventTarget.offset(),d=this._shiftZoom?
"zoom":this._options.mode,h,l;h=this._supportTouch?[b.originalEvent.changedTouches[0].pageX-e.left,b.originalEvent.changedTouches[0].pageY-e.top]:[b.pageX-e.left,b.pageY-e.top];if(this._softDblClick)if(this._isTap){e=h[0]-this._anchor[0];l=h[1]-this._anchor[1];if(Math.sqrt(e*e+l*l)<=8)h=f.merge([],this._anchor)}e=h[0]-this._anchor[0];l=h[1]-this._anchor[1];this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._shiftZoom=this._mouseDown=this._toolPan=false;if(this._isMultiTouch){b.preventDefault();
this._isMultiTouch=false;a=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,false);this._setCenterAndSize(a.center,a.pixelSize,true,true);this._wheelLevel=0;return false}document.releaseCapture&&document.releaseCapture();if(a){a=f.now();this._current=h;switch(d){case "zoom":if(e!=0||l!=0){c=this._pixelSize*6;d=this._toMap([[Math.min(this._anchor[0],h[0]),Math.max(this._anchor[1],h[1])],[Math.max(this._anchor[0],h[0]),Math.min(this._anchor[1],h[1])]]);d=[d[0][0],d[0][1],d[1][0],d[1][1]];if(d[2]-
d[0]<c&&d[3]-d[1]<c)d=f.geo.scaleBy(this._getBbox(f.geo.center(d,true)),0.5,true);this._setBbox(d,true,true)}this._resetDrawing();break;case "drawPoint":if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}if(c)this._panFinalize();else if(a-this._clickDate>100){var n=this;this._drawTimeout=setTimeout(function(){if(n._drawTimeout){n._trigger("shape",b,{type:"Point",coordinates:n.toMap(h)});n._inOp=false;n._drawTimeout=null}},250)}break;case "drawLineString":case "drawPolygon":case "measureLength":case "measureArea":if(c)this._panFinalize();
else{c=this._drawCoords.length==0?0:this._drawCoords.length-1;this._drawCoords[c]=this._toMap(h);this._drawPixels[c]=h;if(c<2||!(this._drawCoords[c][0]==this._drawCoords[c-1][0]&&this._drawCoords[c][1]==this._drawCoords[c-1][1])){this._drawCoords[c+1]=this._toMap(h);this._drawPixels[c+1]=h}this._refreshDrawing()}break;default:if(c)this._panEnd();else if(a-this._clickDate>100){this._trigger("click",b,{type:"Point",coordinates:this.toMap(h)});this._inOp=false}}this._clickDate=a;if(this._softDblClick&&
this._isDbltap){this._isDbltap=this._isTap=false;this._$eventTarget.trigger("dblclick",b)}}if(this._inOp){b.preventDefault();return false}}},_eventTarget_mousewheel:function(b,a){if(!(this._options.mode==="static"||this._options.scroll==="off")){b.preventDefault();this._panFinalize();if(this._mouseDown)return false;if(a!=0){if(this._wheelTimeout){window.clearTimeout(this._wheelTimeout);this._wheelTimeout=null}else{var c=f(b.currentTarget).offset();this._anchor=[b.pageX-c.left,b.pageY-c.top]}this._wheelLevel+=
a;c=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._options.tilingScheme!=null);var e,d=0;for(this._$elem.find(".geo-shapes-container").geographics("clear");d<this._currentServices.length;d++){e=this._currentServices[d];f.geo._serviceTypes[e.type].interactiveScale(this,e,c.center,c.pixelSize)}this._graphicShapes.length>0&&this._graphicShapes.length<256&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,this._graphicShapes,c.center,c.pixelSize);if(this._drawCoords.length>
0){this._drawPixels=this._toPixel(this._drawCoords,c.center,c.pixelSize);this._refreshDrawing()}var h=this;this._wheelTimeout=window.setTimeout(function(){h._mouseWheelFinish(true)},1E3)}return false}}})})(jQuery);
(function(f,p){f.geo._serviceTypes.tiled=function(){return{create:function(t,g,b){t=f.data(b,"geoServiceState");if(!t){t={loadCount:0,reloadTiles:false};g.append('<div data-geo-service="tiled" style="position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0;"></div>');t.serviceContainer=g.children(":last");f.data(b,"geoServiceState",t)}return t.serviceContainer},destroy:function(t,g,b){f.data(b,"geoServiceState").serviceContainer.remove();f.removeData(b,"geoServiceState")},interactivePan:function(t,
g,b,a){var c=f.data(g,"geoServiceState");if(c){this._cancelUnloaded(t,g);c.serviceContainer.children().css("-moz-transition","").css({webkitTransition:"",transition:"",left:function(aa,la){return parseInt(la)+b},top:function(aa,la){return parseInt(la)+a}});if(g&&g.style.visibility==="visible"){var e=t._pixelSize,d=this,h=c.serviceContainer,l=h.children("[data-pixelSize='"+e+"']"),n=t._getContentBounds(),s=t.options.axisLayout==="image",u=s?+1:-1,w=t.options.tilingScheme,G=w.tileWidth,D=w.tileHeight,
P=n.width/2*e,z=n.height/2*e,O=l.position(),K=l.data("scaleOrigin").split(",");n=parseInt(K[0])-O.left;O=parseInt(K[1])-O.top;var Q=t._getCenter();K=[Q[0]+n*e,Q[1]+u*O*e];var S=Math.floor((K[0]-P-w.origin[0])/(e*G));n=Math.max(Math.floor((s?K[1]-z-w.origin[1]:w.origin[1]-(K[1]+z))/(e*D)),0);O=Math.ceil((K[0]+P-w.origin[0])/(e*G));K=Math.ceil((s?K[1]+z-w.origin[1]:w.origin[1]-(K[1]-z))/(e*D));var N=t._getBboxMax(),I=t._getPixelSize(0),R=I/e,W=Math.floor((N[0]-w.origin[0])/(I*G))*R;N=Math.floor((w.origin[1]+
u*N[3])/(I*D))*R;I=w.origin[1]+u*N*D*e;P=Math.round((w.origin[0]+W*G*e-(Q[0]-P))/e);s=Math.round((s?I-(Q[1]-z):Q[1]+z-I)/e);var A=g.style.opacity;for(z=S;z<O;z++)for(Q=n;Q<K;Q++){S=""+z+","+Q;var V=l.children("[data-tile='"+S+"']").removeAttr("data-dirty");if(V.size()===0){I=[w.origin[0]+z*G*e,w.origin[1]+u*Q*D*e];R=[w.origin[0]+((z+1)*G-1)*e,w.origin[1]+u*((Q+1)*D-1)*e];R=[I[0],I[1],R[0],R[1]];I=g.hasOwnProperty("src")?"src":"getUrl";R={bbox:R,width:G,height:D,zoom:t._getZoom(),tile:{row:Q,column:z},
index:Math.abs(Q+z)};if(f.isFunction(g[I]))I=g[I](R);else{f.templates("geoSrc",g[I]);I=f.render.geoSrc(R)}c.loadCount++;if(c.reloadTiles&&V.size()>0)V.attr("src",I);else{R="<img style='position:absolute; left:"+((z-W)*100+(P-P%G)/G*100)+"%; top:"+((Q-N)*100+(s-s%D)/D*100)+"%; ";if(f("body")[0].filters===p)R+="width: 100%; height: 100%;";R+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+
S+"' />";l.append(R);V=l.children(":last")}typeof I==="string"?d._loadImage(V,I,e,c,h,A):I.done(function(aa){d._loadImage(V,aa,e,c,h,A)}).fail(function(){V.remove();c.loadCount--})}}}}},interactiveScale:function(t,g,b,a){var c=f.data(g,"geoServiceState");if(c&&g&&g.style.visibility==="visible"){this._cancelUnloaded(t,g);g=t.options.tilingScheme;var e=g.tileWidth,d=g.tileHeight;c.serviceContainer.children().each(function(){var h=f(this),l=h.attr("data-pixelSize")/a;l=Math.round(l*1E3)/1E3;var n=h.data("scaleOrigin").split(",");
n=t._toMap([n[0],n[1]]);n=t._toPixel(n,b,a);h.css("-moz-transition","").css({webkitTransition:"",transition:"",left:Math.round(n[0])+"px",top:Math.round(n[1])+"px",width:e*l,height:d*l});f("body")[0].filters!==p&&h.children().each(function(){f(this).css("filter","progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+l+",M22="+l+",sizingmethod='auto expand')")})})}},refresh:function(t,g){var b=f.data(g,"geoServiceState");this._cancelUnloaded(t,g);if(b&&g&&g.style.visibility==="visible"&&
!b.serviceContainer.is(":hidden")){var a=t._getBbox(),c=t._pixelSize,e=this,d=b.serviceContainer;t._getContentBounds();var h=t.options.axisLayout==="image",l=h?+1:-1,n=t.options.tilingScheme,s=n.tileWidth,u=n.tileHeight,w=Math.floor((a[0]-n.origin[0])/(c*s)),G=Math.max(Math.floor((h?a[1]-n.origin[1]:n.origin[1]-a[3])/(c*u)),0),D=Math.ceil((a[2]-n.origin[0])/(c*s)),P=Math.ceil((h?a[3]-n.origin[1]:n.origin[1]-a[1])/(c*u)),z=t._getBboxMax(),O=t._getPixelSize(0),K=O/c,Q=Math.floor((z[0]-n.origin[0])/
(O*s))*K,S=Math.floor((n.origin[1]+l*z[3])/(O*u))*K;z=n.origin[1]+l*S*u*c;var N=Math.round((n.origin[0]+Q*s*c-a[0])/c),I=Math.round((h?z-a[1]:a[3]-z)/c);a=d.children().show();h=a.filter("[data-pixelSize='"+c+"']").appendTo(d);var R=g.style.opacity;b.reloadTiles&&a.find("img").attr("data-dirty","true");if(h.size()){h.css({left:N%s+"px",top:I%u+"px"}).data("scaleOrigin",N%s+","+I%u);h.children().each(function(){var V=f(this),aa=V.attr("data-tile").split(",");V.css({left:Math.round((parseInt(aa[0])-
Q)*100+(N-N%s)/s*100)+"%",top:Math.round((parseInt(aa[1])-S)*100+(I-I%u)/u*100)+"%"});R<1&&V.fadeTo(0,R)})}else{d.append("<div style='position:absolute; left:"+N%s+"px; top:"+I%u+"px; width:"+s+"px; height:"+u+"px; margin:0; padding:0;' data-pixelSize='"+c+"'></div>");h=d.children(":last").data("scaleOrigin",N%s+","+I%u)}for(w=w;w<D;w++)for(z=G;z<P;z++){O=""+w+","+z;var W=h.children("[data-tile='"+O+"']").removeAttr("data-dirty");if(W.size()===0||b.reloadTiles){K=[n.origin[0]+w*s*c,n.origin[1]+l*
z*u*c];var A=[n.origin[0]+((w+1)*s-1)*c,n.origin[1]+l*((z+1)*u-1)*c];A=[K[0],K[1],A[0],A[1]];K=g.hasOwnProperty("src")?"src":"getUrl";A={bbox:A,width:s,height:u,zoom:t._getZoom(),tile:{row:z,column:w},index:Math.abs(z+w)};if(f.isFunction(g[K]))K=g[K](A);else{f.templates("geoSrc",g[K]);K=f.render.geoSrc(A)}b.loadCount++;if(b.reloadTiles&&W.size()>0)W.attr("src",K);else{A="<img style='position:absolute; left:"+((w-Q)*100+(N-N%s)/s*100)+"%; top:"+((z-S)*100+(I-I%u)/u*100)+"%; ";if(f("body")[0].filters===
p)A+="width: 100%; height: 100%;";A+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+O+"' />";h.append(A);W=h.children(":last")}typeof K==="string"?e._loadImage(W,K,c,b,d,R):K.done(function(V){e._loadImage(W,V,c,b,d,R)}).fail(function(){W.remove();b.loadCount--})}}a.find("[data-dirty]").remove();b.reloadTiles=false}},resize:function(){},opacity:function(t,g){f.data(g,"geoServiceState").serviceContainer.find("img").stop(true).fadeTo("fast",
g.style.opacity)},toggle:function(t,g){f.data(g,"geoServiceState").serviceContainer.css("display",g.style.visibility==="visible"?"block":"none")},_cancelUnloaded:function(t,g){var b=f.data(g,"geoServiceState");if(b&&b.loadCount>0)for(b.serviceContainer.find("img:hidden").remove();b.loadCount>0;)b.loadCount--},_loadImage:function(t,g,b,a,c,e){t.load(function(d){e<1?f(d.target).fadeTo(0,e):f(d.target).show();a.loadCount--;if(a.loadCount<=0){c.children(":not([data-pixelSize='"+b+"'])").remove();a.loadCount=
0}}).error(function(d){f(d.target).remove();a.loadCount--;if(a.loadCount<=0){c.children(":not([data-pixelSize='"+b+"'])").remove();a.loadCount=0}}).attr("src",g)}}}()})(jQuery);
(function(f){f.geo._serviceTypes.shingled=function(){return{create:function(p,t,g){p=f.data(g,"geoServiceState");if(!p){p={loadCount:0};t.append('<div data-geo-service="shingled" style="position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0;"></div>');p.serviceContainer=t.children(":last");f.data(g,"geoServiceState",p)}return p.serviceContainer},destroy:function(p,t,g){f.data(g,"geoServiceState").serviceContainer.remove();f.removeData(g,"geoServiceState")},interactivePan:function(p,
t,g,b){var a=f.data(t,"geoServiceState");if(a){this._cancelUnloaded(p,t);t=a.serviceContainer;p=p._pixelSize;a=t.children("[data-pixelSize='"+p+"']");var c=a.children("div");if(!c.length){a.children("img").wrap('<div style="position:absolute; left:0; top:0; width:100%; height:100%;"></div>');c=a.children("div")}c.css({left:function(e,d){return parseInt(d)+g},top:function(e,d){return parseInt(d)+b}});t.children(":not([data-pixelSize='"+p+"'])").remove()}},interactiveScale:function(p,t,g,b){var a=f.data(t,
"geoServiceState");if(a){this._cancelUnloaded(p,t);t=a.serviceContainer;p=p._getContentBounds();var c=p.width,e=p.height,d=c/2,h=e/2;t.children().each(function(){var l=f(this),n=l.attr("data-pixelSize"),s=n/b;l.css({width:c*s,height:e*s}).children("img").each(function(){var u=f(this),w=u.data("center");u.css({left:(Math.round((w[0]-g[0])/n)-d)*s+"px",top:(Math.round((g[1]-w[1])/n)-h)*s+"px"})})})}},refresh:function(p,t){var g=f.data(t,"geoServiceState");this._cancelUnloaded(p,t);if(g&&t&&t.style.visibility===
"visible"&&!g.serviceContainer.is(":hidden")){var b=p._getBbox(),a=p._pixelSize,c=this,e=g.serviceContainer,d=p._getContentBounds(),h=d.width,l=d.height,n=h/2,s=l/2;d=e.children('[data-pixelSize="'+a+'"]');var u=t.style.opacity,w;if(!d.size()){e.append('<div style="position:absolute; left:'+n+"px; top:"+s+"px; width:"+h+"px; height:"+l+'px; margin:0; padding:0;" data-pixelSize="'+a+'"></div>');d=e.children(":last")}d.children("img").each(function(){var D=f(this),P=D.data("center"),z=p._getCenter();
D.css({left:Math.round((P[0]-z[0])/a)-n+"px",top:Math.round((z[1]-P[1])/a)-s+"px"})});u<1&&e.find("img").attr("data-keepAlive","0");var G=t.hasOwnProperty("src")?"src":"getUrl";b={bbox:b,width:h,height:l,zoom:p._getZoom(),tile:null,index:0};if(f.isFunction(t[G]))b=t[G](b);else{f.templates("geoSrc",t[G]);b=f.render.geoSrc(b)}g.loadCount++;d.append('<img style="position:absolute; left:-'+n+"px; top:-"+s+'px; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />');
w=d.children(":last").data("center",p._getCenter());typeof b==="string"?c._loadImage(w,b,a,g,e,u):b.done(function(D){c._loadImage(w,D,a,g,e,u)}).fail(function(){w.remove();g.loadCount--})}},resize:function(p,t){var g=f.data(t,"geoServiceState");if(g&&t&&t.style.visibility==="visible"){this._cancelUnloaded(p,t);var b=g.serviceContainer,a=p._getContentBounds();g=a.width/2;a=a.height/2;b=b.children();b.attr("data-pixelSize","0");b.css({left:g+"px",top:a+"px"})}},opacity:function(p,t){f.data(t,"geoServiceState").serviceContainer.find("img").stop(true).fadeTo("fast",
t.style.opacity)},toggle:function(p,t){f.data(t,"geoServiceState").serviceContainer.css("display",t.style.visibility==="visible"?"block":"none")},_cancelUnloaded:function(p,t){var g=f.data(t,"geoServiceState");if(g&&g.loadCount>0)for(g.serviceContainer.find("img:hidden").remove();g.loadCount>0;)g.loadCount--},_loadImage:function(p,t,g,b,a,c){p.load(function(e){c<1?f(e.target).fadeTo(0,c):f(e.target).show();b.loadCount--;if(b.loadCount<=0){a.children(':not([data-pixelSize="'+g+'"])').remove();e=a.find('[data-pixelSize="'+
g+'"]>div');if(e.size()>0){var d=e.position();e.children("img").each(function(){var h=f(this),l=d.left+parseInt(h.css("left")),n=d.top+parseInt(h.css("top"));h.css({left:l+"px",top:n+"px"})}).unwrap();e.remove()}b.loadCount=0}}).error(function(e){f(e.target).remove();b.loadCount--;if(b.loadCount<=0){a.children(":not([data-pixelSize='"+g+"'])").remove();b.loadCount=0}}).attr("src",t)}}}()})(jQuery);
/*! Copyright (c) 2011 Brandon Aaron (http://brandonaaron.net)
 * Licensed under the MIT License (LICENSE.txt).
 *
 * Thanks to: http://adomas.org/javascript-mouse-wheel/ for some pointers.
 * Thanks to: Mathias Bank(http://www.mathias-bank.de) for a scope bug fix.
 * Thanks to: Seamus Leahy for adding deltaX and deltaY
 *
 * Version: 3.0.6
 * 
 * Requires: 1.2.2+
 */
(function(a){function d(b){var c=b||window.event,d=[].slice.call(arguments,1),e=0,f=!0,g=0,h=0;return b=a.event.fix(c),b.type="mousewheel",c.wheelDelta&&(e=c.wheelDelta/120),c.detail&&(e=-c.detail/3),h=e,c.axis!==undefined&&c.axis===c.HORIZONTAL_AXIS&&(h=0,g=-1*e),c.wheelDeltaY!==undefined&&(h=c.wheelDeltaY/120),c.wheelDeltaX!==undefined&&(g=-1*c.wheelDeltaX/120),d.unshift(b,e,g,h),(a.event.dispatch||a.event.handle).apply(this,d)}var b=["DOMMouseScroll","mousewheel"];if(a.event.fixHooks)for(var c=b.length;c;)a.event.fixHooks[b[--c]]=a.event.mouseHooks;a.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=b.length;a;)this.addEventListener(b[--a],d,!1);else this.onmousewheel=d},teardown:function(){if(this.removeEventListener)for(var a=b.length;a;)this.removeEventListener(b[--a],d,!1);else this.onmousewheel=null}},a.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery)
