document.createElement("canvas").getContext||function(){function f(){return this.context_||(this.context_=new q(this))}function p(h,l){var o=I.call(arguments,2);return function(){return h.apply(l,o.concat(I.call(arguments)))}}function m(h){h.namespaces.g_vml_||h.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");h.namespaces.g_o_||h.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!h.styleSheets.ex_canvas_){h=h.createStyleSheet();h.owningElement.id=
"ex_canvas_";h.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function a(h){var l=h.srcElement;switch(h.propertyName){case "width":l.getContext().clearRect();l.style.width=l.attributes.width.nodeValue+"px";l.firstChild.style.width=l.clientWidth+"px";break;case "height":l.getContext().clearRect();l.style.height=l.attributes.height.nodeValue+"px";l.firstChild.style.height=l.clientHeight+"px"}}function c(h){h=h.srcElement;if(h.firstChild){h.firstChild.style.width=
h.clientWidth+"px";h.firstChild.style.height=h.clientHeight+"px"}}function b(){return[[1,0,0],[0,1,0],[0,0,1]]}function d(h,l){for(var o=b(),s=0;s<3;s++)for(var x=0;x<3;x++){for(var t=0,J=0;J<3;J++)t+=h[s][J]*l[J][x];o[s][x]=t}return o}function g(h,l){l.fillStyle=h.fillStyle;l.lineCap=h.lineCap;l.lineJoin=h.lineJoin;l.lineWidth=h.lineWidth;l.miterLimit=h.miterLimit;l.shadowBlur=h.shadowBlur;l.shadowColor=h.shadowColor;l.shadowOffsetX=h.shadowOffsetX;l.shadowOffsetY=h.shadowOffsetY;l.strokeStyle=h.strokeStyle;
l.globalAlpha=h.globalAlpha;l.font=h.font;l.textAlign=h.textAlign;l.textBaseline=h.textBaseline;l.arcScaleX_=h.arcScaleX_;l.arcScaleY_=h.arcScaleY_;l.lineScale_=h.lineScale_}function e(h){var l=h.indexOf("(",3),o=h.indexOf(")",l+1);l=h.substring(l+1,o).split(",");if(l.length!=4||h.charAt(3)!="a")l[3]=1;return l}function k(h,l,o){return Math.min(o,Math.max(l,h))}function j(h,l,o){o<0&&o++;o>1&&o--;return 6*o<1?h+(l-h)*6*o:2*o<1?l:3*o<2?h+(l-h)*(2/3-o)*6:h}function n(h){if(h in M)return M[h];var l,
o=1;h=String(h);if(h.charAt(0)=="#")l=h;else if(/^rgb/.test(h)){o=e(h);l="#";for(var s,x=0;x<3;x++){s=o[x].indexOf("%")!=-1?Math.floor(parseFloat(o[x])/100*255):+o[x];l+=D[k(s,0,255)]}o=+o[3]}else if(/^hsl/.test(h)){x=o=e(h);l=parseFloat(x[0])/360%360;l<0&&l++;s=k(parseFloat(x[1])/100,0,1);x=k(parseFloat(x[2])/100,0,1);if(s==0)s=x=l=x;else{var t=x<0.5?x*(1+s):x+s-x*s,J=2*x-t;s=j(J,t,l+1/3);x=j(J,t,l);l=j(J,t,l-1/3)}l="#"+D[Math.floor(s*255)]+D[Math.floor(x*255)]+D[Math.floor(l*255)];o=o[3]}else l=
h;return M[h]={color:l,alpha:o}}function q(h){this.m_=b();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=B*1;this.globalAlpha=1;this.canvas=h;var l="width:"+h.clientWidth+"px;height:"+h.clientHeight+"px;overflow:hidden;position:absolute",o=h.ownerDocument.createElement("div");o.style.cssText=l;h.appendChild(o);l=o.cloneNode(false);l.style.backgroundColor="red";l.style.filter="alpha(opacity=0)";
h.appendChild(l);this.element_=o;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1}function v(h,l,o,s){h.currentPath_.push({type:"bezierCurveTo",cp1x:l.x,cp1y:l.y,cp2x:o.x,cp2y:o.y,x:s.x,y:s.y});h.currentX_=s.x;h.currentY_=s.y}function r(h,l,o){h=h.m_;return{x:B*(l*h[0][0]+o*h[1][0]+h[2][0])-H,y:B*(l*h[0][1]+o*h[1][1]+h[2][1])-H}}function y(h,l,o){if(isFinite(l[0][0])&&isFinite(l[0][1])&&isFinite(l[1][0])&&isFinite(l[1][1])&&isFinite(l[2][0])&&isFinite(l[2][1])){h.m_=l;if(o)h.lineScale_=C(E(l[0][0]*
l[1][1]-l[0][1]*l[1][0]))}}function z(h){this.code=this[h];this.message=h+": DOM Exception "+this.code}var A=Math,w=A.round,F=A.sin,G=A.cos,E=A.abs,C=A.sqrt,B=10,H=B/2;navigator.userAgent.match(/MSIE ([\d.]+)?/);var I=Array.prototype.slice;m(document);A={init:function(h){h=h||document;h.createElement("canvas");h.attachEvent("onreadystatechange",p(this.init_,this,h))},init_:function(h){h=h.getElementsByTagName("canvas");for(var l=0;l<h.length;l++)this.initElement(h[l])},initElement:function(h){if(!h.getContext){h.getContext=
f;m(h.ownerDocument);h.innerHTML="";h.attachEvent("onpropertychange",a);h.attachEvent("onresize",c);var l=h.attributes;if(l.width&&l.width.specified)h.style.width=l.width.nodeValue+"px";else h.width=h.clientWidth;if(l.height&&l.height.specified)h.style.height=l.height.nodeValue+"px";else h.height=h.clientHeight}return h}};A.init();for(var D=[],u=0;u<16;u++)for(var K=0;K<16;K++)D[u*16+K]=u.toString(16)+K.toString(16);var M={},N={butt:"flat",round:"round"};u=q.prototype;u.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);
this.textMeasureEl_=null}this.element_.innerHTML=""};u.beginPath=function(){this.currentPath_=[]};u.moveTo=function(h,l){var o=r(this,h,l);this.currentPath_.push({type:"moveTo",x:o.x,y:o.y});this.currentX_=o.x;this.currentY_=o.y};u.lineTo=function(h,l){var o=r(this,h,l);this.currentPath_.push({type:"lineTo",x:o.x,y:o.y});this.currentX_=o.x;this.currentY_=o.y};u.bezierCurveTo=function(h,l,o,s,x,t){x=r(this,x,t);h=r(this,h,l);o=r(this,o,s);v(this,h,o,x)};u.quadraticCurveTo=function(h,l,o,s){h=r(this,
h,l);o=r(this,o,s);s={x:this.currentX_+2/3*(h.x-this.currentX_),y:this.currentY_+2/3*(h.y-this.currentY_)};v(this,s,{x:s.x+(o.x-this.currentX_)/3,y:s.y+(o.y-this.currentY_)/3},o)};u.arc=function(h,l,o,s,x,t){o*=B;var J=t?"at":"wa",L=h+G(s)*o-H,O=l+F(s)*o-H;s=h+G(x)*o-H;x=l+F(x)*o-H;if(L==s&&!t)L+=0.125;h=r(this,h,l);L=r(this,L,O);s=r(this,s,x);this.currentPath_.push({type:J,x:h.x,y:h.y,radius:o,xStart:L.x,yStart:L.y,xEnd:s.x,yEnd:s.y})};u.stroke=function(h){var l=[];l.push("<g_vml_:shape",' filled="',
!!h,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0,0"',' coordsize="',B*10,",",B*10,'"',' stroked="',!h,'"',' path="');for(var o={x:null,y:null},s={x:null,y:null},x=0;x<this.currentPath_.length;x++){var t=this.currentPath_[x];switch(t.type){case "moveTo":l.push(" m ",w(t.x),",",w(t.y));break;case "lineTo":l.push(" l ",w(t.x),",",w(t.y));break;case "close":l.push(" x ");t=null;break;case "bezierCurveTo":l.push(" c ",w(t.cp1x),",",w(t.cp1y),",",w(t.cp2x),",",w(t.cp2y),
",",w(t.x),",",w(t.y));break;case "at":case "wa":l.push(" ",t.type," ",w(t.x-this.arcScaleX_*t.radius),",",w(t.y-this.arcScaleY_*t.radius)," ",w(t.x+this.arcScaleX_*t.radius),",",w(t.y+this.arcScaleY_*t.radius)," ",w(t.xStart),",",w(t.yStart)," ",w(t.xEnd),",",w(t.yEnd))}if(t){if(o.x==null||t.x<o.x)o.x=t.x;if(s.x==null||t.x>s.x)s.x=t.x;if(o.y==null||t.y<o.y)o.y=t.y;if(s.y==null||t.y>s.y)s.y=t.y}}l.push(' ">');if(h){h=n(this.fillStyle);l.push('<g_vml_:fill color="',h.color,'" opacity="',h.alpha*this.globalAlpha,
'" />')}else{o=n(this.strokeStyle);h=o.color;o=o.alpha*this.globalAlpha;s=this.lineScale_*this.lineWidth;if(s<1)o*=s;l.push("<g_vml_:stroke",' opacity="',o,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',N[this.lineCap]||"square",'"',' weight="',s,'px"',' color="',h,'" />')}l.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",l.join(""))};u.fill=function(){this.stroke(true)};u.closePath=function(){this.currentPath_.push({type:"close"})};u.save=
function(){var h={};g(this,h);this.aStack_.push(h);this.mStack_.push(this.m_);this.m_=d(b(),this.m_)};u.restore=function(){if(this.aStack_.length){g(this.aStack_.pop(),this);this.m_=this.mStack_.pop()}};u.translate=function(h,l){y(this,d([[1,0,0],[0,1,0],[h,l,1]],this.m_),false)};u.scale=function(h,l){this.arcScaleX_*=h;this.arcScaleY_*=l;y(this,d([[h,0,0],[0,l,0],[0,0,1]],this.m_),true)};u=z.prototype=Error();u.INDEX_SIZE_ERR=1;u.DOMSTRING_SIZE_ERR=2;u.HIERARCHY_REQUEST_ERR=3;u.WRONG_DOCUMENT_ERR=
4;u.INVALID_CHARACTER_ERR=5;u.NO_DATA_ALLOWED_ERR=6;u.NO_MODIFICATION_ALLOWED_ERR=7;u.NOT_FOUND_ERR=8;u.NOT_SUPPORTED_ERR=9;u.INUSE_ATTRIBUTE_ERR=10;u.INVALID_STATE_ERR=11;u.SYNTAX_ERR=12;u.INVALID_MODIFICATION_ERR=13;u.NAMESPACE_ERR=14;u.INVALID_ACCESS_ERR=15;u.VALIDATION_ERR=16;u.TYPE_MISMATCH_ERR=17;G_vmlCanvasManager=A;CanvasRenderingContext2D=q;DOMException=z}();
(function(f){function p(a){var c=[].slice.call(arguments,1),b=0;a=f.event.fix(a||window.event);a.type="mousewheel";if(a.wheelDelta)b=a.wheelDelta/120;if(a.detail)b=-a.detail/3;c.unshift(a,b);return f.event.handle.apply(this,c)}var m=["DOMMouseScroll","mousewheel"];f.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var a=m.length;a;)this.addEventListener(m[--a],p,false);else this.onmousewheel=p},teardown:function(){if(this.removeEventListener)for(var a=m.length;a;)this.removeEventListener(m[--a],
p,false);else this.onmousewheel=null}};f.fn.extend({mousewheel:function(a){return a?this.bind("mousewheel",a):this.trigger("mousewheel")},unmousewheel:function(a){return this.unbind("mousewheel",a)}})})(jQuery);
$.widget||function(f,p){var m=Array.prototype.slice,a=f.cleanData;f.cleanData=function(c){for(var b=0,d;(d=c[b])!=null;b++)f(d).triggerHandler("remove");a(c)};f.widget=function(c,b,d){var g=c.split(".")[0],e;c=c.split(".")[1];e=g+"-"+c;if(!d){d=b;b=f.Widget}f.expr[":"][e]=function(j){return!!f.data(j,c)};f[g]=f[g]||{};f[g][c]=f.extend(function(j,n){if(!this._createWidget)return new f[g][c](j,n);arguments.length&&this._createWidget(j,n)},f[g][c]);var k=new b;k.options=f.extend(true,{},k.options);f.each(d,
function(j,n){if(f.isFunction(n))d[j]=function(){var q=function(r){return b.prototype[r].apply(this,m.call(arguments,1))},v=function(r,y){return b.prototype[r].apply(this,y)};return function(){var r=this._super,y=this._superApply,z;this._super=q;this._superApply=v;z=n.apply(this,arguments);this._super=r;this._superApply=y;return z}}()});f[g][c].prototype=f.extend(true,k,{namespace:g,widgetName:c,widgetEventPrefix:c,widgetBaseClass:e},d);f.widget.bridge(c,f[g][c])};f.widget.bridge=function(c,b){f.fn[c]=
function(d){var g=typeof d==="string",e=m.call(arguments,1),k=this;d=!g&&e.length?f.extend.apply(null,[true,d].concat(e)):d;g?this.each(function(){var j=f.data(this,c);if(!j)return f.error("cannot call methods on "+c+" prior to initialization; attempted to call method '"+d+"'");if(!f.isFunction(j[d])||d.charAt(0)==="_")return f.error("no such method '"+d+"' for "+c+" widget instance");var n=j[d].apply(j,e);if(n!==j&&n!==p){k=n;return false}}):this.each(function(){var j=f.data(this,c);j?j.option(d||
{})._init():b(d,this)});return k}};f.Widget=function(c,b){if(!this._createWidget)return new f[namespace][name](c,b);arguments.length&&this._createWidget(c,b)};f.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false},_createWidget:function(c,b){b=f(b||this.defaultElement||this)[0];this.element=f(b);this.options=f.extend(true,{},this.options,this._getCreateOptions(),c);this.bindings=f();this.hoverable=f();this.focusable=f();if(b!==this){f.data(b,this.widgetName,
this);this._bind({remove:"destroy"})}this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return f.metadata&&f.metadata.get(this.element[0])[this.widgetName]},_create:f.noop,_init:f.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");
this.focusable.removeClass("ui-state-focus")},_destroy:f.noop,widget:function(){return this.element},option:function(c,b){var d=c;if(arguments.length===0)return f.extend({},this.options);if(typeof c==="string"){if(b===p)return this.options[c];d={};d[c]=b}this._setOptions(d);return this},_setOptions:function(c){var b=this;f.each(c,function(d,g){b._setOption(d,g)});return this},_setOption:function(c,b){this.options[c]=b;if(c==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",
!!b).attr("aria-disabled",b);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_bind:function(c,b){if(b){c=f(c);this.bindings=this.bindings.add(c)}else{b=c;c=this.element}var d=this;f.each(b,function(g,e){c.bind(g+"."+d.widgetName,function(){if(!(d.options.disabled===true||f(this).hasClass("ui-state-disabled")))return(typeof e===
"string"?d[e]:e).apply(d,arguments)})})},_hoverable:function(c){this.hoverable=this.hoverable.add(c);this._bind(c,{mouseenter:function(b){f(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){f(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(c){this.focusable=this.focusable.add(c);this._bind(c,{focusin:function(b){f(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){f(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(c,b,d){var g=
this.options[c];b=f.Event(b);b.type=(c===this.widgetEventPrefix?c:this.widgetEventPrefix+c).toLowerCase();d=d||{};if(b.originalEvent){c=f.event.props.length;for(var e;c;){e=f.event.props[--c];b[e]=b.originalEvent[e]}}this.element.trigger(b,d);d=f.isArray(d)?[b].concat(d):[b,d];return!(f.isFunction(g)&&g.apply(this.element[0],d)===false||b.isDefaultPrevented())}}}(jQuery);
(function(f,p,m){var a=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY;f.geo={_allCoordinates:function(b){b=this._flatten(b);for(var d=0,g=[];d<b.length;d++){var e=b[d].coordinates,k=f.isArray(e[0]),j=k&&f.isArray(e[0][0]),n;if(!(j&&f.isArray(e[0][0][0]))){if(!j){k||(e=[e]);e=[e]}e=[e]}for(k=0;k<e.length;k++)for(j=0;j<e[k].length;j++)for(n=0;n<e[k][j].length;n++)g.push(e[k][j][n])}return g},center:function(b,d){if(!d&&f.geo.proj)b=f.geo.proj.fromGeodetic(b);var g=[(b[0]+b[2])/2,(b[1]+b[3])/2];
return!d&&f.geo.proj?f.geo.proj.toGeodetic(g):g},expandBy:function(b,d,g){if(f.geo.proj)b=f.geo.proj.fromGeodetic(b);b=[b[0]-d,b[1]-g,b[2]+d,b[3]+g];return f.geo.proj?f.geo.proj.toGeodetic(b):b},height:function(b,d){if(!d&&f.geo.proj)b=f.geo.proj.fromGeodetic(b);return b[3]-b[1]},_in:function(b,d){return b[0]<=d[0]&&b[1]<=d[1]&&b[2]>=d[2]&&b[3]>=d[3]},reaspect:function(b,d,g){if(!g&&f.geo.proj)b=f.geo.proj.fromGeodetic(b);var e=this.width(b,true),k=this.height(b,true);g=this.center(b,true);if(e!=
0&&k!=0&&d>0){if(e/k>d){b=e/2;e=b/d}else{e=k/2;b=e*d}b=[g[0]-b,g[1]-e,g[0]+b,g[1]+e]}return f.geo.proj?f.geo.proj.toGeodetic(b):b},scaleBy:function(b,d,g){if(!g&&f.geo.proj)b=f.geo.proj.fromGeodetic(b);var e=this.center(b,true),k=(b[2]-b[0])*d/2;b=(b[3]-b[1])*d/2;b=[e[0]-k,e[1]-b,e[0]+k,e[1]+b];return!g&&f.geo.proj?f.geo.proj.toGeodetic(b):b},width:function(b,d){if(!d&&f.geo.proj)b=f.geo.proj.fromGeodetic(b);return b[2]-b[0]},bbox:function(b){var d=f.data(b,"geoBbox");if(!d)if(b.bbox)f.data(b,"geoBbox",
d=b.bbox);else{d=[a,a,c,c];var g=this._allCoordinates(b),e=0;if(g.length==0)return m;if(f.geo.proj)g=f.geo.proj.fromGeodetic(g);for(;e<g.length;e++){d[0]=Math.min(g[e][0],d[0]);d[1]=Math.min(g[e][1],d[1]);d[2]=Math.max(g[e][0],d[2]);d[3]=Math.max(g[e][1],d[3])}f.data(b,"geoBbox",d)}return f.geo.proj?f.geo.proj.toGeodetic(d):d},centroid:function(b,d){switch(b.type){case "Point":return f.extend({},b);case "LineString":case "Polygon":var g=0,e=[0,0],k=f.merge([],b.type=="Polygon"?b.coordinates[0]:b.coordinates),
j=1,n,q;if(!d&&f.geo.proj)k=f.geo.proj.fromGeodetic(k);for(;j<=k.length;j++){n=j%k.length;q=k[j-1][0]*k[n][1]-k[n][0]*k[j-1][1];g+=q;e[0]+=(k[j-1][0]+k[n][0])*q;e[1]+=(k[j-1][1]+k[n][1])*q}if(g==0)if(k.length>0){e[0]=k[0][0];e[1]=k[0][1];return{type:"Point",coordinates:!d&&f.geo.proj?f.geo.proj.toGeodetic(e):e}}else break;g*=3;e[0]/=g;e[1]/=g;return{type:"Point",coordinates:!d&&f.geo.proj?f.geo.proj.toGeodetic(e):e}}return m},contains:function(b,d){if(b.type!="Polygon")return false;switch(d.type){case "Point":return this._containsPolygonPoint(b.coordinates,
d.coordinates);case "LineString":return this._containsPolygonLineString(b.coordinates,d.coordinates);case "Polygon":return this._containsPolygonLineString(b.coordinates,d.coordinates[0]);default:return false}},_containsPolygonPoint:function(b,d){if(b.length==0||b[0].length<4)return false;for(var g=0,e=b[0][0],k=1,j;k<b[0].length;k++){j=b[0][k];if(e[1]<=d[1]&&d[1]<j[1]||j[1]<=d[1]&&d[1]<e[1]&&(d[0]<e[0]||d[0]<j[0])){e=e[0]+(j[0]-e[0])*(d[1]-e[1])/(j[1]-e[1]);e>d[0]&&g++}e=j}return g%2==1},_containsPolygonLineString:function(b,
d){for(var g=0;g<d.length;g++)if(!this._containsPolygonPoint(b,d[g]))return false;return true},distance:function(b,d,g){var e=!g&&f.geo.proj?f.geo.proj.fromGeodetic(b.coordinates):b.coordinates;g=!g&&f.geo.proj?f.geo.proj.fromGeodetic(d.coordinates):d.coordinates;switch(b.type){case "Point":switch(d.type){case "Point":return this._distancePointPoint(g,e);case "LineString":return this._distanceLineStringPoint(g,e);case "Polygon":return this._containsPolygonPoint(g,e)?0:this._distanceLineStringPoint(g[0],
e);default:return m}case "LineString":switch(d.type){case "Point":return this._distanceLineStringPoint(e,g);case "LineString":return this._distanceLineStringLineString(e,g);case "Polygon":return this._containsPolygonLineString(g,e)?0:this._distanceLineStringLineString(g[0],e);default:return m}case "Polygon":switch(d.type){case "Point":return this._containsPolygonPoint(e,g)?0:this._distanceLineStringPoint(e[0],g);case "LineString":return this._containsPolygonLineString(e,g)?0:this._distanceLineStringLineString(e[0],
g);case "Polygon":return this._containsPolygonLineString(e,g[0])?0:this._distanceLineStringLineString(e[0],g[0]);default:return m}}},_distancePointPoint:function(b,d){var g=d[0]-b[0],e=d[1]-b[1];return Math.sqrt(g*g+e*e)},_distanceLineStringPoint:function(b,d){var g=a;if(b.length>0){var e=b[0],k=d[0]-e[0],j=d[1]-e[1];if(b.length==1)return Math.sqrt(k*k+j*j);else for(var n=1;n<b.length;n++){var q=b[n],v=d[0]-q[0],r=d[1]-q[1];e=this._distanceSegmentPoint(q[0]-e[0],q[1]-e[1],k,j,v,r);if(e==0)return 0;
if(e<g)g=e;e=q;k=v;j=r}}return Math.sqrt(g)},_distanceSegmentPoint:function(b,d,g,e,k,j){var n=b*g+d*e;if(n<=0)return g*g+e*e;b=b*b+d*d;if(n>=b)return k*k+j*j;return g*g+e*e-n*n/b},_distanceLineStringLineString:function(b,d){for(var g=a,e=0;e<d.length;e++)g=Math.min(g,this._distanceLineStringPoint(b,d[e]));return g},_flatten:function(b){var d=[],g=0;switch(b.type){case "Feature":f.merge(d,this._flatten(b.geometry));break;case "FeatureCollection":for(;g<b.features.length;g++)f.merge(d,this._flatten(b.features[g].geometry));
break;case "GeometryCollection":for(;g<b.geometries.length;g++)f.merge(d,this._flatten(b.geometries[g]));break;default:d[0]=b}return d},_WKT:function(){function b(e){if(e&&e.length){for(var k=[],j=0;j<e.length;j++)k.push(e[j].join(" "));return"("+k+")"}else return"EMPTY"}function d(e){if(e&&e.length){for(var k=[],j=0;j<e.length;j++)k.push(b(e[j]));return"("+k+")"}else return"EMTPY"}function g(e){if(e&&e.type)switch(e.type){case "Point":return"POINT "+(e.coordinates&&e.coordinates.length?"("+e.coordinates.join(" ")+
")":"EMPTY");case "LineString":return"LINESTRING "+b(e.coordinates);case "Polygon":return"POLYGON "+d(e.coordinates);case "MultiPoint":return"MULTIPOINT "+b(e.coordinates);case "MultiLineString":return"MULTILINSTRING "+d(e.coordinates);case "MultiPolygon":if((e=e.coordinates)&&e.length){for(var k=[],j=0;j<e.length;j++)k.push(d(e[j]));e="("+k+")"}else e="EMPTY";return"MULTIPOLYGON "+e;case "GeometryCollection":if((e=e.geometries)&&e.length){k=[];for(j=0;j<e.length;j++)k.push(g(e[j]));e="("+e+")"}else e=
"EMPTY";return"GEOMETRYCOLLECTION "+e;default:return""}else return""}return{stringify:g,parse:function(e){e=f.trim(e);var k=e.indexOf(" ");switch(e.substr(0,k).toUpperCase()){case "POINT":return(e=e.substr(k+1).match(/\(\s*([\d\.-]+)\s+([\d\.-]+)\s*\)/))&&e.length>=2?{type:"Point",coordinates:[parseFloat(e[1]),parseFloat(e[2])]}:null}}}}(),proj:function(){return{fromGeodeticPos:function(b){return[6378137*b[0]*0.017453292519943295,6378137*Math.log(Math.tan(0.7853981633974483+b[1]*0.017453292519943295/
2))]},fromGeodetic:function(b){var d=f.isArray(b[0]),g=this.fromGeodeticPos;if(!d&&b.length==4){d=g([b[0],b[1]]);b=g([b[2],b[3]]);return[d[0],d[1],b[0],b[1]]}else{var e=d&&f.isArray(b[0][0]),k=e&&f.isArray(b[0][0][0]),j=[[[]]];if(!k){if(!e){d||(b=[b]);b=[b]}b=[b]}f.each(b,function(n){f.each(this,function(q){f.each(this,function(v){j[n][q][v]=g(this)})})});return k?j:e?j[0]:d?j[0][0]:j[0][0][0]}},toGeodeticPos:function(b){return[b[0]/6378137*57.29577951308232,(1.5707963267948966-2*Math.atan(1/Math.exp(b[1]/
6378137)))*57.29577951308232]},toGeodetic:function(b){var d=f.isArray(b[0]),g=this.toGeodeticPos;if(!d&&b.length==4){d=g([b[0],b[1]]);b=g([b[2],b[3]]);return[d[0],d[1],b[0],b[1]]}else{var e=d&&f.isArray(b[0][0]),k=e&&f.isArray(b[0][0][0]),j=[[[]]];if(!k){if(!e){d||(b=[b]);b=[b]}b=[b]}f.each(b,function(n){f.each(this,function(q){f.each(this,function(v){j[n][q][v]=g(this)})})});return k?j:e?j[0]:d?j[0][0]:j[0][0][0]}}}}(),_serviceTypes:{}}})(jQuery,this);
(function(f,p){var m=function(){for(var a=5,c=document.createElement("div"),b=c.all||[];c.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",b[0];);return a>6?a:!a}();f.widget("geo.geographics",{_$elem:p,_options:{},_trueCanvas:true,_width:0,_height:0,_$canvas:p,_context:p,options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:0.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"}},_create:function(){this._$elem=this.element;this._options=this.options;
this._$elem.css({display:"inline-block",overflow:"hidden",textAlign:"left"});this._$elem.css("position")=="static"&&this._$elem.css("position","relative");this._width=this._$elem.width();this._height=this._$elem.height();if(!(this._width&&this._height)){this._width=parseInt(this._$elem.css("width"));this._height=parseInt(this._$elem.css("height"))}if(document.createElement("canvas").getContext){this._$elem.append('<canvas width="'+this._width+'" height="'+this._height+'" style="position:absolute; left:0; top:0; width:'+
this._width+"px; height:"+this._height+'px;"></canvas>');this._$canvas=this._$elem.children(":last");this._context=this._$canvas[0].getContext("2d")}else if(m<=8){this._trueCanvas=false;this._$elem.append('<div width="'+this._width+'" height="'+this._height+'" style="position:absolute; left:0; top:0; width:'+this._width+"px; height:"+this._height+'px; margin:0; padding:0;"></div>');this._$canvas=this._$elem.children(":last");G_vmlCanvasManager.initElement(this._$canvas[0]);this._context=this._$canvas[0].getContext("2d");
this._$canvas.children().css({backgroundColor:"transparent",width:this._width,height:this._height})}},_setOption:function(a,c){if(a=="style")c=f.extend({},this._options.style,c);f.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){f.Widget.prototype.destroy.apply(this,arguments);this._$elem.html("")},clear:function(){this._context.clearRect(0,0,this._width,this._height)},drawArc:function(a,c,b,d){d=this._getGraphicStyle(d);if(d.visibility!="hidden"&&d.opacity>0&&d.widthValue>0&&
d.heightValue>0){var g=Math.min(d.widthValue,d.heightValue)/2;c=c*Math.PI/180;b=b*Math.PI/180;this._context.save();this._context.translate(a[0],a[1]);d.widthValue>d.heightValue?this._context.scale(d.widthValue/d.heightValue,1):this._context.scale(1,d.heightValue/d.widthValue);this._context.beginPath();this._context.arc(0,0,g,c,b,false);this._trueCanvas&&this._context.restore();if(d.doFill){this._context.fillStyle=d.fill;this._context.globalAlpha=d.opacity*d.fillOpacity;this._context.fill()}if(d.doStroke){this._context.lineJoin=
"round";this._context.lineWidth=d.strokeWidthValue;this._context.strokeStyle=d.stroke;this._context.globalAlpha=d.opacity*d.strokeOpacity;this._context.stroke()}this._trueCanvas||this._context.restore()}},drawPoint:function(a,c){c=this._getGraphicStyle(c);if(c.widthValue==c.heightValue&&c.heightValue==c.borderRadiusValue)this.drawArc(a,0,360,c);else if(c.visibility!="hidden"&&c.opacity>0){c.borderRadiusValue=Math.min(Math.min(c.widthValue,c.heightValue)/2,c.borderRadiusValue);a[0]-=c.widthValue/2;
a[1]-=c.heightValue/2;this._context.beginPath();this._context.moveTo(a[0]+c.borderRadiusValue,a[1]);this._context.lineTo(a[0]+c.widthValue-c.borderRadiusValue,a[1]);this._context.quadraticCurveTo(a[0]+c.widthValue,a[1],a[0]+c.widthValue,a[1]+c.borderRadiusValue);this._context.lineTo(a[0]+c.widthValue,a[1]+c.heightValue-c.borderRadiusValue);this._context.quadraticCurveTo(a[0]+c.widthValue,a[1]+c.heightValue,a[0]+c.widthValue-c.borderRadiusValue,a[1]+c.heightValue);this._context.lineTo(a[0]+c.borderRadiusValue,
a[1]+c.heightValue);this._context.quadraticCurveTo(a[0],a[1]+c.heightValue,a[0],a[1]+c.heightValue-c.borderRadiusValue);this._context.lineTo(a[0],a[1]+c.borderRadiusValue);this._context.quadraticCurveTo(a[0],a[1],a[0]+c.borderRadiusValue,a[1]);this._context.closePath();if(c.doFill){this._context.fillStyle=c.fill;this._context.globalAlpha=c.opacity*c.fillOpacity;this._context.fill()}if(c.doStroke){this._context.lineJoin="round";this._context.lineWidth=c.strokeWidthValue;this._context.strokeStyle=c.stroke;
this._context.globalAlpha=c.opacity*c.strokeOpacity;this._context.stroke()}}},drawLineString:function(a,c){this._drawLines([a],false,c)},drawPolygon:function(a,c){this._drawLines(a,true,c)},drawBbox:function(a,c){this._drawLines([[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]],[a[0],a[1]]]],true,c)},_getGraphicStyle:function(a){function c(b){b=parseInt(b);return+b+""===b?+b:b}a=f.extend({},this._options.style,a);a.borderRadiusValue=c(a.borderRadius);a.fill=a.fill||a.color;a.doFill=a.fill&&a.fillOpacity>
0;a.stroke=a.stroke||a.color;a.strokeWidthValue=c(a.strokeWidth);a.doStroke=a.stroke&&a.strokeOpacity>0&&a.strokeWidthValue>0;a.widthValue=c(a.width);a.heightValue=c(a.height);return a},_drawLines:function(a,c,b){if(!(!a||!a.length||a[0].length<2)){b=this._getGraphicStyle(b);var d,g;if(b.visibility!="hidden"&&b.opacity>0){this._context.beginPath();this._context.moveTo(a[0][0][0],a[0][0][1]);var e=a[0][a[0].length-1];for(d=0;d<a.length;d++){for(g=0;g<a[d].length;g++)this._context.lineTo(a[d][g][0],
a[d][g][1]);if(c&&d>0){this._context.lineTo(e[0],e[1]);this._context.closePath()}}if(c&&b.doFill){this._context.fillStyle=b.fill;this._context.globalAlpha=b.opacity*b.fillOpacity;this._context.fill()}if(b.doStroke){this._context.lineJoin="round";this._context.lineWidth=b.strokeWidthValue;this._context.strokeStyle=b.stroke;this._context.globalAlpha=b.opacity*b.strokeOpacity;this._context.stroke()}}}}})})(jQuery);
(function(f,p){var m=function(){for(var a=5,c=document.createElement("div"),b=c.all||[];c.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",b[0];);return a>6?a:!a}();f.widget("geo.geomap",{_$elem:p,_created:false,_contentBounds:{},_$contentFrame:p,_$existingChildren:p,_$servicesContainer:p,_$drawContainer:p,_$shapesContainer:p,_$textContainer:p,_$textContent:p,_$eventTarget:p,_dpi:96,_currentServices:[],_center:p,_pixelSize:p,_centerMax:p,_pixelSizeMax:p,_wheelZoomFactor:1.18920711500273,_wheelTimeout:null,
_wheelLevel:0,_zoomFactor:2,_mouseDown:p,_inOp:p,_toolPan:p,_shiftZoom:p,_anchor:p,_current:p,_downDate:p,_moveDate:p,_clickDate:p,_lastMove:p,_lastDrag:p,_windowHandler:null,_resizeTimeout:null,_panning:p,_velocity:p,_friction:p,_supportTouch:p,_softDblClick:p,_isTap:p,_isDbltap:p,_drawTimeout:null,_drawPixels:[],_drawCoords:[],_graphicShapes:[],_initOptions:{},_options:{},options:f.extend({},{bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{pan:"move",zoom:"crosshair",drawPoint:"crosshair",
drawLineString:"crosshair",drawPolygon:"crosshair"},drawStyle:{},mode:"pan",services:[{id:"OSM",type:"tiled",getUrl:function(a){return"http://tile.openstreetmap.org/"+a.zoom+"/"+a.tile.column+"/"+a.tile.row+".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},zoom:0}),_createWidget:function(a,c){this._$elem=f(c);if(!this._$elem.is("[data-geo-service]")){this._$elem.attr("data-geo-map",
"data-geo-map");this._graphicShapes=[];this._initOptions=a;this._forcePosition(this._$elem);this._$elem.css("text-align","left");var b=this._findMapSize();this._contentBounds={x:parseInt(this._$elem.css("padding-left")),y:parseInt(this._$elem.css("padding-top")),width:b.width,height:b.height};this._createChildren();this._center=this._centerMax=[0,0];this._pixelSize=this._pixelSizeMax=156543.03392799935;this._mouseDown=this._inOp=this._toolPan=this._shiftZoom=this._panning=this._isTap=this._isDbltap=
false;this._anchor=this._current=this._lastMove=this._lastDrag=this._velocity=[0,0];this._friction=[0.8,0.8];this._downDate=this._moveDate=this._clickDate=0}f.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){if(!this._$elem.is("[data-geo-service]")){this._options=this.options;this._softDblClick=(this._supportTouch="ontouchend"in document)||m==7;var a=this._supportTouch?"touchstart":"mousedown",c=this._supportTouch?"touchend touchcancel":"mouseup",b=this._supportTouch?"touchmove":
"mousemove";f(document).keydown(f.proxy(this._document_keydown,this));this._$eventTarget.dblclick(f.proxy(this._eventTarget_dblclick,this));this._$eventTarget.bind(a,f.proxy(this._eventTarget_touchstart,this));a=this._$eventTarget[0].setCapture?this._$eventTarget:f(document);a.bind(b,f.proxy(this._dragTarget_touchmove,this));a.bind(c,f.proxy(this._dragTarget_touchstop,this));this._$eventTarget.mousewheel(f.proxy(this._eventTarget_mousewheel,this));var d=this;this._windowHandler=function(){d._resizeTimeout&&
clearTimeout(d._resizeTimeout);this._resizeTimeout=setTimeout(function(){d._created&&d._$elem.geomap("resize")},500)};f(window).resize(this._windowHandler);this._$drawContainer.geographics({style:this._initOptions.drawStyle||{}});this._options.drawStyle=this._$drawContainer.geographics("option","style");this._$shapesContainer.geographics();if(this._initOptions){this._initOptions.bbox&&this._setOption("bbox",this._initOptions.bbox,false);this._initOptions.center&&this._setOption("center",this._initOptions.center,
false);this._initOptions.zoom&&this._setZoom(this._initOptions.zoom,false,false)}this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._createServices();this._refresh();this._created=true}},_setOption:function(a,c,b){if(!this._$elem.is("[data-geo-service]")){b=b===p||b;switch(a){case "bbox":if(f.geo.proj){c=f.geo.proj.fromGeodetic([[c[0],c[1]],[c[2],c[3]]]);c=[c[0][0],c[0][1],c[1][0],c[1][1]]}this._setBbox(c,false,b);c=this._getBbox();if(f.geo.proj){c=f.geo.proj.toGeodetic([[c[0],
c[1]],[c[2],c[3]]]);c=[c[0][0],c[0][1],c[1][0],c[1][1]]}break;case "center":this._setCenterAndSize(f.geo.proj?f.geo.proj.fromGeodetic([[c[0],c[1]]])[0]:c,this._pixelSize,false,b);break;case "drawStyle":if(this._$drawContainer){this._$drawContainer.geographics("option","style",c);c=this._$drawContainer.geographics("option","style")}break;case "mode":this._$drawContainer.geographics("clear");this._$eventTarget.css("cursor",this._options.cursors[c]);break;case "zoom":this._setZoom(c,false,b)}f.Widget.prototype._setOption.apply(this,
arguments);switch(a){case "services":this._createServices();b&&this._refresh()}}},destroy:function(){if(this._$elem.is("[data-geo-map]")){this._created=false;f(window).unbind("resize",this._windowHandler);for(var a=0;a<this._currentServices.length;a++){this._currentServices[a].serviceContainer.geomap("destroy");f.geo._serviceTypes[this._currentServices[a].type].destroy(this,this._$servicesContainer,this._currentServices[a])}this._$shapesContainer.geographics("destroy");this._$drawContainer.geographics("destroy");
this._$existingChildren.detach();this._$elem.html("");this._$elem.append(this._$existingChildren);this._$elem.removeAttr("data-geo-map")}f.Widget.prototype.destroy.apply(this,arguments)},pixelSize:function(){return this._pixelSize},toMap:function(a){a=this._toMap(a);return f.geo.proj?f.geo.proj.toGeodetic(a):a},toPixel:function(a,c,b){a=f.geo.proj?f.geo.proj.fromGeodetic(a):a;return this._toPixel(a,c,b)},opacity:function(a,c){if(this._$elem.is("[data-geo-service]"))this._$elem.closest("[data-geo-map]").geomap("opacity",
a,this._$elem);else if(a>=0||a<=1)for(var b=0;b<this._currentServices.length;b++){var d=this._currentServices[b];if(!c||d.serviceContainer[0]==c[0]){this._options.services[b].opacity=d.opacity=a;f.geo._serviceTypes[d.type].opacity(this,d)}}},toggle:function(a,c){if(this._$elem.is("[data-geo-service]"))this._$elem.closest("[data-geo-map]").geomap("toggle",a,this._$elem);else for(var b=0;b<this._currentServices.length;b++){var d=this._currentServices[b];if(!c||d.serviceContainer[0]==c[0]){if(a===p)a=
d.visibility===p||d.visibility==="visible"?false:true;this._options.services[b].visibility=d.visibility=a?"visible":"hidden";f.geo._serviceTypes[d.type].toggle(this,d);a&&f.geo._serviceTypes[d.type].refresh(this,d)}}},zoom:function(a){a!=null&&this._setZoom(this._options.zoom+a,false,true)},refresh:function(){this._refresh()},resize:function(){var a=this._findMapSize(),c=a.width/2-this._contentBounds.width/2,b=a.height/2-this._contentBounds.height/2,d;this._contentBounds={x:parseInt(this._$elem.css("padding-left")),
y:parseInt(this._$elem.css("padding-top")),width:a.width,height:a.height};this._$contentFrame.css({width:a.width,height:a.height});this._$servicesContainer.css({width:a.width,height:a.height});this._$eventTarget.css({width:a.width,height:a.height});var g=this._$shapesContainer.geographics("option","style");this._$shapesContainer.geographics("destroy");this._$drawContainer.geographics("destroy");for(d=0;d<this._currentServices.length;d++)f.geo._serviceTypes[this._currentServices[d].type].resize(this,
this._currentServices[d]);this._$drawContainer.css({width:a.width,height:a.height});this._$drawContainer.geographics();this._$shapesContainer.css({width:a.width,height:a.height});this._$shapesContainer.geographics({style:g});for(d=0;d<this._drawPixels.length;d++){this._drawPixels[d][0]+=c;this._drawPixels[d][1]+=b}this._setCenterAndSize(this._center,this._pixelSize,false,true)},shapeStyle:function(a){if(a){this._$shapesContainer.geographics("option","style",a);this._refresh()}else return this._$shapesContainer.geographics("option",
"style")},append:function(a,c,b){b=b===p||b;if(a){var d=this;a=a.type=="FeatureCollection"?a.features:f.isArray(a)?a:[a];f.each(a,function(){d._graphicShapes[d._graphicShapes.length]={shape:this,style:c}});b&&this._refresh()}},empty:function(){this._graphicShapes=[];this._refresh()},find:function(a,c){this.toPixel(a.coordinates);var b=this._pixelSize*c,d=[],g;f.each(this._graphicShapes,function(){if(this.shape.type=="Point")f.geo.distance(this.shape,a,true)<=b&&d.push(this.shape);else{var e=f.geo.bbox(this.shape);
if(f.geo.distance({type:"Polygon",coordinates:[[[e[0],e[1]],[e[0],e[3]],[e[2],e[3]],[e[2],e[1]],[e[0],e[1]]]]},a,true)<=b){e=f.geo._flatten(this.shape);for(g=0;g<e.length;g++)if(f.geo.distance(e[g],a,true)<=b){d.push(this.shape);break}}}});return d},remove:function(a){var c=this;f.each(this._graphicShapes,function(b){if(this.shape==a){var d=c._graphicShapes.slice(b+1||c._graphicShapes.length);c._graphicShapes.length=b<0?c._graphicShapes.length+b:b;c._graphicShapes.push.apply(c._graphicShapes,d);return false}});
this._refresh()},_getBbox:function(a,c){a=a||this._center;c=c||this._pixelSize;var b=this._contentBounds.width/2*c,d=this._contentBounds.height/2*c;return[a[0]-b,a[1]-d,a[0]+b,a[1]+d]},_setBbox:function(a,c,b){var d=[a[0]+(a[2]-a[0])/2,a[1]+(a[3]-a[1])/2];a=Math.max(f.geo.width(a,true)/this._contentBounds.width,f.geo.height(a,true)/this._contentBounds.height);if(this._options.tilingScheme)a=this._getTiledPixelSize(this._getTiledZoom(a));this._setCenterAndSize(d,a,c,b)},_getBboxMax:function(){var a=
this._contentBounds.width/2*this._pixelSizeMax,c=this._contentBounds.height/2*this._pixelSizeMax;return[this._centerMax[0]-a,this._centerMax[1]-c,this._centerMax[0]+a,this._centerMax[1]+c]},_getCenter:function(){return this._center},_getContentBounds:function(){return this._contentBounds},_getServicesContainer:function(){return this._$servicesContainer},_getZoom:function(){if(this._options.tilingScheme)return this._getTiledZoom(this._pixelSize);else{var a=this._contentBounds.width/this._contentBounds.height,
c=f.geo.reaspect(this._getBbox(),a,true);a=f.geo.reaspect(this._getBboxMax(),a,true);return Math.log(f.geo.width(a,true)/f.geo.width(c,true))/Math.log(this._zoomFactor)}},_setZoom:function(a,c,b){a=Math.max(a,0);if(this._options.tilingScheme)this._setCenterAndSize(this._center,this._getTiledPixelSize(a),c,b);else{a=f.geo.scaleBy(this._getBboxMax(),1/Math.pow(this._zoomFactor,a),true);this._setCenterAndSize(this._center,Math.max(f.geo.width(a,true)/this._contentBounds.width,f.geo.height(a,true)/this._contentBounds.height),
c,b)}},_createChildren:function(){this._$existingChildren=this._$elem.children().detach();this._forcePosition(this._$existingChildren);this._$existingChildren.css("-moz-user-select","none");this._$elem.prepend("<div style='position:absolute; left:"+this._contentBounds.x+"px; top:"+this._contentBounds.y+"px; width:"+this._contentBounds.width+"px; height:"+this._contentBounds.height+"px; margin:0; padding:0; overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;' unselectable='on'></div>");
this._$eventTarget=this._$contentFrame=this._$elem.children(":first");this._$contentFrame.append('<div style="position:absolute; left:0; top:0; width:'+this._contentBounds.width+"px; height:"+this._contentBounds.height+'px; margin:0; padding:0;"></div>');this._$servicesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div style="position:absolute; left:0; top:0; width:'+this._contentBounds.width+"px; height:"+this._contentBounds.height+'px; margin:0; padding:0;"></div>');
this._$shapesContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div style="position:absolute; left:0; top:0; width:'+this._contentBounds.width+"px; height:"+this._contentBounds.height+'px; margin:0; padding:0;"></div>');this._$drawContainer=this._$contentFrame.children(":last");this._$contentFrame.append('<div class="ui-widget ui-widget-content ui-corner-all" style="position:absolute; left:0; top:0px; max-width:128px; display:none;"><div style="margin:.2em;"></div></div>');
this._$textContainer=this._$contentFrame.children(":last");this._$textContent=this._$textContainer.children();this._$contentFrame.append(this._$existingChildren)},_createServices:function(){var a;for(a=0;a<this._currentServices.length;a++){this._currentServices[a].serviceContainer.geomap("destroy");f.geo._serviceTypes[this._currentServices[a].type].destroy(this,this._$servicesContainer,this._currentServices[a])}this._currentServices=[];for(a=0;a<this._options.services.length;a++){this._currentServices[a]=
f.extend({},this._options.services[a]);this._currentServices[a].serviceContainer=f.geo._serviceTypes[this._currentServices[a].type].create(this,this._$servicesContainer,this._currentServices[a],a).geomap()}},_refreshDrawing:function(){this._$drawContainer.geographics("clear");if(this._drawPixels.length>0){var a;if(this._options.mode=="drawLineString")this._$drawContainer.geographics("drawLineString",this._drawPixels);else{a=f.merge([],this._drawPixels);a.push(a);this._$drawContainer.geographics("drawPolygon",
a)}}},_resetDrawing:function(){this._drawPixels=[];this._drawCoords=[];this._$drawContainer.geographics("clear")},_refreshShapes:function(a,c,b,d,g){var e,k,j,n,q,v=this._getBbox(d,g),r=this;for(e=0;e<c.length;e++){j=c[e].shape||c[e];j=j.geometry||j;k=f.data(j,"geoBbox");if(!(k&&!f.geo._in(v,k))){n=f.isArray(b)?b[e].style:b;switch(j.type){case "Point":this._$shapesContainer.geographics("drawPoint",this.toPixel(j.coordinates,d,g),n);break;case "LineString":this._$shapesContainer.geographics("drawLineString",
this.toPixel(j.coordinates,d,g),n);break;case "Polygon":q=[];f.each(j.coordinates,function(y){q[y]=r.toPixel(this,d,g)});this._$shapesContainer.geographics("drawPolygon",q,n);break;case "MultiPoint":for(k=0;k<j.coordinates;k++)this._$shapesContainer.geographics("drawPoint",this.toPixel(j.coordinates[k],d,g),n);break;case "MultiLineString":for(k=0;k<j.coordinates;k++)this._$shapesContainer.geographics("drawLineString",this.toPixel(j.coordinates[k],d,g),n);break;case "MultiPolygon":for(k=0;k<j.coordinates;k++){q=
[];f.each(j.coordinates[k],function(y){q[y]=r.toPixel(this,d,g)});this._$shapesContainer.geographics("drawPolygon",q,n)}break;case "GeometryCollection":r._refreshShapes(a,j.geometries,n,d,g)}}}},_findMapSize:function(){for(var a={width:0,height:0},c=this._$elem;c.size()&&!(a.width>0&&a.height>0);){a={width:c.width(),height:c.height()};if(a.width<=0||a.height<=0)a={width:parseInt(c.css("width")),height:parseInt(c.css("height"))};c=c.parent()}return a},_forcePosition:function(a){var c=a.css("position");
c!="relative"&&c!="absolute"&&c!="fixed"&&a.css("position","relative")},_getTiledPixelSize:function(a){var c=this._options.tilingScheme;if(c!=null){if(a===0)return c.pixelSizes!=null?c.pixelSizes[0]:c.basePixelSize;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,(c.pixelSizes!=null?c.pixelSizes.length:c.levels)-1);return c.pixelSizes!=null?c.pixelSizes[a]:c.basePixelSize/Math.pow(2,a)}else return NaN},_getTiledZoom:function(a){var c=this._options.tilingScheme;if(c.pixelSizes!=null){a=Math.floor(a*1E3);
for(var b=(c.pixelSizes!=null?c.pixelSizes.length:c.levels)-1;b>=0;b--)if(Math.floor(c.pixelSizes[b]*1E3)>=a)return b;return 0}else return Math.max(Math.round(Math.log(c.basePixelSize/a)/Math.log(2)),0)},_getZoomCenterAndSize:function(a,c,b){if(this._options.tilingScheme){c=this._getTiledZoom(this._pixelSize)+c;c=this._getTiledPixelSize(c)}else{c=Math.pow(b,-c);c=this._pixelSize*c}b=c/this._pixelSize;a=this._toMap(a);b=[(this._center[0]-a[0])*b,(this._center[1]-a[1])*b];return{pixelSize:c,center:[a[0]+
b[0],a[1]+b[1]]}},_mouseWheelFinish:function(){this._wheelTimeout=null;if(this._wheelLevel!=0){var a=this._getZoomCenterAndSize(this._anchor,this._wheelLevel,this._wheelZoomFactor);this._setCenterAndSize(a.center,a.pixelSize,true,true);this._wheelLevel=0}else this._refresh()},_panEnd:function(){this._velocity=[this._velocity[0]>0?Math.floor(this._velocity[0]*this._friction[0]):Math.ceil(this._velocity[0]*this._friction[0]),this._velocity[1]>0?Math.floor(this._velocity[1]*this._friction[1]):Math.ceil(this._velocity[1]*
this._friction[1])];if(Math.abs(this._velocity[0])<4&&Math.abs(this._velocity[1])<4)this._panFinalize();else{this._current=[this._current[0]+this._velocity[0],this._current[1]+this._velocity[1]];this._panMove();setTimeout(f.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(this._panning){this._velocity=[0,0];var a=-(this._current[0]-this._anchor[0])*this._pixelSize,c=(this._current[1]-this._anchor[1])*this._pixelSize;this._$shapesContainer.css({left:0,top:0});this._setCenterAndSize([this._center[0]+
a,this._center[1]+c],this._pixelSize,true,true);this._inOp=false;this._anchor=this._current;this._toolPan=this._panning=false;this._$eventTarget.css("cursor",this._options.cursors[this._options.mode])}},_panMove:function(){var a=this._current[0]-this._lastDrag[0],c=this._current[1]-this._lastDrag[1],b=0,d;if(this._toolPan||a>3||a<-3||c>3||c<-3){if(!this._toolPan){this._toolPan=true;this._$eventTarget.css("cursor",this._options.cursors.pan)}if(this._mouseDown)this._velocity=[a,c];if(a!=0||c!=0){this._panning=
true;this._lastDrag=this._current;for(b=0;b<this._options.services.length;b++){d=this._options.services[b];f.geo._serviceTypes[d.type].interactivePan(this,d,a,c)}this._$shapesContainer.css({left:function(g,e){return parseInt(e)+a},top:function(g,e){return parseInt(e)+c}});for(b=0;b<this._drawPixels.length;b++){this._drawPixels[b][0]+=a;this._drawPixels[b][1]+=c}this._refreshDrawing()}}},_refresh:function(){for(var a=0;a<this._options.services.length;a++){var c=this._options.services[a];!this._mouseDown&&
f.geo._serviceTypes[c.type]!=null&&f.geo._serviceTypes[c.type].refresh(this,c)}if(this._$shapesContainer){this._$shapesContainer.geographics("clear");this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes)}},_setCenterAndSize:function(a,c,b,d){if(this._pixelSize!=c){this._$shapesContainer.geographics("clear");for(var g=0;g<this._options.services.length;g++){var e=this._options.services[g];f.geo._serviceTypes[e.type].interactiveScale(this,e,
a,c)}}this._center=a;this._pixelSize=c;if(f.geo.proj){a=this._getBbox();a=f.geo.proj.toGeodetic([[a[0],a[1]],[a[2],a[3]]]);a=[a[0][0],a[0][1],a[1][0],a[1][1]];this._options.bbox=a;this._options.center=f.geo.proj.toGeodetic([[this._center[0],this._center[1]]])[0]}else{this._options.bbox=this._getBbox();this._options.center=this._center}this._options.zoom=this._getZoom();if(this._drawCoords.length>0)this._drawPixels=this._toPixel(this._drawCoords);b&&this._trigger("bboxchange",window.event,{bbox:this._options.bbox});
if(d){this._refresh();this._refreshDrawing()}},_toMap:function(a,c,b){var d=f.isArray(a[0]);d||(a=[a]);c=c||this._center;b=b||this._pixelSize;var g=this._contentBounds.width,e=this._contentBounds.height,k=g/2*b;b=e/2*b;var j=[c[0]-k,c[1]-b,c[0]+k,c[1]+b],n=f.geo.width(j,true)/g,q=f.geo.height(j,true)/e,v=[];f.each(a,function(r){v[r]=[j[0]+this[0]*n,j[3]-this[1]*q]});return d?v:v[0]},_toPixel:function(a,c,b){var d=f.isArray(a[0]);d||(a=[a]);c=c||this._center;b=b||this._pixelSize;var g=this._contentBounds.width,
e=this._contentBounds.height,k=g/2*b;b=e/2*b;var j=[c[0]-k,c[1]-b,c[0]+k,c[1]+b],n=f.geo.width(j,true),q=f.geo.height(j,true),v=[];f.each(a,function(r){v[r]=[Math.round((this[0]-j[0])*g/n),Math.round((j[3]-this[1])*e/q)]});return d?v:v[0]},_zoomTo:function(a,c,b,d){c=c<0?0:c;var g=this._getTiledPixelSize(c);if(isNaN(g)){c=f.geo._scaleBy(this._getBboxMax(),1/Math.pow(this._zoomFactor,c),true);c=Math.max(f.geo.width(c,true)/this._contentBounds.width,f.geo.height(c,true)/this._contentBounds.height);
this._setCenterAndSize(a,c,b,d)}else this._setCenterAndSize(a,g,b,d)},_document_keydown:function(a){var c=this._drawCoords.length;if(c>0&&a.which==27)if(c<=2){this._resetDrawing();this._inOp=false}else{this._drawCoords[c-2]=f.merge([],this._drawCoords[c-1]);this._drawPixels[c-2]=f.merge([],this._drawPixels[c-1]);this._drawCoords.length--;this._drawPixels.length--;this._refreshDrawing()}},_eventTarget_dblclick_zoom:function(a){this._trigger("dblclick",a,{type:"Point",coordinates:this.toMap(this._current)});
if(!a.isDefaultPrevented()){a=this._getZoomCenterAndSize(this._current,1,this._zoomFactor);this._setCenterAndSize(a.center,a.pixelSize,true,true)}},_eventTarget_dblclick:function(a){this._panFinalize();if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}f(a.currentTarget).offset();switch(this._options.mode){case "pan":case "drawPoint":this._eventTarget_dblclick_zoom(a);break;case "drawLineString":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&
this._drawCoords[0][1]==this._drawCoords[1][1])){this._drawCoords.length--;this._trigger("shape",a,{type:"LineString",coordinates:f.geo.proj?f.geo.proj.toGeodetic(this._drawCoords):this._drawCoords})}else this._eventTarget_dblclick_zoom(a);this._resetDrawing();break;case "drawPolygon":if(this._drawCoords.length>1&&!(this._drawCoords[0][0]==this._drawCoords[1][0]&&this._drawCoords[0][1]==this._drawCoords[1][1])){var c=this._drawCoords.length-1;if(c>2){this._drawCoords[c]=f.merge([],this._drawCoords[0]);
this._trigger("shape",a,{type:"Polygon",coordinates:[f.geo.proj?f.geo.proj.toGeodetic(this._drawCoords):this._drawCoords]})}}else this._eventTarget_dblclick_zoom(a);this._resetDrawing()}this._inOp=false},_eventTarget_touchstart:function(a){if(!(!this._supportTouch&&a.which!=1)){this._panFinalize();this._mouseWheelFinish();var c=f(a.currentTarget).offset();this._current=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-c.left,a.originalEvent.changedTouches[0].pageY-c.top]:[a.pageX-c.left,
a.pageY-c.top];if(this._softDblClick){c=f.now();if(c-this._downDate<750){if(this._isTap){var b=this._current[0]-this._anchor[0],d=this._current[1]-this._anchor[1];if(Math.sqrt(b*b+d*d)>10)this._isTap=false;else this._current=this._anchor}this._isDbltap=this._isDbltap?false:this._isTap}else this._isDbltap=false;this._isTap=true;this._downDate=c}a.preventDefault();this._mouseDown=true;this._anchor=this._current;if(!this._inOp&&a.shiftKey){this._shiftZoom=true;this._$eventTarget.css("cursor",this._options.cursors.zoom)}else{this._inOp=
true;switch(this._options.mode){case "pan":case "drawPoint":case "drawLineString":case "drawPolygon":this._lastDrag=this._current;a.currentTarget.setCapture&&a.currentTarget.setCapture()}}return false}},_dragTarget_touchmove:function(a){var c=this._$eventTarget.offset(),b=this._drawCoords.length;c=this._supportTouch?[a.originalEvent.changedTouches[0].pageX-c.left,a.originalEvent.changedTouches[0].pageY-c.top]:[a.pageX-c.left,a.pageY-c.top];if(!(c[0]==this._lastMove[0]&&c[1]==this._lastMove[1])){if(this._softDblClick)this._isDbltap=
this._isTap=false;if(this._mouseDown){this._current=c;this._moveDate=f.now()}switch(this._shiftZoom?"zoom":this._options.mode){case "zoom":if(this._mouseDown){this._$drawContainer.geographics("clear");this._$drawContainer.geographics("drawBbox",[this._anchor[0],this._anchor[1],c[0],c[1]])}else this._trigger("move",a,{type:"Point",coordinates:this.toMap(c)});break;case "pan":case "drawPoint":this._mouseDown||this._toolPan?this._panMove():this._trigger("move",a,{type:"Point",coordinates:this.toMap(c)});
break;case "drawLineString":case "drawPolygon":if(this._mouseDown||this._toolPan)this._panMove();else{if(b>0){this._drawCoords[b-1]=this._toMap(c);this._drawPixels[b-1]=c;this._refreshDrawing()}this._trigger("move",a,{type:"Point",coordinates:this.toMap(c)})}}this._lastMove=c}},_dragTarget_touchstop:function(a){!this._mouseDown&&m==7&&this._eventTarget_touchstart(a);var c=this._mouseDown,b=this._toolPan,d=this._$eventTarget.offset(),g=this._shiftZoom?"zoom":this._options.mode,e,k;e=this._supportTouch?
[a.originalEvent.changedTouches[0].pageX-d.left,a.originalEvent.changedTouches[0].pageY-d.top]:[a.pageX-d.left,a.pageY-d.top];d=e[0]-this._anchor[0];k=e[1]-this._anchor[1];this._$eventTarget.css("cursor",this._options.cursors[this._options.mode]);this._shiftZoom=this._mouseDown=this._toolPan=false;document.releaseCapture&&document.releaseCapture();if(c){c=f.now();this._current=e;switch(g){case "zoom":if(d>0||k>0){b=this._pixelSize*6;g=this._toMap([[Math.min(this._anchor[0],e[0]),Math.max(this._anchor[1],
e[1])],[Math.max(this._anchor[0],e[0]),Math.min(this._anchor[1],e[1])]]);g=[g[0][0],g[0][1],g[1][0],g[1][1]];if(g[2]-g[0]<b&&g[3]-g[1]<b)g=f.geo.scaleBy(this._getBbox(f.geo.center(g,true)),0.5,true);this._setBbox(g,true,true)}this._resetDrawing();break;case "pan":if(b)this._panEnd();else if(c-this._clickDate>100){this._trigger("click",a,{type:"Point",coordinates:this.toMap(e)});this._inOp=false}break;case "drawPoint":if(this._drawTimeout){window.clearTimeout(this._drawTimeout);this._drawTimeout=null}if(b)this._panFinalize();
else if(c-this._clickDate>100){var j=this;this._drawTimeout=setTimeout(function(){if(j._drawTimeout){j._trigger("shape",a,{type:"Point",coordinates:j.toMap(e)});j._inOp=false;j._drawTimeout=false}},250)}break;case "drawLineString":case "drawPolygon":if(b)this._panFinalize();else{b=this._drawCoords.length==0?0:this._drawCoords.length-1;this._drawCoords[b]=this._toMap(e);this._drawPixels[b]=e;if(b<2||!(this._drawCoords[b][0]==this._drawCoords[b-1][0]&&this._drawCoords[b][1]==this._drawCoords[b-1][1])){this._drawCoords[b+
1]=this._toMap(e);this._drawPixels[b+1]=e}this._refreshDrawing()}}this._clickDate=c;if(this._softDblClick&&this._isDbltap){this._isDbltap=this._isTap=false;this._$eventTarget.trigger("dblclick",a)}}},_eventTarget_mousewheel:function(a,c){a.preventDefault();this._panFinalize();if(!this._mouseDown){if(c!=0){if(this._wheelTimeout){window.clearTimeout(this._wheelTimeout);this._wheelTimeout=null}else{var b=f(a.currentTarget).offset();this._anchor=[a.pageX-b.left,a.pageY-b.top]}this._wheelLevel+=c;b=this._getZoomCenterAndSize(this._anchor,
this._wheelLevel,this._wheelZoomFactor);this._$shapesContainer.geographics("clear");for(i=0;i<this._options.services.length;i++){var d=this._options.services[i];f.geo._serviceTypes[d.type].interactiveScale(this,d,b.center,b.pixelSize)}this._$shapesContainer.geographics("clear");this._graphicShapes.length>0&&this._refreshShapes(this._$shapesContainer,this._graphicShapes,this._graphicShapes,b.center,b.pixelSize);if(this._drawCoords.length>0){this._drawPixels=this._toPixel(this._drawCoords,b.center,
b.pixelSize);this._refreshDrawing()}var g=this;this._wheelTimeout=window.setTimeout(function(){g._mouseWheelFinish()},1E3)}return false}}})})(jQuery);
(function(f,p){f.geo._serviceTypes.tiled=function(){return{create:function(m,a,c){m=m._getServicesContainer().data("geoTiledServicesState")||{};if(!m[c.id]){m[c.id]={loadCount:0,reloadTiles:false,serviceContainer:null};a.append('<div data-geo-service="tiled" id="'+c.id+'" style="position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0; display:'+(c.visibility===p||c.visibility==="visible"?"block":"none")+';"></div>');m[c.id].serviceContainer=a.children(":last");a.data("geoTiledServicesState",
m)}return m[c.id].serviceContainer},destroy:function(m,a,c){m=m._getServicesContainer().data("geoTiledServicesState");m[c.id].serviceContainer.remove();delete m[c.id]},interactivePan:function(m,a,c,b){var d=m._getServicesContainer().data("geoTiledServicesState");if(d&&d[a.id]){this._cancelUnloaded(m,a);d[a.id].serviceContainer.children().css({left:function(u,K){return parseInt(K)+c},top:function(u,K){return parseInt(K)+b}});if(a&&d[a.id]!=null&&(a.visibility===p||a.visibility==="visible")){var g=
m.pixelSize(),e=d[a.id],k=e.serviceContainer;d=k.children("[data-pixelSize='"+g+"']");var j=m._getContentBounds(),n=m.options.tilingScheme,q=n.tileWidth,v=n.tileHeight,r=j.width/2*g,y=j.height/2*g,z=d.position(),A=d.data("scaleOrigin").split(",");j=parseInt(A[0])-z.left;z=parseInt(A[1])-z.top;var w=m._getCenter();A=[w[0]+j*g,w[1]-z*g];var F=Math.floor((A[0]-r-n.origin[0])/(g*q));j=Math.floor((n.origin[1]-(A[1]+y))/(g*v));z=Math.ceil((A[0]+r-n.origin[0])/(g*q));A=Math.ceil((n.origin[1]-(A[1]-y))/(g*
v));var G=m._getBboxMax(),E=m._getTiledPixelSize(0),C=E/g,B=Math.floor((G[0]-n.origin[0])/(E*q))*C;G=Math.floor((n.origin[1]-G[3])/(E*v))*C;r=Math.round((n.origin[0]+B*q*g-(w[0]-r))/g);y=Math.round((w[1]+y-(n.origin[1]-G*v*g))/g);var H=a.opacity===p?1:a.opacity;for(w=F;w<z;w++)for(F=j;F<A;F++){E=""+w+","+F;C=d.children("[data-tile='"+E+"']").removeAttr("data-dirty");if(C.size()===0){var I=[n.origin[0]+w*q*g,n.origin[1]-F*v*g],D=[n.origin[0]+((w+1)*q-1)*g,n.origin[1]-((F+1)*v-1)*g];I=a.getUrl({bbox:[I[0],
I[1],D[0],D[1]],width:q,height:v,zoom:m._getZoom(),tile:{row:F,column:w},index:Math.abs(F+w)});e.loadCount++;if(e.reloadTiles&&C.size()>0)C.attr("src",I);else{C="<img style='position:absolute; left:"+((w-B)*100+(r-r%q)/q*100)+"%; top:"+((F-G)*100+(y-y%v)/v*100)+"%; ";if(f("body")[0].filters===p)C+="width: 100%; height: 100%;";C+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+E+"' />";d.append(C);
C=d.children(":last");C.load(function(u){H<1?f(u.target).fadeTo(0,H):f(u.target).show();e.loadCount--;if(e.loadCount<=0){k.children(":not([data-pixelSize='"+g+"'])").remove();e.loadCount=0}}).error(function(u){f(u.target).remove();e.loadCount--;if(e.loadCount<=0){k.children(":not([data-pixelSize='"+g+"'])").remove();e.loadCount=0}}).attr("src",I)}}}}}},interactiveScale:function(m,a,c,b){var d=m._getServicesContainer().data("geoTiledServicesState");if(d&&d[a.id]){this._cancelUnloaded(m,a);var g=m.options.tilingScheme,
e=g.tileWidth,k=g.tileHeight;d[a.id].serviceContainer.children().each(function(){var j=f(this),n=j.attr("data-pixelSize")/b;n=Math.round(n*1E3)/1E3;var q=j.data("scaleOrigin").split(",");q=m._toMap([q[0],q[1]]);q=m._toPixel(q,c,b);j.css({left:Math.round(q[0])+"px",top:Math.round(q[1])+"px",width:e*n,height:k*n});f("body")[0].filters!==p&&j.children().each(function(){f(this).css("filter","progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+n+",M22="+n+",sizingmethod='auto expand')")})})}},
refresh:function(m,a){var c=m._getServicesContainer().data("geoTiledServicesState");if(a&&c[a.id]&&(a.visibility===p||a.visibility==="visible")){this._cancelUnloaded(m,a);var b=m._getBbox(),d=m.pixelSize(),g=c[a.id],e=g.serviceContainer;m._getContentBounds();c=m.options.tilingScheme;var k=c.tileWidth,j=c.tileHeight,n=Math.floor((b[0]-c.origin[0])/(d*k)),q=Math.floor((c.origin[1]-b[3])/(d*j)),v=Math.ceil((b[2]-c.origin[0])/(d*k)),r=Math.ceil((c.origin[1]-b[1])/(d*j)),y=m._getBboxMax(),z=m._getTiledPixelSize(0),
A=z/d,w=Math.floor((y[0]-c.origin[0])/(z*k))*A,F=Math.floor((c.origin[1]-y[3])/(z*j))*A,G=Math.round((c.origin[0]+w*k*d-b[0])/d),E=Math.round((b[3]-(c.origin[1]-F*j*d))/d);b=e.children().show();y=b.filter("[data-pixelSize='"+d+"']").appendTo(e);var C=a.opacity===p?1:a.opacity;g.reloadTiles&&b.find("img").attr("data-dirty","true");if(y.size()){y.css({left:G%k+"px",top:E%j+"px"}).data("scaleOrigin",G%k+","+E%j);y.children().each(function(){var D=f(this),u=D.attr("data-tile").split(",");D.css({left:Math.round((parseInt(u[0])-
w)*100+(G-G%k)/k*100)+"%",top:Math.round((parseInt(u[1])-F)*100+(E-E%j)/j*100)+"%"});C<1&&D.fadeTo(0,C)})}else{e.append("<div style='position:absolute; left:"+G%k+"px; top:"+E%j+"px; width:"+k+"px; height:"+j+"px; margin:0; padding:0;' data-pixelSize='"+d+"'></div>");y=e.children(":last").data("scaleOrigin",G%k+","+E%j)}for(n=n;n<v;n++)for(z=q;z<r;z++){A=""+n+","+z;var B=y.children("[data-tile='"+A+"']").removeAttr("data-dirty");if(B.size()===0||g.reloadTiles){var H=[c.origin[0]+n*k*d,c.origin[1]-
z*j*d],I=[c.origin[0]+((n+1)*k-1)*d,c.origin[1]-((z+1)*j-1)*d];H=a.getUrl({bbox:[H[0],H[1],I[0],I[1]],width:k,height:j,zoom:m._getZoom(),tile:{row:z,column:n},index:Math.abs(z+n)});g.loadCount++;if(g.reloadTiles&&B.size()>0)B.attr("src",H);else{B="<img style='position:absolute; left:"+((n-w)*100+(G-G%k)/k*100)+"%; top:"+((z-F)*100+(E-E%j)/j*100)+"%; ";if(f("body")[0].filters===p)B+="width: 100%; height: 100%;";B+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+
A+"' />";y.append(B);B=y.children(":last");B.load(function(D){C<1?f(D.target).fadeTo(0,C):f(D.target).show();g.loadCount--;if(g.loadCount<=0){e.children(":not([data-pixelSize='"+d+"'])").remove();g.loadCount=0}}).error(function(D){f(D.target).remove();g.loadCount--;if(g.loadCount<=0){e.children(":not([data-pixelSize='"+d+"'])").remove();g.loadCount=0}}).attr("src",H)}}}b.find("[data-dirty]").remove();g.reloadTiles=false}},resize:function(){},opacity:function(m,a){m._getServicesContainer().data("geoTiledServicesState")[a.id].serviceContainer.find("img").stop(true).fadeTo("fast",
a.opacity)},toggle:function(m,a){m._getServicesContainer().data("geoTiledServicesState")[a.id].serviceContainer.css("display",a.visibility==="visible"?"block":"none")},_cancelUnloaded:function(m,a){var c=m._getServicesContainer().data("geoTiledServicesState")[a.id];if(c&&c.loadCount>0)for(c.serviceContainer.find("img:hidden").remove();c.loadCount>0;)c.loadCount--}}}()})(jQuery);
(function(f,p){f.geo._serviceTypes.shingled=function(){return{create:function(m,a,c){m=m._getServicesContainer().data("geoShingledServicesState")||{};if(!m[c.id]){m[c.id]={loadCount:0};a.append('<div data-geo-service="shingled" id="'+c.id+'" style="position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0; display:'+(c.visibility===p||c.visibility==="visible"?"block":"none")+';"></div>');m[c.id].serviceContainer=a.children(":last");a.data("geoShingledServicesState",m)}return m[c.id].serviceContainer},
destroy:function(m,a,c){m=m._getServicesContainer().data("geoShingledServicesState");m[c.id].serviceContainer.remove();delete m[c.id]},interactivePan:function(m,a,c,b){var d=m._getServicesContainer().data("geoShingledServicesState");if(d&&d[a.id]){this._cancelUnloaded(m,a);a=d[a.id].serviceContainer;m=m.pixelSize();m=a.children("[data-pixelSize='"+m+"']");a=m.children("div");if(!a.length){m.children("img").wrap('<div style="position:absolute; left:0; top:0; width:100%; height:100%;"></div>');a=m.children("div")}a.css({left:function(g,
e){return parseInt(e)+c},top:function(g,e){return parseInt(e)+b}})}},interactiveScale:function(m,a,c,b){var d=m._getServicesContainer().data("geoShingledServicesState");if(d&&d[a.id]){this._cancelUnloaded(m,a);a=d[a.id].serviceContainer;m=m._getContentBounds();var g=m.width,e=m.height,k=g/2,j=e/2;a.children().each(function(){var n=f(this),q=n.attr("data-pixelSize"),v=q/b;n.css({width:g*v,height:e*v}).children("img").each(function(){var r=f(this),y=r.data("center");r.css({left:(Math.round((y[0]-c[0])/
q)-k)*v+"px",top:(Math.round((c[1]-y[1])/q)-j)*v+"px"})})})}},refresh:function(m,a){var c=m._getServicesContainer().data("geoShingledServicesState");if(a&&c[a.id]&&(a.visibility===p||a.visibility==="visible")){this._cancelUnloaded(m,a);var b=m._getBbox(),d=m.pixelSize(),g=c[a.id],e=g.serviceContainer,k=m._getContentBounds();c=k.width;var j=k.height,n=c/2,q=j/2;k=e.children('[data-pixelSize="'+d+'"]');var v=a.opacity===p?1:a.opacity;if(!k.size()){e.append('<div style="position:absolute; left:'+n+"px; top:"+
q+"px; width:"+c+"px; height:"+j+'px; margin:0; padding:0;" data-pixelSize="'+d+'"></div>');k=e.children(":last")}k.children("img").each(function(){var r=f(this),y=r.data("center"),z=m._getCenter();r.css({left:Math.round((y[0]-z[0])/d)-n+"px",top:Math.round((z[1]-y[1])/d)-q+"px"})});v<1&&e.find("img").attr("data-keepAlive","0");b=a.getUrl({bbox:b,width:c,height:j,zoom:m._getZoom(),tile:null,index:0});g.loadCount++;k.append('<img style="position:absolute; left:-'+n+"px; top:-"+q+'px; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />');
k.children(":last").data("center",m._getCenter()).load(function(r){v<1?f(r.target).fadeTo(0,v):f(r.target).show();g.loadCount--;if(g.loadCount<=0){e.children(':not([data-pixelSize="'+d+'"])').remove();r=e.find('[data-pixelSize="'+d+'"]>div');if(r.size()>0){var y=r.position();r.children("img").each(function(){var z=f(this),A=y.left+parseInt(z.css("left")),w=y.top+parseInt(z.css("top"));z.css({left:A+"px",top:w+"px"})}).unwrap();r.remove()}g.loadCount=0}}).error(function(r){f(r.target).remove();g.loadCount--;
if(g.loadCount<=0){e.children(":not([data-pixelSize='"+d+"'])").remove();g.loadCount=0}}).attr("src",b)}},resize:function(m,a){var c=m._getServicesContainer().data("geoShingledServicesState");if(a&&c[a.id]&&(a.visibility===p||a.visibility==="visible")){this._cancelUnloaded(m,a);var b=c[a.id].serviceContainer,d=m._getContentBounds();c=d.width/2;d=d.height/2;b=b.children();b.attr("data-pixelSize","0");b.css({left:c+"px",top:d+"px"})}},opacity:function(m,a){m._getServicesContainer().data("geoShingledServicesState")[a.id].serviceContainer.find("img").stop(true).fadeTo("fast",
a.opacity)},toggle:function(m,a){m._getServicesContainer().data("geoShingledServicesState")[a.id].serviceContainer.css("display",a.visibility==="visible"?"block":"none")},_cancelUnloaded:function(m,a){var c=m._getServicesContainer().data("geoShingledServicesState")[a.id];if(c&&c.loadCount>0)for(c.serviceContainer.find("img:hidden").remove();c.loadCount>0;)c.loadCount--}}}()})(jQuery);
