(function(d){function n(l){var e=[].slice.call(arguments,1),g=0;l=d.event.fix(l||window.event);l.type="mousewheel";if(l.wheelDelta)g=l.wheelDelta/120;if(l.detail)g=-l.detail/3;e.unshift(l,g);return d.event.handle.apply(this,e)}var r=["DOMMouseScroll","mousewheel"];d.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var l=r.length;l;)this.addEventListener(r[--l],n,false);else this.onmousewheel=n},teardown:function(){if(this.removeEventListener)for(var l=r.length;l;)this.removeEventListener(r[--l],
n,false);else this.onmousewheel=null}};d.fn.extend({mousewheel:function(l){return l?this.bind("mousewheel",l):this.trigger("mousewheel")},unmousewheel:function(l){return this.unbind("mousewheel",l)}})})(jQuery);
(function(d,n){var r=Array.prototype.slice,l=d.cleanData;d.cleanData=function(e){for(var g=0,h;(h=e[g])!=null;g++)d(h).triggerHandler("remove");l(e)};d.widget=function(e,g,h){var k=e.split(".")[0],j;e=e.split(".")[1];j=k+"-"+e;if(!h){h=g;g=d.Widget}d.expr[":"][j]=function(m){return!!d.data(m,e)};d[k]=d[k]||{};d[k][e]=d.extend(function(m,y){if(!this._createWidget)return new d[k][e](m,y);arguments.length&&this._createWidget(m,y)},d[k][e]);var B=new g;B.options=d.extend(true,{},B.options);d.each(h,function(m,
y){if(d.isFunction(y))h[m]=function(){var J=function(D){return g.prototype[D].apply(this,r.call(arguments,1))},I=function(D,u){return g.prototype[D].apply(this,u)};return function(){var D=this._super,u=this._superApply,z;this._super=J;this._superApply=I;z=y.apply(this,arguments);this._super=D;this._superApply=u;return z}}()});d[k][e].prototype=d.extend(true,B,{namespace:k,widgetName:e,widgetEventPrefix:e,widgetBaseClass:j},h);d.widget.bridge(e,d[k][e])};d.widget.bridge=function(e,g){d.fn[e]=function(h){var k=
typeof h==="string",j=r.call(arguments,1),B=this;h=!k&&j.length?d.extend.apply(null,[true,h].concat(j)):h;k?this.each(function(){var m=d.data(this,e);if(!m)return d.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+h+"'");if(!d.isFunction(m[h])||h.charAt(0)==="_")return d.error("no such method '"+h+"' for "+e+" widget instance");var y=m[h].apply(m,j);if(y!==m&&y!==n){B=y;return false}}):this.each(function(){var m=d.data(this,e);m?m.option(h||{})._init():g(h,
this)});return B}};d.Widget=function(e,g){if(!this._createWidget)return new d[namespace][name](e,g);arguments.length&&this._createWidget(e,g)};d.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false},_createWidget:function(e,g){g=d(g||this.defaultElement||this)[0];this.element=d(g);this.options=d.extend(true,{},this.options,this._getCreateOptions(),e);this.bindings=d();this.hoverable=d();this.focusable=d();if(g!==this){d.data(g,this.widgetName,this);
this._bind({remove:"destroy"})}this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return d.metadata&&d.metadata.get(this.element[0])[this.widgetName]},_create:d.noop,_init:d.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");
this.focusable.removeClass("ui-state-focus")},_destroy:d.noop,widget:function(){return this.element},option:function(e,g){var h=e;if(arguments.length===0)return d.extend({},this.options);if(typeof e==="string"){if(g===n)return this.options[e];h={};h[e]=g}this._setOptions(h);return this},_setOptions:function(e){var g=this;d.each(e,function(h,k){g._setOption(h,k)});return this},_setOption:function(e,g){this.options[e]=g;if(e==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",
!!g).attr("aria-disabled",g);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_bind:function(e,g){if(g){e=d(e);this.bindings=this.bindings.add(e)}else{g=e;e=this.element}var h=this;d.each(g,function(k,j){e.bind(k+"."+h.widgetName,function(){if(!(h.options.disabled===true||d(this).hasClass("ui-state-disabled")))return(typeof j===
"string"?h[j]:j).apply(h,arguments)})})},_hoverable:function(e){this.hoverable=this.hoverable.add(e);this._bind(e,{mouseenter:function(g){d(g.currentTarget).addClass("ui-state-hover")},mouseleave:function(g){d(g.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e);this._bind(e,{focusin:function(g){d(g.currentTarget).addClass("ui-state-focus")},focusout:function(g){d(g.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,g,h){var k=
this.options[e];g=d.Event(g);g.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase();h=h||{};if(g.originalEvent){e=d.event.props.length;for(var j;e;){j=d.event.props[--e];g[j]=g.originalEvent[j]}}this.element.trigger(g,h);h=d.isArray(h)?[g].concat(h):[g,h];return!(d.isFunction(k)&&k.apply(this.element[0],h)===false||g.isDefaultPrevented())}}})(jQuery);
(function(d){d.geo={_center:function(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]},_expandBy:function(n,r,l){n=this._center(n);return[n[0]-r,n[1]-l,n[0]+r,n[1]+l]},_height:function(n){return n[3]-n[1]},_reaspect:function(n,r){var l=this._width(n),e=this._height(n);this._center(n);if(l==0||e==0||r<=0)return n;if(l/e>r){l=l/2;e=l/r}else{e=e/2;l=e*r}return[c[0]-l,c[1]-e,c[0]+l,c[1]+e]},_scaleBy:function(n,r){return this._expandBy(n,this._width(n)*r/2,this._height(n)*r/2)},_width:function(n){return n[2]-n[0]},
proj:function(){function n(e){return e>Math.PI?e-=r:e<-Math.PI?e+=r:e}var r=6.283185307179586;this.CoordinateSystem=function(e,g,h,k){if(arguments.length<2)g=0;if(arguments.length<3)h=0;if(arguments.length<4)k=1;switch(k){case "meters":k=1;break;case "feet":k=3.2808333333333333}this.toGeodetic=function(j){return e.toGeodetic({x:(j.x-g)/k,y:(j.y-h)/k})};this.toProjected=function(j){j=e.toProjected(j);return{x:j.x*k+g,y:j.y*k+h}}};this.Mercator=function(e,g,h){e*=0.017453292519943295;g*=0.017453292519943295;
var k=h.e*h.e,j=Math.sin(g),B=1/(Math.sqrt(1-k*j*j)/Math.cos(g));g=k*k;j=g*k;var m=j*k,y=k/2+5*g/24+j/12+13*m/360,J=7*g/48+29*j/240+811*m/11520,I=7*j/120+81*m/1120,D=4279*m/161280;this.toGeodetic=function(u){var z=n(e+u.x/(B*h.smaj));u=1.5707963267948966-2*Math.atan(1/Math.exp(u.y/(B*h.smaj)));return{x:z*57.29577951308232,y:(u+y*Math.sin(2*u)+J*Math.sin(4*u)+I*Math.sin(6*u)+D*Math.sin(8*u))*57.29577951308232}};this.toProjected=function(u){var z=u.y*0.017453292519943295,M=h.e*Math.sin(z);z=Math.tan(Math.PI/
4+z/2)*Math.pow((1-M)/(1+M),h.e/2);u=n(u.x*0.017453292519943295-e);return{x:B*h.smaj*u,y:B*h.smaj*Math.log(z)}}};this.Spheroid=function(e,g){switch(typeof e){case "number":this.smaj=e;this.e=g;break;case "string":switch(e){case "WGS84Sphere":this.smaj=6378137;this.e=0}}this.smin=this.smaj*Math.sqrt(1-this.e*this.e);var h=(this.smaj-this.smin)/this.smaj;this.distance=function(k,j,B){if(arguments.length<3)B=1;switch(B){case "meters":B=1;break;case "feet":B=3.2808333333333333}var m=k.y*0.017453292519943295,
y=j.y*0.017453292519943295,J=(m+y)*0.5,I=(m-y)*0.5,D=(k.x*0.017453292519943295-j.x*0.017453292519943295)*0.5;m=Math.sin(J);m*=m;J=Math.cos(J);J*=J;y=Math.sin(I);y*=y;I=Math.cos(I);I*=I;var u=Math.sin(D);u*=u;var z=Math.cos(D);z*=z;D=y*z+J*u;u=I*z+m*u;z=Math.atan(Math.sqrt(D/u));var M=Math.sqrt(D*u)/z;return 2*this.smaj*z*(1+h*((3*M-1)/(2*u)*m*I-(3*M+1)/(2*D)*J*y))*B}};var l=new Mercator(0,0,new Spheroid("WGS84Sphere"));return{fromGeodetic:function(e){var g=d.isArray(e[0]),h=[],k=0,j;for(g||(e=[e]);k<
e.length;k++){j=l.toProjected({x:e[k][0],y:e[k][1]});h[k]=[j.x,j.y]}return g?h:h[0]},toGeodetic:function(e){var g=d.isArray(e[0]),h=[],k=0,j;for(g||(e=[e]);k<e.length;k++){j=l.toGeodetic({x:e[k][0],y:e[k][1]});h[k]=[j.x,j.y]}return g?h:h[0]}}}()}})(jQuery,this);
(function(d,n){var r="center",l,e={},g,h,k,j,B=[],m,y,J,I=null,D=0,u,z,M,ba,Z,E,ha,ia,fa,ca,ga,N,da,la=function(){for(var a=5,b=document.createElement("div"),f=b.all||[];b.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",f[0];);return a>6?a:!a}(),$,ja=this._supportTouch||this._ieVersion==7,ea,aa,U={},q={},ma={bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{pan:"move"},mode:"pan",services:[{id:"OSM",type:"tiled",getUrl:function(a){return"http://tile.openstreetmap.org/"+
a.zoom+"/"+a.tile.column+"/"+a.tile.row+".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},zoom:0,_serviceTypes:{tiled:function(){var a={};return{create:function(b,f){if(a[f.id]==null){a[f.id]={loadCount:0,reloadTiles:false,serviceContainer:null};h.append("<div data-service='"+f.id+"' style='position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0; display:"+
(f.visible===n||f.visible?"block":"none")+";'></div>");a[f.id].serviceContainer=h.children("[data-service='"+f.id+"']")}},destroy:function(b,f){a[f.id].serviceContainer.remove();delete a[f.id]},interactivePan:function(b,f,o,t){if(a[f.id]){this._cancelUnloaded(b,f);a[f.id].serviceContainer.children().css({left:function(S,ka){return parseInt(ka)+o},top:function(S,ka){return parseInt(ka)+t}});if(f!=null&&a[f.id]!=null&&(f.visible===n||f.visible)){var p=m,A=a[f.id],x=A.serviceContainer,w=x.children("[data-pixelSize='"+
p+"']"),s=b.options.tilingScheme,v=s.tileWidth,K=s.tileHeight,V=e.width/2*p,W=e.height/2*p,F=w.position(),C=w.data("scaleOrigin").split(","),T=parseInt(C[0])-F.left;F=parseInt(C[1])-F.top;var G=r;C=[G[0]+T*p,G[1]-F*p];var O=Math.floor((C[0]-V-s.origin[0])/(p*v));T=Math.floor((s.origin[1]-(C[1]+W))/(p*K));F=Math.ceil((C[0]+V-s.origin[0])/(p*v));C=Math.ceil((s.origin[1]-(C[1]-W))/(p*K));var P=b._getBboxMax(),L=b._getTiledPixelSize(0),H=L/p,Q=Math.floor((P[0]-s.origin[0])/(L*v))*H;P=Math.floor((s.origin[1]-
P[3])/(L*K))*H;V=Math.round((s.origin[0]+Q*v*p-(G[0]-V))/p);W=Math.round((G[1]+W-(s.origin[1]-P*K*p))/p);var X=f.opacity===n?1:f.opacity;for(G=O;G<F;G++)for(O=T;O<C;O++){L=""+G+","+O;H=w.children("[data-tile='"+L+"']").removeAttr("data-dirty");if(H.size()===0){var Y=[s.origin[0]+G*v*p,s.origin[1]-O*K*p],R=[s.origin[0]+((G+1)*v-1)*p,s.origin[1]-((O+1)*K-1)*p];Y=f.getUrl({bbox:[Y[0],Y[1],R[0],R[1]],width:v,height:K,zoom:b._getZoom(),tile:{row:O,column:G},index:Math.abs(O+G)});A.loadCount++;if(A.reloadTiles&&
H.size()>0)H.attr("src",Y);else{H="<img style='position:absolute; left:"+((G-Q)*100+(V-V%v)/v*100)+"%; top:"+((O-P)*100+(W-W%K)/K*100)+"%; ";if(d("body")[0].filters===n)H+="width: 100%; height: 100%;";H+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+L+"' />";w.append(H);H=w.children(":last");H.load(function(S){X<1?d(S.target).fadeTo(0,X):d(S.target).show();A.loadCount--;if(A.loadCount<=
0){x.children(":not([data-pixelSize='"+p+"'])").remove();A.loadCount=0}}).error(function(S){d(S.target).remove();A.loadCount--;if(A.loadCount<=0){x.children(":not([data-pixelSize='"+p+"'])").remove();A.loadCount=0}}).attr("src",Y)}}}}}},interactiveScale:function(b,f,o,t){if(a[f.id]){this._cancelUnloaded(b,f);var p=b.options.tilingScheme,A=p.tileWidth,x=p.tileHeight;a[f.id].serviceContainer.children().each(function(){var w=d(this),s=w.attr("data-pixelSize")/t;s=Math.round(s*1E3)/1E3;var v=w.data("scaleOrigin").split(",");
v=b._toMap([v[0],v[1]]);v=b._toPixel(v,o,t);w.css({left:Math.round(v[0])+"px",top:Math.round(v[1])+"px",width:A*s,height:x*s});d("body")[0].filters!==n&&w.children().each(function(){d(this).css("filter","progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+s+",M22="+s+",sizingmethod='auto expand')")})})}},refresh:function(b,f){if(f!=null&&a[f.id]!=null&&(f.visible===n||f.visible)){this._cancelUnloaded(b,f);var o=b._getBbox(),t=m,p=a[f.id],A=p.serviceContainer,x=b.options.tilingScheme,
w=x.tileWidth,s=x.tileHeight,v=Math.floor((o[0]-x.origin[0])/(t*w)),K=Math.floor((x.origin[1]-o[3])/(t*s)),V=Math.ceil((o[2]-x.origin[0])/(t*w)),W=Math.ceil((x.origin[1]-o[1])/(t*s)),F=b._getBboxMax(),C=b._getTiledPixelSize(0),T=C/t,G=Math.floor((F[0]-x.origin[0])/(C*w))*T,O=Math.floor((x.origin[1]-F[3])/(C*s))*T,P=Math.round((x.origin[0]+G*w*t-o[0])/t),L=Math.round((o[3]-(x.origin[1]-O*s*t))/t);o=A.children().show();F=o.filter("[data-pixelSize='"+t+"']").appendTo(A);var H=f.opacity===n?1:f.opacity;
p.reloadTiles&&o.find("img").attr("data-dirty","true");if(F.size()===0){A.append("<div style='position:absolute; left:"+P%w+"px; top:"+L%s+"px; width:"+w+"px; height:"+s+"px; margin:0; padding:0;' data-pixelSize='"+t+"'></div>");F=A.children(":last").data("scaleOrigin",P%w+","+L%s)}else{F.css({left:P%w+"px",top:L%s+"px"}).data("scaleOrigin",P%w+","+L%s);F.children().each(function(){var R=d(this),S=R.attr("data-tile").split(",");R.css({left:Math.round((parseInt(S[0])-G)*100+(P-P%w)/w*100)+"%",top:Math.round((parseInt(S[1])-
O)*100+(L-L%s)/s*100)+"%"});H<1&&R.fadeTo(0,H)})}for(v=v;v<V;v++)for(C=K;C<W;C++){T=""+v+","+C;var Q=F.children("[data-tile='"+T+"']").removeAttr("data-dirty");if(Q.size()===0||p.reloadTiles){var X=[x.origin[0]+v*w*t,x.origin[1]-C*s*t],Y=[x.origin[0]+((v+1)*w-1)*t,x.origin[1]-((C+1)*s-1)*t];X=f.getUrl({bbox:[X[0],X[1],Y[0],Y[1]],width:w,height:s,zoom:b._getZoom(),tile:{row:C,column:v},index:Math.abs(C+v)});p.loadCount++;if(p.reloadTiles&&Q.size()>0)Q.attr("src",X);else{Q="<img style='position:absolute; left:"+
((v-G)*100+(P-P%w)/w*100)+"%; top:"+((C-O)*100+(L-L%s)/s*100)+"%; ";if(d("body")[0].filters===n)Q+="width: 100%; height: 100%;";Q+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+T+"' />";F.append(Q);Q=F.children(":last");Q.load(function(R){H<1?d(R.target).fadeTo(0,H):d(R.target).show();p.loadCount--;if(p.loadCount<=0){A.children(":not([data-pixelSize='"+t+"'])").remove();p.loadCount=0}}).error(function(R){d(R.target).remove();
p.loadCount--;if(p.loadCount<=0){A.children(":not([data-pixelSize='"+t+"'])").remove();p.loadCount=0}}).attr("src",X)}}}o.find("[data-dirty]").remove();p.reloadTiles=false}},_cancelUnloaded:function(b,f){var o=a[f.id];if(o&&o.loadCount>0)for(o.serviceContainer.find("img:hidden").remove();o.loadCount>0;)o.loadCount--},_onOpacityChanged:function(){}}}()}};d.widget("geo.geomap",function(){return{options:d.extend({},ma),_createWidget:function(a,b){U=a;l=d(b);var f=l.css("position");f!="relative"&&f!=
"absolute"&&f!="fixed"&&l.css("position","relative");l.css("text-align","left");f=this._findMapSize();e={x:parseInt(l.css("padding-left")),y:parseInt(l.css("padding-top")),width:f.width,height:f.height};this._createChildren();r=y=[0,0];m=J=156543.03392799935;u=z=M=ba=ga=ea=aa=false;Z=E=fa=ca=N=[0,0];da=[0.8,0.8];ha=ia=0;d.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){q=this.options;var a=($="ontouchend"in document)?"touchstart":"mousedown",b=$?"touchend touchcancel":"mouseup",
f=$?"touchmove":"mousemove";j.dblclick(d.proxy(this._eventTarget_dblclick,this));j.bind(a,d.proxy(this._eventTarget_touchstart,this));a=j[0].setCapture?j:d(document);a.bind(f,d.proxy(this._dragTarget_touchmove,this));a.bind(b,d.proxy(this._dragTarget_touchstop,this));j.mousewheel(d.proxy(this._eventTarget_mousewheel,this));if(U){U.bbox&&this._setOption("bbox",U.bbox,false);U.center&&this._setOption("center",U.center,false);U.zoom&&this._setZoom(U.zoom,false,false)}j.css("cursor",q.cursors[q.mode]);
this._createServices();this._refresh()},_setOption:function(a,b,f){f=f===n||f;switch(a){case "bbox":if(d.geo.proj){b=d.geo.proj.fromGeodetic([[b[0],b[1]],[b[2],b[3]]]);b=[b[0][0],b[0][1],b[1][0],b[1][1]]}this._setBbox(b,false,f);b=this._getBbox();if(d.geo.proj){b=d.geo.proj.toGeodetic([[b[0],b[1]],[b[2],b[3]]]);b=[b[0][0],b[0][1],b[1][0],b[1][1]]}break;case "center":this._setCenterAndSize(d.geo.proj?d.geo.proj.fromGeodetic([[b[0],b[1]]])[0]:b,m,false,f);break;case "zoom":this._setZoom(b,false,f)}d.Widget.prototype._setOption.apply(this,
arguments);switch(a){case "services":this._createServices();f&&this._refresh()}},destroy:function(){d.Widget.prototype.destroy.apply(this,arguments);this.element.html("")},getPixelSize:function(){return m},toMap:function(a){a=this._toMap(a);return d.geo.proj?d.geo.proj.toGeodetic(a):a},toPixel:function(a){a=d.geo.proj?d.geo.proj.fromGeodetic(a):a;return this._toPixel(a)},_getBbox:function(){var a=e.width/2*m,b=e.height/2*m;return[r[0]-a,r[1]-b,r[0]+a,r[1]+b]},_setBbox:function(a,b,f){var o=[a[0]+
(a[2]-a[0])/2,a[1]+(a[3]-a[1])/2];a=Math.max(d.geo._width(a)/e.width,d.geo._height(a)/e.height);if(q.tilingScheme)a=this._getTiledPixelSize(this._getTiledZoom(a));this._setCenterAndSize(o,a,b,f)},_getBboxMax:function(){var a=e.width/2*J,b=e.height/2*J;return[y[0]-a,y[1]-b,y[0]+a,y[1]+b]},_getZoom:function(){if(q.tilingScheme)return this._getTiledZoom(m);else{var a=e.width/e.height,b=d.geo._reaspect(this._getBbox(),a);a=d.geo._reaspect(this._getBboxMax(),a);return Math.log(d.geo._width(a)/d.geo._width(b))/
Math.log(2)}},_setZoom:function(a,b,f){a=Math.max(a,0);if(q.tilingScheme)this._setCenterAndSize(r,this._getTiledPixelSize(a),b,f);else{a=d.geo._scaleBy(this._getBbox(),1/Math.pow(2,a));a=Math.max(d.geo._width(a)/e.width,d.geo._height(a)/e.height);this._setCenterAndSize(r,a,b,f)}},_createChildren:function(){var a=l.children().detach();a.css("-moz-user-select","none");l.prepend("<div style='position:absolute; left:"+e.x+"px; top:"+e.y+"px; width:"+e.width+"px; height:"+e.height+"px; margin:0; padding:0; overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;' unselectable='on'></div>");
j=g=l.children(":first");g.append('<div style="position:absolute; left:0; top:0; width:'+e.width+"px; height:"+e.height+'px; margin: 0; padding: 0;"></div>');h=g.children(":last");g.append('<div style="position:absolute; left:0; top:0; width:'+e.width+"px; height:"+e.height+'px; margin: 0; padding: 0;"></div>');g.children(":last");g.append('<div class="ui-widget ui-widget-content ui-corner-all" style="position:absolute; left:0; top:0px; max-width:128px; display:none;"><div style="margin:.2em;"></div></div>');
k=g.children(":last");k.children();g.append(a)},_createServices:function(){var a;for(a=0;a<B.length;a++)q._serviceTypes[B[a].type].destroy(this,B[a]);for(a=0;a<q.services.length;a++)q._serviceTypes[q.services[a].type].create(this,q.services[a],a);B=q.services},_findMapSize:function(){for(var a={width:0,height:0},b=l;b.size()&&!(a.width>0&&a.height>0);){a={width:b.width(),height:b.height()};if(a.width<=0||a.height<=0)a={width:parseInt(b.css("width")),height:parseInt(b.css("height"))};b=b.parent()}return a},
_getTiledPixelSize:function(a){var b=q.tilingScheme;if(b!=null){if(a===0)return b.pixelSizes!=null?b.pixelSizes[0]:b.basePixelSize;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,(b.pixelSizes!=null?b.pixelSizes.length:b.levels)-1);return b.pixelSizes!=null?b.pixelSizes[a]:b.basePixelSize/Math.pow(2,a)}else return NaN},_getTiledZoom:function(a){var b=q.tilingScheme;if(b.pixelSizes!=null){a=Math.round(a);for(var f=(b.pixelSizes!=null?b.pixelSizes.length:b.levels)-1;f>=0;f--)if(Math.round(b.pixelSizes[f])>=
a)return f;return 0}else return Math.max(Math.round(Math.log(b.basePixelSize/a)/Math.log(2)),0)},_getWheelCenterAndSize:function(){var a;if(q.tilingScheme){a=this._getTiledZoom(m)+D;a=this._getTiledPixelSize(a)}else{a=Math.pow(1.18920711500273,-D);a=m*a}var b=a/m,f=this._toMap(Z);b=[(r[0]-f[0])*b,(r[1]-f[1])*b];return{pixelSize:a,center:[f[0]+b[0],f[1]+b[1]]}},_mouseWheelFinish:function(){I=null;if(D!=0){var a=this._getWheelCenterAndSize();D=0;this._setCenterAndSize(a.center,a.pixelSize,true,true)}else this._refresh()},
_panEnd:function(){N=[N[0]>0?Math.floor(N[0]*da[0]):Math.ceil(N[0]*da[0]),N[1]>0?Math.floor(N[1]*da[1]):Math.ceil(N[1]*da[1])];if(Math.abs(N[0])<4&&Math.abs(N[1])<4)this._panFinalize();else{E=[E[0]+N[0],E[1]+N[1]];this._panMove();setTimeout(d.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(ga){N=[0,0];this._setCenterAndSize([r[0]+-(E[0]-Z[0])*m,r[1]+(E[1]-Z[1])*m],m,true,true);z=false;Z=E;M=ga=false;j.css("cursor",q.cursors[q.mode])}},_panMove:function(){var a=E[0]-ca[0],b=E[1]-ca[1];if(M||
a>3||a<-3||b>3||b<-3){if(!M){M=true;j.css("cursor",q.cursors.pan)}if(u)N=[a,b];if(a!=0||b!=0){ga=true;ca=E;for(i=0;i<q.services.length;i++){var f=q.services[i];q._serviceTypes[f.type].interactivePan(this,f,a,b)}}}},_refresh:function(){for(var a=0;a<q.services.length;a++){var b=q.services[a];!u&&q._serviceTypes[b.type]!=null&&q._serviceTypes[b.type].refresh(this,b)}},_setCenterAndSize:function(a,b,f,o){if(m!=b)for(var t=0;t<q.services.length;t++){var p=q.services[t];q._serviceTypes[p.type].interactiveScale(this,
p,a,b)}r=a;m=b;if(d.geo.proj){a=this._getBbox();a=d.geo.proj.toGeodetic([[a[0],a[1]],[a[2],a[3]]]);a=[a[0][0],a[0][1],a[1][0],a[1][1]];q.bbox=a;q[r]=d.geo.proj.toGeodetic([[r[0],r[1]]])[0]}else{q.bbox=this._getBbox();q[r]=r}q.zoom=this._getZoom();f&&this._trigger("bboxchange",event,{bbox:q.bbox});o&&this._refresh()},_toMap:function(a,b,f){var o=d.isArray(a[0]);o||(a=[a]);b=b||r;f=f||m;var t=e.width,p=e.height,A=t/2*f;f=p/2*f;var x=[b[0]-A,b[1]-f,b[0]+A,b[1]+f],w=d.geo._width(x)/t,s=d.geo._height(x)/
p,v=[];d.each(a,function(K){v[K]=[x[0]+this[0]*w,x[3]-this[1]*s]});return o?v:v[0]},_toPixel:function(a,b,f){var o=d.isArray(a[0]);o||(a=[a]);b=b||r;f=f||m;var t=e.width,p=e.height,A=t/2*f;f=p/2*f;var x=[b[0]-A,b[1]-f,b[0]+A,b[1]+f],w=d.geo._width(x),s=d.geo._height(x),v=[];d.each(a,function(K){v[K]=[(this[0]-x[0])*t/w,(x[3]-this[1])*p/s]});return o?v:v[0]},_zoomTo:function(a,b,f,o){b=b<0?0:b;var t=this._getTiledPixelSize(b);if(isNaN(t)){b=d.geo._scaleBy(this._getBboxMax(),1/Math.pow(2,b));b=Math.max(d.geo._width(b)/
e.width,d.geo._height(b)/e.height);this._setCenterAndSize(a,b,f,o)}else this._setCenterAndSize(a,t,f,o)},_eventTarget_dblclick:function(a){this._panFinalize();d(a.currentTarget).offset();switch(q.mode){case "pan":this._trigger("dblclick",a,{pixels:E,coordinates:this.toMap(E)});a.isDefaultPrevented()||this._zoomTo(this._toMap(E),this._getZoom()+1,true,true)}z=false},_eventTarget_touchstart:function(a){if(!(!$&&a.which!=1)){if(ja){var b=d.now();aa=b-ha<750?aa?false:ea:false;ea=true;ha=b}a.preventDefault();
this._panFinalize();this._mouseWheelFinish();b=d(a.currentTarget).offset();E=$?[a.originalEvent.changedTouches[0].pageX-b.left,a.originalEvent.changedTouches[0].pageY-b.top]:[a.pageX-b.left,a.pageY-b.top];u=true;Z=E;if(!z&&a.shiftKey){ba=true;j.css("cursor",q.cursors.zoom)}else{z=true;switch(q.mode){case "pan":ca=E;a.currentTarget.setCapture&&a.currentTarget.setCapture()}}return false}},_dragTarget_touchmove:function(a){var b=j.offset();b=$?[a.originalEvent.changedTouches[0].pageX-b.left,a.originalEvent.changedTouches[0].pageY-
b.top]:[a.pageX-b.left,a.pageY-b.top];if(!(b[0]==fa[0]&&b[1]==fa[1])){if(ja)aa=ea=false;if(u){E=b;d.now()}switch(ba?"zoom":q.mode){case "pan":u||M?this._panMove():this._trigger("move",a,{pixels:b,coordinates:this.toMap(b)})}fa=b}},_dragTarget_touchstop:function(a){!u&&la==7&&this._eventTarget_touchstart(a);var b=u,f=M,o=j.offset();o=$?[a.originalEvent.changedTouches[0].pageX-o.left,a.originalEvent.changedTouches[0].pageY-o.top]:[a.pageX-o.left,a.pageY-o.top];var t=ba?"zoom":q.mode;j.css("cursor",
q.cursors[t]);ba=u=M=false;document.releaseCapture&&document.releaseCapture();if(b){b=d.now();E=o;switch(t){case "pan":if(f)this._panEnd();else if(b-ia>100){this._trigger("click",a,{pixels:o,coordinates:this.toMap(o)});z=false}}ia=b;if(ja&&aa){aa=ea=false;j.trigger("dblclick",a)}}},_eventTarget_mousewheel:function(a,b){a.preventDefault();this._panFinalize();if(!u){if(b!=0){if(I){window.clearTimeout(I);I=null}else{var f=d(a.currentTarget).offset();Z=[a.pageX-f.left,a.pageY-f.top]}D+=b;f=this._getWheelCenterAndSize();
for(i=0;i<q.services.length;i++){var o=q.services[i];q._serviceTypes[o.type].interactiveScale(this,o,f.center,f.pixelSize)}var t=this;this._wheelTimer=window.setTimeout(function(){t._mouseWheelFinish()},1E3)}return false}}}}())})(jQuery);
