(function(d){function n(l){var e=[].slice.call(arguments,1),g=0;l=d.event.fix(l||window.event);l.type="mousewheel";if(l.wheelDelta)g=l.wheelDelta/120;if(l.detail)g=-l.detail/3;e.unshift(l,g);return d.event.handle.apply(this,e)}var o=["DOMMouseScroll","mousewheel"];d.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var l=o.length;l;)this.addEventListener(o[--l],n,false);else this.onmousewheel=n},teardown:function(){if(this.removeEventListener)for(var l=o.length;l;)this.removeEventListener(o[--l],
n,false);else this.onmousewheel=null}};d.fn.extend({mousewheel:function(l){return l?this.bind("mousewheel",l):this.trigger("mousewheel")},unmousewheel:function(l){return this.unbind("mousewheel",l)}})})(jQuery);
(function(d,n){var o=Array.prototype.slice,l=d.cleanData;d.cleanData=function(e){for(var g=0,h;(h=e[g])!=null;g++)d(h).triggerHandler("remove");l(e)};d.widget=function(e,g,h){var j=e.split(".")[0],k;e=e.split(".")[1];k=j+"-"+e;if(!h){h=g;g=d.Widget}d.expr[":"][k]=function(m){return!!d.data(m,e)};d[j]=d[j]||{};d[j][e]=d.extend(function(m,y){if(!this._createWidget)return new d[j][e](m,y);arguments.length&&this._createWidget(m,y)},d[j][e]);var B=new g;B.options=d.extend(true,{},B.options);d.each(h,function(m,
y){if(d.isFunction(y))h[m]=function(){var J=function(D){return g.prototype[D].apply(this,o.call(arguments,1))},H=function(D,s){return g.prototype[D].apply(this,s)};return function(){var D=this._super,s=this._superApply,A;this._super=J;this._superApply=H;A=y.apply(this,arguments);this._super=D;this._superApply=s;return A}}()});d[j][e].prototype=d.extend(true,B,{namespace:j,widgetName:e,widgetEventPrefix:e,widgetBaseClass:k},h);d.widget.bridge(e,d[j][e])};d.widget.bridge=function(e,g){d.fn[e]=function(h){var j=
typeof h==="string",k=o.call(arguments,1),B=this;h=!j&&k.length?d.extend.apply(null,[true,h].concat(k)):h;j?this.each(function(){var m=d.data(this,e);if(!m)return d.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+h+"'");if(!d.isFunction(m[h])||h.charAt(0)==="_")return d.error("no such method '"+h+"' for "+e+" widget instance");var y=m[h].apply(m,k);if(y!==m&&y!==n){B=y;return false}}):this.each(function(){var m=d.data(this,e);m?m.option(h||{})._init():g(h,
this)});return B}};d.Widget=function(e,g){if(!this._createWidget)return new d[namespace][name](e,g);arguments.length&&this._createWidget(e,g)};d.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false},_createWidget:function(e,g){g=d(g||this.defaultElement||this)[0];this.element=d(g);this.options=d.extend(true,{},this.options,this._getCreateOptions(),e);this.bindings=d();this.hoverable=d();this.focusable=d();if(g!==this){d.data(g,this.widgetName,this);
this._bind({remove:"destroy"})}this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return d.metadata&&d.metadata.get(this.element[0])[this.widgetName]},_create:d.noop,_init:d.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");
this.focusable.removeClass("ui-state-focus")},_destroy:d.noop,widget:function(){return this.element},option:function(e,g){var h=e;if(arguments.length===0)return d.extend({},this.options);if(typeof e==="string"){if(g===n)return this.options[e];h={};h[e]=g}this._setOptions(h);return this},_setOptions:function(e){var g=this;d.each(e,function(h,j){g._setOption(h,j)});return this},_setOption:function(e,g){this.options[e]=g;if(e==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",
!!g).attr("aria-disabled",g);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_bind:function(e,g){if(g){e=d(e);this.bindings=this.bindings.add(e)}else{g=e;e=this.element}var h=this;d.each(g,function(j,k){e.bind(j+"."+h.widgetName,function(){if(!(h.options.disabled===true||d(this).hasClass("ui-state-disabled")))return(typeof k===
"string"?h[k]:k).apply(h,arguments)})})},_hoverable:function(e){this.hoverable=this.hoverable.add(e);this._bind(e,{mouseenter:function(g){d(g.currentTarget).addClass("ui-state-hover")},mouseleave:function(g){d(g.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e);this._bind(e,{focusin:function(g){d(g.currentTarget).addClass("ui-state-focus")},focusout:function(g){d(g.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,g,h){var j=
this.options[e];g=d.Event(g);g.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase();h=h||{};if(g.originalEvent){e=d.event.props.length;for(var k;e;){k=d.event.props[--e];g[k]=g.originalEvent[k]}}this.element.trigger(g,h);h=d.isArray(h)?[g].concat(h):[g,h];return!(d.isFunction(j)&&j.apply(this.element[0],h)===false||g.isDefaultPrevented())}}})(jQuery);
(function(d){d.geo={_center:function(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]},_expandBy:function(n,o,l){n=this._center(n);return[n[0]-o,n[1]-l,n[0]+o,n[1]+l]},_height:function(n){return n[3]-n[1]},_reaspect:function(n,o){var l=this._width(n),e=this._height(n);this._center(n);if(l==0||e==0||o<=0)return n;if(l/e>o){l=l/2;e=l/o}else{e=e/2;l=e*o}return[c[0]-l,c[1]-e,c[0]+l,c[1]+e]},_scaleBy:function(n,o){return this._expandBy(n,this._width(n)*o/2,this._height(n)*o/2)},_width:function(n){return n[2]-n[0]},
proj:function(){function n(e){return e>Math.PI?e-=o:e<-Math.PI?e+=o:e}var o=6.283185307179586;this.CoordinateSystem=function(e,g,h,j){if(arguments.length<2)g=0;if(arguments.length<3)h=0;if(arguments.length<4)j=1;switch(j){case "meters":j=1;break;case "feet":j=3.2808333333333333}this.toGeodetic=function(k){return e.toGeodetic({x:(k.x-g)/j,y:(k.y-h)/j})};this.toProjected=function(k){k=e.toProjected(k);return{x:k.x*j+g,y:k.y*j+h}}};this.Mercator=function(e,g,h){e*=0.017453292519943295;g*=0.017453292519943295;
var j=h.e*h.e,k=Math.sin(g),B=1/(Math.sqrt(1-j*k*k)/Math.cos(g));g=j*j;k=g*j;var m=k*j,y=j/2+5*g/24+k/12+13*m/360,J=7*g/48+29*k/240+811*m/11520,H=7*k/120+81*m/1120,D=4279*m/161280;this.toGeodetic=function(s){var A=n(e+s.x/(B*h.smaj));s=1.5707963267948966-2*Math.atan(1/Math.exp(s.y/(B*h.smaj)));return{x:A*57.29577951308232,y:(s+y*Math.sin(2*s)+J*Math.sin(4*s)+H*Math.sin(6*s)+D*Math.sin(8*s))*57.29577951308232}};this.toProjected=function(s){var A=s.y*0.017453292519943295,P=h.e*Math.sin(A);A=Math.tan(Math.PI/
4+A/2)*Math.pow((1-P)/(1+P),h.e/2);s=n(s.x*0.017453292519943295-e);return{x:B*h.smaj*s,y:B*h.smaj*Math.log(A)}}};this.Spheroid=function(e,g){switch(typeof e){case "number":this.smaj=e;this.e=g;break;case "string":switch(e){case "WGS84Sphere":this.smaj=6378137;this.e=0}}this.smin=this.smaj*Math.sqrt(1-this.e*this.e);var h=(this.smaj-this.smin)/this.smaj;this.distance=function(j,k,B){if(arguments.length<3)B=1;switch(B){case "meters":B=1;break;case "feet":B=3.2808333333333333}var m=j.y*0.017453292519943295,
y=k.y*0.017453292519943295,J=(m+y)*0.5,H=(m-y)*0.5,D=(j.x*0.017453292519943295-k.x*0.017453292519943295)*0.5;m=Math.sin(J);m*=m;J=Math.cos(J);J*=J;y=Math.sin(H);y*=y;H=Math.cos(H);H*=H;var s=Math.sin(D);s*=s;var A=Math.cos(D);A*=A;D=y*A+J*s;s=H*A+m*s;A=Math.atan(Math.sqrt(D/s));var P=Math.sqrt(D*s)/A;return 2*this.smaj*A*(1+h*((3*P-1)/(2*s)*m*H-(3*P+1)/(2*D)*J*y))*B}};var l=new Mercator(0,0,new Spheroid("WGS84Sphere"));return{fromGeodetic:function(e){for(var g=[],h=0,j;h<e.length;h++){j=l.toProjected({x:e[h][0],
y:e[h][1]});g[h]=[j.x,j.y]}return g},toGeodetic:function(e){for(var g=[],h=0,j;h<e.length;h++){j=l.toGeodetic({x:e[h][0],y:e[h][1]});g[h]=[j.x,j.y]}return g}}}()}})(jQuery,this);
(function(d,n){var o="center",l,e={},g,h,j,k,B=[],m,y,J,H=null,D=0,s,A,P,ba,Z,I,ha,ia,fa,ca,ga,M,da,la=function(){for(var a=5,b=document.createElement("div"),f=b.all||[];b.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",f[0];);return a>6?a:!a}(),$,ja=this._supportTouch||this._ieVersion==7,ea,aa,U={},p={},ma={bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{pan:"move"},mode:"pan",services:[{id:"OSM",type:"tiled",getUrl:function(a){return"http://tile.openstreetmap.org/"+
a.zoom+"/"+a.tile.column+"/"+a.tile.row+".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},zoom:0,_serviceTypes:{tiled:function(){var a={};return{create:function(b,f){if(a[f.id]==null){a[f.id]={loadCount:0,reloadTiles:false,serviceContainer:null};h.append("<div data-service='"+f.id+"' style='position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0; display:"+
(f.visible===n||f.visible?"block":"none")+";'></div>");a[f.id].serviceContainer=h.children("[data-service='"+f.id+"']")}},destroy:function(b,f){a[f.id].serviceContainer.remove();delete a[f.id]},interactivePan:function(b,f,t,v){if(a[f.id]){this._cancelUnloaded(b,f);a[f.id].serviceContainer.children().css({left:function(S,ka){return parseInt(ka)+t},top:function(S,ka){return parseInt(ka)+v}});if(f!=null&&a[f.id]!=null&&(f.visible===n||f.visible)){var q=m,z=a[f.id],x=z.serviceContainer,w=x.children("[data-pixelSize='"+
q+"']"),r=b.options.tilingScheme,u=r.tileWidth,K=r.tileHeight,V=e.width/2*q,W=e.height/2*q,E=w.position(),C=w.data("scaleOrigin").split(","),T=parseInt(C[0])-E.left;E=parseInt(C[1])-E.top;var F=o;C=[F[0]+T*q,F[1]-E*q];var N=Math.floor((C[0]-V-r.origin[0])/(q*u));T=Math.floor((r.origin[1]-(C[1]+W))/(q*K));E=Math.ceil((C[0]+V-r.origin[0])/(q*u));C=Math.ceil((r.origin[1]-(C[1]-W))/(q*K));var O=b._getBboxMax(),L=b._getTiledPixelSize(0),G=L/q,Q=Math.floor((O[0]-r.origin[0])/(L*u))*G;O=Math.floor((r.origin[1]-
O[3])/(L*K))*G;V=Math.round((r.origin[0]+Q*u*q-(F[0]-V))/q);W=Math.round((F[1]+W-(r.origin[1]-O*K*q))/q);var X=f.opacity===n?1:f.opacity;for(F=N;F<E;F++)for(N=T;N<C;N++){L=""+F+","+N;G=w.children("[data-tile='"+L+"']").removeAttr("data-dirty");if(G.size()===0){var Y=[r.origin[0]+F*u*q,r.origin[1]-N*K*q],R=[r.origin[0]+((F+1)*u-1)*q,r.origin[1]-((N+1)*K-1)*q];Y=f.getUrl({bbox:[Y[0],Y[1],R[0],R[1]],width:u,height:K,zoom:b._getZoom(),tile:{row:N,column:F},index:Math.abs(N+F)});z.loadCount++;if(z.reloadTiles&&
G.size()>0)G.attr("src",Y);else{G="<img style='position:absolute; left:"+((F-Q)*100+(V-V%u)/u*100)+"%; top:"+((N-O)*100+(W-W%K)/K*100)+"%; ";if(d("body")[0].filters===n)G+="width: 100%; height: 100%;";G+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+L+"' />";w.append(G);G=w.children(":last");G.load(function(S){X<1?d(S.target).fadeTo(0,X):d(S.target).show();z.loadCount--;if(z.loadCount<=
0){x.children(":not([data-pixelSize='"+q+"'])").remove();z.loadCount=0}}).error(function(S){d(S.target).remove();z.loadCount--;if(z.loadCount<=0){x.children(":not([data-pixelSize='"+q+"'])").remove();z.loadCount=0}}).attr("src",Y)}}}}}},interactiveScale:function(b,f,t,v){if(a[f.id]){this._cancelUnloaded(b,f);var q=b.options.tilingScheme,z=q.tileWidth,x=q.tileHeight;a[f.id].serviceContainer.children().each(function(){var w=d(this),r=w.attr("data-pixelSize")/v;r=Math.round(r*1E3)/1E3;var u=w.data("scaleOrigin").split(",");
u=b._toMap([u[0],u[1]]);u=b._toPixel(u,t,v);w.css({left:Math.round(u[0])+"px",top:Math.round(u[1])+"px",width:z*r,height:x*r});d("body")[0].filters!==n&&w.children().each(function(){d(this).css("filter","progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+r+",M22="+r+",sizingmethod='auto expand')")})})}},refresh:function(b,f){if(f!=null&&a[f.id]!=null&&(f.visible===n||f.visible)){this._cancelUnloaded(b,f);var t=b._getBbox(),v=m,q=a[f.id],z=q.serviceContainer,x=b.options.tilingScheme,
w=x.tileWidth,r=x.tileHeight,u=Math.floor((t[0]-x.origin[0])/(v*w)),K=Math.floor((x.origin[1]-t[3])/(v*r)),V=Math.ceil((t[2]-x.origin[0])/(v*w)),W=Math.ceil((x.origin[1]-t[1])/(v*r)),E=b._getBboxMax(),C=b._getTiledPixelSize(0),T=C/v,F=Math.floor((E[0]-x.origin[0])/(C*w))*T,N=Math.floor((x.origin[1]-E[3])/(C*r))*T,O=Math.round((x.origin[0]+F*w*v-t[0])/v),L=Math.round((t[3]-(x.origin[1]-N*r*v))/v);t=z.children().show();E=t.filter("[data-pixelSize='"+v+"']").appendTo(z);var G=f.opacity===n?1:f.opacity;
q.reloadTiles&&t.find("img").attr("data-dirty","true");if(E.size()===0){z.append("<div style='position:absolute; left:"+O%w+"px; top:"+L%r+"px; width:"+w+"px; height:"+r+"px; margin:0; padding:0;' data-pixelSize='"+v+"'></div>");E=z.children(":last").data("scaleOrigin",O%w+","+L%r)}else{E.css({left:O%w+"px",top:L%r+"px"}).data("scaleOrigin",O%w+","+L%r);E.children().each(function(){var R=d(this),S=R.attr("data-tile").split(",");R.css({left:Math.round((parseInt(S[0])-F)*100+(O-O%w)/w*100)+"%",top:Math.round((parseInt(S[1])-
N)*100+(L-L%r)/r*100)+"%"});G<1&&R.fadeTo(0,G)})}for(u=u;u<V;u++)for(C=K;C<W;C++){T=""+u+","+C;var Q=E.children("[data-tile='"+T+"']").removeAttr("data-dirty");if(Q.size()===0||q.reloadTiles){var X=[x.origin[0]+u*w*v,x.origin[1]-C*r*v],Y=[x.origin[0]+((u+1)*w-1)*v,x.origin[1]-((C+1)*r-1)*v];X=f.getUrl({bbox:[X[0],X[1],Y[0],Y[1]],width:w,height:r,zoom:b._getZoom(),tile:{row:C,column:u},index:Math.abs(C+u)});q.loadCount++;if(q.reloadTiles&&Q.size()>0)Q.attr("src",X);else{Q="<img style='position:absolute; left:"+
((u-F)*100+(O-O%w)/w*100)+"%; top:"+((C-N)*100+(L-L%r)/r*100)+"%; ";if(d("body")[0].filters===n)Q+="width: 100%; height: 100%;";Q+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+T+"' />";E.append(Q);Q=E.children(":last");Q.load(function(R){G<1?d(R.target).fadeTo(0,G):d(R.target).show();q.loadCount--;if(q.loadCount<=0){z.children(":not([data-pixelSize='"+v+"'])").remove();q.loadCount=0}}).error(function(R){d(R.target).remove();
q.loadCount--;if(q.loadCount<=0){z.children(":not([data-pixelSize='"+v+"'])").remove();q.loadCount=0}}).attr("src",X)}}}t.find("[data-dirty]").remove();q.reloadTiles=false}},_cancelUnloaded:function(b,f){var t=a[f.id];if(t&&t.loadCount>0)for(t.serviceContainer.find("img:hidden").remove();t.loadCount>0;)t.loadCount--},_onOpacityChanged:function(){}}}()}};d.widget("geo.geomap",function(){return{options:d.extend({},ma),_createWidget:function(a,b){U=a;l=d(b);var f=l.css("position");f!="relative"&&f!=
"absolute"&&f!="fixed"&&l.css("position","relative");l.css("text-align","left");f=this._findMapSize();e={x:parseInt(l.css("padding-left")),y:parseInt(l.css("padding-top")),width:f.width,height:f.height};this._createChildren();o=y=[0,0];m=J=156543.03392799935;s=A=P=ba=ga=ea=aa=false;Z=I=fa=ca=M=[0,0];da=[0.8,0.8];ha=ia=0;d.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){p=this.options;var a=($="ontouchend"in document)?"touchstart":"mousedown",b=$?"touchend touchcancel":"mouseup",
f=$?"touchmove":"mousemove";k.dblclick(d.proxy(this._eventTarget_dblclick,this));k.bind(a,d.proxy(this._eventTarget_touchstart,this));a=k[0].setCapture?k:d(document);a.bind(f,d.proxy(this._dragTarget_touchmove,this));a.bind(b,d.proxy(this._dragTarget_touchstop,this));k.mousewheel(d.proxy(this._eventTarget_mousewheel,this));if(U){U.bbox&&this._setOption("bbox",U.bbox,false);U.center&&this._setOption("center",U.center,false);U.zoom&&this._setZoom(U.zoom,false,false)}k.css("cursor",p.cursors[p.mode]);
this._createServices();this._refresh()},_setOption:function(a,b,f){f=f===n||f;switch(a){case "bbox":if(d.geo.proj){b=d.geo.proj.fromGeodetic([[b[0],b[1]],[b[2],b[3]]]);b=[b[0][0],b[0][1],b[1][0],b[1][1]]}this._setBbox(b,false,f);b=this._getBbox();if(d.geo.proj){b=d.geo.proj.toGeodetic([[b[0],b[1]],[b[2],b[3]]]);b=[b[0][0],b[0][1],b[1][0],b[1][1]]}break;case "center":this._setCenterAndSize(d.geo.proj?d.geo.proj.fromGeodetic([[b[0],b[1]]])[0]:b,m,false,f);break;case "zoom":this._setZoom(b,false,f)}d.Widget.prototype._setOption.apply(this,
arguments);switch(a){case "services":this._createServices();f&&this._refresh()}},destroy:function(){d.Widget.prototype.destroy.apply(this,arguments);this.element.html("")},getPixelSize:function(){return m},_getBbox:function(){var a=e.width/2*m,b=e.height/2*m;return[o[0]-a,o[1]-b,o[0]+a,o[1]+b]},_setBbox:function(a,b,f){var t=[a[0]+(a[2]-a[0])/2,a[1]+(a[3]-a[1])/2];a=Math.max(d.geo._width(a)/e.width,d.geo._height(a)/e.height);if(p.tilingScheme)a=this._getTiledPixelSize(this._getTiledZoom(a));this._setCenterAndSize(t,
a,b,f)},_getBboxMax:function(){var a=e.width/2*J,b=e.height/2*J;return[y[0]-a,y[1]-b,y[0]+a,y[1]+b]},_getZoom:function(){if(p.tilingScheme)return this._getTiledZoom(m);else{var a=e.width/e.height,b=d.geo._reaspect(this._getBbox(),a);a=d.geo._reaspect(this._getBboxMax(),a);return Math.log(d.geo._width(a)/d.geo._width(b))/Math.log(2)}},_setZoom:function(a,b,f){a=Math.max(a,0);if(p.tilingScheme)this._setCenterAndSize(o,this._getTiledPixelSize(a),b,f);else{a=d.geo._scaleBy(this._getBbox(),1/Math.pow(2,
a));a=Math.max(d.geo._width(a)/e.width,d.geo._height(a)/e.height);this._setCenterAndSize(o,a,b,f)}},_createChildren:function(){var a=l.children().detach();a.css("-moz-user-select","none");l.prepend("<div style='position:absolute; left:"+e.x+"px; top:"+e.y+"px; width:"+e.width+"px; height:"+e.height+"px; margin:0; padding:0; overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;' unselectable='on'></div>");k=g=l.children(":first");g.append('<div style="position:absolute; left:0; top:0; width:'+
e.width+"px; height:"+e.height+'px; margin: 0; padding: 0;"></div>');h=g.children(":last");g.append('<div style="position:absolute; left:0; top:0; width:'+e.width+"px; height:"+e.height+'px; margin: 0; padding: 0;"></div>');g.children(":last");g.append('<div class="ui-widget ui-widget-content ui-corner-all" style="position:absolute; left:0; top:0px; max-width:128px; display:none;"><div style="margin:.2em;"></div></div>');j=g.children(":last");j.children();g.append(a)},_createServices:function(){var a;
for(a=0;a<B.length;a++)p._serviceTypes[B[a].type].destroy(this,B[a]);for(a=0;a<p.services.length;a++)p._serviceTypes[p.services[a].type].create(this,p.services[a],a);B=p.services},_findMapSize:function(){for(var a={width:0,height:0},b=l;b.size()&&!(a.width>0&&a.height>0);){a={width:b.width(),height:b.height()};if(a.width<=0||a.height<=0)a={width:parseInt(b.css("width")),height:parseInt(b.css("height"))};b=b.parent()}return a},_getTiledPixelSize:function(a){var b=p.tilingScheme;if(b!=null){if(a===
0)return b.pixelSizes!=null?b.pixelSizes[0]:b.basePixelSize;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,(b.pixelSizes!=null?b.pixelSizes.length:b.levels)-1);return b.pixelSizes!=null?b.pixelSizes[a]:b.basePixelSize/Math.pow(2,a)}else return NaN},_getTiledZoom:function(a){var b=p.tilingScheme;if(b.pixelSizes!=null){a=Math.round(a);for(var f=(b.pixelSizes!=null?b.pixelSizes.length:b.levels)-1;f>=0;f--)if(Math.round(b.pixelSizes[f])>=a)return f;return 0}else return Math.max(Math.round(Math.log(b.basePixelSize/
a)/Math.log(2)),0)},_getWheelCenterAndSize:function(){var a;if(p.tilingScheme){a=this._getTiledZoom(m)+D;a=this._getTiledPixelSize(a)}else{a=Math.pow(1.18920711500273,-D);a=m*a}var b=a/m,f=this._toMap(Z);b=[(o[0]-f[0])*b,(o[1]-f[1])*b];return{pixelSize:a,center:[f[0]+b[0],f[1]+b[1]]}},_mouseWheelFinish:function(){H=null;if(D!=0){var a=this._getWheelCenterAndSize();D=0;this._setCenterAndSize(a.center,a.pixelSize,true,true)}else this._refresh()},_panEnd:function(){M=[M[0]>0?Math.floor(M[0]*da[0]):Math.ceil(M[0]*
da[0]),M[1]>0?Math.floor(M[1]*da[1]):Math.ceil(M[1]*da[1])];if(Math.abs(M[0])<4&&Math.abs(M[1])<4)this._panFinalize();else{I=[I[0]+M[0],I[1]+M[1]];this._panMove();setTimeout(d.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(ga){M=[0,0];this._setCenterAndSize([o[0]+-(I[0]-Z[0])*m,o[1]+(I[1]-Z[1])*m],m,true,true);A=false;Z=I;P=ga=false;k.css("cursor",p.cursors[p.mode])}},_panMove:function(){var a=I[0]-ca[0],b=I[1]-ca[1];if(P||a>3||a<-3||b>3||b<-3){if(!P){P=true;k.css("cursor",p.cursors.pan)}if(s)M=
[a,b];if(a!=0||b!=0){ga=true;ca=I;for(i=0;i<p.services.length;i++){var f=p.services[i];p._serviceTypes[f.type].interactivePan(this,f,a,b)}}}},_refresh:function(){for(var a=0;a<p.services.length;a++){var b=p.services[a];!s&&p._serviceTypes[b.type]!=null&&p._serviceTypes[b.type].refresh(this,b)}},_setCenterAndSize:function(a,b,f,t){if(m!=b)for(f=0;f<p.services.length;f++){var v=p.services[f];p._serviceTypes[v.type].interactiveScale(this,v,a,b)}o=a;m=b;if(d.geo.proj){a=this._getBbox();a=d.geo.proj.toGeodetic([[a[0],
a[1]],[a[2],a[3]]]);a=[a[0][0],a[0][1],a[1][0],a[1][1]];p.bbox=a;p[o]=d.geo.proj.toGeodetic([[o[0],o[1]]])[0]}else{p.bbox=this._getBbox();p[o]=o}p.zoom=this._getZoom();t&&this._refresh()},_toMap:function(a,b,f){var t=d.isArray(a[0]);t||(a=[a]);b=b||o;f=f||m;var v=e.width,q=e.height,z=v/2*f;f=q/2*f;var x=[b[0]-z,b[1]-f,b[0]+z,b[1]+f],w=d.geo._width(x)/v,r=d.geo._height(x)/q,u=[];d.each(a,function(K){u[K]=[x[0]+this[0]*w,x[3]-this[1]*r]});return t?u:u[0]},_toPixel:function(a,b,f){var t=d.isArray(a[0]);
t||(a=[a]);b=b||o;f=f||m;var v=e.width,q=e.height,z=v/2*f;f=q/2*f;var x=[b[0]-z,b[1]-f,b[0]+z,b[1]+f],w=d.geo._width(x),r=d.geo._height(x),u=[];d.each(a,function(K){u[K]=[(this[0]-x[0])*v/w,(x[3]-this[1])*q/r]});return t?u:u[0]},_zoomTo:function(a,b){b=b<0?0:b;var f=this._getTiledPixelSize(b);if(isNaN(f)){f=d.geo._scaleBy(this._getBboxMax(),1/Math.pow(2,b));f=Math.max(d.geo._width(f)/e.width,d.geo._height(f)/e.height);this._setCenterAndSize(a,f,false,true)}else this._setCenterAndSize(a,f,false,true)},
_eventTarget_dblclick:function(a){this._panFinalize();d(a.currentTarget).offset();switch(p.mode){case "pan":this._zoomTo(this._toMap(I),this._getZoom()+1)}A=false},_eventTarget_touchstart:function(a){if(!(!$&&a.which!=1)){if(ja){var b=d.now();aa=b-ha<750?aa?false:ea:false;ea=true;ha=b}a.preventDefault();this._panFinalize();this._mouseWheelFinish();b=d(a.currentTarget).offset();I=$?[a.originalEvent.changedTouches[0].pageX-b.left,a.originalEvent.changedTouches[0].pageY-b.top]:[a.pageX-b.left,a.pageY-
b.top];s=true;Z=I;if(!A&&a.shiftKey){ba=true;k.css("cursor",p.cursors.zoom)}else{A=true;switch(p.mode){case "pan":ca=I;a.currentTarget.setCapture&&a.currentTarget.setCapture()}}return false}},_dragTarget_touchmove:function(a){var b=k.offset();a=$?[a.originalEvent.changedTouches[0].pageX-b.left,a.originalEvent.changedTouches[0].pageY-b.top]:[a.pageX-b.left,a.pageY-b.top];if(!(a[0]==fa[0]&&a[1]==fa[1])){if(ja)aa=ea=false;if(s){I=a;ia=d.now()}switch(ba?"zoom":p.mode){case "pan":s&&this._panMove()}fa=
a}},_dragTarget_touchstop:function(a){!s&&la==7&&this._eventTarget_touchstart(a);var b=s,f=k.offset();f=$?[a.originalEvent.changedTouches[0].pageX-f.left,a.originalEvent.changedTouches[0].pageY-f.top]:[a.pageX-f.left,a.pageY-f.top];var t=ba?"zoom":p.mode;k.css("cursor",p.cursors[t]);ba=s=P=false;document.releaseCapture&&document.releaseCapture();if(b){b=d.now();I=f;switch(t){case "pan":b-ia>500?this._panFinalize():this._panEnd()}if(ja&&aa){aa=ea=false;k.trigger("dblclick",a)}}},_eventTarget_mousewheel:function(a,
b){this._panFinalize();if(!s)if(b!=0){if(H){window.clearTimeout(H);H=null}else{var f=d(a.currentTarget).offset();Z=[a.pageX-f.left,a.pageY-f.top]}D+=b;f=this._getWheelCenterAndSize();for(i=0;i<p.services.length;i++){var t=p.services[i];p._serviceTypes[t.type].interactiveScale(this,t,f.center,f.pixelSize)}var v=this;this._wheelTimer=window.setTimeout(function(){v._mouseWheelFinish()},1E3)}}}}())})(jQuery);
