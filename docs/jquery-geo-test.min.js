document.createElement("canvas").getContext||function(){function d(){return this.context_||(this.context_=new w(this))}function E(e,l){var q=ja.call(arguments,2);return function(){return e.apply(l,q.concat(ja.call(arguments)))}}function J(e){e.namespaces.g_vml_||e.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");e.namespaces.g_o_||e.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!e.styleSheets.ex_canvas_){e=e.createStyleSheet();e.owningElement.id=
"ex_canvas_";e.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}"}}function j(e){var l=e.srcElement;switch(e.propertyName){case "width":l.getContext().clearRect();l.style.width=l.attributes.width.nodeValue+"px";l.firstChild.style.width=l.clientWidth+"px";break;case "height":l.getContext().clearRect();l.style.height=l.attributes.height.nodeValue+"px";l.firstChild.style.height=l.clientHeight+"px"}}function f(e){e=e.srcElement;if(e.firstChild){e.firstChild.style.width=
e.clientWidth+"px";e.firstChild.style.height=e.clientHeight+"px"}}function k(){return[[1,0,0],[0,1,0],[0,0,1]]}function c(e,l){for(var q=k(),v=0;v<3;v++)for(var A=0;A<3;A++){for(var p=0,Y=0;Y<3;Y++)p+=e[v][Y]*l[Y][A];q[v][A]=p}return q}function m(e,l){l.fillStyle=e.fillStyle;l.lineCap=e.lineCap;l.lineJoin=e.lineJoin;l.lineWidth=e.lineWidth;l.miterLimit=e.miterLimit;l.shadowBlur=e.shadowBlur;l.shadowColor=e.shadowColor;l.shadowOffsetX=e.shadowOffsetX;l.shadowOffsetY=e.shadowOffsetY;l.strokeStyle=e.strokeStyle;
l.globalAlpha=e.globalAlpha;l.font=e.font;l.textAlign=e.textAlign;l.textBaseline=e.textBaseline;l.arcScaleX_=e.arcScaleX_;l.arcScaleY_=e.arcScaleY_;l.lineScale_=e.lineScale_}function s(e){var l=e.indexOf("(",3),q=e.indexOf(")",l+1);l=e.substring(l+1,q).split(",");if(l.length!=4||e.charAt(3)!="a")l[3]=1;return l}function g(e,l,q){return Math.min(q,Math.max(l,e))}function o(e,l,q){q<0&&q++;q>1&&q--;return 6*q<1?e+(l-e)*6*q:2*q<1?l:3*q<2?e+(l-e)*(2/3-q)*6:e}function n(e){if(e in ma)return ma[e];var l,
q=1;e=String(e);if(e.charAt(0)=="#")l=e;else if(/^rgb/.test(e)){q=s(e);l="#";for(var v,A=0;A<3;A++){v=q[A].indexOf("%")!=-1?Math.floor(parseFloat(q[A])/100*255):+q[A];l+=ea[g(v,0,255)]}q=+q[3]}else if(/^hsl/.test(e)){A=q=s(e);l=parseFloat(A[0])/360%360;l<0&&l++;v=g(parseFloat(A[1])/100,0,1);A=g(parseFloat(A[2])/100,0,1);if(v==0)v=A=l=A;else{var p=A<0.5?A*(1+v):A+v-A*v,Y=2*A-p;v=o(Y,p,l+1/3);A=o(Y,p,l);l=o(Y,p,l-1/3)}l="#"+ea[Math.floor(v*255)]+ea[Math.floor(A*255)]+ea[Math.floor(l*255)];q=q[3]}else l=
e;return ma[e]={color:l,alpha:q}}function w(e){this.m_=k();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=aa*1;this.globalAlpha=1;this.canvas=e;var l="width:"+e.clientWidth+"px;height:"+e.clientHeight+"px;overflow:hidden;position:absolute",q=e.ownerDocument.createElement("div");q.style.cssText=l;e.appendChild(q);l=q.cloneNode(false);l.style.backgroundColor="red";l.style.filter="alpha(opacity=0)";
e.appendChild(l);this.element_=q;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1}function I(e,l,q,v){e.currentPath_.push({type:"bezierCurveTo",cp1x:l.x,cp1y:l.y,cp2x:q.x,cp2y:q.y,x:v.x,y:v.y});e.currentX_=v.x;e.currentY_=v.y}function G(e,l,q){e=e.m_;return{x:aa*(l*e[0][0]+q*e[1][0]+e[2][0])-ba,y:aa*(l*e[0][1]+q*e[1][1]+e[2][1])-ba}}function P(e,l,q){if(isFinite(l[0][0])&&isFinite(l[0][1])&&isFinite(l[1][0])&&isFinite(l[1][1])&&isFinite(l[2][0])&&isFinite(l[2][1])){e.m_=l;if(q)e.lineScale_=na(Q(l[0][0]*
l[1][1]-l[0][1]*l[1][0]))}}function M(e){this.code=this[e];this.message=e+": DOM Exception "+this.code}var H=Math,D=H.round,V=H.sin,fa=H.cos,Q=H.abs,na=H.sqrt,aa=10,ba=aa/2;navigator.userAgent.match(/MSIE ([\d.]+)?/);var ja=Array.prototype.slice;J(document);H={init:function(e){e=e||document;e.createElement("canvas");e.attachEvent("onreadystatechange",E(this.init_,this,e))},init_:function(e){e=e.getElementsByTagName("canvas");for(var l=0;l<e.length;l++)this.initElement(e[l])},initElement:function(e){if(!e.getContext){e.getContext=
d;J(e.ownerDocument);e.innerHTML="";e.attachEvent("onpropertychange",j);e.attachEvent("onresize",f);var l=e.attributes;if(l.width&&l.width.specified)e.style.width=l.width.nodeValue+"px";else e.width=e.clientWidth;if(l.height&&l.height.specified)e.style.height=l.height.nodeValue+"px";else e.height=e.clientHeight}return e}};H.init();for(var ea=[],y=0;y<16;y++)for(var ga=0;ga<16;ga++)ea[y*16+ga]=y.toString(16)+ga.toString(16);var ma={},ha={butt:"flat",round:"round"};y=w.prototype;y.clearRect=function(){if(this.textMeasureEl_){this.textMeasureEl_.removeNode(true);
this.textMeasureEl_=null}this.element_.innerHTML=""};y.beginPath=function(){this.currentPath_=[]};y.moveTo=function(e,l){var q=G(this,e,l);this.currentPath_.push({type:"moveTo",x:q.x,y:q.y});this.currentX_=q.x;this.currentY_=q.y};y.lineTo=function(e,l){var q=G(this,e,l);this.currentPath_.push({type:"lineTo",x:q.x,y:q.y});this.currentX_=q.x;this.currentY_=q.y};y.bezierCurveTo=function(e,l,q,v,A,p){A=G(this,A,p);e=G(this,e,l);q=G(this,q,v);I(this,e,q,A)};y.quadraticCurveTo=function(e,l,q,v){e=G(this,
e,l);q=G(this,q,v);v={x:this.currentX_+2/3*(e.x-this.currentX_),y:this.currentY_+2/3*(e.y-this.currentY_)};I(this,v,{x:v.x+(q.x-this.currentX_)/3,y:v.y+(q.y-this.currentY_)/3},q)};y.arc=function(e,l,q,v,A,p){q*=aa;var Y=p?"at":"wa",a=e+fa(v)*q-ba,b=l+V(v)*q-ba;v=e+fa(A)*q-ba;A=l+V(A)*q-ba;if(a==v&&!p)a+=0.125;e=G(this,e,l);a=G(this,a,b);v=G(this,v,A);this.currentPath_.push({type:Y,x:e.x,y:e.y,radius:q,xStart:a.x,yStart:a.y,xEnd:v.x,yEnd:v.y})};y.stroke=function(e){var l=[];l.push("<g_vml_:shape",
' filled="',!!e,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0,0"',' coordsize="',aa*10,",",aa*10,'"',' stroked="',!e,'"',' path="');for(var q={x:null,y:null},v={x:null,y:null},A=0;A<this.currentPath_.length;A++){var p=this.currentPath_[A];switch(p.type){case "moveTo":l.push(" m ",D(p.x),",",D(p.y));break;case "lineTo":l.push(" l ",D(p.x),",",D(p.y));break;case "close":l.push(" x ");p=null;break;case "bezierCurveTo":l.push(" c ",D(p.cp1x),",",D(p.cp1y),",",D(p.cp2x),
",",D(p.cp2y),",",D(p.x),",",D(p.y));break;case "at":case "wa":l.push(" ",p.type," ",D(p.x-this.arcScaleX_*p.radius),",",D(p.y-this.arcScaleY_*p.radius)," ",D(p.x+this.arcScaleX_*p.radius),",",D(p.y+this.arcScaleY_*p.radius)," ",D(p.xStart),",",D(p.yStart)," ",D(p.xEnd),",",D(p.yEnd))}if(p){if(q.x==null||p.x<q.x)q.x=p.x;if(v.x==null||p.x>v.x)v.x=p.x;if(q.y==null||p.y<q.y)q.y=p.y;if(v.y==null||p.y>v.y)v.y=p.y}}l.push(' ">');if(e){e=n(this.fillStyle);l.push('<g_vml_:fill color="',e.color,'" opacity="',
e.alpha*this.globalAlpha,'" />')}else{q=n(this.strokeStyle);e=q.color;q=q.alpha*this.globalAlpha;v=this.lineScale_*this.lineWidth;if(v<1)q*=v;l.push("<g_vml_:stroke",' opacity="',q,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',ha[this.lineCap]||"square",'"',' weight="',v,'px"',' color="',e,'" />')}l.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",l.join(""))};y.fill=function(){this.stroke(true)};y.closePath=function(){this.currentPath_.push({type:"close"})};
y.save=function(){var e={};m(this,e);this.aStack_.push(e);this.mStack_.push(this.m_);this.m_=c(k(),this.m_)};y.restore=function(){if(this.aStack_.length){m(this.aStack_.pop(),this);this.m_=this.mStack_.pop()}};y.translate=function(e,l){P(this,c([[1,0,0],[0,1,0],[e,l,1]],this.m_),false)};y.scale=function(e,l){this.arcScaleX_*=e;this.arcScaleY_*=l;P(this,c([[e,0,0],[0,l,0],[0,0,1]],this.m_),true)};y=M.prototype=Error();y.INDEX_SIZE_ERR=1;y.DOMSTRING_SIZE_ERR=2;y.HIERARCHY_REQUEST_ERR=3;y.WRONG_DOCUMENT_ERR=
4;y.INVALID_CHARACTER_ERR=5;y.NO_DATA_ALLOWED_ERR=6;y.NO_MODIFICATION_ALLOWED_ERR=7;y.NOT_FOUND_ERR=8;y.NOT_SUPPORTED_ERR=9;y.INUSE_ATTRIBUTE_ERR=10;y.INVALID_STATE_ERR=11;y.SYNTAX_ERR=12;y.INVALID_MODIFICATION_ERR=13;y.NAMESPACE_ERR=14;y.INVALID_ACCESS_ERR=15;y.VALIDATION_ERR=16;y.TYPE_MISMATCH_ERR=17;G_vmlCanvasManager=H;CanvasRenderingContext2D=w;DOMException=M}();
(function(d){function E(j){var f=[].slice.call(arguments,1),k=0;j=d.event.fix(j||window.event);j.type="mousewheel";if(j.wheelDelta)k=j.wheelDelta/120;if(j.detail)k=-j.detail/3;f.unshift(j,k);return d.event.handle.apply(this,f)}var J=["DOMMouseScroll","mousewheel"];d.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var j=J.length;j;)this.addEventListener(J[--j],E,false);else this.onmousewheel=E},teardown:function(){if(this.removeEventListener)for(var j=J.length;j;)this.removeEventListener(J[--j],
E,false);else this.onmousewheel=null}};d.fn.extend({mousewheel:function(j){return j?this.bind("mousewheel",j):this.trigger("mousewheel")},unmousewheel:function(j){return this.unbind("mousewheel",j)}})})(jQuery);
$.widget||function(d,E){var J=Array.prototype.slice,j=d.cleanData;d.cleanData=function(f){for(var k=0,c;(c=f[k])!=null;k++)d(c).triggerHandler("remove");j(f)};d.widget=function(f,k,c){var m=f.split(".")[0],s;f=f.split(".")[1];s=m+"-"+f;if(!c){c=k;k=d.Widget}d.expr[":"][s]=function(o){return!!d.data(o,f)};d[m]=d[m]||{};d[m][f]=d.extend(function(o,n){if(!this._createWidget)return new d[m][f](o,n);arguments.length&&this._createWidget(o,n)},d[m][f]);var g=new k;g.options=d.extend(true,{},g.options);d.each(c,
function(o,n){if(d.isFunction(n))c[o]=function(){var w=function(G){return k.prototype[G].apply(this,J.call(arguments,1))},I=function(G,P){return k.prototype[G].apply(this,P)};return function(){var G=this._super,P=this._superApply,M;this._super=w;this._superApply=I;M=n.apply(this,arguments);this._super=G;this._superApply=P;return M}}()});d[m][f].prototype=d.extend(true,g,{namespace:m,widgetName:f,widgetEventPrefix:f,widgetBaseClass:s},c);d.widget.bridge(f,d[m][f])};d.widget.bridge=function(f,k){d.fn[f]=
function(c){var m=typeof c==="string",s=J.call(arguments,1),g=this;c=!m&&s.length?d.extend.apply(null,[true,c].concat(s)):c;m?this.each(function(){var o=d.data(this,f);if(!o)return d.error("cannot call methods on "+f+" prior to initialization; attempted to call method '"+c+"'");if(!d.isFunction(o[c])||c.charAt(0)==="_")return d.error("no such method '"+c+"' for "+f+" widget instance");var n=o[c].apply(o,s);if(n!==o&&n!==E){g=n;return false}}):this.each(function(){var o=d.data(this,f);o?o.option(c||
{})._init():k(c,this)});return g}};d.Widget=function(f,k){if(!this._createWidget)return new d[namespace][name](f,k);arguments.length&&this._createWidget(f,k)};d.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false},_createWidget:function(f,k){k=d(k||this.defaultElement||this)[0];this.element=d(k);this.options=d.extend(true,{},this.options,this._getCreateOptions(),f);this.bindings=d();this.hoverable=d();this.focusable=d();if(k!==this){d.data(k,this.widgetName,
this);this._bind({remove:"destroy"})}this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return d.metadata&&d.metadata.get(this.element[0])[this.widgetName]},_create:d.noop,_init:d.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");
this.focusable.removeClass("ui-state-focus")},_destroy:d.noop,widget:function(){return this.element},option:function(f,k){var c=f;if(arguments.length===0)return d.extend({},this.options);if(typeof f==="string"){if(k===E)return this.options[f];c={};c[f]=k}this._setOptions(c);return this},_setOptions:function(f){var k=this;d.each(f,function(c,m){k._setOption(c,m)});return this},_setOption:function(f,k){this.options[f]=k;if(f==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",
!!k).attr("aria-disabled",k);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_bind:function(f,k){if(k){f=d(f);this.bindings=this.bindings.add(f)}else{k=f;f=this.element}var c=this;d.each(k,function(m,s){f.bind(m+"."+c.widgetName,function(){if(!(c.options.disabled===true||d(this).hasClass("ui-state-disabled")))return(typeof s===
"string"?c[s]:s).apply(c,arguments)})})},_hoverable:function(f){this.hoverable=this.hoverable.add(f);this._bind(f,{mouseenter:function(k){d(k.currentTarget).addClass("ui-state-hover")},mouseleave:function(k){d(k.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(f){this.focusable=this.focusable.add(f);this._bind(f,{focusin:function(k){d(k.currentTarget).addClass("ui-state-focus")},focusout:function(k){d(k.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(f,k,c){var m=
this.options[f];k=d.Event(k);k.type=(f===this.widgetEventPrefix?f:this.widgetEventPrefix+f).toLowerCase();c=c||{};if(k.originalEvent){f=d.event.props.length;for(var s;f;){s=d.event.props[--f];k[s]=k.originalEvent[s]}}this.element.trigger(k,c);c=d.isArray(c)?[k].concat(c):[k,c];return!(d.isFunction(m)&&m.apply(this.element[0],c)===false||k.isDefaultPrevented())}}}(jQuery);
(function(d){var E=Number.POSITIVE_INFINITY,J=Number.NEGATIVE_INFINITY;d.geo={_allCoordinates:function(j){j=this._flatten(j);for(var f=0,k=[];f<j.length;f++){var c=j[f].coordinates,m=d.isArray(c[0]),s=m&&d.isArray(c[0][0]),g;if(!(s&&d.isArray(c[0][0][0]))){if(!s){m||(c=[c]);c=[c]}c=[c]}for(m=0;m<c.length;m++)for(s=0;s<c[m].length;s++)for(g=0;g<c[m][s].length;g++)k.push(c[m][s][g])}return k},_center:function(j){return[(j[0]+j[2])/2,(j[1]+j[3])/2]},_expandBy:function(j,f,k){j=this._center(j);return[j[0]-
f,j[1]-k,j[0]+f,j[1]+k]},_height:function(j){return j[3]-j[1]},_reaspect:function(j,f){var k=this._width(j),c=this._height(j),m=this._center(j);if(k==0||c==0||f<=0)return j;if(k/c>f){k=k/2;c=k/f}else{c=c/2;k=c*f}return[m[0]-k,m[1]-c,m[0]+k,m[1]+c]},_scaleBy:function(j,f){return this._expandBy(j,this._width(j)*f/2,this._height(j)*f/2)},_width:function(j){return j[2]-j[0]},_bbox:function(j){var f=d(j).data("bbox");if(!f)if(j.bbox)d(j).data("bbox",f=j.bbox);else{f=[E,E,J,J];for(var k=this._allCoordinates(j),
c=0;c<k.length;c++){f[0]=Math.min(k[c][0],f[0]);f[1]=Math.min(k[c][1],f[1]);f[2]=Math.max(k[c][0],f[2]);f[3]=Math.max(k[c][1],f[3])}d(j).data("bbox",f)}return f},_contains:function(j,f){if(j.type!="Polygon")return false;switch(f.type){case "Point":return this._containsPolygonPoint(j.coordinates,f.coordinates);case "LineString":return this._containsPolygonLineString(j.coordinates,f.coordinates);case "Polygon":return this._containsPolygonLineString(j.coordinates,f.coordinates[0])}},_containsPolygonPoint:function(j,
f){if(j.length==0||j[0].length<4)return false;for(var k=0,c=j[0][0],m=1,s;m<j[0].length;m++){s=j[0][m];if(c[1]<=f[1]&&f[1]<s[1]||s[1]<=f[1]&&f[1]<c[1]&&(f[0]<c[0]||f[0]<s[0])){c=c[0]+(s[0]-c[0])*(f[1]-c[1])/(s[1]-c[1]);c>f[0]&&k++}c=s}return k%2==1},_containsPolygonLineString:function(j,f){for(var k=0;k<f.length;k++)if(!this._containsPolygonPoint(j,f[k]))return false;return true},_distance:function(j,f){var k=d.isArray(j)?j:j.coordinates,c=d.isArray(f)?f:f.coordinates;k=d.geo.proj?d.geo.proj.fromGeodetic(k):
k;c=d.geo.proj?d.geo.proj.fromGeodetic(c):c;switch(j.type){case "Point":switch(f.type){case "Point":return this._distancePointPoint(c,k);case "LineString":return this._distanceLineStringPoint(c,k);case "Polygon":return this._containsPolygonPoint(c,k)?0:this._distanceLineStringPoint(c[0],k);default:throw Error("not implemented");}case "LineString":switch(f.type){case "Point":return this._distanceLineStringPoint(k,c);case "LineString":return this._distanceLineStringLineString(k,c);case "Polygon":return this._containsPolygonLineString(c,
k)?0:this._distanceLineStringLineString(c[0],k);default:throw Error("not implemented");}case "Polygon":switch(f.type){case "Point":return this._containsPolygonPoint(k,c)?0:this._distanceLineStringPoint(k[0],c);case "LineString":return this._containsPolygonLineString(k,c)?0:this._distanceLineStringLineString(k[0],c);case "Polygon":return this._containsPolygonLineString(k,c[0])?0:this._distanceLineStringLineString(k[0],c[0]);default:throw Error("not implemented");}}},_distancePointPoint:function(j,
f){var k=f[0]-j[0],c=f[1]-j[1];return Math.sqrt(k*k+c*c)},_distanceLineStringPoint:function(j,f){var k=E;if(j.length>0){var c=j[0],m=f[0]-c[0],s=f[1]-c[1];if(j.length==1)return Math.sqrt(m*m+s*s);else for(var g=1;g<j.length;g++){var o=j[g],n=f[0]-o[0],w=f[1]-o[1];c=this._distanceSegmentPoint(o[0]-c[0],o[1]-c[1],m,s,n,w);if(c==0)return 0;if(c<k)k=c;c=o;m=n;s=w}}return Math.sqrt(k)},_distanceSegmentPoint:function(j,f,k,c,m,s){var g=j*k+f*c;if(g<=0)return k*k+c*c;j=j*j+f*f;if(g>=j)return m*m+s*s;return k*
k+c*c-g*g/j},_distanceLineStringLineString:function(j,f){for(var k=E,c=0;c<f;c++)k=Math.min(k,this._distanceLineStringPoint(j,f[c]));return k},_flatten:function(j){var f=[];switch(j.type){case "Feature":d.merge(f,this._flatten(j.geometry));break;case "GeometryCollection":for(curGeom=0;curGeom<j.geometries.length;curGeom++)d.merge(f,this._flatten(j.geometries[curGeom]));break;default:f[0]=j}return f},proj:function(){function j(c){return c>Math.PI?c-=f:c<-Math.PI?c+=f:c}var f=6.283185307179586;this.CoordinateSystem=
function(c,m,s,g){if(arguments.length<2)m=0;if(arguments.length<3)s=0;if(arguments.length<4)g=1;switch(g){case "meters":g=1;break;case "feet":g=3.2808333333333333}this.toGeodetic=function(o){return c.toGeodetic({x:(o.x-m)/g,y:(o.y-s)/g})};this.toProjected=function(o){o=c.toProjected(o);return{x:o.x*g+m,y:o.y*g+s}}};this.Mercator=function(c,m,s){c*=0.017453292519943295;m*=0.017453292519943295;var g=s.e*s.e,o=Math.sin(m),n=1/(Math.sqrt(1-g*o*o)/Math.cos(m));m=g*g;o=m*g;var w=o*g,I=g/2+5*m/24+o/12+13*
w/360,G=7*m/48+29*o/240+811*w/11520,P=7*o/120+81*w/1120,M=4279*w/161280;this.toGeodetic=function(H){var D=j(c+H.x/(n*s.smaj));H=1.5707963267948966-2*Math.atan(1/Math.exp(H.y/(n*s.smaj)));return{x:D*57.29577951308232,y:(H+I*Math.sin(2*H)+G*Math.sin(4*H)+P*Math.sin(6*H)+M*Math.sin(8*H))*57.29577951308232}};this.toProjected=function(H){var D=H.y*0.017453292519943295,V=s.e*Math.sin(D);D=Math.tan(Math.PI/4+D/2)*Math.pow((1-V)/(1+V),s.e/2);H=j(H.x*0.017453292519943295-c);return{x:n*s.smaj*H,y:n*s.smaj*
Math.log(D)}}};this.Spheroid=function(c,m){switch(typeof c){case "number":this.smaj=c;this.e=m;break;case "string":switch(c){case "WGS84Sphere":this.smaj=6378137;this.e=0}}this.smin=this.smaj*Math.sqrt(1-this.e*this.e);var s=(this.smaj-this.smin)/this.smaj;this.distance=function(g,o,n){if(arguments.length<3)n=1;switch(n){case "meters":n=1;break;case "feet":n=3.2808333333333333}var w=g.y*0.017453292519943295,I=o.y*0.017453292519943295,G=(w+I)*0.5,P=(w-I)*0.5,M=(g.x*0.017453292519943295-o.x*0.017453292519943295)*
0.5;w=Math.sin(G);w*=w;G=Math.cos(G);G*=G;I=Math.sin(P);I*=I;P=Math.cos(P);P*=P;var H=Math.sin(M);H*=H;var D=Math.cos(M);D*=D;M=I*D+G*H;H=P*D+w*H;D=Math.atan(Math.sqrt(M/H));var V=Math.sqrt(M*H)/D;return 2*this.smaj*D*(1+s*((3*V-1)/(2*H)*w*P-(3*V+1)/(2*M)*G*I))*n}};var k=new Mercator(0,0,new Spheroid("WGS84Sphere"));return{fromGeodeticPos:function(c){c=k.toProjected({x:c[0],y:c[1]});return[c.x,c.y]},fromGeodetic:function(c){var m=d.isArray(c[0]),s=m&&d.isArray(c[0][0]),g=s&&d.isArray(c[0][0][0]),
o=[[[]]],n=this.fromGeodeticPos;if(!g){if(!s){m||(c=[c]);c=[c]}c=[c]}d.each(c,function(w){d.each(this,function(I){d.each(this,function(G){o[w][I][G]=n(this)})})});return g?o:s?o[0]:m?o[0][0]:o[0][0][0]},toGeodeticPos:function(c){c=k.toGeodetic({x:c[0],y:c[1]});return[c.x,c.y]},toGeodetic:function(c){var m=d.isArray(c[0]),s=m&&d.isArray(c[0][0]),g=s&&d.isArray(c[0][0][0]),o=[[[]]],n=this.toGeodeticPos;if(!g){if(!s){m||(c=[c]);c=[c]}c=[c]}d.each(c,function(w){d.each(this,function(I){d.each(this,function(G){o[w][I][G]=
n(this)})})});return g?o:s?o[0]:m?o[0][0]:o[0][0][0]}}}()}})(jQuery,this);
(function(d){var E,J,j=true,f,k,c,m,s=function(){for(var g=5,o=document.createElement("div"),n=o.all||[];o.innerHTML="<!--[if gt IE "+ ++g+"]><br><![endif]--\>",n[0];);return g>6?g:!g}();d.widget("geo.geographics",{options:{style:{borderRadius:"8px",color:"#7f0000",fillOpacity:0.2,height:"8px",opacity:1,strokeOpacity:1,strokeWidth:"2px",visibility:"visible",width:"8px"}},_create:function(){E=this.element;J=this.options;E.css({display:"inline-block",overflow:"hidden",textAlign:"left"});E.css("position")==
"static"&&E.css("position","relative");f=E.width();k=E.height();if(!(f&&k)){f=parseInt(E.css("width"));k=parseInt(E.css("height"))}if(document.createElement("canvas").getContext){E.append('<canvas width="'+f+'" height="'+k+'" style="position:absolute; left:0; top:0; width:'+f+"px; height:"+k+'px;"></canvas>');c=E.children(":last");m=c[0].getContext("2d")}else if(s<=8){j=false;E.append('<div width="'+f+'" height="'+k+'" style="position:absolute; left:0; top:0; width:'+f+"px; height:"+k+'px; margin:0; padding:0;"></div>');
c=E.children(":last");G_vmlCanvasManager.initElement(c[0]);m=c[0].getContext("2d");c.children().css({backgroundColor:"transparent",width:f,height:k})}},_setOption:function(g,o){if(g=="style")o=d.extend({},J.style,o);d.Widget.prototype._setOption.apply(this,arguments)},destroy:function(){d.Widget.prototype.destroy.apply(this,arguments);E.html("")},clear:function(){m.clearRect(0,0,f,k)},drawArc:function(g,o,n,w){w=this._getGraphicStyle(w);if(w.visibility!="hidden"&&w.widthValue>0&&w.heightValue>0){var I=
Math.min(w.widthValue,w.heightValue)/2;o=o*Math.PI/180;n=n*Math.PI/180;m.save();m.translate(g[0],g[1]);w.widthValue>w.heightValue?m.scale(w.widthValue/w.heightValue,1):m.scale(1,w.heightValue/w.widthValue);m.beginPath();m.arc(0,0,I,o,n,false);j&&m.restore();if(w.doFill){m.fillStyle=w.fill;m.globalAlpha=w.opacity*w.fillOpacity;m.fill()}if(w.doStroke){m.lineJoin="round";m.lineWidth=w.strokeWidthValue;m.strokeStyle=w.stroke;m.globalAlpha=w.opacity*w.strokeOpacity;m.stroke()}j||m.restore()}},drawPoint:function(g,
o){var n=this._getGraphicStyle(o);if(n.widthValue==n.heightValue&&n.heightValue==n.borderRadiusValue)this.drawArc(g,0,360,o);else if(n.visibility!="hidden"){n.borderRadiusValue=Math.min(Math.min(n.widthValue,n.heightValue)/2,n.borderRadiusValue);g[0]-=n.widthValue/2;g[1]-=n.heightValue/2;m.beginPath();m.moveTo(g[0]+n.borderRadiusValue,g[1]);m.lineTo(g[0]+n.widthValue-n.borderRadiusValue,g[1]);m.quadraticCurveTo(g[0]+n.widthValue,g[1],g[0]+n.widthValue,g[1]+n.borderRadiusValue);m.lineTo(g[0]+n.widthValue,
g[1]+n.heightValue-n.borderRadiusValue);m.quadraticCurveTo(g[0]+n.widthValue,g[1]+n.heightValue,g[0]+n.widthValue-n.borderRadiusValue,g[1]+n.heightValue);m.lineTo(g[0]+n.borderRadiusValue,g[1]+n.heightValue);m.quadraticCurveTo(g[0],g[1]+n.heightValue,g[0],g[1]+n.heightValue-n.borderRadiusValue);m.lineTo(g[0],g[1]+n.borderRadiusValue);m.quadraticCurveTo(g[0],g[1],g[0]+n.borderRadiusValue,g[1]);m.closePath();if(n.doFill){m.fillStyle=n.fill;m.globalAlpha=n.opacity*n.fillOpacity;m.fill()}if(n.doStroke){m.lineJoin=
"round";m.lineWidth=n.strokeWidthValue;m.strokeStyle=n.stroke;m.globalAlpha=n.opacity*n.strokeOpacity;m.stroke()}}},drawLineString:function(g,o){this._drawLines([g],false,o)},drawPolygon:function(g,o){this._drawLines(g,true,o)},drawBbox:function(g,o){this._drawLines([[[g[0],g[1]],[g[0],g[3]],[g[2],g[3]],[g[2],g[1]],[g[0],g[1]]]],true,o)},_getGraphicStyle:function(g){function o(n){n=parseInt(n);return+n+""===n?+n:n}g=d.extend({},J.style,g);g.borderRadiusValue=o(g.borderRadius);g.fill=g.fill||g.color;
g.fillOpacity=g.fillOpacity||g.opacity;g.doFill=g.fill&&g.fillOpacity>0;g.stroke=g.stroke||g.color;g.strokeOpacity=g.strokeOpacity||g.opacity;g.strokeWidthValue=o(g.strokeWidth);g.doStroke=g.stroke&&g.strokeOpacity>0&&g.strokeWidthValue>0;g.widthValue=o(g.width);g.heightValue=o(g.height);return g},_drawLines:function(g,o,n){if(!(!g||!g.length||g[0].length<2)){n=this._getGraphicStyle(n);var w,I;if(n.visibility!="hidden"){m.beginPath();m.moveTo(g[0][0][0],g[0][0][1]);var G=g[0][g[0].length-1];for(w=
0;w<g.length;w++){for(I=0;I<g[w].length;I++)m.lineTo(g[w][I][0],g[w][I][1]);if(o&&w>0){m.lineTo(G[0],G[1]);m.closePath()}}if(o&&n.doFill){m.fillStyle=n.fill;m.globalAlpha=n.opacity*n.fillOpacity;m.fill()}if(n.doStroke){m.lineJoin="round";m.lineWidth=n.strokeWidthValue;m.strokeStyle=n.stroke;m.globalAlpha=n.opacity*n.strokeOpacity;m.stroke()}}}}})})(jQuery);
(function(d,E){var J,j={},f,k,c,m,s,g=[],o,n,w,I,G=null,P=0,M,H,D,V,fa,Q,na,aa,ba,ja,ea,y,ga,ma=function(){for(var a=5,b=document.createElement("div"),h=b.all||[];b.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",h[0];);return a>6?a:!a}(),ha,e,l,q,v=[],A={},p={},Y={bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{pan:"move"},mode:"pan",services:[{id:"OSM",type:"tiled",getUrl:function(a){return"http://tile.openstreetmap.org/"+a.zoom+"/"+a.tile.column+"/"+a.tile.row+".png"},
attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},zoom:0,_serviceTypes:{tiled:function(){var a={};return{create:function(b,h){if(!a[h.id]){a[h.id]={loadCount:0,reloadTiles:false,serviceContainer:null};k.append("<div data-service='"+h.id+"' style='position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0; display:"+(h.visible===E||h.visible?
"block":"none")+";'></div>");a[h.id].serviceContainer=k.children("[data-service='"+h.id+"']")}},destroy:function(b,h){a[h.id].serviceContainer.remove();delete a[h.id]},interactivePan:function(b,h,u,t){if(a[h.id]){this._cancelUnloaded(b,h);a[h.id].serviceContainer.children().css({left:function(ia,oa){return parseInt(oa)+u},top:function(ia,oa){return parseInt(oa)+t}});if(h&&a[h.id]!=null&&(h.visible===E||h.visible)){var r=n,z=a[h.id],C=z.serviceContainer,F=C.children("[data-pixelSize='"+r+"']"),x=b.options.tilingScheme,
B=x.tileWidth,K=x.tileHeight,T=j.width/2*r,N=j.height/2*r,O=F.position(),L=F.data("scaleOrigin").split(","),ca=parseInt(L[0])-O.left;O=parseInt(L[1])-O.top;var R=o;L=[R[0]+ca*r,R[1]-O*r];var W=Math.floor((L[0]-T-x.origin[0])/(r*B));ca=Math.floor((x.origin[1]-(L[1]+N))/(r*K));O=Math.ceil((L[0]+T-x.origin[0])/(r*B));L=Math.ceil((x.origin[1]-(L[1]-N))/(r*K));var X=b._getBboxMax(),U=b._getTiledPixelSize(0),S=U/r,Z=Math.floor((X[0]-x.origin[0])/(U*B))*S;X=Math.floor((x.origin[1]-X[3])/(U*K))*S;T=Math.round((x.origin[0]+
Z*B*r-(R[0]-T))/r);N=Math.round((R[1]+N-(x.origin[1]-X*K*r))/r);var ka=h.opacity===E?1:h.opacity;for(R=W;R<O;R++)for(W=ca;W<L;W++){U=""+R+","+W;S=F.children("[data-tile='"+U+"']").removeAttr("data-dirty");if(S.size()===0){var la=[x.origin[0]+R*B*r,x.origin[1]-W*K*r],da=[x.origin[0]+((R+1)*B-1)*r,x.origin[1]-((W+1)*K-1)*r];la=h.getUrl({bbox:[la[0],la[1],da[0],da[1]],width:B,height:K,zoom:b._getZoom(),tile:{row:W,column:R},index:Math.abs(W+R)});z.loadCount++;if(z.reloadTiles&&S.size()>0)S.attr("src",
la);else{S="<img style='position:absolute; left:"+((R-Z)*100+(T-T%B)/B*100)+"%; top:"+((W-X)*100+(N-N%K)/K*100)+"%; ";if(d("body")[0].filters===E)S+="width: 100%; height: 100%;";S+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+U+"' />";F.append(S);S=F.children(":last");S.load(function(ia){ka<1?d(ia.target).fadeTo(0,ka):d(ia.target).show();z.loadCount--;if(z.loadCount<=0){C.children(":not([data-pixelSize='"+
r+"'])").remove();z.loadCount=0}}).error(function(ia){d(ia.target).remove();z.loadCount--;if(z.loadCount<=0){C.children(":not([data-pixelSize='"+r+"'])").remove();z.loadCount=0}}).attr("src",la)}}}}}},interactiveScale:function(b,h,u,t){if(a[h.id]){this._cancelUnloaded(b,h);var r=b.options.tilingScheme,z=r.tileWidth,C=r.tileHeight;a[h.id].serviceContainer.children().each(function(){var F=d(this),x=F.attr("data-pixelSize")/t;x=Math.round(x*1E3)/1E3;var B=F.data("scaleOrigin").split(",");B=b._toMap([B[0],
B[1]]);B=b._toPixel(B,u,t);F.css({left:Math.round(B[0])+"px",top:Math.round(B[1])+"px",width:z*x,height:C*x});d("body")[0].filters!==E&&F.children().each(function(){d(this).css("filter","progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+x+",M22="+x+",sizingmethod='auto expand')")})})}},refresh:function(b,h){if(h&&a[h.id]&&(h.visible===E||h.visible)){this._cancelUnloaded(b,h);var u=b._getBbox(),t=n,r=a[h.id],z=r.serviceContainer,C=b.options.tilingScheme,F=C.tileWidth,x=C.tileHeight,
B=Math.floor((u[0]-C.origin[0])/(t*F)),K=Math.floor((C.origin[1]-u[3])/(t*x)),T=Math.ceil((u[2]-C.origin[0])/(t*F)),N=Math.ceil((C.origin[1]-u[1])/(t*x)),O=b._getBboxMax(),L=b._getTiledPixelSize(0),ca=L/t,R=Math.floor((O[0]-C.origin[0])/(L*F))*ca,W=Math.floor((C.origin[1]-O[3])/(L*x))*ca,X=Math.round((C.origin[0]+R*F*t-u[0])/t),U=Math.round((u[3]-(C.origin[1]-W*x*t))/t);u=z.children().show();O=u.filter("[data-pixelSize='"+t+"']").appendTo(z);var S=h.opacity===E?1:h.opacity;r.reloadTiles&&u.find("img").attr("data-dirty",
"true");if(O.size()){O.css({left:X%F+"px",top:U%x+"px"}).data("scaleOrigin",X%F+","+U%x);O.children().each(function(){var da=d(this),ia=da.attr("data-tile").split(",");da.css({left:Math.round((parseInt(ia[0])-R)*100+(X-X%F)/F*100)+"%",top:Math.round((parseInt(ia[1])-W)*100+(U-U%x)/x*100)+"%"});S<1&&da.fadeTo(0,S)})}else{z.append("<div style='position:absolute; left:"+X%F+"px; top:"+U%x+"px; width:"+F+"px; height:"+x+"px; margin:0; padding:0;' data-pixelSize='"+t+"'></div>");O=z.children(":last").data("scaleOrigin",
X%F+","+U%x)}for(B=B;B<T;B++)for(L=K;L<N;L++){ca=""+B+","+L;var Z=O.children("[data-tile='"+ca+"']").removeAttr("data-dirty");if(Z.size()===0||r.reloadTiles){var ka=[C.origin[0]+B*F*t,C.origin[1]-L*x*t],la=[C.origin[0]+((B+1)*F-1)*t,C.origin[1]-((L+1)*x-1)*t];ka=h.getUrl({bbox:[ka[0],ka[1],la[0],la[1]],width:F,height:x,zoom:b._getZoom(),tile:{row:L,column:B},index:Math.abs(L+B)});r.loadCount++;if(r.reloadTiles&&Z.size()>0)Z.attr("src",ka);else{Z="<img style='position:absolute; left:"+((B-R)*100+(X-
X%F)/F*100)+"%; top:"+((L-W)*100+(U-U%x)/x*100)+"%; ";if(d("body")[0].filters===E)Z+="width: 100%; height: 100%;";Z+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+ca+"' />";O.append(Z);Z=O.children(":last");Z.load(function(da){S<1?d(da.target).fadeTo(0,S):d(da.target).show();r.loadCount--;if(r.loadCount<=0){z.children(":not([data-pixelSize='"+t+"'])").remove();r.loadCount=0}}).error(function(da){d(da.target).remove();
r.loadCount--;if(r.loadCount<=0){z.children(":not([data-pixelSize='"+t+"'])").remove();r.loadCount=0}}).attr("src",ka)}}}u.find("[data-dirty]").remove();r.reloadTiles=false}},_cancelUnloaded:function(b,h){var u=a[h.id];if(u&&u.loadCount>0)for(u.serviceContainer.find("img:hidden").remove();u.loadCount>0;)u.loadCount--}}}(),shingled:function(){var a={};return{create:function(b,h){if(!a[h.id]){a[h.id]={loadCount:0};k.append('<div data-service="'+h.id+'" style="position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0; display:'+
(h.visible===E||h.visible?"block":"none")+';"></div>');a[h.id].serviceContainer=k.children('[data-service="'+h.id+'"]')}},destroy:function(b,h){a[h.id].serviceContainer.remove();delete a[h.id]},interactivePan:function(b,h,u,t){if(a[h.id]){this._cancelUnloaded(b,h);b=a[h.id].serviceContainer.children("[data-pixelSize='"+n+"']");h=b.children("div");if(!h.length){b.children("img").wrap('<div style="position:absolute; left:0; top:0; width:100%; height:100%;"></div>');h=b.children("div")}h.css({left:function(r,
z){return parseInt(z)+u},top:function(r,z){return parseInt(z)+t}})}},interactiveScale:function(b,h,u,t){if(a[h.id]){this._cancelUnloaded(b,h);var r=j.width,z=j.height,C=r/2,F=z/2;a[h.id].serviceContainer.children().each(function(){var x=d(this),B=x.attr("data-pixelSize"),K=B/t;x.css({width:r*K,height:z*K}).children("img").each(function(){var T=d(this),N=T.data("center");T.css({left:(Math.round((N[0]-u[0])/B)-C)*K+"px",top:(Math.round((u[1]-N[1])/B)-F)*K+"px"})})})}},refresh:function(b,h){if(h&&a[h.id]&&
(h.visible===E||h.visible)){this._cancelUnloaded(b,h);var u=b._getBbox(),t=n,r=a[h.id],z=r.serviceContainer,C=j.width,F=j.height,x=C/2,B=F/2,K=z.children('[data-pixelSize="'+t+'"]'),T=h.opacity===E?1:h.opacity;if(!K.size()){z.append('<div style="position:absolute; left:'+x+"px; top:"+B+"px; width:"+C+"px; height:"+F+'px; margin:0; padding:0;" data-pixelSize="'+t+'"></div>');K=z.children(":last")}K.children("img").each(function(){var N=d(this),O=N.data("center");N.css({left:Math.round((O[0]-o[0])/
t)-x+"px",top:Math.round((o[1]-O[1])/t)-B+"px"})});T<1&&z.find("img").attr("data-keepAlive","0");u=h.getUrl({bbox:u,width:C,height:F,zoom:b._getZoom(),tile:null,index:0});r.loadCount++;K.append('<img style="position:absolute; left:-'+x+"px; top:-"+B+'px; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />');K.children(":last").data("center",o).load(function(N){T<1?d(N.target).fadeTo(0,
T):d(N.target).show();r.loadCount--;if(r.loadCount<=0){z.children(':not([data-pixelSize="'+t+'"])').remove();N=z.find('[data-pixelSize="'+t+'"]>div');if(N.size()>0){var O=N.position();N.children("img").each(function(){var L=d(this),ca=O.left+parseInt(L.css("left")),R=O.top+parseInt(L.css("top"));L.css({left:ca+"px",top:R+"px"})}).unwrap();N.remove()}r.loadCount=0}}).error(function(N){d(N.target).remove();r.loadCount--;if(r.loadCount<=0){z.children(":not([data-pixelSize='"+t+"'])").remove();r.loadCount=
0}}).attr("src",u)}},_cancelUnloaded:function(b,h){var u=a[h.id];if(u&&u.loadCount>0)for(u.serviceContainer.find("img:hidden").remove();u.loadCount>0;)u.loadCount--}}}()}};d.widget("geo.geomap",function(){return{options:d.extend({},Y),_createWidget:function(a,b){A=a;J=d(b);this._forcePosition(J);J.css("text-align","left");var h=this._findMapSize();j={x:parseInt(J.css("padding-left")),y:parseInt(J.css("padding-top")),width:h.width,height:h.height};this._createChildren();o=w=[0,0];n=I=156543.03392799935;
M=H=D=V=ea=l=q=false;fa=Q=ba=ja=y=[0,0];ga=[0.8,0.8];na=aa=0;d.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){p=this.options;e=(ha="ontouchend"in document)||ma==7;var a=ha?"touchstart":"mousedown",b=ha?"touchend touchcancel":"mouseup",h=ha?"touchmove":"mousemove";s.dblclick(d.proxy(this._eventTarget_dblclick,this));s.bind(a,d.proxy(this._eventTarget_touchstart,this));a=s[0].setCapture?s:d(document);a.bind(h,d.proxy(this._dragTarget_touchmove,this));a.bind(b,d.proxy(this._dragTarget_touchstop,
this));s.mousewheel(d.proxy(this._eventTarget_mousewheel,this));c.geographics();if(A){A.bbox&&this._setOption("bbox",A.bbox,false);A.center&&this._setOption("center",A.center,false);A.zoom&&this._setZoom(A.zoom,false,false)}s.css("cursor",p.cursors[p.mode]);this._createServices();this._refresh()},_setOption:function(a,b,h){h=h===E||h;switch(a){case "bbox":if(d.geo.proj){b=d.geo.proj.fromGeodetic([[b[0],b[1]],[b[2],b[3]]]);b=[b[0][0],b[0][1],b[1][0],b[1][1]]}this._setBbox(b,false,h);b=this._getBbox();
if(d.geo.proj){b=d.geo.proj.toGeodetic([[b[0],b[1]],[b[2],b[3]]]);b=[b[0][0],b[0][1],b[1][0],b[1][1]]}break;case "center":this._setCenterAndSize(d.geo.proj?d.geo.proj.fromGeodetic([[b[0],b[1]]])[0]:b,n,false,h);break;case "zoom":this._setZoom(b,false,h)}d.Widget.prototype._setOption.apply(this,arguments);switch(a){case "services":this._createServices();h&&this._refresh()}},destroy:function(){d.Widget.prototype.destroy.apply(this,arguments);this.element.html("")},getPixelSize:function(){return n},
toMap:function(a){a=this._toMap(a);return d.geo.proj?d.geo.proj.toGeodetic(a):a},toPixel:function(a){a=d.geo.proj?d.geo.proj.fromGeodetic(a):a;return this._toPixel(a)},opacity:function(a,b){if(b>=0||b<=1){var h=this;d.each(g,function(){if(this.id==a){this.opacity=b;h._createServices();h._refresh();return false}})}},refresh:function(){this._refresh()},shapeStyle:function(a){if(a){c.geographics("option","style",a);this._refresh()}else return c.geographics("option","style")},append:function(a,b,h){h=
h===E||h;if(a){a=a.type=="FeatureCollection"?a.features:d.isArray(a)?a:[a];d.each(a,function(){v[v.length]={shape:this,style:b}});h&&this._refresh()}},empty:function(){v=[];this._refresh()},find:function(a,b){this.toPixel(a.coordinates);var h=n*b,u=[],t;d.each(v,function(){var r=d.geo._bbox(this.shape);if(d.geo._distance({type:"Polygon",coordinates:[[[r[0],r[1]],[r[0],r[3]],[r[2],r[3]],[r[2],r[1]],[r[0],r[1]]]]},a)<=h){r=d.geo._flatten(this.shape);for(t=0;t<r.length;t++)if(d.geo._distance(r[t],a)<=
h){u.push(this.shape);break}}});return u},remove:function(a){d.each(v,function(b){if(this.shape==a){var h=v.slice(b+1||v.length);v.length=b<0?v.length+b:b;v.push.apply(v,h);return false}});this._refresh()},_getBbox:function(){var a=j.width/2*n,b=j.height/2*n;return[o[0]-a,o[1]-b,o[0]+a,o[1]+b]},_setBbox:function(a,b,h){var u=[a[0]+(a[2]-a[0])/2,a[1]+(a[3]-a[1])/2];a=Math.max(d.geo._width(a)/j.width,d.geo._height(a)/j.height);if(p.tilingScheme)a=this._getTiledPixelSize(this._getTiledZoom(a));this._setCenterAndSize(u,
a,b,h)},_getBboxMax:function(){var a=j.width/2*I,b=j.height/2*I;return[w[0]-a,w[1]-b,w[0]+a,w[1]+b]},_getZoom:function(){if(p.tilingScheme)return this._getTiledZoom(n);else{var a=j.width/j.height,b=d.geo._reaspect(this._getBbox(),a);a=d.geo._reaspect(this._getBboxMax(),a);return Math.log(d.geo._width(a)/d.geo._width(b))/Math.log(2)}},_setZoom:function(a,b,h){a=Math.max(a,0);if(p.tilingScheme)this._setCenterAndSize(o,this._getTiledPixelSize(a),b,h);else{a=d.geo._scaleBy(this._getBbox(),1/Math.pow(2,
a));a=Math.max(d.geo._width(a)/j.width,d.geo._height(a)/j.height);this._setCenterAndSize(o,a,b,h)}},_createChildren:function(){var a=J.children().detach();this._forcePosition(a);a.css("-moz-user-select","none");J.prepend("<div style='position:absolute; left:"+j.x+"px; top:"+j.y+"px; width:"+j.width+"px; height:"+j.height+"px; margin:0; padding:0; overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;' unselectable='on'></div>");s=f=J.children(":first");
f.append('<div style="position:absolute; left:0; top:0; width:'+j.width+"px; height:"+j.height+'px; margin:0; padding:0;"></div>');k=f.children(":last");f.append('<div style="position:absolute; left:0; top:0; width:'+j.width+"px; height:"+j.height+'px; margin:0; padding:0;"></div>');c=f.children(":last");f.append('<div class="ui-widget ui-widget-content ui-corner-all" style="position:absolute; left:0; top:0px; max-width:128px; display:none;"><div style="margin:.2em;"></div></div>');m=f.children(":last");
m.children();f.append(a)},_createServices:function(){var a;for(a=0;a<g.length;a++)p._serviceTypes[g[a].type].destroy(this,g[a]);for(a=0;a<p.services.length;a++)p._serviceTypes[p.services[a].type].create(this,p.services[a],a);g=p.services},_drawGraphics:function(a,b,h){var u,t,r,z,C,F=this;for(u=0;u<b.length;u++){r=b[u].shape||b[u];r=r.geometry||r;z=d.isArray(h)?h[u].style:h;switch(r.type){case "Point":c.geographics("drawPoint",this.toPixel(r.coordinates),z);break;case "LineString":c.geographics("drawLineString",
this.toPixel(r.coordinates),z);break;case "Polygon":C=[];d.each(r.coordinates,function(x){C[x]=F.toPixel(this)});c.geographics("drawPolygon",C,z);break;case "MultiPoint":for(t=0;t<r.coordinates;t++)c.geographics("drawPoint",this.toPixel(r.coordinates[t]),z);break;case "MultiLineString":for(t=0;t<r.coordinates;t++)c.geographics("drawLineString",this.toPixel(r.coordinates[t]),z);break;case "MultiPolygon":for(t=0;t<r.coordinates;t++){C=[];d.each(r.coordinates[t],function(x){C[x]=F.toPixel(this)});c.geographics("drawPolygon",
C,z)}break;case "GeometryCollection":F._drawGraphics(a,r.geometries,z)}}},_findMapSize:function(){for(var a={width:0,height:0},b=J;b.size()&&!(a.width>0&&a.height>0);){a={width:b.width(),height:b.height()};if(a.width<=0||a.height<=0)a={width:parseInt(b.css("width")),height:parseInt(b.css("height"))};b=b.parent()}return a},_forcePosition:function(a){var b=a.css("position");b!="relative"&&b!="absolute"&&b!="fixed"&&a.css("position","relative")},_getTiledPixelSize:function(a){var b=p.tilingScheme;if(b!=
null){if(a===0)return b.pixelSizes!=null?b.pixelSizes[0]:b.basePixelSize;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,(b.pixelSizes!=null?b.pixelSizes.length:b.levels)-1);return b.pixelSizes!=null?b.pixelSizes[a]:b.basePixelSize/Math.pow(2,a)}else return NaN},_getTiledZoom:function(a){var b=p.tilingScheme;if(b.pixelSizes!=null){a=Math.round(a);for(var h=(b.pixelSizes!=null?b.pixelSizes.length:b.levels)-1;h>=0;h--)if(Math.round(b.pixelSizes[h])>=a)return h;return 0}else return Math.max(Math.round(Math.log(b.basePixelSize/
a)/Math.log(2)),0)},_getWheelCenterAndSize:function(){var a;if(p.tilingScheme){a=this._getTiledZoom(n)+P;a=this._getTiledPixelSize(a)}else{a=Math.pow(1.18920711500273,-P);a=n*a}var b=a/n,h=this._toMap(fa);b=[(o[0]-h[0])*b,(o[1]-h[1])*b];return{pixelSize:a,center:[h[0]+b[0],h[1]+b[1]]}},_mouseWheelFinish:function(){G=null;if(P!=0){var a=this._getWheelCenterAndSize();P=0;this._setCenterAndSize(a.center,a.pixelSize,true,true)}else this._refresh()},_panEnd:function(){y=[y[0]>0?Math.floor(y[0]*ga[0]):
Math.ceil(y[0]*ga[0]),y[1]>0?Math.floor(y[1]*ga[1]):Math.ceil(y[1]*ga[1])];if(Math.abs(y[0])<4&&Math.abs(y[1])<4)this._panFinalize();else{Q=[Q[0]+y[0],Q[1]+y[1]];this._panMove();setTimeout(d.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(ea){y=[0,0];var a=-(Q[0]-fa[0])*n,b=(Q[1]-fa[1])*n;c.css({left:0,top:0});this._setCenterAndSize([o[0]+a,o[1]+b],n,true,true);H=false;fa=Q;D=ea=false;s.css("cursor",p.cursors[p.mode])}},_panMove:function(){var a=Q[0]-ja[0],b=Q[1]-ja[1];if(D||a>3||a<-3||
b>3||b<-3){if(!D){D=true;s.css("cursor",p.cursors.pan)}if(M)y=[a,b];if(a!=0||b!=0){ea=true;ja=Q;for(i=0;i<p.services.length;i++){var h=p.services[i];p._serviceTypes[h.type].interactivePan(this,h,a,b)}c.css({left:function(u,t){return parseInt(t)+a},top:function(u,t){return parseInt(t)+b}})}}},_refresh:function(){for(var a=0;a<p.services.length;a++){var b=p.services[a];!M&&p._serviceTypes[b.type]!=null&&p._serviceTypes[b.type].refresh(this,b)}if(c){c.geographics("clear");v.length>0&&this._drawGraphics(c,
v,v)}},_setCenterAndSize:function(a,b,h,u){if(n!=b){c.geographics("clear");for(var t=0;t<p.services.length;t++){var r=p.services[t];p._serviceTypes[r.type].interactiveScale(this,r,a,b)}}o=a;n=b;if(d.geo.proj){a=this._getBbox();a=d.geo.proj.toGeodetic([[a[0],a[1]],[a[2],a[3]]]);a=[a[0][0],a[0][1],a[1][0],a[1][1]];p.bbox=a;p.center=d.geo.proj.toGeodetic([[o[0],o[1]]])[0]}else{p.bbox=this._getBbox();p.center=o}p.zoom=this._getZoom();h&&this._trigger("bboxchange",window.event,{bbox:p.bbox});u&&this._refresh()},
_toMap:function(a,b,h){var u=d.isArray(a[0]);u||(a=[a]);b=b||o;h=h||n;var t=j.width,r=j.height,z=t/2*h;h=r/2*h;var C=[b[0]-z,b[1]-h,b[0]+z,b[1]+h],F=d.geo._width(C)/t,x=d.geo._height(C)/r,B=[];d.each(a,function(K){B[K]=[C[0]+this[0]*F,C[3]-this[1]*x]});return u?B:B[0]},_toPixel:function(a,b,h){var u=d.isArray(a[0]);u||(a=[a]);b=b||o;h=h||n;var t=j.width,r=j.height,z=t/2*h;h=r/2*h;var C=[b[0]-z,b[1]-h,b[0]+z,b[1]+h],F=d.geo._width(C),x=d.geo._height(C),B=[];d.each(a,function(K){B[K]=[Math.round((this[0]-
C[0])*t/F),Math.round((C[3]-this[1])*r/x)]});return u?B:B[0]},_zoomTo:function(a,b,h,u){b=b<0?0:b;var t=this._getTiledPixelSize(b);if(isNaN(t)){b=d.geo._scaleBy(this._getBboxMax(),1/Math.pow(2,b));b=Math.max(d.geo._width(b)/j.width,d.geo._height(b)/j.height);this._setCenterAndSize(a,b,h,u)}else this._setCenterAndSize(a,t,h,u)},_eventTarget_dblclick:function(a){this._panFinalize();d(a.currentTarget).offset();switch(p.mode){case "pan":this._trigger("dblclick",a,{type:"Point",coordinates:this.toMap(Q)});
a.isDefaultPrevented()||this._zoomTo(this._toMap(Q),this._getZoom()+1,true,true)}H=false},_eventTarget_touchstart:function(a){if(!(!ha&&a.which!=1)){if(e){var b=d.now();q=b-na<750?q?false:l:false;l=true;na=b}a.preventDefault();this._panFinalize();this._mouseWheelFinish();b=d(a.currentTarget).offset();Q=ha?[a.originalEvent.changedTouches[0].pageX-b.left,a.originalEvent.changedTouches[0].pageY-b.top]:[a.pageX-b.left,a.pageY-b.top];M=true;fa=Q;if(!H&&a.shiftKey){V=true;s.css("cursor",p.cursors.zoom)}else{H=
true;switch(p.mode){case "pan":ja=Q;a.currentTarget.setCapture&&a.currentTarget.setCapture()}}return false}},_dragTarget_touchmove:function(a){var b=s.offset();b=ha?[a.originalEvent.changedTouches[0].pageX-b.left,a.originalEvent.changedTouches[0].pageY-b.top]:[a.pageX-b.left,a.pageY-b.top];if(!(b[0]==ba[0]&&b[1]==ba[1])){if(e)q=l=false;if(M){Q=b;d.now()}switch(V?"zoom":p.mode){case "pan":M||D?this._panMove():this._trigger("move",a,{type:"Point",coordinates:this.toMap(b)})}ba=b}},_dragTarget_touchstop:function(a){!M&&
ma==7&&this._eventTarget_touchstart(a);var b=M,h=D,u=s.offset();u=ha?[a.originalEvent.changedTouches[0].pageX-u.left,a.originalEvent.changedTouches[0].pageY-u.top]:[a.pageX-u.left,a.pageY-u.top];var t=V?"zoom":p.mode;s.css("cursor",p.cursors[t]);V=M=D=false;document.releaseCapture&&document.releaseCapture();if(b){b=d.now();Q=u;switch(t){case "pan":if(h)this._panEnd();else if(b-aa>100){this._trigger("click",a,{type:"Point",coordinates:this.toMap(u)});H=false}}aa=b;if(e&&q){q=l=false;s.trigger("dblclick",
a)}}},_eventTarget_mousewheel:function(a,b){a.preventDefault();this._panFinalize();if(!M){if(b!=0){if(G){window.clearTimeout(G);G=null}else{var h=d(a.currentTarget).offset();fa=[a.pageX-h.left,a.pageY-h.top]}P+=b;h=this._getWheelCenterAndSize();c.geographics("clear");for(i=0;i<p.services.length;i++){var u=p.services[i];p._serviceTypes[u.type].interactiveScale(this,u,h.center,h.pixelSize)}var t=this;G=window.setTimeout(function(){t._mouseWheelFinish()},1E3)}return false}}}}())})(jQuery);
