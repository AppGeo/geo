(function(d){function n(g){var e=[].slice.call(arguments,1),f=0;g=d.event.fix(g||window.event);g.type="mousewheel";if(g.wheelDelta)f=g.wheelDelta/120;if(g.detail)f=-g.detail/3;e.unshift(g,f);return d.event.handle.apply(this,e)}var y=["DOMMouseScroll","mousewheel"];d.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var g=y.length;g;)this.addEventListener(y[--g],n,false);else this.onmousewheel=n},teardown:function(){if(this.removeEventListener)for(var g=y.length;g;)this.removeEventListener(y[--g],
n,false);else this.onmousewheel=null}};d.fn.extend({mousewheel:function(g){return g?this.bind("mousewheel",g):this.trigger("mousewheel")},unmousewheel:function(g){return this.unbind("mousewheel",g)}})})(jQuery);
(function(d,n){var y=Array.prototype.slice,g=d.cleanData;d.cleanData=function(e){for(var f=0,h;(h=e[f])!=null;f++)d(h).triggerHandler("remove");g(e)};d.widget=function(e,f,h){var j=e.split(".")[0],q;e=e.split(".")[1];q=j+"-"+e;if(!h){h=f;f=d.Widget}d.expr[":"][q]=function(o){return!!d.data(o,e)};d[j]=d[j]||{};d[j][e]=d.extend(function(o,B){if(!this._createWidget)return new d[j][e](o,B);arguments.length&&this._createWidget(o,B)},d[j][e]);var t=new f;t.options=d.extend(true,{},t.options);d.each(h,function(o,
B){if(d.isFunction(B))h[o]=function(){var K=function(F){return f.prototype[F].apply(this,y.call(arguments,1))},J=function(F,v){return f.prototype[F].apply(this,v)};return function(){var F=this._super,v=this._superApply,C;this._super=K;this._superApply=J;C=B.apply(this,arguments);this._super=F;this._superApply=v;return C}}()});d[j][e].prototype=d.extend(true,t,{namespace:j,widgetName:e,widgetEventPrefix:e,widgetBaseClass:q},h);d.widget.bridge(e,d[j][e])};d.widget.bridge=function(e,f){d.fn[e]=function(h){var j=
typeof h==="string",q=y.call(arguments,1),t=this;h=!j&&q.length?d.extend.apply(null,[true,h].concat(q)):h;j?this.each(function(){var o=d.data(this,e);if(!o)return d.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+h+"'");if(!d.isFunction(o[h])||h.charAt(0)==="_")return d.error("no such method '"+h+"' for "+e+" widget instance");var B=o[h].apply(o,q);if(B!==o&&B!==n){t=B;return false}}):this.each(function(){var o=d.data(this,e);o?o.option(h||{})._init():f(h,
this)});return t}};d.Widget=function(e,f){if(!this._createWidget)return new d[namespace][name](e,f);arguments.length&&this._createWidget(e,f)};d.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:false},_createWidget:function(e,f){f=d(f||this.defaultElement||this)[0];this.element=d(f);this.options=d.extend(true,{},this.options,this._getCreateOptions(),e);this.bindings=d();this.hoverable=d();this.focusable=d();if(f!==this){d.data(f,this.widgetName,this);
this._bind({remove:"destroy"})}this._create();this._trigger("create");this._init()},_getCreateOptions:function(){return d.metadata&&d.metadata.get(this.element[0])[this.widgetName]},_create:d.noop,_init:d.noop,destroy:function(){this._destroy();this.element.unbind("."+this.widgetName).removeData(this.widgetName);this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled");this.bindings.unbind("."+this.widgetName);this.hoverable.removeClass("ui-state-hover");
this.focusable.removeClass("ui-state-focus")},_destroy:d.noop,widget:function(){return this.element},option:function(e,f){var h=e;if(arguments.length===0)return d.extend({},this.options);if(typeof e==="string"){if(f===n)return this.options[e];h={};h[e]=f}this._setOptions(h);return this},_setOptions:function(e){var f=this;d.each(e,function(h,j){f._setOption(h,j)});return this},_setOption:function(e,f){this.options[e]=f;if(e==="disabled"){this.widget().toggleClass(this.widgetBaseClass+"-disabled ui-state-disabled",
!!f).attr("aria-disabled",f);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")}return this},enable:function(){return this._setOption("disabled",false)},disable:function(){return this._setOption("disabled",true)},_bind:function(e,f){if(f){e=d(e);this.bindings=this.bindings.add(e)}else{f=e;e=this.element}var h=this;d.each(f,function(j,q){e.bind(j+"."+h.widgetName,function(){if(!(h.options.disabled===true||d(this).hasClass("ui-state-disabled")))return(typeof q===
"string"?h[q]:q).apply(h,arguments)})})},_hoverable:function(e){this.hoverable=this.hoverable.add(e);this._bind(e,{mouseenter:function(f){d(f.currentTarget).addClass("ui-state-hover")},mouseleave:function(f){d(f.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(e){this.focusable=this.focusable.add(e);this._bind(e,{focusin:function(f){d(f.currentTarget).addClass("ui-state-focus")},focusout:function(f){d(f.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(e,f,h){var j=
this.options[e];f=d.Event(f);f.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase();h=h||{};if(f.originalEvent){e=d.event.props.length;for(var q;e;){q=d.event.props[--e];f[q]=f.originalEvent[q]}}this.element.trigger(f,h);h=d.isArray(h)?[f].concat(h):[f,h];return!(d.isFunction(j)&&j.apply(this.element[0],h)===false||f.isDefaultPrevented())}}})(jQuery);
(function(d){d.geo={_center:function(n){return[(n[0]+n[2])/2,(n[1]+n[3])/2]},_expandBy:function(n,y,g){n=this._center(n);return[n[0]-y,n[1]-g,n[0]+y,n[1]+g]},_height:function(n){return n[3]-n[1]},_reaspect:function(n,y){var g=this._width(n),e=this._height(n),f=this._center(n);if(g==0||e==0||y<=0)return n;if(g/e>y){g=g/2;e=g/y}else{e=e/2;g=e*y}return[f[0]-g,f[1]-e,f[0]+g,f[1]+e]},_scaleBy:function(n,y){return this._expandBy(n,this._width(n)*y/2,this._height(n)*y/2)},_width:function(n){return n[2]-
n[0]},proj:function(){function n(e){return e>Math.PI?e-=y:e<-Math.PI?e+=y:e}var y=6.283185307179586;this.CoordinateSystem=function(e,f,h,j){if(arguments.length<2)f=0;if(arguments.length<3)h=0;if(arguments.length<4)j=1;switch(j){case "meters":j=1;break;case "feet":j=3.2808333333333333}this.toGeodetic=function(q){return e.toGeodetic({x:(q.x-f)/j,y:(q.y-h)/j})};this.toProjected=function(q){q=e.toProjected(q);return{x:q.x*j+f,y:q.y*j+h}}};this.Mercator=function(e,f,h){e*=0.017453292519943295;f*=0.017453292519943295;
var j=h.e*h.e,q=Math.sin(f),t=1/(Math.sqrt(1-j*q*q)/Math.cos(f));f=j*j;q=f*j;var o=q*j,B=j/2+5*f/24+q/12+13*o/360,K=7*f/48+29*q/240+811*o/11520,J=7*q/120+81*o/1120,F=4279*o/161280;this.toGeodetic=function(v){var C=n(e+v.x/(t*h.smaj));v=1.5707963267948966-2*Math.atan(1/Math.exp(v.y/(t*h.smaj)));return{x:C*57.29577951308232,y:(v+B*Math.sin(2*v)+K*Math.sin(4*v)+J*Math.sin(6*v)+F*Math.sin(8*v))*57.29577951308232}};this.toProjected=function(v){var C=v.y*0.017453292519943295,N=h.e*Math.sin(C);C=Math.tan(Math.PI/
4+C/2)*Math.pow((1-N)/(1+N),h.e/2);v=n(v.x*0.017453292519943295-e);return{x:t*h.smaj*v,y:t*h.smaj*Math.log(C)}}};this.Spheroid=function(e,f){switch(typeof e){case "number":this.smaj=e;this.e=f;break;case "string":switch(e){case "WGS84Sphere":this.smaj=6378137;this.e=0}}this.smin=this.smaj*Math.sqrt(1-this.e*this.e);var h=(this.smaj-this.smin)/this.smaj;this.distance=function(j,q,t){if(arguments.length<3)t=1;switch(t){case "meters":t=1;break;case "feet":t=3.2808333333333333}var o=j.y*0.017453292519943295,
B=q.y*0.017453292519943295,K=(o+B)*0.5,J=(o-B)*0.5,F=(j.x*0.017453292519943295-q.x*0.017453292519943295)*0.5;o=Math.sin(K);o*=o;K=Math.cos(K);K*=K;B=Math.sin(J);B*=B;J=Math.cos(J);J*=J;var v=Math.sin(F);v*=v;var C=Math.cos(F);C*=C;F=B*C+K*v;v=J*C+o*v;C=Math.atan(Math.sqrt(F/v));var N=Math.sqrt(F*v)/C;return 2*this.smaj*C*(1+h*((3*N-1)/(2*v)*o*J-(3*N+1)/(2*F)*K*B))*t}};var g=new Mercator(0,0,new Spheroid("WGS84Sphere"));return{fromGeodetic:function(e){var f=d.isArray(e[0]),h=[],j=0,q;for(f||(e=[e]);j<
e.length;j++){q=g.toProjected({x:e[j][0],y:e[j][1]});h[j]=[q.x,q.y]}return f?h:h[0]},toGeodetic:function(e){var f=d.isArray(e[0]),h=[],j=0,q;for(f||(e=[e]);j<e.length;j++){q=g.toGeodetic({x:e[j][0],y:e[j][1]});h[j]=[q.x,q.y]}return f?h:h[0]}}}()}})(jQuery,this);
(function(d,n){var y,g={},e,f,h,j,q=[],t,o,B,K,J=null,F=0,v,C,N,aa,Y,H,ga,ha,ea,ba,fa,O,ca,ka=function(){for(var a=5,b=document.createElement("div"),c=b.all||[];b.innerHTML="<!--[if gt IE "+ ++a+"]><br><![endif]--\>",c[0];);return a>6?a:!a}(),Z,ia=this._supportTouch||this._ieVersion==7,da,$,V={},s={},la={bbox:[-180,-85,180,85],bboxMax:[-180,-85,180,85],center:[0,0],cursors:{pan:"move"},mode:"pan",services:[{id:"OSM",type:"tiled",getUrl:function(a){return"http://tile.openstreetmap.org/"+a.zoom+"/"+
a.tile.column+"/"+a.tile.row+".png"},attr:"&copy; OpenStreetMap &amp; contributors, CC-BY-SA"}],tilingScheme:{tileWidth:256,tileHeight:256,levels:18,basePixelSize:156543.03392799935,origin:[-2.0037508342787E7,2.0037508342787E7]},zoom:0,_serviceTypes:{tiled:function(){var a={};return{create:function(b,c){if(!a[c.id]){a[c.id]={loadCount:0,reloadTiles:false,serviceContainer:null};f.append("<div data-service='"+c.id+"' style='position:absolute; left:0; top:0; width:8px; height:8px; margin:0; padding:0; display:"+
(c.visible===n||c.visible?"block":"none")+";'></div>");a[c.id].serviceContainer=f.children("[data-service='"+c.id+"']")}},destroy:function(b,c){a[c.id].serviceContainer.remove();delete a[c.id]},interactivePan:function(b,c,k,m){if(a[c.id]){this._cancelUnloaded(b,c);a[c.id].serviceContainer.children().css({left:function(U,ja){return parseInt(ja)+k},top:function(U,ja){return parseInt(ja)+m}});if(c&&a[c.id]!=null&&(c.visible===n||c.visible)){var l=o,u=a[c.id],x=u.serviceContainer,w=x.children("[data-pixelSize='"+
l+"']"),p=b.options.tilingScheme,r=p.tileWidth,z=p.tileHeight,L=g.width/2*l,D=g.height/2*l,E=w.position(),A=w.data("scaleOrigin").split(","),S=parseInt(A[0])-E.left;E=parseInt(A[1])-E.top;var G=t;A=[G[0]+S*l,G[1]-E*l];var P=Math.floor((A[0]-L-p.origin[0])/(l*r));S=Math.floor((p.origin[1]-(A[1]+D))/(l*z));E=Math.ceil((A[0]+L-p.origin[0])/(l*r));A=Math.ceil((p.origin[1]-(A[1]-D))/(l*z));var Q=b._getBboxMax(),M=b._getTiledPixelSize(0),I=M/l,R=Math.floor((Q[0]-p.origin[0])/(M*r))*I;Q=Math.floor((p.origin[1]-
Q[3])/(M*z))*I;L=Math.round((p.origin[0]+R*r*l-(G[0]-L))/l);D=Math.round((G[1]+D-(p.origin[1]-Q*z*l))/l);var W=c.opacity===n?1:c.opacity;for(G=P;G<E;G++)for(P=S;P<A;P++){M=""+G+","+P;I=w.children("[data-tile='"+M+"']").removeAttr("data-dirty");if(I.size()===0){var X=[p.origin[0]+G*r*l,p.origin[1]-P*z*l],T=[p.origin[0]+((G+1)*r-1)*l,p.origin[1]-((P+1)*z-1)*l];X=c.getUrl({bbox:[X[0],X[1],T[0],T[1]],width:r,height:z,zoom:b._getZoom(),tile:{row:P,column:G},index:Math.abs(P+G)});u.loadCount++;if(u.reloadTiles&&
I.size()>0)I.attr("src",X);else{I="<img style='position:absolute; left:"+((G-R)*100+(L-L%r)/r*100)+"%; top:"+((P-Q)*100+(D-D%z)/z*100)+"%; ";if(d("body")[0].filters===n)I+="width: 100%; height: 100%;";I+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+M+"' />";w.append(I);I=w.children(":last");I.load(function(U){W<1?d(U.target).fadeTo(0,W):d(U.target).show();u.loadCount--;if(u.loadCount<=
0){x.children(":not([data-pixelSize='"+l+"'])").remove();u.loadCount=0}}).error(function(U){d(U.target).remove();u.loadCount--;if(u.loadCount<=0){x.children(":not([data-pixelSize='"+l+"'])").remove();u.loadCount=0}}).attr("src",X)}}}}}},interactiveScale:function(b,c,k,m){if(a[c.id]){this._cancelUnloaded(b,c);var l=b.options.tilingScheme,u=l.tileWidth,x=l.tileHeight;a[c.id].serviceContainer.children().each(function(){var w=d(this),p=w.attr("data-pixelSize")/m;p=Math.round(p*1E3)/1E3;var r=w.data("scaleOrigin").split(",");
r=b._toMap([r[0],r[1]]);r=b._toPixel(r,k,m);w.css({left:Math.round(r[0])+"px",top:Math.round(r[1])+"px",width:u*p,height:x*p});d("body")[0].filters!==n&&w.children().each(function(){d(this).css("filter","progid:DXImageTransform.Microsoft.Matrix(FilterType=bilinear,M11="+p+",M22="+p+",sizingmethod='auto expand')")})})}},refresh:function(b,c){if(c&&a[c.id]&&(c.visible===n||c.visible)){this._cancelUnloaded(b,c);var k=b._getBbox(),m=o,l=a[c.id],u=l.serviceContainer,x=b.options.tilingScheme,w=x.tileWidth,
p=x.tileHeight,r=Math.floor((k[0]-x.origin[0])/(m*w)),z=Math.floor((x.origin[1]-k[3])/(m*p)),L=Math.ceil((k[2]-x.origin[0])/(m*w)),D=Math.ceil((x.origin[1]-k[1])/(m*p)),E=b._getBboxMax(),A=b._getTiledPixelSize(0),S=A/m,G=Math.floor((E[0]-x.origin[0])/(A*w))*S,P=Math.floor((x.origin[1]-E[3])/(A*p))*S,Q=Math.round((x.origin[0]+G*w*m-k[0])/m),M=Math.round((k[3]-(x.origin[1]-P*p*m))/m);k=u.children().show();E=k.filter("[data-pixelSize='"+m+"']").appendTo(u);var I=c.opacity===n?1:c.opacity;l.reloadTiles&&
k.find("img").attr("data-dirty","true");if(E.size()){E.css({left:Q%w+"px",top:M%p+"px"}).data("scaleOrigin",Q%w+","+M%p);E.children().each(function(){var T=d(this),U=T.attr("data-tile").split(",");T.css({left:Math.round((parseInt(U[0])-G)*100+(Q-Q%w)/w*100)+"%",top:Math.round((parseInt(U[1])-P)*100+(M-M%p)/p*100)+"%"});I<1&&T.fadeTo(0,I)})}else{u.append("<div style='position:absolute; left:"+Q%w+"px; top:"+M%p+"px; width:"+w+"px; height:"+p+"px; margin:0; padding:0;' data-pixelSize='"+m+"'></div>");
E=u.children(":last").data("scaleOrigin",Q%w+","+M%p)}for(r=r;r<L;r++)for(A=z;A<D;A++){S=""+r+","+A;var R=E.children("[data-tile='"+S+"']").removeAttr("data-dirty");if(R.size()===0||l.reloadTiles){var W=[x.origin[0]+r*w*m,x.origin[1]-A*p*m],X=[x.origin[0]+((r+1)*w-1)*m,x.origin[1]-((A+1)*p-1)*m];W=c.getUrl({bbox:[W[0],W[1],X[0],X[1]],width:w,height:p,zoom:b._getZoom(),tile:{row:A,column:r},index:Math.abs(A+r)});l.loadCount++;if(l.reloadTiles&&R.size()>0)R.attr("src",W);else{R="<img style='position:absolute; left:"+
((r-G)*100+(Q-Q%w)/w*100)+"%; top:"+((A-P)*100+(M-M%p)/p*100)+"%; ";if(d("body")[0].filters===n)R+="width: 100%; height: 100%;";R+="margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;' unselectable='on' data-tile='"+S+"' />";E.append(R);R=E.children(":last");R.load(function(T){I<1?d(T.target).fadeTo(0,I):d(T.target).show();l.loadCount--;if(l.loadCount<=0){u.children(":not([data-pixelSize='"+m+"'])").remove();l.loadCount=0}}).error(function(T){d(T.target).remove();
l.loadCount--;if(l.loadCount<=0){u.children(":not([data-pixelSize='"+m+"'])").remove();l.loadCount=0}}).attr("src",W)}}}k.find("[data-dirty]").remove();l.reloadTiles=false}},_cancelUnloaded:function(b,c){var k=a[c.id];if(k&&k.loadCount>0)for(k.serviceContainer.find("img:hidden").remove();k.loadCount>0;)k.loadCount--}}}(),shingled:function(){var a={};return{create:function(b,c){if(!a[c.id]){a[c.id]={loadCount:0};f.append('<div data-service="'+c.id+'" style="position:absolute; left:0; top:0; width:16px; height:16px; margin:0; padding:0; display:'+
(c.visible===n||c.visible?"block":"none")+';"></div>');a[c.id].serviceContainer=f.children('[data-service="'+c.id+'"]')}},destroy:function(b,c){a[c.id].serviceContainer.remove();delete a[c.id]},interactivePan:function(b,c,k,m){if(a[c.id]){this._cancelUnloaded(b,c);b=a[c.id].serviceContainer.children("[data-pixelSize='"+o+"']");c=b.children("div");if(!c.length){b.children("img").wrap('<div style="position:absolute; left:0; top:0; width:100%; height:100%;"></div>');c=b.children("div")}c.css({left:function(l,
u){return parseInt(u)+k},top:function(l,u){return parseInt(u)+m}})}},interactiveScale:function(b,c,k,m){if(a[c.id]){this._cancelUnloaded(b,c);var l=g.width,u=g.height,x=l/2,w=u/2;a[c.id].serviceContainer.children().each(function(){var p=d(this),r=p.attr("data-pixelSize"),z=r/m;p.css({width:l*z,height:u*z}).children("img").each(function(){var L=d(this),D=L.data("center");L.css({left:(Math.round((D[0]-k[0])/r)-x)*z+"px",top:(Math.round((k[1]-D[1])/r)-w)*z+"px"})})})}},refresh:function(b,c){if(c&&a[c.id]&&
(c.visible===n||c.visible)){this._cancelUnloaded(b,c);var k=b._getBbox(),m=o,l=a[c.id],u=l.serviceContainer,x=g.width,w=g.height,p=x/2,r=w/2,z=u.children('[data-pixelSize="'+m+'"]'),L=c.opacity===n?1:c.opacity;if(!z.size()){u.append('<div style="position:absolute; left:'+p+"px; top:"+r+"px; width:"+x+"px; height:"+w+'px; margin:0; padding:0;" data-pixelSize="'+m+'"></div>');z=u.children(":last")}z.children("img").each(function(){var D=d(this),E=D.data("center");D.css({left:Math.round((E[0]-t[0])/
m)-p+"px",top:Math.round((t[1]-E[1])/m)-r+"px"})});L<1&&u.find("img").attr("data-keepAlive","0");k=c.getUrl({bbox:k,width:x,height:w,zoom:b._getZoom(),tile:null,index:0});l.loadCount++;z.append('<img style="position:absolute; left:-'+p+"px; top:-"+r+'px; width:100%; height:100%; margin:0; padding:0; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none; display:none;" unselectable="on" />');z.children(":last").data("center",t).load(function(D){L<1?d(D.target).fadeTo(0,
L):d(D.target).show();l.loadCount--;if(l.loadCount<=0){u.children(':not([data-pixelSize="'+m+'"])').remove();D=u.find('[data-pixelSize="'+m+'"]>div');if(D.size()>0){var E=D.position();D.children("img").each(function(){var A=d(this),S=E.left+parseInt(A.css("left")),G=E.top+parseInt(A.css("top"));A.css({left:S+"px",top:G+"px"})}).unwrap();D.remove()}l.loadCount=0}}).error(function(D){d(D.target).remove();l.loadCount--;if(l.loadCount<=0){u.children(":not([data-pixelSize='"+m+"'])").remove();l.loadCount=
0}}).attr("src",k)}},_cancelUnloaded:function(b,c){var k=a[c.id];if(k&&k.loadCount>0)for(k.serviceContainer.find("img:hidden").remove();k.loadCount>0;)k.loadCount--}}}()}};d.widget("geo.geomap",function(){return{options:d.extend({},la),_createWidget:function(a,b){V=a;y=d(b);var c=y.css("position");c!="relative"&&c!="absolute"&&c!="fixed"&&y.css("position","relative");y.css("text-align","left");c=this._findMapSize();g={x:parseInt(y.css("padding-left")),y:parseInt(y.css("padding-top")),width:c.width,
height:c.height};this._createChildren();t=B=[0,0];o=K=156543.03392799935;v=C=N=aa=fa=da=$=false;Y=H=ea=ba=O=[0,0];ca=[0.8,0.8];ga=ha=0;d.Widget.prototype._createWidget.apply(this,arguments)},_create:function(){s=this.options;var a=(Z="ontouchend"in document)?"touchstart":"mousedown",b=Z?"touchend touchcancel":"mouseup",c=Z?"touchmove":"mousemove";j.dblclick(d.proxy(this._eventTarget_dblclick,this));j.bind(a,d.proxy(this._eventTarget_touchstart,this));a=j[0].setCapture?j:d(document);a.bind(c,d.proxy(this._dragTarget_touchmove,
this));a.bind(b,d.proxy(this._dragTarget_touchstop,this));j.mousewheel(d.proxy(this._eventTarget_mousewheel,this));if(V){V.bbox&&this._setOption("bbox",V.bbox,false);V.center&&this._setOption("center",V.center,false);V.zoom&&this._setZoom(V.zoom,false,false)}j.css("cursor",s.cursors[s.mode]);this._createServices();this._refresh()},_setOption:function(a,b,c){c=c===n||c;switch(a){case "bbox":if(d.geo.proj){b=d.geo.proj.fromGeodetic([[b[0],b[1]],[b[2],b[3]]]);b=[b[0][0],b[0][1],b[1][0],b[1][1]]}this._setBbox(b,
false,c);b=this._getBbox();if(d.geo.proj){b=d.geo.proj.toGeodetic([[b[0],b[1]],[b[2],b[3]]]);b=[b[0][0],b[0][1],b[1][0],b[1][1]]}break;case "center":this._setCenterAndSize(d.geo.proj?d.geo.proj.fromGeodetic([[b[0],b[1]]])[0]:b,o,false,c);break;case "zoom":this._setZoom(b,false,c)}d.Widget.prototype._setOption.apply(this,arguments);switch(a){case "services":this._createServices();c&&this._refresh()}},destroy:function(){d.Widget.prototype.destroy.apply(this,arguments);this.element.html("")},getPixelSize:function(){return o},
toMap:function(a){a=this._toMap(a);return d.geo.proj?d.geo.proj.toGeodetic(a):a},toPixel:function(a){a=d.geo.proj?d.geo.proj.fromGeodetic(a):a;return this._toPixel(a)},_getBbox:function(){var a=g.width/2*o,b=g.height/2*o;return[t[0]-a,t[1]-b,t[0]+a,t[1]+b]},_setBbox:function(a,b,c){var k=[a[0]+(a[2]-a[0])/2,a[1]+(a[3]-a[1])/2];a=Math.max(d.geo._width(a)/g.width,d.geo._height(a)/g.height);if(s.tilingScheme)a=this._getTiledPixelSize(this._getTiledZoom(a));this._setCenterAndSize(k,a,b,c)},_getBboxMax:function(){var a=
g.width/2*K,b=g.height/2*K;return[B[0]-a,B[1]-b,B[0]+a,B[1]+b]},_getZoom:function(){if(s.tilingScheme)return this._getTiledZoom(o);else{var a=g.width/g.height,b=d.geo._reaspect(this._getBbox(),a);a=d.geo._reaspect(this._getBboxMax(),a);return Math.log(d.geo._width(a)/d.geo._width(b))/Math.log(2)}},_setZoom:function(a,b,c){a=Math.max(a,0);if(s.tilingScheme)this._setCenterAndSize(t,this._getTiledPixelSize(a),b,c);else{a=d.geo._scaleBy(this._getBbox(),1/Math.pow(2,a));a=Math.max(d.geo._width(a)/g.width,
d.geo._height(a)/g.height);this._setCenterAndSize(t,a,b,c)}},_createChildren:function(){var a=y.children().detach();a.css("-moz-user-select","none");y.prepend("<div style='position:absolute; left:"+g.x+"px; top:"+g.y+"px; width:"+g.width+"px; height:"+g.height+"px; margin:0; padding:0; overflow:hidden; -khtml-user-select:none; -moz-user-select:none; -webkit-user-select:none; user-select:none;' unselectable='on'></div>");j=e=y.children(":first");e.append('<div style="position:absolute; left:0; top:0; width:'+
g.width+"px; height:"+g.height+'px; margin: 0; padding: 0;"></div>');f=e.children(":last");e.append('<div style="position:absolute; left:0; top:0; width:'+g.width+"px; height:"+g.height+'px; margin: 0; padding: 0;"></div>');e.children(":last");e.append('<div class="ui-widget ui-widget-content ui-corner-all" style="position:absolute; left:0; top:0px; max-width:128px; display:none;"><div style="margin:.2em;"></div></div>');h=e.children(":last");h.children();e.append(a)},_createServices:function(){var a;
for(a=0;a<q.length;a++)s._serviceTypes[q[a].type].destroy(this,q[a]);for(a=0;a<s.services.length;a++)s._serviceTypes[s.services[a].type].create(this,s.services[a],a);q=s.services},_findMapSize:function(){for(var a={width:0,height:0},b=y;b.size()&&!(a.width>0&&a.height>0);){a={width:b.width(),height:b.height()};if(a.width<=0||a.height<=0)a={width:parseInt(b.css("width")),height:parseInt(b.css("height"))};b=b.parent()}return a},_getTiledPixelSize:function(a){var b=s.tilingScheme;if(b!=null){if(a===
0)return b.pixelSizes!=null?b.pixelSizes[0]:b.basePixelSize;a=Math.round(a);a=Math.max(a,0);a=Math.min(a,(b.pixelSizes!=null?b.pixelSizes.length:b.levels)-1);return b.pixelSizes!=null?b.pixelSizes[a]:b.basePixelSize/Math.pow(2,a)}else return NaN},_getTiledZoom:function(a){var b=s.tilingScheme;if(b.pixelSizes!=null){a=Math.round(a);for(var c=(b.pixelSizes!=null?b.pixelSizes.length:b.levels)-1;c>=0;c--)if(Math.round(b.pixelSizes[c])>=a)return c;return 0}else return Math.max(Math.round(Math.log(b.basePixelSize/
a)/Math.log(2)),0)},_getWheelCenterAndSize:function(){var a;if(s.tilingScheme){a=this._getTiledZoom(o)+F;a=this._getTiledPixelSize(a)}else{a=Math.pow(1.18920711500273,-F);a=o*a}var b=a/o,c=this._toMap(Y);b=[(t[0]-c[0])*b,(t[1]-c[1])*b];return{pixelSize:a,center:[c[0]+b[0],c[1]+b[1]]}},_mouseWheelFinish:function(){J=null;if(F!=0){var a=this._getWheelCenterAndSize();F=0;this._setCenterAndSize(a.center,a.pixelSize,true,true)}else this._refresh()},_panEnd:function(){O=[O[0]>0?Math.floor(O[0]*ca[0]):Math.ceil(O[0]*
ca[0]),O[1]>0?Math.floor(O[1]*ca[1]):Math.ceil(O[1]*ca[1])];if(Math.abs(O[0])<4&&Math.abs(O[1])<4)this._panFinalize();else{H=[H[0]+O[0],H[1]+O[1]];this._panMove();setTimeout(d.proxy(this._panEnd,this),30)}},_panFinalize:function(){if(fa){O=[0,0];this._setCenterAndSize([t[0]+-(H[0]-Y[0])*o,t[1]+(H[1]-Y[1])*o],o,true,true);C=false;Y=H;N=fa=false;j.css("cursor",s.cursors[s.mode])}},_panMove:function(){var a=H[0]-ba[0],b=H[1]-ba[1];if(N||a>3||a<-3||b>3||b<-3){if(!N){N=true;j.css("cursor",s.cursors.pan)}if(v)O=
[a,b];if(a!=0||b!=0){fa=true;ba=H;for(i=0;i<s.services.length;i++){var c=s.services[i];s._serviceTypes[c.type].interactivePan(this,c,a,b)}}}},_refresh:function(){for(var a=0;a<s.services.length;a++){var b=s.services[a];!v&&s._serviceTypes[b.type]!=null&&s._serviceTypes[b.type].refresh(this,b)}},_setCenterAndSize:function(a,b,c,k){if(o!=b)for(var m=0;m<s.services.length;m++){var l=s.services[m];s._serviceTypes[l.type].interactiveScale(this,l,a,b)}t=a;o=b;if(d.geo.proj){a=this._getBbox();a=d.geo.proj.toGeodetic([[a[0],
a[1]],[a[2],a[3]]]);a=[a[0][0],a[0][1],a[1][0],a[1][1]];s.bbox=a;s.center=d.geo.proj.toGeodetic([[t[0],t[1]]])[0]}else{s.bbox=this._getBbox();s.center=t}s.zoom=this._getZoom();c&&this._trigger("bboxchange",window.event,{bbox:s.bbox});k&&this._refresh()},_toMap:function(a,b,c){var k=d.isArray(a[0]);k||(a=[a]);b=b||t;c=c||o;var m=g.width,l=g.height,u=m/2*c;c=l/2*c;var x=[b[0]-u,b[1]-c,b[0]+u,b[1]+c],w=d.geo._width(x)/m,p=d.geo._height(x)/l,r=[];d.each(a,function(z){r[z]=[x[0]+this[0]*w,x[3]-this[1]*
p]});return k?r:r[0]},_toPixel:function(a,b,c){var k=d.isArray(a[0]);k||(a=[a]);b=b||t;c=c||o;var m=g.width,l=g.height,u=m/2*c;c=l/2*c;var x=[b[0]-u,b[1]-c,b[0]+u,b[1]+c],w=d.geo._width(x),p=d.geo._height(x),r=[];d.each(a,function(z){r[z]=[(this[0]-x[0])*m/w,(x[3]-this[1])*l/p]});return k?r:r[0]},_zoomTo:function(a,b,c,k){b=b<0?0:b;var m=this._getTiledPixelSize(b);if(isNaN(m)){b=d.geo._scaleBy(this._getBboxMax(),1/Math.pow(2,b));b=Math.max(d.geo._width(b)/g.width,d.geo._height(b)/g.height);this._setCenterAndSize(a,
b,c,k)}else this._setCenterAndSize(a,m,c,k)},_eventTarget_dblclick:function(a){this._panFinalize();d(a.currentTarget).offset();switch(s.mode){case "pan":this._trigger("dblclick",a,{pixels:H,coordinates:this.toMap(H)});a.isDefaultPrevented()||this._zoomTo(this._toMap(H),this._getZoom()+1,true,true)}C=false},_eventTarget_touchstart:function(a){if(!(!Z&&a.which!=1)){if(ia){var b=d.now();$=b-ga<750?$?false:da:false;da=true;ga=b}a.preventDefault();this._panFinalize();this._mouseWheelFinish();b=d(a.currentTarget).offset();
H=Z?[a.originalEvent.changedTouches[0].pageX-b.left,a.originalEvent.changedTouches[0].pageY-b.top]:[a.pageX-b.left,a.pageY-b.top];v=true;Y=H;if(!C&&a.shiftKey){aa=true;j.css("cursor",s.cursors.zoom)}else{C=true;switch(s.mode){case "pan":ba=H;a.currentTarget.setCapture&&a.currentTarget.setCapture()}}return false}},_dragTarget_touchmove:function(a){var b=j.offset();b=Z?[a.originalEvent.changedTouches[0].pageX-b.left,a.originalEvent.changedTouches[0].pageY-b.top]:[a.pageX-b.left,a.pageY-b.top];if(!(b[0]==
ea[0]&&b[1]==ea[1])){if(ia)$=da=false;if(v){H=b;d.now()}switch(aa?"zoom":s.mode){case "pan":v||N?this._panMove():this._trigger("move",a,{pixels:b,coordinates:this.toMap(b)})}ea=b}},_dragTarget_touchstop:function(a){!v&&ka==7&&this._eventTarget_touchstart(a);var b=v,c=N,k=j.offset();k=Z?[a.originalEvent.changedTouches[0].pageX-k.left,a.originalEvent.changedTouches[0].pageY-k.top]:[a.pageX-k.left,a.pageY-k.top];var m=aa?"zoom":s.mode;j.css("cursor",s.cursors[m]);aa=v=N=false;document.releaseCapture&&
document.releaseCapture();if(b){b=d.now();H=k;switch(m){case "pan":if(c)this._panEnd();else if(b-ha>100){this._trigger("click",a,{pixels:k,coordinates:this.toMap(k)});C=false}}ha=b;if(ia&&$){$=da=false;j.trigger("dblclick",a)}}},_eventTarget_mousewheel:function(a,b){a.preventDefault();this._panFinalize();if(!v){if(b!=0){if(J){window.clearTimeout(J);J=null}else{var c=d(a.currentTarget).offset();Y=[a.pageX-c.left,a.pageY-c.top]}F+=b;c=this._getWheelCenterAndSize();for(i=0;i<s.services.length;i++){var k=
s.services[i];s._serviceTypes[k.type].interactiveScale(this,k,c.center,c.pixelSize)}var m=this;this._wheelTimer=window.setTimeout(function(){m._mouseWheelFinish()},1E3)}return false}}}}())})(jQuery);
